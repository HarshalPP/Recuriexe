const {
  success,
  unknownError,
  serverValidation,
  badRequest,
  notFound,
  parseJwt,
  badRequestwitherror
} = require("../../../../globalHelper/response.globalHelper");
const { validationResult } = require("express-validator");
const mongoose = require("mongoose");
const ObjectId = mongoose.Types.ObjectId;
const moment = require("moment-timezone");
const { PDFDocument } = require("pdf-lib");
const employeModel = require("../model/adminMaster/employe.model.js");
const coApplicantModel = require("../model/co-Applicant.model");
const applicantModel = require("../model/applicant.model.js");
const guarantorModel = require("../model/guarantorDetail.model");
const referenceModel = require("../model/reference.model");
const customerModel = require("../model/customer.model");
const bankAccountModel = require("../model/banking.model");
const vendorModel = require("../model/adminMaster/vendor.model.js")
const vendorTypeModel = require("../model/adminMaster/vendorType.model.js")
const bankModel = require("../model/bankAccount.model.js");
const productModel = require("../model/adminMaster/product.model");
const processModel = require("../model/process.model.js");
const cibilModel = require("../model/cibilDetail.model.js");
const { createOrder } = require("../services/razorpay.js");
const salesCaseModel = require("../model/salesCase.model.js");
const { updateFileFields } = require("./functions.Controller.js");
const aadharModel = require("../model/aadhaar.model.js");
const aadharOcrModel = require("../model/aadhaarOcr.model.js");
const panFatherModel = require("../model/panFather.model.js");
const panComprehensiveModel = require("../model/panComprehensive.model.js");
const permissionModel = require("../model/adminMaster/permissionForm.model.js");
const leadGenerateModel = require("../model/leadGenerate.model.js");
const employeeModel = require("../model/adminMaster/employe.model.js");
// const branchModel = require("../model/adminMaster/branch.model.js");
const newBranchModel = require("../model/adminMaster/newBranch.model.js");
const creditPdModel = require("../model/credit.Pd.model.js");
const { paginationData } = require("../helper/pagination.helper.js");
const udyamModel = require("../model/branchPendency/udhyamKyc.model.js");
const gtrPdcModel = require("../model/branchPendency/gtrPdc.model.js");
const appPdcModel = require("../model/branchPendency/appPdc.model.js");
const approverFormModel = require("../model/branchPendency/approverTechnicalFormModel.js");
const electricityKycModel = require("../model/branchPendency/electricityKyc.model.js");
const samagraIdModel = require("../model/branchPendency/samagraIdKyc.model.js");
const udhyamKycModel = require("../model/branchPendency/udhyamKyc.model.js");
const bankStatementModel = require("../model/branchPendency/bankStatementKyc.model.js");
const salaryAndOtherIncomeModel = require("../model/branchPendency/salaryAndOtherIncomeModel.js");
const milkIncomeModel = require("../model/branchPendency/milkIncomeModel.js");
const otherBuisnessModel = require("../model/branchPendency/otherBusinessModel.js");
const propertyPaperKycModel = require("../model/branchPendency/propertyPaper.model.js");
const nachRegistrationKyModel = require("../model/branchPendency/nachRegistration.model.js");
const physicalFileCourierModel = require("../model/physicalFileCourier.model.js");
const rmPaymentUpdateModel = require("../model/branchPendency/rmPaymentUpdateModel.js");
const agricultureModel = require("../model/branchPendency/agricultureIncomeModel.js");
const externalVendorFormModel = require("../model/externalManager/externalVendorDynamic.model.js");
const technicalApproveFormModel = require("../model/branchPendency/approverTechnicalFormModel.js");
const tvrModel = require("../model/fileProcess/tvr.model.js");
// const finalSanctionModel = require("../model/fileProcess/finalSanction.model.js");
const final = require("../model/finalSanction/finalSnction.model.js");
const legalReportModel = require("../model/branchPendency/approveLegalForm.model.js");
const esignPhotoModel = require("../model/branchPendency/esignPhoto.model.js");
const disbursementModel = require("../model/fileProcess/disbursement.model.js");
const jinamEntryModel = require("../model/fileProcess/jinamEntry.model.js");
const fileEnventoryModel = require("../model/fileProcess/fileEnventory.model.js");
const camReportModel = require("../model/fileProcess/camReport.model.js");
const lendersModel = require("../model/lender.model.js");
const finalModel = require("../model/finalSanction/finalSnction.model.js");
const SignKycModel = require("../model/branchPendency/signkyc.model.js");
const lenderDocumentModel = require("../model/lenderDocument.model.js");
const sanctionPendencyModel = require("../model/finalApproval/sanctionPendency.model.js");
const newfinalSanctionModel = require("../model/finalSanction/finalSnction.model.js");
const internalLegalModel = require("../model/finalApproval/internalLegal.model.js");
const customerDocumentModel = require("../model/customerPropertyDetail.model.js");
const documentQueryModel = require("../model/finalApproval/documentQuery.model.js");
const decisionModel = require("../model/finalApproval/decision.model.js");
const guarantorStatementDetails = require("../model/branchPendency/gurrantorbankStatment.model.js");
const bankDeatilsKycs = require('../model/branchPendency/bankStatementKyc.model');
const { ratnaEmDeedPdf } = require('./ratnaaFin/emDeed.controller')

// const finalScantionModel = require("../model/fileProcess/finalSanction.model");
const queryFormModel = require("../model/queryForm.model.js");
const { sendEmail } = require("../controller/functions.Controller.js");
const uploadToSpaces = require('../services/spaces.service');

const { mailSendPartnerToSanction } = require('../controller/MailFunction/finalApprovalMail.js')

const {sendEmailByVendor} = require("./functions.Controller.js")
const {
  sectionLatter,
} = require("../controller/ratnaaFin/sectionLatter.controller.js");
const {
  applicantLatter,
} = require("../controller/ratnaaFin/newApplicant.controller.js");
const {
  incomesectionLatter,
} = require("../controller/ratnaaFin/IncomeSanctionLetter.controller.js");
const {
  ratnaDobSignForm,
} = require("../controller/ratnaaFin/ratnaDobSign.controller.js");
const {
  growDualNamepdf,
} = require("../controller/growMoneyPdf/dualName.controller.js");
const {
  growSignaturepdf,
} = require("../controller/growMoneyPdf/growSignature.controller.js");
const {
  rcplLoanAgreement,
} = require("../controller/growMoneyPdf/rcplLoanAggrement.js");
const {
  LdAndPdDeed,
} = require("../controller/ratnaaFin/loanDocument.controller.js");
const {
  legalPdf,
} = require("../controller/legalTechnicalPdfs/legal.controller.js");
const {
  finallegalPdf,
} = require("../controller/legalTechnicalPdfs/finalLegal.controller.js");
const {
  vettingPdf,
} = require("../controller/legalTechnicalPdfs/vetting.controller.js");
const {
  sevenPagerpdf,
} = require("../controller/legalTechnicalPdfs/SevenPagerLegal.controller.js");
const {
  sevenPagervettingPdf,
} = require("../controller/legalTechnicalPdfs/sevenPagerVetting.controller.js");
const {
  BtsevenPagerLegalpdf,
} = require("../controller/legalTechnicalPdfs/btSevenPagerLegal.controller.js");
const {
  bt7PagervettingPdf,
} = require("../controller/legalTechnicalPdfs/bt7pagerVetting.controller.js");
const {
  executedvettingPdf,
} = require("../controller/legalTechnicalPdfs/executedVetting.controller.js");
const {
  executedfinallegalPdf,
} = require("../controller/legalTechnicalPdfs/executedFinalLegal.controller.js");
const {
  btexecutedvettingPdf,
} = require("../controller/legalTechnicalPdfs/btexecutedVetting.controller.js");
const {
  btexecutedfinallegalPdf,
} = require("../controller/legalTechnicalPdfs/btexecutedFinalLegal.controller.js");

const {
  namDevApplicantLatter,
} = require("../controller/naamDevPdfs/nammDevApplicantLatter.controller.js");

const {
  namdevSectionLatter,
} = require("../controller/naamDevPdfs/naamdevSectionLatter.controller.js");

const {
  namdevLoanPdf,
} = require("../controller/naamDevPdfs/namdevLoan.controller.js");
const { uploadZip } = require("../controller/adminMaster/server.controller.js");
const btDetailsModel = require("../model/finalApproval/btBankDetail.model");



const axios = require("axios");
const path = require("path");
const fs = require("fs");
const FormData = require("form-data");
const { initESign } = require("../services/legality.services.js");
const FinpdfLogo = path.join(
  __dirname,
  "../../../../assets/image/FINCOOPERSLOGO.png"
);
const RatnapdfLogo = path.join(
  __dirname,
  "../../../../assets/image/image_1727359738344.file_1727075312891.ratnaafin (1).png"
);
const growPdfLogo = path.join(
  __dirname,
  "../../../../assets/image/gmcpl logo.png"
);
const {
  growPgDeedPdf,
} = require("../controller/growMoneyPdf/pdDeed.contorller.js");
const {
  growSanctionLetterPdf,
} = require("../controller/growMoneyPdf/sanctionLetter.controller.js");
const {
  growApplicantPdf,
} = require("../controller/growMoneyPdf/aplication.controller.js");
const {
  FincooperPgDeedPdf,
} = require("../controller/fincoopersPdf/pdDeed.contorller.js");
const {
  FincooperApplicantionPdf,
} = require("./fincoopersPdf/aplication.controller.js");
const {
  FincooperLoanAgreement,
} = require("../controller/fincoopersPdf/finLoanAggrement.controller.js");
const {
  FincooperSanctionLetterPdf,
} = require("../controller/fincoopersPdf/sanctionLetter.controller.js");

const {
  GmRmDeedPdf,
} = require("../controller/growMoneyPdf/rmDeed.controller.js");
const {
  GmemDeedPdf,
} = require("../controller/growMoneyPdf/emDeed.controller.js");

const {
  fcplRmDeedPdf} = require("../controller/fincoopersPdf/fcplrmdeeDeed.comtroller.js");
const { google } = require("googleapis");
const credentials = require("../../../../liveSheet.json");
const loanDocumentModel = require("../model/finalApproval/allDocument.model.js");
const lenderModel = require("../model/lender.model.js");
const ExcelJS = require("exceljs");
// const {finalApprovalSheet} = require("../controller/googleSheet.controller.js");
require('dotenv').config();

const {finalApprovalSheet,fileProcessSheet } = require("../controller/finalSanction/faGoogleSheet.controller.js");

// --------Dission box ---------

const DissionBox = async (data) => {
  console.log("Data:", data);

  // Destructure the data with default values set to "pending" if not provided
  const {
    customerId,
    employeeId,
    SendtoPatner,
    finalSanction,
    IncomeSanction,
    preDisbusment,
    postDisbusment,
  } = data;
  try {
    if (!customerId) {
      return {
        status: false,
        message: "customerId is required to create or update the document.",
      };
    }

    // Check if the document already exists
    const existingData = await decisionModel.findOne({ customerId });
    console.log("Existing Data:", existingData);

    // Prepare fields for update, using upcoming data or fallback to existing data
    const updateFields = {
      SendtoPatner: SendtoPatner || existingData?.SendtoPatner || "pending",
      finalSanction: finalSanction || existingData?.finalSanction || "pending",
      IncomeSanction:
        IncomeSanction || existingData?.IncomeSanction || "pending",
      preDisbusment: preDisbusment || existingData?.preDisbusment || "pending",
      postDisbusment:
        postDisbusment || existingData?.postDisbusment || "pending",
    };

    // Update or insert the document
    const result = await decisionModel.findOneAndUpdate(
      { customerId }, // Match by customerId
      {
        $set: updateFields, // Update the provided fields
        $setOnInsert: { employeeId }, // Set employeeId if inserting a new document
      },
      { new: true, upsert: true } // Return the new document after update/insert
    );

    // Return success response
    return {
      status: true,
      message: "Document created or updated successfully.",
      data: result,
    };
  } catch (error) {
    console.error("Error in DissionBox function:", error);
    // Return error response
    return {
      status: false,
      message: "An error occurred while processing the request.",
      error: error.message,
    };
  }
};

const customerLoanType = async (req, res) => {
  try {
    // let { customerId } = req.query;
    const { customerId } = req.query;
    if (!mongoose.isValidObjectId(customerId)) {
      return badRequest(res, "Invalid customerId format");
    }

    const data = await customerModel.findOne({ _id: customerId });
    if (!data) {
      return badRequest(res, "Customer not found");
    }
    const creditPdData = await creditPdModel.findOne({
      customerId: new mongoose.Types.ObjectId(customerId),
    });
    const responseData = {
      LoanAmountRequested:
        creditPdData?.approveLoanDetails?.demandLoanAmountByCustomer || "",
      LoanTenureRequested: creditPdData?.approveLoanDetails?.Tenure || "",
      LoanPurpose: creditPdData?.approveLoanDetails?.endUseOfLoan || "",
      LoanType: creditPdData?.approveLoanDetails?.loanType || "",
      roi: creditPdData?.approveLoanDetails?.ROI || "",
      emi: creditPdData?.approveLoanDetails?.EMI || "",
    };
    return success(res, "loan type details", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// get Dission box data by customerId //

const getDissionBox = async (req, res) => {
  try {
    const { customerId } = req.query;
    if (!customerId) {
      return badRequest(res, "customerId is required");
    }

    //----------FINAL SENCTION DETAILS ------------//
    let finalsanctiondata = false;

    const findDataFromFinal = await finalModel.findOne({ customerId });
    if (!findDataFromFinal) {
      finalsanctiondata = false;
    }

    // Check if all fields are non-empty or non-null
    if (
      findDataFromFinal &&
      findDataFromFinal.finalLoanAmount &&
      findDataFromFinal.loanAmountInWords &&
      findDataFromFinal.tenureInMonth &&
      findDataFromFinal.roi &&
      findDataFromFinal.emiAmount &&
      findDataFromFinal.customerSegment &&
      findDataFromFinal.customerProfile &&
      findDataFromFinal.EndUseOfLoan
    ) {
      finalsanctiondata = true;
    }

    //-----  CAM DETAILS  ----//

    let Cam = true;

    const updatedDetail = await finalModel.findOne({ customerId });
    if (!updatedDetail) {
      Cam = false;
    }
    const cibilData = await cibilModel.findOne({ customerId });
    if (!cibilData) {
      Cam = false;
    }
    const creditPdData = await creditPdModel.findOne({ customerId });
    if (!creditPdData) {
      Cam = false;
    }

    const responseData = {
      sanctionConditionQuery: updatedDetail?.sanctionConditionQuery || [],
      branchPendencyQuery: updatedDetail?.branchPendencyQuery || [],
      deviation: updatedDetail?.deviation || [],
      mitigate: updatedDetail?.mitigate || [],
      department_info: updatedDetail?.department_info || [],
      cibilDetails: cibilData?.applicantCibilDetail || [],
      applicantTotalObligation: cibilData?.applicantTotalObligation || 0,
      applicantTotalObligationMonthly:
        cibilData?.applicantTotalObligationMonthly || 0,
      agricultureIncome: updatedDetail?.agricultureIncome || {},
      milkIncomeCalculation: updatedDetail?.milkIncomeCalculation || {},
      otherIncomeCalculation: updatedDetail?.otherIncomeCalculation || {},
      totalIncomeMonthlyCalculation:
        updatedDetail?.totalIncomeMonthlyCalculation || {},
      department_info: creditPdData?.department_info || [],
      agricultureRatnaIncome: updatedDetail?.agricultureRatnaIncome || {},
      milkRatnaIncomeCalculation:
        updatedDetail?.milkRatnaIncomeCalculation || {},
      otherBusinessIncomeCalculation:
        updatedDetail?.otherBusinessIncomeCalculation || {},
      expensesDetails: updatedDetail?.expensesDetails || {},
      grossCalculation: updatedDetail?.grossCalculation || {},
      netCalculation: updatedDetail?.netCalculation || {},
      Allow_Permission: updatedDetail?.Allow_Permission || true, // Default to true
    };

    // For senction query //

    if (responseData.sanctionConditionQuery?.query) {
      responseData.sanctionConditionQuery.query.forEach((item) => {
        if (!item) {
          Cam = false; // If any query item is invalid, set the flag to false.
        }
      });
    }

    // Check if cibilDetails is valid
    if (
      responseData.cibilDetails.some(
        (item) =>
          !item.loanType ||
          !item.loanAmount ||
          !item.outstandingAmount ||
          !item.emiMonthly ||
          !item.emiAnnual
      )
    ) {
      Cam = false;
    }

    // Check if agricultureRatnaIncome has data
    if (
      !responseData.agricultureRatnaIncome.grossYearlyIncome &&
      !responseData.agricultureRatnaIncome.grossMonthlyIncome
    ) {
      Cam = false;
    }

    if (
      responseData.agricultureRatnaIncome.details &&
      responseData.agricultureRatnaIncome.details.length > 0
    ) {
      responseData.agricultureRatnaIncome.details.forEach((item) => {
        if (
          !item.district ||
          !item.season ||
          !item.AreaCultivationAcres ||
          !item.crop ||
          !item.netIncome
        ) {
          Cam = false;
        }
      });
    }

    // Check if milkRatnaIncomeCalculation has required values
    if (
      !responseData.milkRatnaIncomeCalculation.grossYearlyIncome ||
      !responseData.milkRatnaIncomeCalculation.grossMonthlyIncome ||
      !responseData.milkRatnaIncomeCalculation.totalNoOfMilkGivingCatel ||
      !responseData.milkRatnaIncomeCalculation
        .incomeConsideredPerMilkGivingCatel
    ) {
      Cam = false;
    }

    // Check if otherBusinessIncomeCalculation has required values
    if (
      !responseData.otherBusinessIncomeCalculation.grossBusinessYearlyIncome ||
      !responseData.otherBusinessIncomeCalculation.grossBusinessMonthlyIncome
    ) {
      Cam = false;
    }

    // Check if grossCalculation has required values
    if (
      !responseData.grossCalculation.totalAnnualIncome ||
      !responseData.grossCalculation.agricultureIncome ||
      !responseData.grossCalculation.incomeFromMilk ||
      !responseData.grossCalculation.incomeFromOtherSource
    ) {
      Cam = false;
    }

    // Check if netCalculation has required values
    if (
      // !responseData.netCalculation.totalNetAnnualIncome ||
      !responseData.netCalculation.totalNetAnnualExpenses ||
      !responseData.netCalculation.totalNetMonthlyIncome ||
      !responseData.netCalculation.totalNetAnnualIncome
    ) {
      Cam = false;
    }

    if (!responseData.expensesDetails.grossExpensesFromExisting) {
      Cam = false;
    }

    //-------  UDHYAM CHECK  ----//

    const udhyamKyc = await udhyamKycModel.findOne({ customerId });

    let Udhyam = true; // Default to true, assuming all fields are valid

    if (!udhyamKyc) {
      Udhyam = false; // If no data is found, set Udhyam to false
    } else if (udhyamKyc.udyamDetails) {
      const {
        enterpriseName,
        udyamRegistrationNo,
        organisationType,
        socialCategory,
        dateofIncorporation,
        majorActivity,
        DateofCommencementofProductionBusiness,
        enterpriseType,
        classificationDate,
        classificationYear,
        officialAddressOfEnterprise: {
          FlatDoorBlockNo,
          VillageTown,
          RoadStreetLane,
          state,
          mobile,
          nameofPremisesBuilding,
          block,
          city,
          district,
          pin,
        },
        nationalIndustryClassificationCode: {
          activity,
          date,
          nic2Digit,
          nic4Digit,
          nic5Digit,
          dicName,
          msmeDFO,
          DateofUdyamRegistration,
        },
        unitsDetails: { unitName, flat, building },
      } = udhyamKyc.udyamDetails;

      // Check if any required field is missing or empty
      const isAnyFieldMissing = [
        enterpriseName,
        udyamRegistrationNo,
        organisationType,
        socialCategory,
        dateofIncorporation,
        majorActivity,
        DateofCommencementofProductionBusiness,
        enterpriseType,
        classificationDate,
        classificationYear,
        FlatDoorBlockNo,
        VillageTown,
        RoadStreetLane,
        state,
        mobile,
        nameofPremisesBuilding,
        block,
        city,
        district,
        pin,
        activity,
        date,
        nic2Digit,
        nic4Digit,
        nic5Digit,
        dicName,
        msmeDFO,
        DateofUdyamRegistration,
        unitName,
        flat,
        building,
      ].some((field) => !field || field === "");

      // If any required field is missing or empty, set Udhyam to false
      Udhyam = !isAnyFieldMissing;
    }

    // ---------------   for bank statement  --------------- //

    let Bank = true;
    const existingBankStatement = await bankStatementModel.findOne({
      customerId,
    });

    if (!existingBankStatement) {
      Bank = false;
    } else {
      for (const bankDetail of existingBankStatement.bankDetails) {
        const {
          bankName,
          acHolderName,
          accountNumber,
          ifscCode,
          branchName,
          accountType,
          e_Nachamount,
          mandate_end_date,
          E_Nach_Remarks,
        } = bankDetail;

        if (
          !bankName ||
          !acHolderName ||
          !accountNumber ||
          !ifscCode ||
          !branchName ||
          !accountType
        ) {
          Bank = false;
          break;
        }

        if (
          E_Nach_Remarks !== "false" &&
          (!e_Nachamount || !mandate_end_date)
        ) {
          Bank = false;
          break;
        }
      }
    }

    if (Bank) {
      console.log("All bank details are valid.");
      // Add logic here for valid bank details
    } else {
      console.log("Bank details are incomplete or invalid.");
      // Add logic here for invalid or incomplete bank details
    }

    //  --------------  Chargress Details  -------------- //
    let checkstatuss = true;
    const data = await disbursementModel.findOne({ customerId });
    if (!data) {
      checkstatuss = false;
    }

    const chargesDetails = {
      processingFees: data?.kfsDetails?.processingFees || "",
      documentsCharges: data?.kfsDetails?.documentsCharges || "",
      cersaiCharges: data?.kfsDetails?.cersaiCharges || "",
      insuranceCharges: data?.kfsDetails?.insuranceCharges || "",
      preEmiInterest: data?.kfsDetails?.preEmiInterest || "",
    };

    const kfsDetails = {
      benchmarkinterestRate: data?.kfsDetails?.benchmarkinterestRate || "",
      SpreadInterestRate: data?.kfsDetails?.SpreadInterestRate || "",
      annualPercentageRateAprPercentage:
        data?.kfsDetails?.annualPercentageRateAprPercentage || "",
      epi: data?.kfsDetails?.epi || "",
      noOfEpi: data?.kfsDetails?.noOfEpi || "",
    };

    for (const key in chargesDetails) {
      if (!chargesDetails[key]) {
        checkstatuss = false;
        break;
      }
    }

    // Validate kfsDetails if chargesDetails are valid
    if (checkstatuss) {
      for (const key in kfsDetails) {
        if (!kfsDetails[key]) {
          checkstatuss = false;
          break;
        }
      }
    }

    let finalApproval = "pending";

    // Check conditions
    if (
      Bank == true &&
      checkstatuss == true &&
      Udhyam == true &&
      Cam == true &&
      finalsanctiondata == true
    ) {
      finalApproval = "completed"; // All conditions are true
      console.log("All conditions are satisfied. finalApproval is completed.");
    } else {
      finalApproval = "pending"; // At least one condition is false
      console.log(
        "One or more conditions are not satisfied. finalApproval is pending."
      );
    }

    let Reject = "pending"; // Ensure 'pending' is defined or imported
    const externalVendor = await externalVendorFormModel.findOne({
      customerId,
    });
    if (!externalVendor) {
      Reject = "pending"; // Ensure 'pending' is defined or imported
    }

    if (externalVendor && externalVendor.fileStatus == "inactive") {
      console.log("externalVendor.fileStatus", externalVendor.fileStatus);
      Reject = "completed"; // Ensure 'completed' is defined or imported
    }

    console.log("Reject", Reject);

    // console.log("findDataFromFinal", findDataFromFinal?.esignLink);
    // console.log("gurrantorDetails", gurrantor?.guarantorDetails);
    // console.log("Nach", nach);
    // console.log("Kyc", kyc);
    // console.log("PdcAndBsv", pdcAndBsv);
    // console.log("Stamp", stamp);

    let isFindDataFromFinalValids = false;
    let isKycValid = true; // Start with a default of true

    const dis = await disbursementModel.findOne({ customerId });
    if (!dis) {
      isKycValid = false; // If no disbursement data is found, set isKycValid to false'
      isFindDataFromFinalValids = false;
    }
    const kyc = dis?.kycAndAffidavit?.kycDetail || [];
    const stamp = dis?.estampRequirement || [];
    const nach = dis?.eNachLinkSentToBranch || [];
    let pdcAndBsv = dis?.pdcAndBsv || [];
    const Dis = dis ? dis.postDisbursement : null;

    let newDis = "pending"; // Default to "pending"

    if (Dis) {
      // Check if every field in Dis has data
      const hasAllData = [
        Dis.loanNumber,
        Dis.actualPreEmi,
        Dis.dateOfDisbursement,
        Dis.dateOfFirstEmi,
        Dis.utrNumber1,
        Dis.utrNumber2,
        Dis.disbursementDoneBy,
      ].every((field) => field !== null && field !== undefined && field !== "");

      console.log("hasAllData", hasAllData);

      // Update newDis based on completeness
      newDis = hasAllData == false ? "pending" : "completed";
      console.log("newDis", newDis);
    } else {
      newDis = "pending"; // Dis is null or undefined
    }

    const sanctionData = await sanctionPendencyModel.findOne({ customerId });
    if (!sanctionData) {
      isFindDataFromFinalValids = false;
    }
    if (sanctionData) {
      isFinalSanctionFinal = false;
    }

    const isFinalSanctionCompleted =
      sanctionData &&
      (sanctionData.partnerLoanNo ||
        sanctionData.sanctionDate ||
        sanctionData.loanAgreementDate ||
        sanctionData.partnerCustomerId);

    // Check if required data for preDisbursement is available

    const dataNew = findDataFromFinal?.esignLink;
    // console.log("dataNew", dataNew);
    if (findDataFromFinal?.esignLink) {
      for (let i = 0; i < findDataFromFinal.esignLink.length; i++) {
        const item = findDataFromFinal.esignLink[i];
        if (item.pdf || item.pdfName) {
          isFindDataFromFinalValids = true;
          break;
        }
      }
    }

    // console.log("isFindDataFromFinalValids--------> ", isFindDataFromFinalValids);

    // const isGuarantorDetailsValid = gurrantor?.guarantorDetails.every(
    //   (item) =>
    //     item.bankName &&
    //     item.acHolderName &&
    //     item.accountNumber &&
    //     item.ifscCode &&
    //     item.branchName &&
    //     item.accountType
    // );

    const gurrantor = await guarantorStatementDetails
      .findOne({ customerId })
      .lean();
    let isGuarantorDetailsValid = true;
    if (!gurrantor) {
      isGuarantorDetailsValid = false;
    }
    if (gurrantor?.guarantorDetails) {
      for (let i = 0; i < gurrantor.guarantorDetails.length; i++) {
        const item = gurrantor.guarantorDetails[i];
        if (
          !item.bankName ||
          !item.acHolderName ||
          !item.accountNumber ||
          !item.ifscCode ||
          !item.branchName ||
          !item.accountType
        ) {
          isGuarantorDetailsValid = false;
          break;
        }
      }
    }

    let isNachValid = nach && nach.length > 0;
    if (!isNachValid) {
      isNachValid = false;
    }

    // console.log("isNachValid", isNachValid);

    /// KYC ///

    if (dis?.kycAndAffidavit?.kycDetail) {
      for (let i = 0; i < dis.kycAndAffidavit.kycDetail.length; i++) {
        const kyc = dis.kycAndAffidavit.kycDetail[i];

        // Check if any required field is missing or empty
        if (
          !kyc.type ||
          !kyc.nameAsPerAadhaar ||
          !kyc.nameAsPerPanCard ||
          !kyc.nameAsPerVoter ||
          !kyc.dobAsPerAadhaar ||
          !kyc.dobAsPerPanCard ||
          !kyc.dobAsPerVoter ||
          !kyc.kycUpload ||
          !kyc.dualNameUpload ||
          !kyc.dualDOBUpload
        ) {
          isKycValid = false;
          break;
        }
      }
    }

    // if (dis?.kycAndAffidavit?.kycDetail) {
    //   for (let i = 0; i < dis.kycAndAffidavit.kycDetail.length; i++) {
    //     const kyc = dis.kycAndAffidavit.kycDetail[i];

    //     if (
    //       !kyc.type ||
    //       !kyc.nameAsPerAadhaar ||
    //       !kyc.nameAsPerPanCard ||
    //       !kyc.nameAsPerVoter ||
    //       !kyc.dobAsPerAadhaar ||
    //       !kyc.dobAsPerPanCard ||
    //       !kyc.dobAsPerVoter ||
    //       !kyc.kycUpload ||
    //       !kyc.dualNameUpload ||
    //       !kyc.dualDOBUpload
    //     ) {
    //       isKycValid = false;
    //       break;
    //     }
    //   }
    // } else {

    //   isKycValid = false;
    // }

    // console.log("isKycValid------------ ", isKycValid);

    const isPdcAndBsvValid =
      pdcAndBsv?.applicantChequeAndBSV?.chequeDetail?.some(
        (detail) => detail.trim() !== ""
      ) && // Check that there is a valid non-empty chequeDetail
      pdcAndBsv?.applicantChequeAndBSV?.upload && // Ensure upload is present
      pdcAndBsv?.guarantorChequeAndBSV?.chequeDetail?.some(
        (detail) => detail.trim() !== ""
      ) && // Check that there is a valid non-empty chequeDetail
      pdcAndBsv?.guarantorChequeAndBSV?.upload; // Ensure upload is present

    console.log("isPdcAndBsvValid", isPdcAndBsvValid);

    const isStampValid = stamp.every(
      (item) =>
        item.denominator &&
        item.totalStampNo &&
        item.partnerName &&
        item.vendorName &&
        item.requiredFor
    );

    const isFindDataFromFinalValid =
      isFindDataFromFinalValids &&
      isGuarantorDetailsValid &&
      isNachValid &&
      isKycValid &&
      isPdcAndBsvValid &&
      isStampValid;

    console.log("preDisbursementCompleted", isFindDataFromFinalValid);
    console.log("finalSanctionCompleted", isFindDataFromFinalValids);
    console.log("isNachValid", isNachValid);
    console.log("isKycValid", isKycValid);
    console.log("isPdcAndBsvValid", isPdcAndBsvValid);
    console.log("isStampValid", isStampValid);
    console.log("isGuarantorDetailsValid", isGuarantorDetailsValid);

    // For Final Approval //

    // const fileProcess = await finalScantionModel.findOne({
    //   customerId: customerId,
    // })

    // console.log("fileProcess", fileProcess)

    const datas = await decisionModel.updateOne(
      { customerId }, // Find document by customerId
      {
        $set: {
          Reject: Reject,
          employeeId:
            findDataFromFinal &&
            mongoose.isValidObjectId(findDataFromFinal.employeeId)
              ? findDataFromFinal.employeeId
              : null,
          SendtoPatner: finalApproval,
          finalSanction: isFinalSanctionCompleted ? "completed" : "pending",
          IncomeSanction: findDataFromFinal?.incomesectionLatterUrl
            ? "completed"
            : "pending",
          postDisbusment: newDis,
          preDisbusment: isFindDataFromFinalValid ? "completed" : "pending",
        },
      },
      { upsert: true }
    );

    const updatedData = await decisionModel.findOne({ customerId });
    return success(res, "Dission box data", { datas: updatedData });
  } catch (error) {
    console.error("Error in getDissionBox:", error);
    return unknownError(res, error);
  }
};

//old api
const testecustomerDetailsList = async (req, res) => {
  // <<><><><><><><><><><>
  try {
    const { pageLimit, pageNumber, search } = req.query;
    const { offset, limit } = paginationData(pageLimit, pageNumber);

    console.log("api test------", offset, limit);
    // Build search filter
    const searchFilter = {};
    if (search) {
      searchFilter.$or = [
        { "nearestBranchData.name": { $regex: search, $options: "i" } },
        { "branchDetail.name": { $regex: search, $options: "i" } },
        { "applicantDetail.fullName": { $regex: search, $options: "i" } }, // Applicant name (case-insensitive)
        { customerFinId: { $regex: search, $options: "i" } },
        {
          $expr: {
            $regexMatch: {
              input: { $toString: "$mobileNo" }, // Convert numeric field to string
              regex: search,
              options: "i",
            },
          },
        }, // Mobile number as string (case-insensitive)
      ];
    }
    console.time("API Execution Time");
    const userData = await customerModel.aggregate([
      {
        $lookup: {
          from: "products",
          localField: "productId",
          foreignField: "_id",
          as: "productData",
        },
      },
      // {
      //   $unwind: {
      //     path: "$productData",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "employees",
          localField: "employeId",
          foreignField: "_id",
          as: "employeeDetail",
        },
      },
      {
        $unwind: {
          path: "$employeeDetail",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "employeeDetail.reportingManagerId",
          foreignField: "_id",
          as: "salesManagerDetails",
        },
      },
      // {
      //   $unwind: {
      //     path: "$salesManagerDetails",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "newbranches",
          localField: "employeeDetail.branchId",
          foreignField: "_id",
          as: "branchDetail",
        },
      },
      // {
      //   $unwind: {
      //     path: "$branchDetail",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          as: "applicantDetail",
        },
      },
      // {
      //   $unwind: {
      //     path: "$applicantDetail",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          as: "cibildetailDetail",
        },
      },
      // {
      //   $unwind: {
      //     path: "$cibildetailDetail",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "pdformdatas",
          localField: "_id",
          foreignField: "customerId",
          as: "pdData",
        },
      },
      {
        $unwind: {
          path: "$pdData",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $match: {
          $or: [
            { "pdData.status": "complete" },
            { "pdData.status": "approve" },
          ],
        },
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          as: "finalSanctionData",
        },
      },
      {
        $unwind: {
          path: "$finalSanctionData",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "finalSanctionData.employeeId",
          foreignField: "_id",
          as: "finalSanctionData.employeeDetail",
        },
      },
      {
        $unwind: {
          path: "$finalSanctionData.employeeDetail",
          preserveNullAndEmptyArrays: true,
        },
      },

      {
        $addFields: {
          isEmployeeIdMissing: {
            $not: { $ifNull: ["$finalSanctionData.employeeId", false] },
          },
        },
      },
      {
        $group: {
          _id: "$_id", // Use a unique field to group by
          document: { $first: "$$ROOT" }, // Retain the first occurrence of each record
        },
      },
      {
        $replaceRoot: { newRoot: "$document" }, // Replace the grouped document as the root
      },
      {
        $sort: {
          isEmployeeIdMissing: -1, // True means missing employeeId
        },
      },
      {
        $project: {
          _id: 1,
          // finalSanctionData: 1,
          finalSanctionData: {
            _id: 1,
            status: 1,
            employeeId: 1,
            "employeeDetail.employeName":
              "$finalSanctionData.employeeDetail.employeName", // Add the employee name
            // Add the selfAssignStatus field based on the presence of employeeId
            selfAssignStatus: {
              $cond: {
                if: { $gt: ["$finalSanctionData.employeeId", null] }, // Check if employeeId exists
                then: true,
                else: false,
              },
            },
          },
          employeId: 1,
          productId: 1,
          customerFinId: 1,
          mobileNo: 1,
          loanAmount: 1,
          roi: 1,
          tenure: 1,
          emi: 1,
          executiveName: 1,
          createdAt: 1,
          updatedAt: 1,
          "pdData.status": 1,
          // "finalSanctionData.employeeDetail.employeName":1,
          "applicantDetail.fullName": 1,
          "applicantDetail.fatherName": 1,
          "applicantDetail.mobileNo": 1,
          "applicantDetail.applicantPhoto": 1,
          "applicantDetail.applicantAddress":
            "$applicantDetail.permanentAddress.addressLine1",
          "cibildetailDetail.applicantCibilScore": 1,
          "nearestBranchData.name": 1,
          "branchDetail.name": 1,
          "productData.productName": 1,
          "employeeDetail.employeName": 1,
          "employeeDetail.userName": 1,
          "employeeDetail.employeUniqueId": 1,
          "salesManagerDetails.employeName": 1,
          "salesManagerDetails.employeUniqueId": 1,
          "salesManagerDetails.userName": 1,
          tvrDetails: {
            income: "7%",
            propertyValue: "50L",
            foir: "30%",
            ltv: "9%",
          },
        },
      },
      // Apply search filter
      { $match: searchFilter },
      {
        $skip: offset,
      },
      {
        $limit: limit,
      },
    ]);

    // Fetch total count without pagination for accurate results
    const totalCount = await customerModel.aggregate([
      {
        $lookup: {
          from: "newbranches",
          localField: "nearestBranchId",
          foreignField: "_id",
          as: "nearestBranchData",
        },
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "branch",
          foreignField: "_id",
          as: "branchDetail",
        },
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          as: "applicantDetail",
        },
      },
      // {
      //   $unwind: {
      //     path: "$applicantDetail",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          as: "cibildetailDetail",
        },
      },
      // {
      //   $unwind: {
      //     path: "$cibildetailDetail",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "pdformdatas",
          localField: "_id",
          foreignField: "customerId",
          as: "pdData",
        },
      },
      // {
      //   $unwind: {
      //     path: "$pdData",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          as: "finalSanctionData",
        },
      },
      // {
      //   $unwind: {
      //     path: "$finalSanctionData",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $match: {
          $or: [
            { "pdData.status": "complete" },
            { "pdData.status": "approve" },
          ],
        },
      },
      {
        $group: {
          _id: "$_id", // Use a unique field to group by
          document: { $first: "$$ROOT" }, // Retain the first occurrence of each record
        },
      },
      {
        $replaceRoot: { newRoot: "$document" }, // Replace the grouped document as the root
      },
      {
        $project: {
          "nearestBranchData.name": 1,
          "branchDetail.name": 1,
          "applicantDetail.fullName": 1,
          mobileNo: 1,
        },
      },
      // Match filter for total count
      { $match: searchFilter },
    ]);
    console.timeEnd("API Execution Time");
    const result = await customerModel.aggregate([
      {
        $match: {
          customerFinId: {
            $regex: "FINS",
            $options: "i",
          },
        },
      },
      {
        $lookup: {
          from: "pdformdatas", // Secondary collection name
          localField: "_id", // Field in the customers collection
          foreignField: "customerId", // Field in the  collection
          as: "pdData", // Name of the joined array
          pipeline: [
            // Use pipeline to filter `pdformdatas`
            {
              $match: {
                status: { $in: ["complete", "approve"] }, // Filter on `status`
              },
            },
          ],
        },
      },
    ]);
    console.log(result.length, "result<><><><>");
    // console.log("all res data ===",totalCount)
    success(res, "All customer details List", {
      totalCount: totalCount.length,
      userDataLength: userData.length,
      userData,
    });

    // Execute final approval sheet for each user
    // for (const user of userData) {
    //   await finalApprovalSheet(user._id);
    // }
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// const testecustomerDetailsList = async (req, res) => {
//   try {
//     const { pageLimit, pageNumber, search } = req.query;
//     const { offset, limit } = paginationData(pageLimit, pageNumber);

//     console.log('api test------',offset, limit)
//     // Build search filter
//     const searchFilter = {};
//     if (search) {
//       searchFilter.$or = [
//         { "nearestBranchData.name": { $regex: search, $options: "i" } },
//         { "branchDetail.name": { $regex: search, $options: "i" } },
//         { "applicantDetail.fullName": { $regex: search, $options: "i" } }, // Applicant name (case-insensitive)
//         { customerFinId: { $regex: search, $options: "i" } },
//         {
//           $expr: {
//             $regexMatch: {
//               input: { $toString: "$mobileNo" }, // Convert numeric field to string
//               regex: search,
//               options: "i",
//             },
//           },
//         }, // Mobile number as string (case-insensitive)
//       ];
//     }
//     console.time("API Execution Time");
//     const userData = await customerModel.aggregate([
//       {
//         $lookup: {
//           from: "pdformdatas",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "pdData",
//         },
//       },
//       {
//         $unwind: {
//           path: "$pdData",
//           preserveNullAndEmptyArrays: true,
//         },
//       },
//       {
//         $match: {
//           $or: [
//             { "pdData.status": "complete" },
//             { "pdData.status": "approve" }
//           ]
//         }
//       },
//       {
//         $lookup: {
//           from: "employees",
//           localField: "pdData.pdId",
//           foreignField: "_id",
//           as: "pdCompleteDetails",
//         },
//       },
//       {
//         $lookup: {
//           from: "employees",
//           localField: "employeId",
//           foreignField: "_id",
//           as: "employeeDetail",
//         },
//       },
//       {
//         $unwind: {
//           path: "$employeeDetail",
//           preserveNullAndEmptyArrays: true,
//         },
//       },
//       {
//         $lookup: {
//           from: "employees",
//           localField: "employeeDetail.reportingManagerId",
//           foreignField: "_id",
//           as: "salesManagerDetails",
//         },
//       },
//       {
//         $lookup: {
//           from: "newbranches",
//           localField: "employeeDetail.branchId",
//           foreignField: "_id",
//           as: "branchDetail",
//         },
//       },
//       {
//         $lookup: {
//           from: "applicantdetails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "applicantDetail",
//         },
//       },
//       {
//         $lookup: {
//           from: "cibildetails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "cibildetailDetail",
//         },
//       },
//       {
//         $lookup: {
//           from: "externalvendordynamics",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "externalVendorDetail",
//         },
//       },
//       {
//         $unwind: {
//           path: "$externalVendorDetail",
//           preserveNullAndEmptyArrays: true,
//         },
//       },
//       {
//         $unwind: {
//           path: "$externalVendorDetail.vendors",
//           preserveNullAndEmptyArrays: true,
//         },
//       },
//       {
//         $group: {
//           _id: "$_id",
//           document: { $first: "$$ROOT" },
//           vendors: { $push: "$externalVendorDetail.vendors" },
//         },
//       },
//       {
//         $addFields: {
//           "document.externalVendorDetail": "$vendors",
//         },
//       },
//       {
//         $replaceRoot: { newRoot: "$document" },
//       },
//       {
//         $lookup: {
//           from: "bankstatementkycs",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "bankStatementKycDetail",
//         },
//       },
//       {
//         $addFields: {
//           hasNachoLink: {
//             $cond: {
//               if: {
//                 $anyElementTrue: {
//                   $map: {
//                     input: "$bankStatementKycDetail",
//                     as: "kyc",
//                     in: { $and: [
//                       { $ne: ["$$kyc.Nachlink", ""] },  // Ensure Nachlink is not an empty string
//                       { $ne: ["$$kyc.Nachlink", null] } // Ensure Nachlink is not null
//                     ]}
//                   }
//                 }
//               },
//               then: true,
//               else: false,
//             },
//           },
//         },
//       },
//       {
//         $lookup: {
//           from: "finalsanctiondetaails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "finalSanctionData",
//         },
//       },
//       {
//         $unwind: {
//           path: "$finalSanctionData",
//           preserveNullAndEmptyArrays: true,
//         },
//       },
//       {
//         $lookup: {
//           from: "employees",
//           localField: "finalSanctionData.employeeId",
//           foreignField: "_id",
//           as: "finalSanctionData.employeeDetail",
//         },
//       },
//       {
//         $unwind: {
//           path: "$finalSanctionData.employeeDetail",
//           preserveNullAndEmptyArrays: true,
//         },
//       },
//       {
//         $addFields: {
//           isEmployeeIdMissing: { $not: { $ifNull: ["$finalSanctionData.employeeId", false] } },
//         },
//       },
//       {
//         $group: {
//           _id: "$_id", // Use a unique field to group by
//           document: { $first: "$$ROOT" }, // Retain the first occurrence of each record
//         },
//       },
//       {
//         $replaceRoot: { newRoot: "$document" }, // Replace the grouped document as the root
//       },
//       {
//         $sort: {
//           isEmployeeIdMissing: -1, // True means missing employeeId
//         },
//       },
//       {
//         $project: {
//           _id: 1,
//           // "externalVendorDetail.vendors" : 1,
//           externalVendorDetail: 1,
//           // "bankStatementKycDetail":1,
//           hasNachoLink:1,
//           // vendors: {
//           //   $map: {
//           //     input: "$externalVendorDetail.vendors",
//           //     as: "vendor",
//           //     in: {
//           //       vendorType: "$$vendor.vendorType",
//           //       statusByVendor: "$$vendor.statusByVendor",
//           //     },
//           //   },
//           // },
//           finalSanctionData: {
//             _id: 1,
//             status: 1,
//             employeeId: 1,
//             "employeeDetail.employeName": "$finalSanctionData.employeeDetail.employeName",
//             "finalSanctionData.finalLoanAmount": "$finalSanctionData.finalLoanAmount",
//             "finalSanctionData.roi": "$finalSanctionData.roi",
//             "finalSanctionData.tenureInMonth": "$finalSanctionData.tenureInMonth",
//             // Add the selfAssignStatus field based on the presence of employeeId
//             selfAssignStatus: {
//               $cond: {
//                 if: { $gt: ["$finalSanctionData.employeeId", null] }, // Check if employeeId exists
//                 then: true,
//                 else: false,
//               },
//             },
//             esignLinkStatus: {
//               $cond: {
//                 if: {
//                   $and: [
//                     { $eq: [{ $type: "$finalSanctionData.esignLink" }, "array"] }, // Check if esignLink is an array
//                     { $gt: [{ $size: { $ifNull: ["$finalSanctionData.esignLink", []] } }, 0] } // Check if the array is not empty
//                   ]
//                 },
//                 then: "Yes",  // Return Yes if esignLink is an array and has elements
//                 else: "No",   // Return No if esignLink is not an array or is empty
//               },
//             },
//           },
//           employeId: 1,
//           productId: 1,
//           customerFinId: 1,
//           mobileNo: 1,
//           // loanAmount: 1,
//           // roi: 1,
//           // tenure: 1,
//           emi: 1,
//           executiveName: 1,
//           createdAt: 1,
//           updatedAt: 1,
//           "pdData.status":1,
//           "pdData.bdCompleteDate":1,
//           "pdCompleteDetails.employeName":1,
//           // "finalSanctionData.employeeDetail.employeName":1,
//           "applicantDetail.fullName": 1,
//           "applicantDetail.fatherName": 1,
//           "applicantDetail.mobileNo": 1,
//           "applicantDetail.applicantPhoto": 1,
//           "applicantDetail.applicantAddress": "$applicantDetail.permanentAddress.addressLine1",
//           "cibildetailDetail.applicantCibilScore": 1,
//           "nearestBranchData.name": 1,
//           "branchDetail.name":1,
//           "productData.productName": 1,
//           "employeeDetail.employeName":1,
//           "employeeDetail.userName":1,
//           "employeeDetail.employeUniqueId":1,
//           "salesManagerDetails.employeName":1,
//           "salesManagerDetails.employeUniqueId":1,
//           "salesManagerDetails.userName":1,
//           // tvrDetails: {
//           //   income: "7%",
//           //   propertyValue: "50L",
//           //   foir: "30%",
//           //   ltv: "9%",
//           // },
//         },
//       },
//       // Apply search filter
//       { $match: searchFilter },
//       {
//         $skip: offset,
//       },
//       {
//         $limit: limit,
//       },
//     ]);

//     // Fetch total count without pagination for accurate results
//     const totalCount = await customerModel.aggregate([
//       {
//         $lookup: {
//           from: "newbranches",
//           localField: "nearestBranchId",
//           foreignField: "_id",
//           as: "nearestBranchData",
//         },
//       },
//       {
//         $lookup: {
//           from: "newbranches",
//           localField: "branch",
//           foreignField: "_id",
//           as: "branchDetail",
//         },
//       },
//       {
//         $lookup: {
//           from: "applicantdetails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "applicantDetail",
//         },
//       },
//       // {
//       //   $unwind: {
//       //     path: "$applicantDetail",
//       //     preserveNullAndEmptyArrays: true,
//       //   },
//       // },
//       {
//         $lookup: {
//           from: "cibildetails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "cibildetailDetail",
//         },
//       },
//       // {
//       //   $unwind: {
//       //     path: "$cibildetailDetail",
//       //     preserveNullAndEmptyArrays: true,
//       //   },
//       // },
//       {
//         $lookup: {
//           from: "pdformdatas",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "pdData",
//         },
//       },
//       // {
//       //   $unwind: {
//       //     path: "$pdData",
//       //     preserveNullAndEmptyArrays: true,
//       //   },
//       // },
//       {
//         $lookup: {
//           from: "finalsanctiondetaails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "finalSanctionData",
//         },
//       },
//       // {
//       //   $unwind: {
//       //     path: "$finalSanctionData",
//       //     preserveNullAndEmptyArrays: true,
//       //   },
//       // },
//       {
//         $match: {
//           $or: [
//             { "pdData.status": "complete" },
//             { "pdData.status": "approve" }
//           ]
//         }
//       },
//       {
//         $group: {
//           _id: "$_id", // Use a unique field to group by
//           document: { $first: "$$ROOT" }, // Retain the first occurrence of each record
//         },
//       },
//       {
//         $replaceRoot: { newRoot: "$document" }, // Replace the grouped document as the root
//       },
//       {
//         $project: {
//           "nearestBranchData.name": 1,
//           "branchDetail.name":1,
//           "applicantDetail.fullName": 1,
//           mobileNo: 1,
//         },
//       },
//       // Match filter for total count
//       { $match: searchFilter },
//     ]);
//     console.timeEnd("API Execution Time");
//     // console.log("all res data ===",totalCount)
//     success(res, "All customer details List", {
//       totalCount: totalCount.length,
//       userDataLength:  userData.length,
//       userData,
//     });

//     // Execute final approval sheet for each user
//     // for (const user of userData) {
//     //   await finalApprovalSheet(user._id);
//     // }

//   } catch (error) {
//     console.log(error);
//     return unknownError(res, error);
//   }
// };

//new updated
const customerDetailsList = async (req, res) => {
  try {
    const { pageLimit, pageNumber, search } = req.query;
    const { offset, limit } = paginationData(pageLimit, pageNumber);

    console.log("api test------", offset, limit);
    // Build search filter
    const searchFilter = {};
    if (search) {
      searchFilter.$or = [
        { "nearestBranchData.name": { $regex: search, $options: "i" } },
        { "branchDetail.name": { $regex: search, $options: "i" } },
        { "applicantDetail.fullName": { $regex: search, $options: "i" } }, // Applicant name (case-insensitive)
        { customerFinId: { $regex: search, $options: "i" } },
        {
          $expr: {
            $regexMatch: {
              input: { $toString: "$mobileNo" }, // Convert numeric field to string
              regex: search,
              options: "i",
            },
          },
        }, // Mobile number as string (case-insensitive)
      ];
    }
    console.time("API Execution Time");

    const results = await customerModel.aggregate([
      // Lookup pdData with filtered pipeline
      {
        $lookup: {
          from: "externalvendordynamics",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                statusByCreditPd: { $in: ["complete", "approve"] },
                fileStatus: { $in: ["active"] },
              },
            },
            {
              $project: {
                customerId: 1,
                statusByCreditPd: 1,
                fileStatus: 1,
                creditPdId:1,
                creditPdCompleteDate:1
              },
            },
          ],
          as: "externalVenderData",
        },
      },
      { $match: { externalVenderData: { $ne: [] } } },
      // {
      //   $lookup: {
      //     from: "pdformdatas", // Collection name in MongoDB
      //     let: { 
      //       creditPdIds: {
      //         $map: {
      //           input: "$externalVenderData",
      //           as: "vendor",
      //           in: "$$vendor.creditPdId"
      //         }
      //       }
      //     },
      //     pipeline: [
      //       {
      //         $match: {
      //           $expr: {
      //             $in: [
      //               { $toObjectId: "$_id" }, 
      //               { $map: { input: "$$creditPdIds", as: "id", in: { $toObjectId: "$$id" } } }
      //             ]
      //           }
      //         }
      //       },
      //       {
      //         $project: {
      //           status: 1,
      //           bdCompleteDate: 1,
      //           pdId: 1,
      //           hoStatus: 1,
      //           hoRemark: 1,
      //           defaultStatus: 1,
      //           fileProcessStatus: 1,
      //           branchStatus: 1
      //         }
      //       }
      //     ],
      //     as: "pdData"
      //   }
      // },
      // Match customers with pdData
      // { $match: { pdData: { $ne: [] } } },
      {
        $lookup: {
          from: "employees",
          let: { 
            pdIds: "$externalVenderData.creditPdId"
          },
          pipeline: [
            {
              $match: {
                $expr: {
                  $in: ["$_id", "$$pdIds"]
                }
              }
            },
            {
              $project: {
                employeName: 1,
              }
            }
          ],
          as: "pdCompleteDetails"
        }
      },
      // Lookup employeeDetail and branchDetail in one go
      {
        $lookup: {
          from: "employees",
          let: { employeeId: "$employeId" },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$employeeId"] } } },
            {
              $project: {
                employeName: 1,
                userName: 1,
                employeUniqueId: 1,
                reportingManagerId: 1,
                branchId: 1,
              },
            },
          ],
          as: "employeeDetail",
        },
      },
      // Lookup salesManagerDetails
      {
        $lookup: {
          from: "employees",
          let: {
            reportingManagerId: {
              $arrayElemAt: ["$employeeDetail.reportingManagerId", 0],
            },
          },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$reportingManagerId"] } } },
            { $project: { employeName: 1, employeUniqueId: 1, userName: 1 } },
          ],
          as: "salesManagerDetails",
        },
      },
      // Lookup branchDetail
      {
        $lookup: {
          from: "newbranches",
          let: { branchId: { $arrayElemAt: ["$employeeDetail.branchId", 0] } },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$branchId"] } } },
            { $project: { name: 1 } },
          ],
          as: "branchDetail",
        },
      },
      // Lookup applicantDetail
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            {
              $project: {
                fullName: 1,
                fatherName: 1,
                mobileNo: 1,
                applicantPhoto: 1,
                applicantAddress: "$permanentAddress.addressLine1",
              },
            },
          ],
          as: "applicantDetail",
        },
      },
      // Lookup cibildetailDetail
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [{ $project: { applicantCibilScore: 1 } }],
          as: "cibildetailDetail",
        },
      },
      // Lookup finalSanctionData with nested employee details
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            {
              $lookup: {
                from: "employees",
                localField: "employeeId",
                foreignField: "_id",
                as: "employeeDetail",
              },
            },
            {
              $addFields: {
                isEmployeeIdMissing: {
                  $not: { $ifNull: ["$employeeId", false] },
                },
                esignLinkStatus: {
                  $cond: [
                    {
                      $and: [
                        { $eq: [{ $type: "$esignLink" }, "array"] },
                        {
                          $gt: [{ $size: { $ifNull: ["$esignLink", []] } }, 0],
                        },
                      ],
                    },
                    "Yes",
                    "No",
                  ],
                },
              },
            },
          ],
          as: "finalSanctionData",
        },
      },
      {
        $lookup: {
          from: "bankstatementkycs",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            { $match: { Nachlink: { $nin: ["", null] } } }, // Filter out empty/null Nachlink earlier
            { $project: { Nachlink: 1 } },
          ],
          as: "bankStatementKycDetail",
        },
      },

      // Add field to check if Nachlink exists
      {
        $addFields: {
          hasNachLink: {
            $cond: {
              if: { $gt: [{ $size: "$bankStatementKycDetail" }, 0] },
              then: true,
              else: false,
            },
          },
        },
      },
      {
        $lookup: {
          from: "externalvendordynamics",
          localField: "_id",
          foreignField: "customerId",
          as: "externalVendorDetail",
          pipeline: [
            {
              $project: {
                vendors: {
                  $map: {
                    input: "$vendors",
                    as: "vendor",
                    in: {
                      vendorType: "$$vendor.vendorType",
                      statusByVendor: "$$vendor.statusByVendor",
                    },
                  },
                },
              },
            },
          ],
        },
      },
      // Final Projection
      {
        $project: {
          _id: 1,
          employeId: 1,
          productId: 1,
          customerFinId: 1,
          mobileNo: 1,
          executiveName: 1,
          "externalVenderData.customerId": 1,
          "externalVenderData.statusByCreditPd": 1,
          "externalVenderData.fileStatus": 1,
          "externalVenderData.creditPdCompleteDate": 1,
          // debugPdIds: 1,
          // // pdData:1,
          // "pdData.fileProcessStatus": 1,
          // "pdData.fileProcessStatus": { $arrayElemAt: ["$pdData.fileProcessStatus", 0] },
          // "pdData.branchStatus": { $arrayElemAt: ["$pdData.branchStatus", 0] },
          // "pdData.status": { $arrayElemAt: ["$pdData.status", 0] },
          // "pdData.bdCompleteDate": { $arrayElemAt: ["$pdData.bdCompleteDate", 0] },
          // "pdData.hoStatus": { $arrayElemAt: ["$pdData.hoStatus", 0] },
          // "pdData.hoRemark": { $arrayElemAt: ["$pdData.hoRemark", 0] },
          // "pdData.defaultStatus": { $arrayElemAt: ["$pdData.defaultStatus", 0] },
          // "pdData.fileProcessStatus": 1,
          "pdCompleteDetails.employeName": 1,
          "employeeDetail.employeName": {
            $arrayElemAt: ["$employeeDetail.employeName", 0],
          },
          "employeeDetail.userName": {
            $arrayElemAt: ["$employeeDetail.userName", 0],
          },
          "employeeDetail.employeUniqueId": {
            $arrayElemAt: ["$employeeDetail.employeUniqueId", 0],
          },
          "salesManagerDetails.employeName": {
            $arrayElemAt: ["$salesManagerDetails.employeName", 0],
          },
          "salesManagerDetails.employeUniqueId": {
            $arrayElemAt: ["$salesManagerDetails.employeUniqueId", 0],
          },
          "salesManagerDetails.userName": {
            $arrayElemAt: ["$salesManagerDetails.userName", 0],
          },
          "branchDetail.name": { $arrayElemAt: ["$branchDetail.name", 0] },
          "applicantDetail.fullName": {
            $arrayElemAt: ["$applicantDetail.fullName", 0],
          },
          "applicantDetail.fatherName": {
            $arrayElemAt: ["$applicantDetail.fatherName", 0],
          },
          "applicantDetail.mobileNo": {
            $arrayElemAt: ["$applicantDetail.mobileNo", 0],
          },
          "applicantDetail.applicantPhoto": {
            $arrayElemAt: ["$applicantDetail.applicantPhoto", 0],
          },
          "applicantDetail.applicantAddress": {
            $arrayElemAt: ["$applicantDetail.applicantAddress", 0],
          },
          "cibildetailDetail.applicantCibilScore": {
            $arrayElemAt: ["$cibildetailDetail.applicantCibilScore", 0],
          },
          finalSanctionData: {
            _id: { $arrayElemAt: ["$finalSanctionData._id", 0] },
            status: { $arrayElemAt: ["$finalSanctionData.status", 0] },
            employeeId: { $arrayElemAt: ["$finalSanctionData.employeeId", 0] },
            employeeDetail: {
              employeName: {
                $arrayElemAt: [
                  {
                    $arrayElemAt: [
                      "$finalSanctionData.employeeDetail.employeName",
                      0,
                    ],
                  },
                  0,
                ],
              },
            },
            finalLoanAmount: {
              $arrayElemAt: ["$finalSanctionData.finalLoanAmount", 0],
            },
            roi: { $arrayElemAt: ["$finalSanctionData.roi", 0] },
            tenureInMonth: {
              $arrayElemAt: ["$finalSanctionData.tenureInMonth", 0],
            },
            selfAssignStatus: {
              $cond: {
                if: {
                  $gt: [
                    { $arrayElemAt: ["$finalSanctionData.employeeId", 0] },
                    null,
                  ],
                },
                then: true,
                else: false,
              },
            },
            esignLinkStatus: {
              $cond: {
                if: {
                  $and: [
                    {
                      $eq: [
                        {
                          $type: {
                            $arrayElemAt: ["$finalSanctionData.esignLink", 0],
                          },
                        },
                        "array",
                      ],
                    },
                    {
                      $gt: [
                        {
                          $size: {
                            $ifNull: [
                              {
                                $arrayElemAt: [
                                  "$finalSanctionData.esignLink",
                                  0,
                                ],
                              },
                              [],
                            ],
                          },
                        },
                        0,
                      ],
                    },
                  ],
                },
                then: "Yes",
                else: "No",
              },
            },
          },
          hasNachLink: 1,
          externalVendorDetail: {
            $arrayElemAt: ["$externalVendorDetail.vendors", 0],
          },
        },
      },
      { $match: searchFilter },
      {
        $skip: offset,
      },
      {
        $limit: limit,
      },
    ]);
    // const finalData = await creditPdModel.findOne({customerId: "676f8a4f4e55f86160f1804d"})
    // console.log(finalData,"finalData")
    // Fetch total count without pagination for accurate results
    const totalCount = await customerModel.aggregate([
      // Lookup pdData with filtered pipeline
      {
        $lookup: {
          from: "externalvendordynamics",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                statusByCreditPd: { $in: ["complete", "approve"] },
                fileStatus: { $in: ["active"] },
              },
            },
            {
              $project: {
                customerId: 1,
                statusByCreditPd: 1,
                fileStatus: 1,
              },
            },
          ],
          as: "externalVenderData",
        },
      },
      { $match: { externalVenderData: { $ne: [] } } },
      // {
      //   $lookup: {
      //     from: "pdformdatas",
      //     let: { customerId: "$_id" },
      //     pipeline: [
      //       {
      //         $match: {
      //           $expr: {
      //             $and: [
      //               { $eq: ["$customerId", "$$customerId"] },
      //               // { $in: ["$status", ["complete", "approve"]] },
      //             ],
      //           },
      //         },
      //       },
      //       {
      //         $project: {
      //           status: 1,
      //           bdCompleteDate: 1,
      //           pdId: 1,
      //           hoStatus: 1,
      //           hoRemark: 1,
      //           defaultStatus: 1,
      //           fileProcessStatus: 1,
      //           branchStatus: 1,
      //         },
      //       },
      //     ],
      //     as: "pdData",
      //   },
      // },
      { $match: { pdData: { $ne: [] } } },
      { $match: searchFilter },
    ]);

    // Respond with success
    res.status(200).json({
      success: true,
      totalCount: totalCount.length,
      userDataLength: results.length,
      userData: results,
    });
  } catch (error) {
    // Log error and respond with failure
    console.error("Error fetching customer details:", error);
    res.status(500).json({
      success: false,
      message: "An error occurred while fetching customer details.",
    });
  }
};

const dashbordCountUser = async (req, res) => {
  try {
    const result = await customerModel.aggregate([
      // Join pdformdatas to get related pdData
      {
        $lookup: {
          from: "pdformdatas",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                hoStatus: { $in: ["complete", "approve"] },
              },
            },
          ],
          as: "pdData",
        },
      },
      // Filter customers with at least one matching pdData
      {
        $match: {
          pdData: { $ne: [] },
        },
      },
      // Join finalsanctiondetaails to check employeeId and preSanctionStatus
      {
        $lookup: {
          from: "finalsanctiondetaails",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                employeeId: { $ne: null }, // Ensure employeeId exists
              },
            },
          ],
          as: "finalSanctionData",
        },
      },
      // Add a condition for preSanctionStatus to track "approve" cases
      {
        $addFields: {
          preSanctionApproveCount: {
            $size: {
              $filter: {
                input: "$finalSanctionData",
                as: "item",
                cond: { $eq: ["$$item.preSanctionStatus", "approve"] },
              },
            },
          },
        },
      },
      // Calculate totalCount, selfAssignCount, and preSanctionToBanch
      {
        $group: {
          _id: null,
          totalCount: { $sum: 1 }, // Count all documents with matching pdData
          selfAssignCount: {
            $sum: {
              $cond: [{ $gt: [{ $size: "$finalSanctionData" }, 0] }, 1, 0],
            }, // Count if employeeId exists
          },
          preSanctionToBanch: { $sum: "$preSanctionApproveCount" }, // Count where preSanctionStatus is "approve"
        },
      },
    ]);

    // Extract counts
    const totalCount = result[0]?.totalCount || 0;
    const selfAssignCount = result[0]?.selfAssignCount || 0;
    const totalSanctionToBanch = result[0]?.preSanctionToBanch || 0;

    // Return the counts
    return success(res, "Counts fetched successfully", {
      totalCount,
      selfAssignCount,
      totalSanctionToBanch,
    });
  } catch (error) {
    console.error("Error fetching counts:", error);
    return res.status(500).json({
      message: "An unknown error occurred",
      error: error.message,
    });
  }
};

// dashbord file process api
const customerListFileProcess = async (req, res) => {
  try {
    const { pageLimit, pageNumber, search } = req.query;
    const { offset, limit } = paginationData(pageLimit, pageNumber);

    console.log("api test------", offset, limit);
    // Build search filter
    const searchFilter = {};
    if (search) {
      searchFilter.$or = [
        { "nearestBranchData.name": { $regex: search, $options: "i" } },
        { "branchDetail.name": { $regex: search, $options: "i" } },
        { "applicantDetail.fullName": { $regex: search, $options: "i" } }, // Applicant name (case-insensitive)
        { customerFinId: { $regex: search, $options: "i" } },
        {
          $expr: {
            $regexMatch: {
              input: { $toString: "$mobileNo" }, // Convert numeric field to string
              regex: search,
              options: "i",
            },
          },
        }, // Mobile number as string (case-insensitive)
      ];
    }
    console.time("API Execution Time");

    const results = await customerModel.aggregate([
      // Lookup pdData with filtered pipeline
      {
        $lookup: {
          from: "pdformdatas",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$customerId", "$$customerId"] }, // Match customerId
                    { $eq: ["$defaultStatus", true] }, // Match defaultStatus as true
                    {
                      $or: [
                        { $eq: ["$status", "complete"] }, // Match status "complete"
                        { $eq: ["$status", "approve"] }, // Match status "approve"
                      ],
                    },
                  ],
                },
              },
            },
            {
              $project: {
                status: 1,
                bdCompleteDate: 1,
                pdId: 1,
                hoStatus: 1,
                hoRemark: 1,
              },
            },
          ],
          as: "pdData",
        },
      },
      // Match customers with pdData
      { $match: { pdData: { $ne: [] } } },
      {
        $lookup: {
          from: "employees",
          let: { pdId: { $arrayElemAt: ["$pdData.pdId", 0] } }, // Lookup using the first pdId
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$pdId"] } } },
            { $project: { employeName: 1 } },
          ],
          as: "pdCompleteDetails",
        },
      },
      // Lookup employeeDetail and branchDetail in one go
      {
        $lookup: {
          from: "employees",
          let: { employeeId: "$employeId" },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$employeeId"] } } },
            {
              $project: {
                employeName: 1,
                userName: 1,
                employeUniqueId: 1,
                reportingManagerId: 1,
                branchId: 1,
              },
            },
          ],
          as: "employeeDetail",
        },
      },
      // Lookup salesManagerDetails
      {
        $lookup: {
          from: "employees",
          let: {
            reportingManagerId: {
              $arrayElemAt: ["$employeeDetail.reportingManagerId", 0],
            },
          },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$reportingManagerId"] } } },
            { $project: { employeName: 1, employeUniqueId: 1, userName: 1 } },
          ],
          as: "salesManagerDetails",
        },
      },
      // Lookup branchDetail
      {
        $lookup: {
          from: "newbranches",
          let: { branchId: { $arrayElemAt: ["$employeeDetail.branchId", 0] } },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$branchId"] } } },
            { $project: { name: 1 } },
          ],
          as: "branchDetail",
        },
      },
      // Lookup applicantDetail
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            {
              $project: {
                fullName: 1,
                fatherName: 1,
                mobileNo: 1,
                applicantPhoto: 1,
                applicantAddress: "$permanentAddress.addressLine1",
              },
            },
          ],
          as: "applicantDetail",
        },
      },
      // Lookup cibildetailDetail
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [{ $project: { applicantCibilScore: 1 } }],
          as: "cibildetailDetail",
        },
      },
      // Lookup finalSanctionData with nested employee details
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            {
              $lookup: {
                from: "employees",
                localField: "employeeId",
                foreignField: "_id",
                as: "employeeDetail",
              },
            },
            {
              $addFields: {
                isEmployeeIdMissing: {
                  $not: { $ifNull: ["$employeeId", false] },
                },
                esignLinkStatus: {
                  $cond: [
                    {
                      $and: [
                        { $eq: [{ $type: "$esignLink" }, "array"] },
                        {
                          $gt: [{ $size: { $ifNull: ["$esignLink", []] } }, 0],
                        },
                      ],
                    },
                    "Yes",
                    "No",
                  ],
                },
              },
            },
          ],
          as: "finalSanctionData",
        },
      },
      {
        $lookup: {
          from: "bankstatementkycs",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            { $match: { Nachlink: { $nin: ["", null] } } }, // Filter out empty/null Nachlink earlier
            { $project: { Nachlink: 1 } },
          ],
          as: "bankStatementKycDetail",
        },
      },

      // Add field to check if Nachlink exists
      {
        $addFields: {
          hasNachLink: {
            $cond: {
              if: { $gt: [{ $size: "$bankStatementKycDetail" }, 0] },
              then: true,
              else: false,
            },
          },
        },
      },
      {
        $lookup: {
          from: "externalvendordynamics",
          localField: "_id",
          foreignField: "customerId",
          as: "externalVendorDetail",
          pipeline: [
            {
              $project: {
                vendors: {
                  $map: {
                    input: "$vendors",
                    as: "vendor",
                    in: {
                      vendorType: "$$vendor.vendorType",
                      statusByVendor: "$$vendor.statusByVendor",
                    },
                  },
                },
              },
            },
          ],
        },
      },
      // Final Projection
      {
        $project: {
          _id: 1,
          employeId: 1,
          productId: 1,
          customerFinId: 1,
          mobileNo: 1,
          executiveName: 1,
          "pdData.status": 1,
          "pdData.bdCompleteDate": 1,
          "pdCompleteDetails.employeName": 1,
          "pdData.hoStatus": 1,
          "pdData.hoRemark": 1,
          "employeeDetail.employeName": {
            $arrayElemAt: ["$employeeDetail.employeName", 0],
          },
          "employeeDetail.userName": {
            $arrayElemAt: ["$employeeDetail.userName", 0],
          },
          "employeeDetail.employeUniqueId": {
            $arrayElemAt: ["$employeeDetail.employeUniqueId", 0],
          },
          "salesManagerDetails.employeName": {
            $arrayElemAt: ["$salesManagerDetails.employeName", 0],
          },
          "salesManagerDetails.employeUniqueId": {
            $arrayElemAt: ["$salesManagerDetails.employeUniqueId", 0],
          },
          "salesManagerDetails.userName": {
            $arrayElemAt: ["$salesManagerDetails.userName", 0],
          },
          "branchDetail.name": { $arrayElemAt: ["$branchDetail.name", 0] },
          "applicantDetail.fullName": {
            $arrayElemAt: ["$applicantDetail.fullName", 0],
          },
          "applicantDetail.fatherName": {
            $arrayElemAt: ["$applicantDetail.fatherName", 0],
          },
          "applicantDetail.mobileNo": {
            $arrayElemAt: ["$applicantDetail.mobileNo", 0],
          },
          "applicantDetail.applicantPhoto": {
            $arrayElemAt: ["$applicantDetail.applicantPhoto", 0],
          },
          "applicantDetail.applicantAddress": {
            $arrayElemAt: ["$applicantDetail.applicantAddress", 0],
          },
          "cibildetailDetail.applicantCibilScore": {
            $arrayElemAt: ["$cibildetailDetail.applicantCibilScore", 0],
          },
          finalSanctionData: {
            _id: { $arrayElemAt: ["$finalSanctionData._id", 0] },
            status: { $arrayElemAt: ["$finalSanctionData.status", 0] },
            employeeId: { $arrayElemAt: ["$finalSanctionData.employeeId", 0] },
            employeeDetail: {
              employeName: {
                $arrayElemAt: [
                  {
                    $arrayElemAt: [
                      "$finalSanctionData.employeeDetail.employeName",
                      0,
                    ],
                  },
                  0,
                ],
              },
            },
            finalLoanAmount: {
              $arrayElemAt: ["$finalSanctionData.finalLoanAmount", 0],
            },
            roi: { $arrayElemAt: ["$finalSanctionData.roi", 0] },
            tenureInMonth: {
              $arrayElemAt: ["$finalSanctionData.tenureInMonth", 0],
            },
            selfAssignStatus: {
              $cond: {
                if: {
                  $gt: [
                    { $arrayElemAt: ["$finalSanctionData.employeeId", 0] },
                    null,
                  ],
                },
                then: true,
                else: false,
              },
            },
            esignLinkStatus: {
              $cond: {
                if: {
                  $and: [
                    {
                      $eq: [
                        {
                          $type: {
                            $arrayElemAt: ["$finalSanctionData.esignLink", 0],
                          },
                        },
                        "array",
                      ],
                    },
                    {
                      $gt: [
                        {
                          $size: {
                            $ifNull: [
                              {
                                $arrayElemAt: [
                                  "$finalSanctionData.esignLink",
                                  0,
                                ],
                              },
                              [],
                            ],
                          },
                        },
                        0,
                      ],
                    },
                  ],
                },
                then: "Yes",
                else: "No",
              },
            },
          },
          hasNachLink: 1,
          externalVendorDetail: {
            $arrayElemAt: ["$externalVendorDetail.vendors", 0],
          },
        },
      },
      { $match: searchFilter },
      {
        $skip: offset,
      },
      {
        $limit: limit,
      },
    ]);

    //     // Fetch total count without pagination for accurate results
    const totalCount = await customerModel.aggregate([
      {
        $lookup: {
          from: "newbranches",
          localField: "nearestBranchId",
          foreignField: "_id",
          as: "nearestBranchData",
        },
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "branch",
          foreignField: "_id",
          as: "branchDetail",
        },
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          as: "applicantDetail",
        },
      },
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          as: "cibildetailDetail",
        },
      },
      {
        $lookup: {
          from: "pdformdatas",
          localField: "_id",
          foreignField: "customerId",
          as: "pdData",
        },
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          as: "finalSanctionData",
        },
      },
      // {
      //   $match: {
      //     $or: [
      //       { "pdData.defaultStatus": true },
      //       // { "pdData.status": "approve" }
      //     ]
      //   }
      // },
      {
        $match: {
          pdData: {
            $elemMatch: {
              defaultStatus: true,
              $or: [{ status: "complete" }, { status: "approve" }],
            },
          },
        },
      },
      {
        $group: {
          _id: "$_id", // Use a unique field to group by
          document: { $first: "$$ROOT" }, // Retain the first occurrence of each record
        },
      },
      {
        $replaceRoot: { newRoot: "$document" }, // Replace the grouped document as the root
      },
      {
        $project: {
          "nearestBranchData.name": 1,
          "branchDetail.name": 1,
          "applicantDetail.fullName": 1,
          mobileNo: 1,
        },
      },
      // Match filter for total count
      { $match: searchFilter },
    ]);
    // Extract totalCount and userData from results
    // const totalCount = results[0].totalCount[0]?.count || 0;
    // const userData = results[0].paginatedResults;
    console.log(totalCount, "totalCount<><><><><><><><><><>");
    // Respond with success
    return success(res, "customerDetails", {
      totalCount: totalCount.length,
      userDataLength: results.length,
      userData: results,
    });
  } catch (error) {
    // Log error and respond with failure
    console.error("Error fetching customer details:", error);
    res.status(500).json({
      success: false,
      message: "An error occurred while fetching customer details.",
    });
  }
};

const customerDetails = async (req, res) => {
  try {
    let { customerId } = req.params;
    customerId = new mongoose.Types.ObjectId(req.params.customerId);
    const userData = await customerModel.aggregate([
      {
        $match: {
          _id: customerId,
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "employeId",
          foreignField: "_id",
          as: "salesPersonDetail",
        },
      },
        {
          $unwind: {
            path: "$salesPersonDetail",
            preserveNullAndEmptyArrays: true,
          },
        },
      {
        $lookup: {
          from: "newbranches",
          localField: "branch",
          foreignField: "_id",
          as: "branchData",
        },
      },
        {
          $unwind: {
            path: "$branchData",
            preserveNullAndEmptyArrays: true,
          },
        },
      
      {
        $lookup: {
          from: "products",
          localField: "productId",
          foreignField: "_id",
          as: "productData",
        },
      },
      {
        $unwind: {
          path: "$productData",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "nearestBranchId",
          foreignField: "_id",
          as: "nearestBranchData",
        },
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          as: "applicantDetail",
        },
      },
      {
        $unwind: {
          path: "$applicantDetail",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          as: "cibildetailDetail",
        },
      },
      {
        $unwind: {
          path: "$cibildetailDetail",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "externalvendordynamics",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$customerId", "$$customerId"] },
                    { $ne: [{ $type: "$customerId" }, "missing"] }
                  ]
                }
              }
            }
          ],
          as: "pdDetail"
        }
      },
      {
        $unwind: {
          path: "$pdDetail",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "employees",
          let: { creditPdId: "$pdDetail.creditPdId" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$_id", "$$creditPdId"] },
                    { $ne: [{ $type: "$$creditPdId" }, "missing"] }
                  ]
                }
              }
            }
          ],
          as: "creditPdDetail"
        }
      },
      {
        $unwind: {
          path: "$creditPdDetail",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$customerId", "$$customerId"] },
                    { $ne: [{ $type: "$customerId" }, "missing"] }
                  ]
                }
              }
            }
          ],
          as: "finalSanction"
        }
      },
      {
        $unwind: {
          path: "$finalSanction",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "lenders",
          let: { partnerId: "$finalSanction.partnerId" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$_id", "$$partnerId"] },
                    { $ne: [{ $type: "$$partnerId" }, "missing"] }
                  ]
                }
              }
            }
          ],
          as: "partnerDetail"
        }
      },
      {
        $unwind: {
          path: "$partnerDetail",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $project: {
          _id: 1,
          employeId: 1,
          productId: 1,
          customerFinId: 1,
          mobileNo: 1,
          loanAmount: 1,
          roi: 1,
          tenure: 1,
          emi: 1,
          executiveName: 1,
          createdAt: 1,
          updatedAt: 1,
          "applicantDetail.fullName": 1,
          "applicantDetail.mobileNo": 1,
          "applicantDetail.applicantPhoto": 1,
          "cibildetailDetail.applicantCibilScore": 1,
          "salesPersonDetail.employeName":1,
          "creditPdDetail.employeName":1,
          "partnerDetail.fullName":1,
          "branchData.name":1,
          "productData.productName": 1,
          tvrDetails: {
            income: "7%",
            propertyValue: "50L",
            foir: "30%",
            ltv: "9%",
          },
        },
      },
      {
        $group: {
          _id: "$_id", // Group by customer ID to remove duplicates
          employeId: { $first: "$employeId" },
          productId: { $first: "$productId" },
          customerFinId: { $first: "$customerFinId" },
          mobileNo: { $first: "$mobileNo" },
          loanAmount: { $first: "$loanAmount" },
          roi: { $first: "$roi" },
          tenure: { $first: "$tenure" },
          emi: { $first: "$emi" },
          executiveName: { $first: "$executiveName" },
          createdAt: { $first: "$createdAt" },
          updatedAt: { $first: "$updatedAt" },
          applicantDetail: { $first: "$applicantDetail" },
          cibildetailDetail: { $first: "$cibildetailDetail" },
          salesPersonDetail:{$first: "$salesPersonDetail" },
          creditPdDetail:{$first: "$creditPdDetail" },
          partnerDetail:{$first: "$partnerDetail" },
          branchName:{$first:"$branchData"},
          productData: { $first: "$productData" },
          tvrDetails: { $first: "$tvrDetails" },
        },
      },
    ]);

    return success(res, "customer details", {
      userData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// ----------------DEAL SUMMARY AC ,ACG , ACC , ACCG -------------------

async function dealSummaryType(req, res) {
  try {
    const { customerId } = req.query;

    if (!customerId) {
      return badRequest(res, "customerId is required");
    }

    // Check in Customer Detail
    const customer = await customerModel.findById(customerId);
    if (!customer) {
      return badRequest(res, "Customer not found");
    }

    // Check in Applicant Model
    const applicant = await applicantModel.findOne({ customerId });

    // Check in Co-Applicant Model
    const coApplicantCount = await coApplicantModel.countDocuments({ customerId });

    // Check in Guarantor Model
    const guarantorCount = await guarantorModel.countDocuments({ customerId });

    // Initialize an empty type array
    let typeArray = [];

    if (applicant) typeArray.push("A");
    if (coApplicantCount > 0) typeArray.push("C".repeat(coApplicantCount));
    if (guarantorCount > 0) typeArray.push("G".repeat(guarantorCount));

    // Generate type string
    const type = typeArray.join("");

    if (!type) {
      return badRequest(res, "Customer ID not found in any model");
    }

    const selectionData = await final.findOne({ customerId });
    let newSelectionData;
    
    // Check if selectionData exists before accessing pdfSelection
    if (!selectionData || !selectionData?.pdfSelection) {
      console.log("in if block");
    
      newSelectionData = await final.findOneAndUpdate(
        { customerId },
        { $set: { pdfSelection: type } },
        { new: true, upsert: true } // upsert ensures a document is created if it doesn't exist
      );
    }
    
    // Ensure selectionData is always defined
    const pdfSelectionValue = newSelectionData?.pdfSelection || selectionData?.pdfSelection || type;
    
    // console.log(pdfSelectionValue, "pdfSelectionValue<<>><<>>");
    
    return success(res, "Customer Deal Summary Type", 
       pdfSelectionValue.toUpperCase()
    );

  } catch (error) {
    console.error("Error in dealSummaryType:", error);
    return unknownError(res, error);
  }
}


const customerApplicantDetail = async (req, res) => {
  try {
    let { customerId } = req.query;
    customerId = new mongoose.Types.ObjectId(customerId);
    const data = await applicantModel.findOne({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const udyamdatasDetail = await udyamModel.findOne({ customerId });
    const camReportDetails = await camReportModel.findOne({ customerId });
    const civilDetails = await cibilModel.findOne({ customerId });

    const responseData = {
      ApplicantDetails: {
        ApplicantType: data?.applicantType || "",
        bussinessType: data?.businessType || " ",
        caste: data?.caste || "",
        noOfDependentWithCustomer: data?.noOfDependentWithCustomer || "",
        occupation: data?.occupation || "",
        residenceType: data?.residenceType || "",
        applicantPhoto: data?.applicantPhoto || "",
        fullName: data?.fullName || "",
        fatherName: data?.fatherName || "",
        motherName: data?.motherName || "",
        spouseName: data?.spouseName || "",
        dob: data?.dob || "",
        age: data?.age || "",
        gender: data?.gender || "",
        maritalStatus: data?.maritalStatus || "",
        educationalDetails: data?.education || "",
        religion: data?.religion || "",
        nationality: "Indian" || "",
        category: data?.category || "",
      },
      kycDetailsOf: {
        panNo: data?.panNo || "",
        aadharNo: data?.aadharNo || "",
        voterIdNo: data?.voterIdNo || "",
        udyamRegistrationNo:
          udyamdatasDetail?.udyamDetails?.udyamRegistrationNo || "",
          
      },
      kycUpload: {
        aadharFrontImage:data?.kycUpload?.aadharFrontImage || "",
        aadharBackImage: data?.kycUpload?.aadharBackImage || "",
        panFrontImage: data?.kycUpload?.panFrontImage || "",
        drivingLicenceImage: data?.kycUpload?.drivingLicenceImage || "",
        voterIdImage: data?.kycUpload?.voterIdImage || "",
      },
      
      contactInformation: {
        mobileNo: data?.mobileNo || "",
        mobileNoTwo: data?.alternateMobileNo || "",
        email: data?.email || "",
      },
      persnalDetails: {
        religion: data?.religion || "",
        nationality: data?.nationality || "",
        category: data?.category || "",
      },
      // permanentInformation: {
      //   fullAddress: data?.permanentAddress?.addressLine1 || "",
      //   addressLine2: data?.permanentAddress?.addressLine2 || "",
      //   presentAddress: data?.localAddress?.addressLine1 || "",
      //   landmark: pdformdatasDetail?.applicant?.houseLandMark || "",
      //   city: data?.permanentAddress?.city || "",
      //   state: data?.permanentAddress?.state || "",
      //   district: data?.permanentAddress?.district || "",
      //   pinCode: data?.permanentAddress?.pinCode || "",
      //   noOfyearsAtCurrentAddress:
      //     pdformdatasDetail?.applicant?.noOfyearsAtCurrentAddress || "",
      //   country: "India",
      // },
      presentInformation: {
        addressAsPerAdhar: data?.localAddress?.addressLine1 || "",
        addressLine2: data?.localAddress?.addressLine2 || "",
        landmark: data?.houseLandMark || "",
        city: data?.localAddress?.city || "",
        state: data?.localAddress?.state || "",
        district: data?.localAddress?.district || "",
        pinCode: data?.localAddress?.pinCode || "",
        noOfyearsAtCurrentAddress:
          data?.noOfyearsAtCurrentAddress || "",
        country: "India",
        residenceType: data?.residenceType || "",
      },
      basicInformation: {
        applicantCibilScore: civilDetails?.applicantCibilScore || "",
      },
      accountSummary: {
        totalAccounts: civilDetails?.applicantTotalAccount || "",
        overdueAccounts: civilDetails?.applicantOverdueAccount || "",
        zeroBalanceAccount: civilDetails?.applicantZeroBalanceAccount || "",
      },
      financialOverview: {
        HighCreditAndSanctionAmount:
          civilDetails?.applicantHighCreditSanctionAmount || "",
        TotalCurrentOutstanding:
          civilDetails?.applicantcurrentOutstanding || "",
        TotalOverdueAmount: civilDetails?.applicantTotalOverDueAmount || "",
        totalNoOfEnquiry: civilDetails?.applicantNumberOfEnquiry || "",
      },
      educationAndOccupation: {
        education: data?.education || "",
        occupation: camReportDetails?.applicationInformation?.occupation || "",
        monthlyIncome:
          camReportDetails?.applicationInformation?.monthlyIncome || "",
        otherMonthlyIncome:
          camReportDetails?.applicationInformation?.otherMonthlyIncome || "",
        sourceOfOtherIncome:
          camReportDetails?.applicationInformation?.sourceOfOtherIncome || "",
        annualIncome:
          camReportDetails?.applicationInformation?.annualIncome || "",
        totalHouseHoldExpenses:
          camReportDetails?.applicationInformation?.totalHouseHoldExpenses ||
          "",
      },
    };

    return success(res, "Customer applicant details", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// const customerCoApplicantDetail = async (req, res) => {
//   try {
//     const { customerId } = req.query;
//     const data = await coApplicantModel.find({ customerId });
//     const pdformdatasDetail = await creditPdModel.findOne({ customerId });
//     const camReportDetails = await camReportModel.findOne({ customerId });
//     const udhyamKycData = await udhyamKycModel.findOne({ customerId });
//     // console.log(data, "datadatadata");

//     const coApplicantDetailsArray = (
//       pdformdatasDetail?.co_Applicant &&
//       pdformdatasDetail.co_Applicant.length > 0
//         ? pdformdatasDetail.co_Applicant
//         : [{}]
//     ).map((value = {}, index) => {
//       return {
//         [`coApplicantDetails`]: {
//           _id :data?.[index]?._id,
//           customerId:data?.[index]?.customerId,
//           ApplicantType: value.coApplicantType || "",
//           bussinessType: value.businessType || "",
//           coApplicantPhoto: data?.[index]?.coApplicantPhoto || "",
//           fullName: data?.[index]?.fullName || "",
//           fatherName: data?.[index]?.fatherName || "",
//           motherName: data?.[index]?.motherName || "",
//           dob: data?.[index]?.dob || "",
//           age: data?.[index]?.age || "",
//           gender: data?.[index]?.gender || "",
//           maritalStatus: data?.[index]?.maritalStatus || "",
//           educationDetails: data?.[index]?.education || "",
//           relationWithApplicant: data?.[index]?.relationWithApplicant || "",
//           religion: data?.[index]?.religion || "",
//           nationality: "indian",
//           caste: value.caste || "",
//           category: data?.[index]?.category || "",
//           occupation: value?.occupation || "",
          
//           contactInformation: {
//             mobileNo: data?.[index]?.mobileNo || "",
//             mobileNoTwo: value.alternateMobileNo || "",
//             email: data?.[index]?.email || "",
//           },
    
//           kycDetails: {
//             udyamRegistrationNo: "",
//             docType: data?.[index]?.docType || "",
//             aadharNo: data?.[index]?.aadharNo || "",
//             docNo: data?.[index]?.docNo || "",
//           },
//           kycUpload: {
//             aadharFrontImage: data?.[index]?.kycUpload?.aadharFrontImage || "",
//             aadharBackImage: data?.[index]?.kycUpload?.aadharBackImage || "",
//             docImage: data?.[index]?.kycUpload?.docImage || "",
//           },
    
//           presentAddressInformation: {
//             AddressAsPerAdhar: data?.[index]?.localAddress?.addressLine1 || "",
//             addressLine2: data?.[index]?.localAddress?.addressLine2 || "",
//             landmark: value.houseLandMark || "",
//             nameOfCity: data?.[index]?.localAddress?.city || "",
//             city: data?.[index]?.localAddress?.city || "",
//             state: data?.[index]?.localAddress?.state || "",
//             districtName: data?.[index]?.localAddress?.district || "",
//             pinCode: data?.[index]?.localAddress?.pinCode || "",
//             residenceType: value?.residenceType || "",
//             noOfyearsAtCurrentAddress: value.noOfyearsAtCurrentAddress || "",
//             country: "India",
//           },
    
//           employeDetails: {
//             education: data?.[index]?.education || "",
//             occupation:
//               camReportDetails?.coApplicationInformation?.[index]?.occupation || "",
//             monthlyIncome:
//               camReportDetails?.coApplicationInformation?.[index]?.monthlyIncome ||
//               "",
//             otherMonthlyIncome:
//               camReportDetails?.coApplicationInformation?.[index]
//                 ?.otherMonthlyIncome || "",
//             sourceOfOtherIncome:
//               camReportDetails?.coApplicationInformation?.[index]
//                 ?.sourceOfOtherIncome || "",
//             annualIncome:
//               camReportDetails?.coApplicationInformation?.[index]?.annualIncome ||
//               "",
//             totalHouseHoldExpenses:
//               camReportDetails?.coApplicationInformation?.[index]
//                 ?.totalHouseHoldExpenses || "",
//           },
//         },
//       };
//     });
    
//     const responseData = coApplicantDetailsArray.length > 0 ? coApplicantDetailsArray : [{}];
    
//     // Combine array into an object
//     // const responseData = coApplicantDetailsArray.reduce(
//     //   (acc, curr) => Object.assign(acc, curr),
//     //   {}
//     // );

//     if (!Object.keys(responseData).length) {
//       responseData = {
//         ApplicantType: "",
//         bussinessType: "",
//         fullName: "",
//         fatherName: "",
//         motherName: "",
//         dob: "",
//         age: "",
//         gender: "",
//         maritalStatus: "",
//         educationDetails: "",
//         relationWithApplicant: "",
//         religion: "",
//         nationality: "",
//         category: "",
//         caste: "",
//         occupation: "",
//         residenceType: "",

//         contactInformation: {
//           mobileNo: "",
//           mobileNoTwo: "",
//           email: "",
//         },

//         kycDetails: {
//           udyamRegistrationNo: "",
//           docType: "",
//           aadharNo: "",
//           docNo: "",
//         },

//         permanentAddressInformation: {
//           AddressAsPerAdhar: "",
//           // landmark: "",
//           nameOfCity: "",
//           city: "",
//           state: "",
//           districtName: "",
//           pinCode: "",
//           noOfyearsAtCurrentAddress: "",
//           country: "India",
//           residenceType: "",
//         },

//         presentAddressInformation: {
//           presentAddress: "",
//           fullAddress: "",
//           landmark: "",
//           nameOfCity: "",
//           addressLine1: "",
//           addressLine2: "",
//           city: "",
//           state: "",
//           districtName: "",
//           pinCode: "",
//           noOfyearsAtCurrentAddress: "",
//           country: "India",
//         },

//         employeDetails: {
//           education: "",
//           occupation: "",
//           monthlyIncome: "",
//           otherMonthlyIncome: "",
//           sourceOfOtherIncome: "",
//           annualIncome: "",
//           totalHouseHoldExpenses: "",
//         },
//       };
//     }

//     return success(res, "Customer co-applicant details", {
//       data: responseData,
//     });
//   } catch (error) {
//     console.log(error);
//     return unknownError(res, error);
//   }
// };


const customerCoApplicantDetail = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await coApplicantModel.find({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const camReportDetails = await camReportModel.findOne({ customerId });

    const coApplicantDetailsArray = data.map((value, index) => {
      const pdDetail = pdformdatasDetail?.co_Applicant?.[index] || {};
      const camDetail = camReportDetails?.coApplicationInformation?.[index] || {};

      return {
        [`coApplicantDetails`]: {
          _id: value?._id,
          customerId: value?.customerId,
          ApplicantType: value.coApplicantType || "",
          bussinessType: value.businessType || "",
          coApplicantPhoto: value?.coApplicantPhoto || "",
          fullName: value?.fullName || "",
          fatherName: value?.fatherName || "",
          motherName: value?.motherName || "",
          dob: value?.dob || "",
          age: value?.age || "",
          gender: value?.gender || "",
          maritalStatus: value?.maritalStatus || "",
          educationDetails: value?.education || "",
          relationWithApplicant: value?.relationWithApplicant || "",
          religion: value?.religion || "",
          nationality: "Indian",
          caste: value.caste || "",
          category: value?.category || "",
          occupation: value?.occupation || "",
          
          contactInformation: {
            mobileNo: value?.mobileNo || "",
            mobileNoTwo: value?.alternateMobileNo || "",
            email: value?.email || "",
          },

          kycDetails: {
            udyamRegistrationNo: "",
            docType: value?.docType || "",
            aadharNo: value?.aadharNo || "",
            docNo: value?.docNo || "",
          },

          kycUpload: {
            aadharFrontImage: value?.kycUpload?.aadharFrontImage || "",
            aadharBackImage: value?.kycUpload?.aadharBackImage || "",
            docImage: value?.kycUpload?.docImage || "",
          },

          presentAddressInformation: {
            AddressAsPerAdhar: value?.localAddress?.addressLine1 || "",
            addressLine2: value?.localAddress?.addressLine2 || "",
            landmark: value.houseLandMark || "",
            nameOfCity: value?.localAddress?.city || "",
            city: value?.localAddress?.city || "",
            state: value?.localAddress?.state || "",
            districtName: value?.localAddress?.district || "",
            pinCode: value?.localAddress?.pinCode || "",
            residenceType: value?.residenceType || "",
            noOfyearsAtCurrentAddress: value?.noOfyearsAtCurrentAddress || "",
            country: "India",
          },

          employeDetails: {
            education: value?.education || "",
            occupation: camDetail?.occupation || "",
            monthlyIncome: camDetail?.monthlyIncome || "",
            otherMonthlyIncome: camDetail?.otherMonthlyIncome || "",
            sourceOfOtherIncome: camDetail?.sourceOfOtherIncome || "",
            annualIncome: camDetail?.annualIncome || "",
            totalHouseHoldExpenses: camDetail?.totalHouseHoldExpenses || "",
          },
        },
      };
    });

    const responseData = coApplicantDetailsArray.length > 0 ? coApplicantDetailsArray : [{}];

    return success(res, "Customer co-applicant details", { data: responseData });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};



const customerGuarantorDetail = async (req, res) => {
  try {
    const { customerId } = req.query;
    if (!customerId) {
      return badRequest(res, "customerId is required");
    }
    const data = await guarantorModel.findOne({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const camReportDetails = await camReportModel.findOne({ customerId });

    const responseData = {
      guarantorInformation: {
        name: data?.fullName,
        fatherName: data?.fatherName || "",
        motherName: data?.motherName || "",
        guarantorPhoto: data?.guarantorPhoto || "",
        relationWithApplicant: data?.relationWithApplicant || "",
        GuarantorType: data?.guarantorType || "",
        businessType: data?.businessType || "",
        dob: data?.dob || "",
        age: data?.age || "",
        gender: data?.gender || "",
        maritalStatus: data?.maritalStatus || "",
        educationalDetails: data?.education || "",
        religion: data?.religion || "",
        nationality: data?.nationality || "",
        caste: data?.caste || "",
        category: data?.category || "",
        occupation: data?.occupation || "",
        residenceType: data?.occupation || "",
      },
      kycDetails: {
        panNumber: data?.aadharNo || "",
        adharNumber: data?.aadharNo || "",
        docType: data?.docType || "", //base on the type
        docNo: data?.docNo || "",
      },
      kycUpload: {
        aadharFrontImage:data?.kycUpload?.aadharFrontImage || "",
        aadharBackImage: data?.kycUpload?.aadharBackImage || "",
        docImage: data?.kycUpload?.docImage || "",
        
      },
      contactInformation: {
        mobileNo: data?.mobileNo || "",
        MobileNoTwo: data?.alternateMobileNo || "",
        email: data?.email || "",
      },
      // permanentAddressInformation: {
      //   addressAsPerAdhar: data?.permanentAddress?.addressLine1 || "",
      //   presentAddress: data?.localAddress?.addressLine1 || "",
      //   // landmark: data?.permanentAddress?.houseLandMark || "",
      //   city: data?.permanentAddress?.city || "",
      //   state: data?.permanentAddress?.state || "",
      //   district: data?.permanentAddress?.district || "",
      //   pinCode: data?.permanentAddress?.pinCode || "",
      //   noOfyearsAtCurrentAddress:
      //     data?.noOfyearsAtCurrentAddress || "",
      //   country: "India",
      // },
      presentAddressInformation: {
        presentAddressAsPerAdhar: data?.localAddress?.addressLine1 || "",
        addressLine2: data?.localAddress?.addressLine2 || "",
        landmark: data?.houseLandMark || "",
        city: data?.localAddress?.city || "",
        state: data?.localAddress?.state || "",
        district: data?.localAddress?.district || "",
        pinCode: data?.localAddress?.pinCode || "",
        noOfyearsAtCurrentAddress:
          data?.noOfyearsAtCurrentAddress || "",
        country: "India",
        residenceType: data?.residenceType || "",
      },
      persnalDetails: {
        education: data?.education || "",
        occupation:
          camReportDetails?.guarantorInformation?.[0]?.occupation || "",
        monthlyIncome:
          camReportDetails?.guarantorInformation?.[0]?.monthlyIncome || "",
        otherMonthlyIncome:
          camReportDetails?.guarantorInformation?.[0]?.otherMonthlyIncome || "",
        sourceOfOtherIncome:
          camReportDetails?.guarantorInformation?.[0]?.sourceOfOtherIncome ||
          "",
        annualIncome:
          camReportDetails?.guarantorInformation?.[0]?.annualIncome || "",
        totalHouseHoldExpenses:
          camReportDetails?.guarantorInformation?.[0]?.totalHouseHoldExpenses ||
          "",
      },
    };
    return success(res, "Customer guarantor details", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};



const customerReferenceDetail = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await creditPdModel.findOne({ customerId });
    const responseData =
      Array.isArray(data?.referenceDetails) && data?.referenceDetails.length > 0
        ? data?.referenceDetails.map((value) => ({
            name: value.name || " ",
            address: value.address || " ",
            relation: value.relation || " ",
            mobileNumber: value.mobileNumber || " ",
          }))
        : [
            {
              name: " ",
              address: " ",
              relation: " ",
              mobileNumber: " ",
            },
          ];

    return success(res, "Customer reference details", {
      referenceDetails: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const customerCibilDetail = async (req, res) => {
  try {
    const { customerId } = req.query;

    // Fetch necessary data from the database
    const data = await cibilModel
      .findOne({ customerId })
      .populate("customerId");

    const allData = await cibilModel.aggregate([
      {
        $match: { customerId: new ObjectId(customerId) },
      },
      {
        $project: {
          applicantPdf: { $ifNull: ["$applicantCibilReport", ""] },
          guarantorPdf: { $ifNull: ["$guarantorCibilReport", ""] },
          coApplicantOnePdf: {
            $ifNull: [
              {
                $arrayElemAt: [
                  {
                    $map: {
                      input: "$coApplicantData",
                      as: "coApplicant",
                      in: "$$coApplicant.coApplicantCibilReport",
                    },
                  },
                  0,
                ],
              },
              "",
            ],
          },
          coApplicantTwoPdf: {
            $ifNull: [
              {
                $arrayElemAt: [
                  {
                    $map: {
                      input: "$coApplicantData",
                      as: "coApplicant",
                      in: "$$coApplicant.coApplicantCibilReport",
                    },
                  },
                  1,
                ],
              },
              "",
            ],
          },
        },
      },
    ]);

    // Fetch additional related data
    const guarantorData = await guarantorModel.findOne({ customerId });
    const cibilKyc = await cibilModel.findOne({ customerId });

    // Define co-applicant data logic
    const coApplicantOne = data?.coApplicantData?.[0] || {};
    const coApplicantTwo = data?.coApplicantData?.[1] || {};

    // Build the response data
    const responseData = {
      applicantData: {
        applicantCibilReportPdf: allData[0]?.applicantPdf || "",
        customerName: data?.customerId?.executiveName || "",
        applicantCibilScore: data?.applicantCibilScore || "",
        totalAccounts: data?.applicantTotalAccount || "",
        overdueAccount: data?.applicantOverdueAccount || "",
        zeroBalanceAccount: cibilKyc?.applicantZeroBalanceAccount || "",
        totalNumberOfEnquiry: cibilKyc?.applicantNumberOfEnquiry || "",
        appFinancialOverview: {
          HighCreditAndSanctionAmount:
            cibilKyc?.applicantHighCreditSanctionAmount || "",
          TotalCurrentOutstanding: cibilKyc?.applicantcurrentOutstanding || "",
          TotalOverdueAmount: cibilKyc?.applicantTotalOverDueAmount || "",
          TotalNumberOfEnquiry: cibilKyc?.applicantNumberOfEnquiry || "",
        },
        applicantCibilDetail: (data?.applicantCibilDetail || []).map(
          (value) => ({
            loanType: value?.loanType || "",
            loanAmount: value?.loanAmount || "",
            outstandingAmount: value?.outstandingAmount || "",
            overDue: value?.overDue || "",
            emi: value?.emi || "",
            cibilScore: value?.cibilScore || "",
            ownership: value?.ownership || "",
            SanctionedAmount: value?.SanctionedAmount || "",
            CurrentBalance: value?.CurrentBalance || "",
            RateOfInterest: value?.RateOfInterest || "",
            TotalTenure: value?.TotalTenure || "",
            BalanceTenure: value?.BalanceTenure || "",
            LoanStatus: value?.LoanStatus || "",
            LoanObligated: value?.LoanObligated || "",
            ObligationConsidered: value?.ObligationConsidered || "",
          })
        ),
      },
      coApplicantOne: {
        coApplicantCibilReportPdf: allData[0]?.coApplicantOnePdf || "",
        coApplicantName: coApplicantOne?.fullName || "",
        coApplicantCibilScore: coApplicantOne?.coApplicantCibilScore || "",
        totalAccount: coApplicantOne?.coApplicantTotalAccount || "",
        zeroBalanceAccount: coApplicantOne?.coApplicantZeroBalanceAccount || "",
        overdueAccount: coApplicantOne?.coApplicantOverdueAccount || "",
        appFinancialOverview: {
          HighCreditAndSanctionAmount:
            coApplicantOne?.coApplicantHighCreditSanctionAmount || "",
          TotalCurrentOutstanding:
            coApplicantOne?.coApplicantcurrentOutstanding || "",
          TotalOverdueAmount:
            coApplicantOne?.coApplicantTotalOverDueAmount || "",
          TotalNumberOfEnquiry:
            coApplicantOne?.coApplicantNumberOfEnquiry || "",
        },
        coApplicantCibilDetail: (
          coApplicantOne?.coApplicantCibilDetail || []
        ).map((value) => ({
          loanType: value?.loanType || "",
          loanAmount: value?.loanAmount || "",
          outstandingAmount: value?.outstandingAmount || "",
          overDue: value?.overDue || "",
          emi: value?.emi || "",
          cibilScore: value?.cibilScore || "",
          ownership: value?.ownership || "",
          SanctionedAmount: value?.SanctionedAmount || "",
          CurrentBalance: value?.CurrentBalance || "",
          RateOfInterest: value?.RateOfInterest || "",
          TotalTenure: value?.TotalTenure || "",
          BalanceTenure: value?.BalanceTenure || "",
          LoanStatus: value?.LoanStatus || "",
          LoanObligated: value?.LoanObligated || "",
          ObligationConsidered: value?.ObligationConsidered || "",
        })),
      },
      coApplicantTwo: {
        coApplicantCibilReportPdf: allData[0]?.coApplicantTwoPdf || "",
        coApplicantName: coApplicantTwo?.fullName || "",
        coApplicantCibilScore: coApplicantTwo?.coApplicantCibilScore || "",
        totalAccount: coApplicantTwo?.coApplicantTotalAccount || "",
        zeroBalanceAccount: coApplicantTwo?.coApplicantZeroBalanceAccount || "",
        overdueAccount: coApplicantTwo?.coApplicantOverdueAccount || "",
        appFinancialOverview: {
          HighCreditAndSanctionAmount:
            coApplicantTwo?.coApplicantHighCreditSanctionAmount || "",
          TotalCurrentOutstanding:
            coApplicantTwo?.coApplicantcurrentOutstanding || "",
          TotalOverdueAmount:
            coApplicantTwo?.coApplicantTotalOverDueAmount || "",
          TotalNumberOfEnquiry:
            coApplicantTwo?.coApplicantNumberOfEnquiry || "",
        },
        coApplicantCibilDetail: (
          coApplicantTwo?.coApplicantCibilDetail || []
        ).map((value) => ({
          loanType: value?.loanType || "",
          loanAmount: value?.loanAmount || "",
          outstandingAmount: value?.outstandingAmount || "",
          overDue: value?.overDue || "",
          emi: value?.emi || "",
          cibilScore: value?.cibilScore || "",
          ownership: value?.ownership || "",
          SanctionedAmount: value?.SanctionedAmount || "",
          CurrentBalance: value?.CurrentBalance || "",
          RateOfInterest: value?.RateOfInterest || "",
          TotalTenure: value?.TotalTenure || "",
          BalanceTenure: value?.BalanceTenure || "",
          LoanStatus: value?.LoanStatus || "",
          LoanObligated: value?.LoanObligated || "",
          ObligationConsidered: value?.ObligationConsidered || "",
        })),
      },
      guarantorData: {
        guarantorCibilReportPdf: allData[0]?.guarantorPdf || "",
        guarantorName: guarantorData?.fullName || "",
        guarantorCibilScore: data?.guarantorCibilScore || "",
      },
    };

    return success(res, "Customer cibil details", { data: responseData });
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const customerbankDetail = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await creditPdModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const responseData = {
      bankApplicantDetails: {
        applicantPdcDocument: appPdcData?.applicantPdcDocument || "",
        nameOfBankApplicant: appPdcData?.customerName || "",
        acHolderName: appPdcData?.acHolderName || "",
        bankBranch: appPdcData?.branchName || "",
        accountNumber: appPdcData?.accountNumber || "",
        accountType: appPdcData?.accountType || "",
        ifscCode: appPdcData?.ifscCode || "",
        bankName: appPdcData?.bankName || "",
      },
      guarantorRepaymentDetails: {
        guarantorPdcDocument: gtrPdcData?.guarantorPdcDocument || "",
        nameOfBankApplicant: gtrPdcData?.acHolderName || "",
        acHolderName: gtrPdcData?.acHolderName || "",
        bankBranch: gtrPdcData?.branchName || "",
        accountNumber: gtrPdcData?.accountNumber || "",
        accountType: gtrPdcData?.accountType || "",
        ifscCode: gtrPdcData?.ifscCode || "",
        bankName: gtrPdcData?.bankName || "",
      },
    };
    return success(res, "Customer bank details", {
      bankDetails: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const customercollateralDetail = async (req, res) => {
  try {
    const { customerId } = req.query;

    const customerData  = await customerModel.findById({ _id: new ObjectId(customerId) });
    if (!customerData) {
      return badRequest(res, "Customer not found" );
    }

    const branchData = await newBranchModel.findOne({ _id: customerData.branch });
    const approverData = await approverFormModel.findOne({
      customerId: new ObjectId(customerId),
    });

    const findEmi = await final.findOne({
      customerId,
    });

    // Extract the EMI amount (convert to a number if it's a string)
    const EMI = findEmi?.emiAmount ? parseFloat(findEmi.emiAmount) : 0;
    // console.log("EMI", EMI);
    const LoanAmount = findEmi?.finalLoanAmount
      ? parseFloat(findEmi.finalLoanAmount)
      : 0;
    // console.log("LoanAmount", LoanAmount);

    const responseData = {
      propertyHolderInformation: {
        nameOfDocumentHolder: approverData?.nameOfDocumentHolder || "",
        fatherName: approverData?.fatherName || "",
        relationWithApplicant: approverData?.relationWithApplicant || "",
      },
      PropertyLocationDetails: {
        houseNo: approverData?.houseNo || "",
        surveyNo: approverData?.surveyNo || "",
        patwariHalkaNo: approverData?.patwariHalkaNo || "",
        wardNo: approverData?.wardNo || "",
        villageName: approverData?.villageName || "",
        gramPanchayat: approverData?.gramPanchayat || "",
        tehsil: approverData?.tehsil || "",
        district: approverData?.district || "",
        state: approverData?.state || "",
        fullAddressOfProperty: approverData?.fullAddressOfProperty || "",
        pinCode: approverData?.pinCode || "",
      },
      propertyAddressAndLandmark: {
        propertyLandMark: approverData?.propertyLandmark || "",
        fullAddressOfProperty: approverData?.fullAddressOfProperty || "",
        latitude: approverData?.latitude || "",
        longitude: approverData?.longitude || "",
      },
      propertySpecifications: {
        typeOfProperty: approverData?.propertyType || "",
        totalLandAreaInSqFt: approverData?.totalLandArea || "",
        totalBuiltUpAreaInSqFt: approverData?.totalBuiltUpArea || "",
        typeOfConstruction: approverData?.constructionType || "",
        qualityOfConstruction: approverData?.constructionQuality || "",
        ageOfProperty: approverData?.propertyAge || "",
      },
      PropertyBoundaries: {
        eastBoundary: approverData?.eastBoundary || "",
        westBoundary: approverData?.westBoundary || "",
        northBoundary: approverData?.northBoundary || "",
        southBoundary: approverData?.southBoundary || "",
      },
      PropertyValuation: {
        landValue: approverData?.landValue || "",
        constructionValue: approverData?.constructionValue || "",
        fairMarketValueOfLand: approverData?.fairMarketValueOfLand || "",
        realizableValue: approverData?.realizableValue || "",
        Ltv:
          approverData?.fairMarketValueOfLand && LoanAmount
            ? `${(
                (LoanAmount / approverData.fairMarketValueOfLand) *
                100
              ).toFixed(2)}%`
            : "",
        // Ltv: approverData?.Ltv || "",
      },
      sellerBuyerInformation:{
        sellerName: approverData?.sellerName || "",
        sellerFatherName: approverData?.sellerFatherName || "",
        buyerName:  approverData?.buyerName || "",
        buyerFatherName: approverData?.buyerFatherName || "",
      },
      // propertyAddressAndLandmark:
      //   approverData?.propertyAddressAndLandmark || {},
      // propertySpecifications: approverData?.propertySpecifications || {},
      // propertyBoundaries: approverData?.propertyBoundaries || {},
      // propertyValuation: approverData?.propertyValuation || {},
      branchLocation: branchData?.location || {},
      branchName: branchData?.name || "",
    };

    // console.log("responseData", responseData);

    // Check if required fields are empty or null
    const isAnyFieldEmpty =
      !responseData.propertyHolderInformation.nameOfDocumentHolder ||
      !responseData.propertyHolderInformation.fatherName ||
      !responseData.propertyHolderInformation.relationWithApplicant ||
      !responseData.PropertyLocationDetails.houseNo ||
      // !responseData.PropertyLocationDetails.surveyNo ||
      !responseData.PropertyLocationDetails.patwariHalkaNo ||
      !responseData.PropertyLocationDetails.wardNo ||
      !responseData.PropertyLocationDetails.villageName ||
      !responseData.PropertyLocationDetails.gramPanchayat ||
      !responseData.PropertyLocationDetails.tehsil ||
      !responseData.PropertyLocationDetails.district ||
      !responseData.PropertyLocationDetails.state ||
      !responseData.PropertyLocationDetails.pinCode ||
      !responseData.PropertyBoundaries.eastBoundary ||
      !responseData.PropertyBoundaries.westBoundary ||
      !responseData.PropertyBoundaries.northBoundary ||
      !responseData.PropertyBoundaries.southBoundary ||
      // !responseData.propertySpecifications.totalBuiltUpAreaInSqFt ||
      !responseData.propertySpecifications.totalLandAreaInSqFt;

    const Allow_Permission = !isAnyFieldEmpty;

    const data = await internalLegalModel.findOneAndUpdate(
      { customerId: new ObjectId(customerId) },
      { $set: { Allow_Permission: Allow_Permission ? "true" : "false" } }
    );

    const updateInCollateral = await approverFormModel.findOneAndUpdate(
      {
        customerId: new ObjectId(customerId),
      },
      {
        $set: { Allow_Permission: Allow_Permission ? "true" : "false" },
      }
    );

    let newResponse = {
      ...responseData,
      Allow_Permission,
    };

    console.log(
      `Allow_Permission set to: ${Allow_Permission ? "true" : "false"}`
    );

    return success(res, "Customer collateral details", {
      bankDetails: newResponse,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const customerloanAgreementDetail = async (req, res) => {
  try {
    const { customerId } = req.query;
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const propertyData = await propertyPaperKycModel.findOne({ customerId });

    const responseData = {
      bankGuarantorDetails: {
        guarantorPdcDocument: gtrPdcData?.guarantorPdcDocument || "",
        nameOfBankGuarantor: gtrPdcData?.gtrName || "",
        acHolderName: gtrPdcData?.acHolderName || "",
        bankBranch: gtrPdcData?.branchName || "",
        accountNumber: gtrPdcData?.accountNumber || "",
        accountType: gtrPdcData?.accountType || "",
        ifscCode: gtrPdcData?.ifscCode || "",
        chequeNoOfGuarantor: gtrPdcData?.totalChequeCount || "",
      },
      bankApplicantDetails: {
        applicantPdcDocument: appPdcData?.applicantPdcDocument || "",
        nameOfBankApplicant: appPdcData?.customerName || "",
        acHolderName: appPdcData?.acHolderName || "",
        bankBranch: appPdcData?.branchName || "",
        accountNumber: appPdcData?.accountNumber || "",
        accountType: appPdcData?.accountType || "",
        ifscCode: appPdcData?.ifscCode || "",
        chequeNoOfapplicant: appPdcData?.totalChequeCount || "",
      },
      boundariesOfProperty: {
        onorTowardsNorth: propertyData?.northBoundary || "",
        onorTowardsSouth: propertyData?.southBoundary || "",
        onorTowardsEast: propertyData?.eastBoundary || "",
        onorTowardswest: propertyData?.westBoundary || "",
      },
      loanAgreementDetails: {
        dateOfTheAgreement: appPdcData?.approvalDate || "",
        placeOfExecution: appPdcData?.placeOfExecution || "",
      },
    };
    return success(res, "Customer loan agreement details", {
      bankDetails: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const customercreditAndPdReportDetail = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await applicantModel.findOne({ customerId });
    const coApplicantdata = await coApplicantModel.findOne({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const cibilData = await cibilModel
      .findOne({ customerId })
      .populate("customerId");
    const udyamdatasDetail = await udyamModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const camReportDetails = await camReportModel.findOne({ customerId });
    const electricityKycData = await electricityKycModel.findOne({
      customerId,
    });
    const udhyamKycData = await udhyamKycModel.findOne({ customerId });

    const pdIsActive = pdformdatasDetail?.status || "";
    //  console.log(pdIsActive,"pdIsActivepdIsActive<><>")

    const responseData = {
      message: pdformdatasDetail
        ? pdformdatasDetail.status === "approve"
          ? "PD approved"
          : "PD not approved"
        : "PD not found",
      applicantDetails:
        pdformdatasDetail?.status === "approve"
          ? {
              image: pdformdatasDetail?.applicantImage || "",
              caste: pdformdatasDetail?.applicant?.caste || "",
              occupation:
                camReportDetails?.applicationInformation?.occupation || "",
              landmark: pdformdatasDetail?.applicant?.houseLandMark || "",
              noOfyearsAtCurrentAddress:
                pdformdatasDetail?.applicant?.noOfyearsAtCurrentAddress || "",
              country: "India",
              alternateMobileNo:
                pdformdatasDetail?.applicant?.alternateMobileNo || "",
              email: data?.email || "",
              religion: data?.religion || "",
              nationality: pdformdatasDetail?.applicant?.nationality || "",
              category: pdformdatasDetail?.applicant?.category || "",
              noOfDependentWithCustomer:
                pdformdatasDetail?.applicant?.noOfDependentWithCustomer || "",
              education: data?.education || "",
            }
          : {},
      coApplicantDetails:
        pdformdatasDetail?.status === "approve"
          ? {
              image: pdformdatasDetail?.coApplicantImage || [],
              occupation:
                camReportDetails?.coApplicationInformation?.occupation || "",
              caste: pdformdatasDetail?.co_Applicant[0]?.caste || "",
              landmark: pdformdatasDetail?.co_Applicant[0]?.houseLandMark || "",
              noOfyearsAtCurrentAddress:
                pdformdatasDetail?.co_Applicant[0]?.noOfyearsAtCurrentAddress ||
                "",
              country: "India",
              alternateMobileNo:
                pdformdatasDetail?.co_Applicant[0]?.alternateMobileNo || "",
              email: coApplicantdata?.email || "",
              religion: coApplicantdata?.religion || "",
              nationality:
                pdformdatasDetail?.co_Applicant[0]?.nationality || "",
              category: pdformdatasDetail?.co_Applicant[0]?.category || "",
              noOfDependentWithCustomer: "",
              education: coApplicantdata?.education || "",
              relationWithApplicant:
                coApplicantdata?.relationWithApplicant || "",
            }
          : {},
      guarantorInformation:
        pdformdatasDetail?.status === "approve"
          ? {
              image: pdformdatasDetail?.guarantorImage || "",
              caste: pdformdatasDetail?.guarantor?.caste || "",
              occupation:
                camReportDetails?.guarantorInformation?.occupation || "",
              landmark: guarantorData?.permanentAddress?.houseLandMark || "",
              noOfyearsAtCurrentAddress:
                pdformdatasDetail?.guarantor?.noOfyearsAtCurrentAddress || "",
              alternateMobileNo:
                pdformdatasDetail?.guarantor?.alternateMobileNo || "",
              religion: guarantorData?.religion || "",
              nationality: pdformdatasDetail?.guarantor?.nationality || "",
              category: pdformdatasDetail?.guarantor?.category || "",
              noOfDependentWithCustomer: "",
              education: guarantorData?.education || "",
              relationWithApplicant: "",
            }
          : {},
      bankApplicantDetails:
        pdformdatasDetail?.status === "approve"
          ? {
              applicantPdcDocument: appPdcData?.applicantPdcDocument || "",
              nameOfBankApplicant: appPdcData?.customerName || "",
              acHolderName: appPdcData?.acHolderName || "",
              bankBranch: appPdcData?.branchName || "",
              accountNumber: appPdcData?.accountNumber || "",
              accountType: appPdcData?.accountType || "",
              ifscCode: appPdcData?.ifscCode || "",
              bankName: appPdcData?.bankName || "",
            }
          : {},
      cibilAnlysis:
        pdformdatasDetail?.status === "approve"
          ? {
              numberOfTotalLoans: cibilData?.TotalLoansNumbers || "",
              detailOfCurrentLoans: cibilData?.CurrentLoanDetail || "",
              rasonOdDpd: cibilData?.reasonOfDPD || "",
            }
          : {},
      samagraDetails:
        pdformdatasDetail?.status === "approve"
          ? {
              samgraFamilyIDNumber:
                pdformdatasDetail?.samagraDetail?.samagraFamilyIdNo || "",
              smagraIDHeadName:
                pdformdatasDetail?.samagraDetail?.samagraIdHeadName || "",
              SamagraIdPhoto: pdformdatasDetail?.SSSMPhoto || "",
              gasDairyPhoto: pdformdatasDetail?.gasDiaryPhoto || "",
              familyMember: pdformdatasDetail?.familyMember[0]?.name || "",
              dependentName:
                pdformdatasDetail?.familyMember[0]?.dependent || "",
              age: pdformdatasDetail?.familyMember[0]?.age || "",
              relation: pdformdatasDetail?.familyMember[0]?.relation || "",
            }
          : {},
      assetsDetail:
        pdformdatasDetail?.status === "approve"
          ? pdformdatasDetail?.assetDetails?.map((value) => ({
              name: value?.name || "",
              purchaseValue: value?.purchaseValue || "",
              marketValue: value?.marketValue || "",
            })) || [] // In case assetDetails is null or undefined, fallback to an empty array
          : [],
      ElectricityBill:
        pdformdatasDetail?.status === "approve"
          ? {
              electricityKycDocument:
                electricityKycData?.electricityKycDocument || "",
              selectElectricityBoard:
                electricityKycData?.electricityBoard || "",
              enterServiceNo: electricityKycData?.InterServiceNumber || "",
              billDetail: "",
              consumerAddress: electricityKycData?.addressOfConsumer || "",
              billAmount: electricityKycData?.billAmount || "",
              cashDueDate: electricityKycData?.cashDueDate || "",
              chequeDueDate: electricityKycData?.chequeDueDate || "",
              iVRSNumber: electricityKycData?.ivrsNo || "",
              consumerName: electricityKycData?.nameOfConsumer || "",
              serviceNo: electricityKycData?.serviceNo || "",
              consumerNo: electricityKycData?.consumerNo || "",
              relationWithApplicant:
                electricityKycData?.relationWithApplicant || "",
              clickMeterPhoto: electricityKycData?.meterPhoto || "",
              clickBillPhoto: electricityKycData?.electricityBillUpload || "",
            }
          : "",
      policeStation:
        pdformdatasDetail?.status === "approve"
          ? {
              policeStationName:
                pdformdatasDetail?.policeStation?.staionName || "",
              policeStationAddress:
                pdformdatasDetail?.policeStation?.stationAdress || "",
            }
          : "",
      businessDetail:
        pdformdatasDetail?.status === "approve"
          ? {
              udhyamKycDocument: udhyamKycData?.udhyamKycDocument || [],
              udhyamRegisteredNumber: udhyamKycData?.udhyamRegistrationNo || "",
              udhyamRegisteredDetail: "",
              nameOfEnterprise:
                udhyamKycData?.udyamDetails?.enterpriseName || "",
              typeOfEnterprise:
                udhyamKycData?.udyamDetails?.enterpriseType || "",
              organisationType:
                udhyamKycData?.udyamDetails?.organisationType || "",
              socialCategory: udhyamKycData?.udyamDetails?.socialCategory || "",
              dateOfIncorporation: udhyamKycData?.dateOfIncorporation || "",
              majorActivity: udhyamKycData?.udyamDetails?.majorActivity || "",
              dateOfCommencementOfProductionAndBusiness:
                udhyamKycData?.udyamDetails
                  ?.DateofCommencementofProductionBusiness || "",
              enterpriseType: udhyamKycData?.udyamDetails?.enterpriseType || [],
              officialAddresOfEntrprise: {
                FlatDoorBlockNo:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.FlatDoorBlockNo || "",
                VillageTown:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.VillageTown || "",
                RoadStreetLane:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.RoadStreetLane || "",
                state:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.state || "",
                mobile:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.mobile || "",
                nameofPremisesBuilding:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.nameofPremisesBuilding || "",
                block:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.block || "",
                city:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.city || "",
                district:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.district || "",
                pin:
                  udhyamKycData?.udyamDetails?.officialAddressOfEnterprise
                    ?.pin || "",
              },
              nationalIndustryClassificationCode: {
                activity:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode?.activity || "",
                date:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode?.date || "",
                nic2Digit:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode?.nic2Digit || "",
                nic4Digit:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode?.nic4Digit || "",
                nic5Digit:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode?.nic5Digit || "",
                dicName:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode?.dicName || "",
                msmeDFO:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode?.msmeDFO || "",
                DateofUdyamRegistration:
                  udhyamKycData?.udyamDetails
                    ?.nationalIndustryClassificationCode
                    ?.DateofUdyamRegistration || "",
              },
              unitDetail: {
                unitName:
                  udhyamKycData?.udyamDetails?.unitsDetails?.unitName || "",
                flat: udhyamKycData?.udyamDetails?.unitsDetails?.flat || "",
                building:
                  udhyamKycData?.udyamDetails?.unitsDetails?.building || "",
                VillageTown:
                  udhyamKycData?.udyamDetails?.unitsDetails?.VillageTown || "",
                block: udhyamKycData?.udyamDetails?.unitsDetails?.block || "",
                road: udhyamKycData?.udyamDetails?.unitsDetails?.road || "",
                city: udhyamKycData?.udyamDetails?.unitsDetails?.city || "",
                pin: udhyamKycData?.udyamDetails?.unitsDetails?.pin || "",
                state: udhyamKycData?.udyamDetails?.unitsDetails?.state || "",
                district:
                  udhyamKycData?.udyamDetails?.unitsDetails?.district || "",
              },
            }
          : {},
      totalIncomeDetail:
        pdformdatasDetail?.status === "approve"
          ? {
              totalYearlyIncome:
                pdformdatasDetail?.totalIncomeDetails?.totalYearlyIncome || "",
              totalMonthlyIncome:
                pdformdatasDetail?.totalIncomeDetails?.totalMonthlyIncome || "",
              totalExpensesYearly:
                pdformdatasDetail?.totalIncomeDetails?.totalExpensesYearly ||
                "",
              totalExpensesMonthly:
                pdformdatasDetail?.totalIncomeDetails?.totalExpensesMonthly ||
                "",
            }
          : {},
      propertyCollateralsDetails:
        pdformdatasDetail?.status === "approve"
          ? {
              documentHolderName:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.typeOfProperty || "",
              relationWithApplicant:
                pdformdatasDetail?.property?.relationWithApplicant || "",
              fatherName: pdformdatasDetail?.property?.fatherName || "",
              villageName: pdformdatasDetail?.property?.villageName || "",
              gramPanchayat: pdformdatasDetail?.property?.gramPanchayat || "",
              patwariHalkaNo: pdformdatasDetail?.property?.patwariHalkaNo || "",
              state: pdformdatasDetail?.property?.state || "",
              district: pdformdatasDetail?.property?.district || "",
              tehsil: pdformdatasDetail?.property?.tehsil || "",
              houseNo: pdformdatasDetail?.property?.houseNo || "",
              wardNo: pdformdatasDetail?.property?.wardNo || "",
              surveyNo: pdformdatasDetail?.property?.surveyNo || "",
            }
          : {},
      houseBoundaries:
        pdformdatasDetail?.status === "approve"
          ? {
              east:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.boundariesEast || "",
              west:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.boundariesWest || "",
              north:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.boundariesNorth || "",
              south:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.boundariesSouth || "",
              documentProvided:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.documentsProvided || "",
              relationWithApplicant:
                pdformdatasDetail?.property?.relationWithApplicantouth || "",
              boundariesMatchingWithPatta:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.boundariesMatching || "",
              propertyAddress:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.propertyAddress || "",
              documentHolderName:
                pdformdatasDetail?.property?.collateralsDetails
                  ?.nameOfTheDocumentHolder || "",
              propertyLatitude:
                pdformdatasDetail?.property?.latitudeOfTheProrty || "",
              propertyLongitude:
                pdformdatasDetail?.property?.longitudeOfTheProrty || "",
              doorsWindowsAvailability:
                pdformdatasDetail?.property?.doorsAndWindowsAreAvailable || "",
              kitchenLatAndBathAvailability:
                pdformdatasDetail?.property?.kitchenAndLatBathAvailable || "",
              assetSeenAtResidence:
                pdformdatasDetail?.property?.assetSeenAtResidence || "",
              landmark:
                pdformdatasDetail?.property?.collateralsDetails?.landmark || "",
              locationAndZone:
                pdformdatasDetail?.property?.collateralsDetails?.locationZone ||
                "",
            }
          : {},
      accommodationDetails:
        pdformdatasDetail?.status === "approve"
          ? {
              groundFloor:
                pdformdatasDetail?.property?.accommodationDetails
                  ?.groundFloor || "",
              firstFloor:
                pdformdatasDetail?.property?.accommodationDetails?.firstFloor ||
                "",
              actualUsageProperty:
                pdformdatasDetail?.property?.accommodationDetails
                  ?.actualUsageOfProperty || "",
              structureType:
                pdformdatasDetail?.property?.accommodationDetails
                  ?.typeOfStructure || "",
              plotLocation:
                pdformdatasDetail?.property?.accommodationDetails
                  ?.locationOfPlot || "",
              builtUpArea:
                pdformdatasDetail?.property?.accommodationDetails
                  ?.builtUpAreaSft || "",
              occupancy:
                pdformdatasDetail?.property?.accommodationDetails?.occupancy ||
                "",
              electricityGasConnection:
                pdformdatasDetail?.property?.accommodationDetails
                  ?.electricityAndGasConnection || "",
              surroundingAreaDevelopment: "",
              totalBuiltUpArea:
                pdformdatasDetail?.property?.TotalBuilUpArea || "",
              qualityOfConstruction:
                pdformdatasDetail?.property?.qualityOfConstruction || "",
              propertyAge: pdformdatasDetail?.property?.ageOfProperty || "",
              propertyMaintenance:
                pdformdatasDetail?.property?.MaintenanceOfTheProperty || "",
              projectedLifeYear:
                pdformdatasDetail?.property?.ProjectedLifeYear || "",
              constructionType:
                pdformdatasDetail?.property?.typeOfContruction || "",
              landRatePerSQFT:
                pdformdatasDetail?.property?.landRatePerSQFT || "",
              totalConsAreaSQFT:
                pdformdatasDetail?.property?.totalConstruction || "",
              uploadImage: {
                selfieWithCostumer:
                  pdformdatasDetail?.property?.selfiWithCustomer || "",
                photoWithLatlong:
                  pdformdatasDetail?.property?.photoWithLatLong || "",
                frontPhoto: pdformdatasDetail?.property?.front || "",
                leftSide: pdformdatasDetail?.property?.leftSide || "",
                rightSide: pdformdatasDetail?.property?.rightSide || "",
                approachRoad: pdformdatasDetail?.property?.approachRoad || "",
                mainRoad: pdformdatasDetail?.property?.mainRoad || "",
                inferiorRoad: pdformdatasDetail?.property?.interiorRoad || "",
                addImage: "",
              },
            }
          : "",
      LoanDetail:
        pdformdatasDetail?.status === "approve"
          ? {
              customerDemandLoanAmount:
                pdformdatasDetail?.approveLoanDetails
                  ?.demandLoanAmountByCustomer || "",
              approvedAmount:
                pdformdatasDetail?.approveLoanDetails?.approvedAmount || "",
              roi: pdformdatasDetail?.approveLoanDetails?.ROI || "",
              tenure: pdformdatasDetail?.approveLoanDetails?.Tenure || "",
              emi: pdformdatasDetail?.approveLoanDetails?.EMI || "",
              finalDecision:
                pdformdatasDetail?.approveLoanDetails?.finalDecision || "",
              endUseOfLoan:
                pdformdatasDetail?.approveLoanDetails?.endUseOfLoan || "",
            }
          : {},
      referenceDetail:
        pdformdatasDetail?.status === "approve"
          ? pdformdatasDetail?.referenceDetails || []
          : [],
      remarkAndPendency:
        pdformdatasDetail?.status === "approve"
          ? {
              remarksAnyCondition: pdformdatasDetail?.remarkByPd || "",
            }
          : "",
      pdfLink:
        pdformdatasDetail?.status === "approve"
          ? pdformdatasDetail?.pdfLink || ""
          : "",
    };

    return success(res, "Customer credit and pd details", {
      bankDetails: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const customerdueDiligenceReportDetail = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await applicantModel.findOne({ customerId });
    const coApplicantdata = await coApplicantModel.findOne({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const technicalData = await technicalApproveFormModel.findOne({
      customerId,
    });
    const legalReportDetails = await legalReportModel.findOne({ customerId });
    const externalVendorFormData = await externalVendorFormModel.findOne({
      customerId,
    });
    // console.log(externalVendorFormData,"externalVendorFormDataexternalVendorFormData")
    const rcuVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rcu"
    );
    const legalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "legal"
    );
    const technicalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "technical"
    );
    const rmVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rm"
    );
    let legalIsApproved = legalReportDetails?.status === "approve";
    const technicalIsApproved = technicalData?.status === "approve";

    // console.log(rcuVendor,"rcuVendor",legalVendor,"legalVendor",technicalVendor,"technicalVendor",rmVendor,"rmVendor")

    // console.log(externalVendorFormData,"technicalData")
    const responseData = {
      allPdf: {
        rcuPdf:
          rcuVendor?.statusByVendor === "approve"
            ? rcuVendor?.assignDocuments
            : [],
        legalPdf:
          legalVendor?.statusByVendor === "approve"
            ? legalVendor?.assignDocuments
            : [],
        technicalPdf:
          technicalVendor?.statusByVendor === "approve"
            ? technicalVendor?.assignDocuments
            : [],
        rmPdf:
          rmVendor?.statusByVendor === "approve"
            ? rmVendor?.assignDocuments
            : [],
        pdPdf:
          pdformdatasDetail?.status === "approve"
            ? pdformdatasDetail?.pdfLink
            : "",
      },
      rcuReport: {
        // message: rcuVendor
        //   ? rcuVendor.statusByVendor === "approve"
        //     ? "RCU approved"
        //     : "RCU not approved"
        //   : "RCU not approved",
        reportRecievedDate: rcuVendor?.assignDate || "",
        reportStatus: rcuVendor?.statusByVendor || "",
      },
      technicalReport: {
        // message: technicalVendor
        //   ? technicalVendor.statusByVendor === "approve"
        //     ? "technical approved"
        //     : "technical not approved"
        //   : "technical not approved",
        receivedDate: technicalData?.receivedDate || "",
        status: technicalData?.status || "",
        assignDate: technicalVendor?.assignDate || "",
        reportStatus: technicalVendor?.statusByVendor || "",
        nameOfDocumentHolder: technicalIsApproved
          ? technicalData.propertyHolderInformation?.documentHolderName
          : "" || "",
        fatherName: technicalIsApproved
          ? technicalData.propertyHolderInformation?.fatherName
          : "" || "",
        relationWithApplicant: technicalIsApproved
          ? technicalData.propertyHolderInformation?.relationWithApplicant
          : "" || "",
        houseNo: technicalIsApproved
          ? technicalData.propertyLocationDetails?.houseNumber
          : "" || "",
        surveyNo: technicalIsApproved
          ? technicalData.propertyLocationDetails?.surveyNumber
          : "" || "",
        patwariHalkaNo: technicalIsApproved
          ? technicalData.propertyLocationDetails?.patwariHalkaNumber
          : "" || "",
        wardNo: technicalIsApproved
          ? technicalData.propertyLocationDetails?.wardNumber
          : "" || "",
        villageName: technicalIsApproved
          ? technicalData.propertyLocationDetails?.villageName
          : "" || "",
        gramPanchayat: technicalIsApproved
          ? technicalData.propertyLocationDetails?.gramPanchayat
          : "" || "",
        tehsil: technicalIsApproved
          ? technicalData.propertyLocationDetails?.tehsil
          : "" || "",
        district: technicalIsApproved
          ? technicalData.propertyLocationDetails?.district
          : "" || "",
        state: technicalIsApproved
          ? technicalData.propertyLocationDetails?.state
          : "" || "",
        propertyLandmark: technicalIsApproved
          ? technicalData.propertyAddressAndLandmark?.propertyLandmark
          : "" || "",
        fullAddressOfProperty: technicalIsApproved
          ? technicalData.propertyAddressAndLandmark?.fullAddressOfProperty
          : "" || "",
        typeOfProperty: technicalIsApproved
          ? technicalData.propertySpecifications?.propertyType
          : "" || "",
        totalLandArea: technicalIsApproved
          ? technicalData.propertySpecifications?.totalLandArea
          : "" || "",
        totalBuiltUpArea: technicalIsApproved
          ? technicalData.propertySpecifications?.totalBuiltUpArea
          : "" || "",
        typeOfConstruction: technicalIsApproved
          ? technicalData.propertySpecifications?.constructionType
          : "" || "",
        qualityOfConstruction: technicalIsApproved
          ? technicalData.propertySpecifications?.constructionQuality
          : "" || "",
        ageOfProperty: technicalIsApproved
          ? technicalData.propertySpecifications?.propertyAge
          : "" || "",
        eastBoundary: technicalIsApproved
          ? technicalData.propertyBoundaries?.eastBoundary
          : "" || "",
        westBoundary: technicalIsApproved
          ? technicalData.propertyBoundaries?.westBoundary
          : "" || "",
        northBoundary: technicalIsApproved
          ? technicalData.propertyBoundaries?.northBoundary
          : "" || "",
        southBoundary: technicalIsApproved
          ? technicalData.propertyBoundaries?.southBoundary
          : "" || "",
        developmentPercentage: technicalIsApproved
          ? technicalData.propertySpecifications?.devlopmentPercentage
          : "" || "",
        areaOfProperty: technicalIsApproved
          ? technicalData.propertySpecifications?.totalLandArea
          : "" || "",
        landValue: technicalIsApproved
          ? technicalData.propertyValuation?.landValue
          : "" || "",
        constructionValue: technicalIsApproved
          ? technicalData.propertyValuation?.constructionValue
          : "" || "",
        fairMarketValueOfLand: technicalIsApproved
          ? technicalData.propertyValuation?.fairMarketValueOfLand
          : "" || "",
        realizableValue: technicalIsApproved
          ? technicalData.propertyValuation?.realizableValue
          : "" || "",
        latitude: technicalIsApproved
          ? technicalData.propertyAddressAndLandmark?.latitudeOfTheProperty
          : "" || "",
        longitude: technicalIsApproved
          ? technicalData.propertyAddressAndLandmark?.longitudeOfTheProperty
          : "" || "",
        valuationDoneBy: technicalIsApproved
          ? technicalData.propertyValuation?.valuationDoneBy
          : "" || "",
      },
      legalReport: {
        // message: legalVendor
        //   ? technicalVendor.statusByVendor === "approve"
        //     ? "legal approved"
        //     : "legal not approved"
        //   : "legal not approved",
        receivedDate: legalReportDetails?.receivedDate || "",
        status: legalReportDetails?.status || "",
        assignDate: legalVendor?.assignDate || "",
        reportStatus: legalVendor?.statusByVendor || "",
        documentType: legalIsApproved
          ? legalReportDetails.documentType || ""
          : "",
        nameOfApplicant: legalIsApproved
          ? legalReportDetails.nameOfApplicant || ""
          : "",
        nameOfCoApplicant: legalIsApproved
          ? legalReportDetails.nameOfCoApplicant || ""
          : "",
        nameOfDocumentHolder: legalIsApproved
          ? legalReportDetails.nameOfDocumentHolder || ""
          : "",
        relationWithApplicant: legalIsApproved
          ? legalReportDetails.relationWithApplicant || ""
          : "",
        fullAddressOfTheProperty: legalIsApproved
          ? legalReportDetails.propertyInformation?.fullAddressOfTheProperty ||
            ""
          : "",
        descriptionOfListOfDocuments: legalIsApproved
          ? legalReportDetails.propertyInformation
              ?.descriptionOfListOfDocuments || ""
          : "",
        documentDetails: legalIsApproved
          ? legalReportDetails.documentDetails || {}
          : {
              document1: legalReportDetails?.documentDetails?.document1 || "",
              document2: legalReportDetails?.documentDetails?.document2 || "",
              document3: legalReportDetails?.documentDetails?.document3 || "",
              document4: legalReportDetails?.documentDetails?.document4 || "",
              document5: legalReportDetails?.documentDetails?.document5 || "",
              document6: legalReportDetails?.documentDetails?.document6 || "",
              document7: legalReportDetails?.documentDetails?.document7 || "",
            },
        statusOfReport: legalIsApproved
          ? legalReportDetails.reportStatus || ""
          : "",
      },
      taggingReport: {
        applicantName: "",
        fatherName: "",
        contactNumber: "",
        addressOfApplicant: "",
        date: "",
        place: "",
        tagNo: "",
        animalNo: "",
        breedNo: "",
        genderNo: "",
        colourNo: "",
        ageNo: "",
        milkInLiterPerDay: "",
      },
    };
    return success(res, "Customer due&diligance details", {
      bankDetails: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const partnerNameDetails = async (req, res) => {
  try {
    const partnerData = await lenderModel.find({})
    .populate("branchId", "name") // Only select name and location fields
    .populate("productId", "productName")
    .populate("employeeId", "employeName") // Only select name and price fields
    .populate({
      path: "venders",
      populate: [
        {
          path: "branch",
          model: "newbranch",
          select: "name",
        },
        {
          path: "vender",
          model: "vendor",
          select: "fullName",
        },
      ],
    })
    .populate({
      path: "sopDetails",
      populate: [
        {
          path: "name",
          model: "employee",
          select: "employeName",
        }
      ],
    })
    .populate({
      path: "policy",
      populate: [
        {
          path: "productId",
          model: "product",
          select: "productName",
        }
      ],
    })
    // .select("fullName partnerUniqueId");
    // let responseData = {
    //   name1: "Ratnaafin Capital Pvt Ltd",
    //   name2: "Grow Money Capital Pvt Ltd",
    //   name3: "Namdev Finvest Pvt Ltd",
    //   name4: "Fin Coopers Capital Pvt Ltd",
    // };
    return success(res, "partner details", {
      data: partnerData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const branchPendencyDetails = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await applicantModel.findOne({ customerId });
    const electricityData = await electricityKycModel.findOne({ customerId });
    const samagraIdData = await samagraIdModel.findOne({ customerId });
    const udhyamKycdata = await udhyamKycModel.findOne({ customerId });
    const bankStatementData = await bankStatementModel.findOne({ customerId });
    const salaryAndOtherIncomeData = await salaryAndOtherIncomeModel.findOne({
      customerId,
    });
    const milkIncomeData = await milkIncomeModel.findOne({ customerId });
    const otherBuisnessData = await otherBuisnessModel.findOne({ customerId });
    const propertyPaperKycData = await propertyPaperKycModel.findOne({
      customerId,
    });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const nachRegistrationKyData = await nachRegistrationKyModel.findOne({
      customerId,
    });
    const physicalFileCourierData = await physicalFileCourierModel.findOne({
      customerId,
    });
    const rmPaymentUpdateData = await rmPaymentUpdateModel.findOne({
      customerId,
    });
    const agricultureData = await agricultureModel.findOne({ customerId });
    const esignPhotoData = await esignPhotoModel.findOne({ customerId });
    const electricityKycData = await electricityKycModel.findOne({
      customerId,
    });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });

    const yearlyIncome =
      pdformdatasDetail?.incomeSource?.[0]?.agricultureBusiness
        ?.agriIncomeYearly || "";
    const MonthlyIncome = salaryAndOtherIncomeData?.monthlyIncomeEarned || "";

    let responseData = {
      allPdf: {
        electricityBill:
          electricityKycData?.status === "approve"
            ? electricityKycData?.electricityKycDocument
            : [],
        samagraId:
          samagraIdData?.status === "approve"
            ? samagraIdData?.samagraIdDocument
            : [],
        udhyamCertificate:
          udhyamKycdata?.status === "approve"
            ? udhyamKycdata?.udhyamKycDocument
            : [],
        agricultureIncome:
          agricultureData?.status === "approve"
            ? agricultureData?.agricultureDocument
            : [],
        milkIncome:
          milkIncomeData?.status === "approve"
            ? milkIncomeData?.milkDocument
            : [],
        salaryAndOtherIncome:
          salaryAndOtherIncomeData?.status === "approve"
            ? salaryAndOtherIncomeData?.otherIncomeDocument
            : [],
        otherBusinessIncome:
          otherBuisnessData?.status === "approve"
            ? otherBuisnessData?.otherBusinessDocument
            : [],
        // bankStatement:
        //   bankStatementData?.status === "approve"
        //     ? bankStatementData?.bankStatementDocument
        //     : [],
        bankStatement: dataExists(
          bankStatementData?.status === "approve" 
            ? [
                ...(Array.isArray(bankStatementData?.bankStatementDocument) 
                  ? bankStatementData?.bankStatementDocument 
                  : bankStatementData?.bankStatementDocument 
                    ? [bankStatementData?.bankStatementDocument] 
                    : []
                ),
                ...(bankStatementData?.Account_Aggregator_Link 
                  ? [bankStatementData?.Account_Aggregator_Link] 
                  : []
                )
              ]
            : []
        ),
        propertyPaper:
          propertyPaperKycData?.status === "approve"
            ? propertyPaperKycData?.propertyPapersKycDocument
            : [],
        rmPayment:
          rmPaymentUpdateData?.status === "approve"
            ? rmPaymentUpdateData?.rmPaymentDocument
            : [],
        appPdc:
          appPdcData?.status === "approve"
            ? appPdcData?.applicantPdcDocument
            : [],
        gtrPdc:
          gtrPdcData?.status === "approve"
            ? gtrPdcData?.guarantorPdcDocument
            : [],
        nachRegistration:
          nachRegistrationKyData?.status === "approve"
            ? nachRegistrationKyData?.nachRegistrationKycDocument
            : [],
        esignPhoto:
          esignPhotoData?.status === "approve"
            ? esignPhotoData?.esignPhotoDocument
            : [],
        physicalFileCourirer:
          physicalFileCourierData?.status === "approve"
            ? physicalFileCourierData?.physicalFileCourierDocument
            : [],
      },
      ElectricityBill: {
        UploadImageElectricityBillMultiple:
          electricityKycData?.electricityKycDocument || [], // electricityKycDocument
        IVRSNumber: electricityKycData?.ivrsNo || "",
        ConsumerName: electricityKycData?.consumerName || "",
        BillDate: electricityKycData?.billDate || "",
      },
      SamagraID: {
        samagraIdDocument: samagraIdData?.samagraIdDocument || [],
        familyMemberData: samagraIdData?.samagraData || [],
      },
      UdhyamCertificate: {
        udhyamKycDocument: udhyamKycdata?.udhyamKycDocument || [],
        UdhyamRegisteredAndReferenceNumber:
          udhyamKycdata?.udhyamRegistrationNo || "",
        DateOfUdhyamaRegistation: udhyamKycdata?.dateOfUdhyamRegistration || "",
        NameOfUnit: udhyamKycdata?.nameOfUnit || "",
        TypeOfEnterprises: udhyamKycdata?.typeOfEnterprises || "",
        TypeOfOrganisaiton: udhyamKycdata?.typeOfOrganisation || "",
        OwnerName: udhyamKycdata?.ownerName || "",
        DateOfIncorporation: udhyamKycdata?.dateOfIncorporation || "",
        AddressOfEnterprises: udhyamKycdata?.addressOfEnterprises || "",
      },
      BankStatement: {
        bankStatementDocument: bankStatementData?.bankStatementDocument || [],
        bankName: bankStatementData?.bankName || "",
        AccountHolderName: bankStatementData?.acHolderName || "",
        AccountNumber: bankStatementData?.accountNumber || "",
        IFSCCode: bankStatementData?.ifscCode || "",
        BranchName: bankStatementData?.branchName || "",
        AccountType: bankStatementData?.accountType || "",
        statementFromDate: bankStatementData?.statementFromDate || "",
        statementToDate: bankStatementData?.statementToDate || "",
        Account_Aggregator_Link: bankStatementData?.Account_Aggregator_Link || "",
      },
      agriculture: {
        // agricultureDocument: agricultureData?.agricultureDocument || [],
        // LD: agricultureData?.LD || "",
        // incomeType: agricultureData?.incomeType || "",
        // agriDetails: agricultureData?.agriDetails || "",
        yearlyIncome:
          pdformdatasDetail?.incomeSource[0]?.agricultureBusiness
            ?.agriIncomeYearly || "",
        availableLand: agricultureData?.availableLandInAcre || "",
        // agriLandAddressAsPerPavati:
        //   agricultureData?.agriLandAddressAsPerPavati || "",
        agriLandSurveyNo: agricultureData?.agriLandSurveyNo || "",
        LandOwnerName: agricultureData?.LandOwnerName || "",
        // relationWithApplicant: agricultureData?.relationWithApplicant || "",
        cropCultivated: agricultureData?.cropCultivated || "",
        // yearOfExprience: "",
        // yearlyIncome: "",
        monthlyIncome: yearlyIncome ? yearlyIncome / 12 : 0,
        monthlyExpence: agricultureData?.monthlyExpence || "",
        TotalNoOfAGRILand:
          pdformdatasDetail?.incomeSource[0]?.agricultureBusiness
            ?.agriLandInBigha || "",
        NoOfAgricultureOwner: agricultureData?.NoOfAgricultureOwner || "",
        agriDoingFromNoOfYears:
          pdformdatasDetail?.incomeSource[0]?.agricultureBusiness
            ?.agriDoingFromNoOfYears || "",
      },
      MilkBusiness: {
        milkDocument: milkIncomeData?.milkDocument || [],
        yearOfExperience: milkIncomeData?.noOfYears || "",
        TotalCattle: milkIncomeData?.NoOfCattles || "",
        MilkGivingCattle: milkIncomeData?.NoOfMilkGivingCattles || "",
        AverageDailyMilkQuantitIinLitters:
          milkIncomeData?.averageDailyMilkQuantity || "",
        DairyName: milkIncomeData?.NameOfDairy || "",
        DairyAddress: milkIncomeData?.adressOfDairy || "",
        DairyOwnerContact:
          milkIncomeData?.contactDetailsOfDairyOwnerIfAvailable || "",
        YearProvdingToDairy: milkIncomeData?.noOfYears || "",
        Expenses: milkIncomeData?.expensesOfMilkBuisness || "",
        MonthlyIncome: milkIncomeData?.monthlyIncomeMilkBuisness || "",
        annualIncome: milkIncomeData?.yearlyIncomeMilkBuisness || "",
        monthlyExpence: milkIncomeData?.expensesAtMilkBuisness || "",
        milkProvidingToAboveDairy:
          milkIncomeData?.milkProvidingToAboveDairy || "",
      },
      SalaryIncome: {
        // otherIncomeDocument:
        //   salaryAndOtherIncomeData?.otherIncomeDocument || [],
        // LD: salaryAndOtherIncomeData?.LD || "",
        // incomeType3: salaryAndOtherIncomeData?.incomeType3 || "",
        // salaryOtherIncomeSource:
        //   salaryAndOtherIncomeData?.salaryOtherIncomeSource || "",
        // companyName: salaryAndOtherIncomeData?.companyName || "",
        // adressOfSalaryProvider:
        //   salaryAndOtherIncomeData?.adressOfSalaryProvider || "",
        // mobNoOfSalaryProvider:
        //   salaryAndOtherIncomeData?.mobNoOfSalaryProvider || "",
        doingFromNoYears: salaryAndOtherIncomeData?.doingFromNoYears || "",
        monthlyIncomeEarned:
          salaryAndOtherIncomeData?.monthlyIncomeEarned || "",
        monthlyExpences: salaryAndOtherIncomeData?.monthlyExpences || "",
        yearlyIncome: MonthlyIncome ? MonthlyIncome * 12 : 0 || "",
      },
      OthersBusinessIncome: {
        // otherBusinessDocument: otherBuisnessData?.otherBusinessDocument || [],
        YearOfExperience: otherBuisnessData?.doingFromNoOfYears || "",
        NatureOfBusiness: otherBuisnessData?.natureOfBuisness || "",
        // NameOfBusines: otherBuisnessData?.nameOfBuisness || "",
        MonthlyIncome: otherBuisnessData?.monthlyIncomeEarned || "",
        Monthlyexpences: otherBuisnessData?.monthlyexpences || "",
        AnnualIncome:
          pdformdatasDetail?.incomeSource[0]?.other?.yearlyIncome || "",
      },
      PropertyPaperKYCForm: {
        propertyPapersKycDocument:
          propertyPaperKycData?.propertyPapersKycDocument || [],
        LD: propertyPaperKycData?.LD || "",
        cutomerName: data?.fullName || "",
        propertyOwnerName: propertyPaperKycData?.propertyOwnerName || "",
        relationWithCustomer: propertyPaperKycData?.relationWithCustomer || "",
        houseNo: propertyPaperKycData?.houseNo || "",
        surveyNo: propertyPaperKycData?.surveyNo || "",
        patwaryHalkaNo: propertyPaperKycData?.patwariHalkaNo || "",
        wardNo: propertyPaperKycData?.wardNo || "",
        villageName: propertyPaperKycData?.villageName || "",
        gramPanchayatName: propertyPaperKycData?.grampanchayatName || "",
        tehsilName: propertyPaperKycData?.tehsilName || "",
        ditrictName: propertyPaperKycData?.districtName || "",
        pincode: propertyPaperKycData?.pincode || "",
        stateName: propertyPaperKycData?.stateName || "",
        eastBoundary: propertyPaperKycData?.eastBoundary || "",
        westBoundry: propertyPaperKycData?.westBoundary || "",
        northBoundry: propertyPaperKycData?.northBoundary || "",
        southBoundry: propertyPaperKycData?.southBoundary || "",
        plotLength: propertyPaperKycData?.plotLength || "",
        plotBirth: propertyPaperKycData?.plotBridth || "",
        totalPlotArea: propertyPaperKycData?.totalPlotArea || "",
        totalAreaOfConsutruction:
          propertyPaperKycData?.totalAreaOfConstruction || "",
        typeOfConsutruction: propertyPaperKycData?.typeOfConstruction || "",
        ageOfProperty: propertyPaperKycData?.ageOfProperty || "",
        pattaNo: propertyPaperKycData?.pattaNo || "",
        pattaDate: propertyPaperKycData?.pattaDate || "",
        buildingPermissionNo: propertyPaperKycData?.buildingPermissionNo || "",
        buildingPermissionDate:
          propertyPaperKycData?.buildingPermissionDate || "",
        mutationCertificateNo:
          propertyPaperKycData?.mutationCertificateNo || "",
        mutationCertificateDate:
          propertyPaperKycData?.mutationCertificateDate || "",
        ownerCertificateNo: propertyPaperKycData?.ownerCertificateNo || "",
        ownerCertificateDate: propertyPaperKycData?.ownerCertificateDate || "",
        TaxRecieptNo: propertyPaperKycData?.taxReceiptNo || "",
        TaxRecieptDate: propertyPaperKycData?.taxReceiptDate || "",
        nocCertificateNo: propertyPaperKycData?.nocCertificateNo || "",
        nocCertificateDate: propertyPaperKycData?.nocCertificateDate || "",
        coOwnershipDeedNo: propertyPaperKycData?.coOwnershipDeedNo || "",
        coOwnershipDeedDate: propertyPaperKycData?.coOwnershipDeedDate || "",
      },
      ApplicantPDC: {
        applicantPdcDocument: appPdcData?.applicantPdcDocument || [],
        LD: appPdcData?.LD || "",
        CutomerName: data?.fullName || "",
        BankName: appPdcData?.bankName || "",
        AccountHolderName: appPdcData?.acHolderName || "",
        AccountNumber: appPdcData?.accountNumber || "",
        IFSCCode: appPdcData?.ifscCode || "",
        BranchName: appPdcData?.branchName || "",
        AccountType: appPdcData?.accountType || "",
        ChequeNumber: appPdcData?.totalChequeCount || "",
        AddChequeNumberIFNeed: "",
      },
      GuarantorPDC: {
        guarantorPdcDocument: gtrPdcData?.guarantorPdcDocument || [],
        Name: gtrPdcData?.gtrName || "",
        BankName: gtrPdcData?.gtrName || "",
        AccountHolderName: gtrPdcData?.acHolderName || "",
        AccountNumber: gtrPdcData?.accountNumber || "",
        IFSCCode: gtrPdcData?.ifscCode || "",
        BranchName: gtrPdcData?.branchName || "",
        AccountType: gtrPdcData?.accountType || "",
        ChequeNumber: gtrPdcData?.totalChequeCount || "",
        AddChequeNumber: "",
      },
      NachRagistration: {
        nachRegistrationKycDocument:
          nachRegistrationKyData?.nachRegistrationKycDocument || [],
        NachRagistrationNo:
          nachRegistrationKyData?.nachRegistrationNoUMRN || "",
        NachDoneDate: nachRegistrationKyData?.nachDoneDate || "",
      },
      PhysicalFileCourier: {
        physicalFileCourierDocument:
          physicalFileCourierData?.physicalFileCourierDocument || [],
        BranchName: physicalFileCourierData?.branchName || "",
        CourierBy: physicalFileCourierData?.courierBy || "",
        CourierTo: physicalFileCourierData?.courierTo || "",
        PODNo: physicalFileCourierData?.podNo || "",
        CourierDate: physicalFileCourierData?.courierDate || "",
      },
      RMPayment: {
        rmPaymentDocument: rmPaymentUpdateData?.rmPaymentDocument || [],
        LD: rmPaymentUpdateData?.LD || "",
        CutomerName: data?.fullName || "",
        ContactNo: rmPaymentUpdateData?.contactNo || "",
        BranchName: rmPaymentUpdateData?.branchName || "",
        AmountDeposited: rmPaymentUpdateData?.amountDeposited || "",
        UTRAndReferenceNo: rmPaymentUpdateData?.utrReferenceNo || "",
        DateOfDeposition: rmPaymentUpdateData?.dateOfDeposition || "",
        DepositedBy: rmPaymentUpdateData?.depositedBy || "",
      },
      esignPhoto: {
        esignPhoto: esignPhotoData?.esignPhotoDocument || [], //design
      },
    };
    return success(res, "branch Pendency details", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const sanctionDetails = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await applicantModel.findOne({ customerId });
    const tvrData = await tvrModel.findOne({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const customerData = await customerModel.findOne({ _id: customerId });
    const finalSanctionData = await finalSanctionModel.findOne({ customerId });
    let responseData = {
      tvrForm: {
        applicantInformation: {
          applicantName: tvrData?.applicantInformation?.customerName || "",
          applicationNumber: tvrData?.applicantInformation?.fileNumber || "",
          dateOfVerification:
            tvrData?.applicantInformation?.dateOfVerification || "",
          timeOfCall: tvrData?.applicantInformation?.timeOfCall || "",
        },
        contactVerification: {
          primaryContactNumberOfApplicant:
            tvrData?.contactVerification?.primaryContactNumberOfApplicant || "",
          alternativeContactNumber:
            tvrData?.contactVerification?.alternativeContactNumber || "",
        },
        personalAndFamilyInformation: {
          applicantDateOfBirth:
            tvrData?.personalAndFamilyInformation?.applicantDateOfBirth || "",
          numberOfDependentsInHousehold:
            tvrData?.personalAndFamilyInformation
              ?.numberOfDependentsInHousehold || "",
          relationshipStatus:
            tvrData?.personalAndFamilyInformation?.relationshipStatus || "",
          areThereAnyOtherFamilyMembersInvolvedInPayingTheEMI:
            tvrData?.personalAndFamilyInformation
              ?.areThereAnyOtherFamilyMembersInvolvedInPayingTheEMI || "",
          ifYesprovideNamesAndRelationship: tvrData?.familyDetails || {},
        },
        employmentAndIncomeDetails: {
          agriLand: tvrData?.employmentAndIncomeDetails?.agriLand || "",
          numberOfCattles:
            tvrData?.employmentAndIncomeDetails?.numberOfCattles || "",
          dairyNameWhereMilkSupplied:
            tvrData?.employmentAndIncomeDetails?.dairyNameWhereMilkSupplied ||
            "",
          phoneNumberOfDairyOwner:
            tvrData?.employmentAndIncomeDetails?.phoneNoOfDairyOwner || "",
          monthlyIncome:
            tvrData?.employmentAndIncomeDetails?.monthlyIncome || "",
          additionalSourcesOfIncome:
            tvrData?.employmentAndIncomeDetails?.additionalSourcesOfIncome ||
            [],
          totalMonthlyIncome:
            tvrData?.employmentAndIncomeDetails?.totalMonthlyIncome || "",
        },
        loanDetails: {
          loanAmountRequested: tvrData?.loanDetails?.loanAmountRequested || "",
          purposeOfLoan: tvrData?.loanDetails?.purposeOfLoan || "",
          tenureRequestedInMonths:
            tvrData?.loanDetails?.tenureRequestedInMonths || "",
          confortableEmiAmountForCustomer:
            tvrData?.loanDetails?.CustomerComfortableEmiAmount || "",
          justificationOnNeedForFundsWithBifurcation:
            tvrData?.loanDetails?.justificationOnNeedForFundsWithBifurcation ||
            "",
        },
        financialSatisfactionDetails: {
          kyaAapLoanAmountSeSantustHai:
            tvrData?.financialSatisfactionDetails?.satisfiedWithLoanAmount ||
            "",
          KyaAapROISeSantustHai:
            tvrData?.financialSatisfactionDetails?.satisfiedWithRoi || "",
          KyaAapTenureSeSantustHai:
            tvrData?.financialSatisfactionDetails?.satisfiedWithTenure || "",
          KyaAapMonthlyEMISeSantustHai:
            tvrData?.financialSatisfactionDetails
              ?.CustomerComfortableEmiAmount || "",
          fasalkharabHogiTabkaiseEMIBharenge:
            tvrData?.financialSatisfactionDetails
              ?.fasalkharabHogiTabkaiseEMIBharenge || "",
          pachTarikhKiEMIDateHaiAapkoChaarTareekSeBalanceMaintainKarnaPdegaKrPaenge:
            tvrData?.financialSatisfactionDetails
              ?.panchTarikhKiEMIDateHaiAapkoChaarTareekSeBalanceMaintainKarnaPdegaKrPaenge ||
            "",
          coOwnershipAlterKarniHogiKarwaPaenge:
            tvrData?.financialSatisfactionDetails
              ?.coOwnershipAlterKarniHogiKarwaPaenge || "",
          branchJakarLDSignKarniHogiKrPaenge:
            tvrData?.financialSatisfactionDetails
              ?.branchJakarLDSignKarniHogiKrPaenge || "",
          aapkoRMPaymentJamaKarnaPadegakrPaenge:
            tvrData?.financialSatisfactionDetails
              ?.aapkoRMPaymentJamaKarnaPadegakrPaenge || "",
        },
        propertyOwnershipDetails: {
          propertyAddress:
            tvrData?.propertyOwnershipDetails?.propertyAddress || "",
          typeOfProperty:
            tvrData?.propertyOwnershipDetails?.typeOfProperty || "",
          estimatedMarketValueOfProperty:
            tvrData?.propertyOwnershipDetails?.estimatedMarketValueOfProperty ||
            "",
          isThePropertyOwnedSolelyByTheApplicant:
            tvrData?.propertyOwnershipDetails
              ?.isThePropertyOwnedSolelyByTheApplicant || "",
          coOwnerDetails:
            tvrData?.propertyOwnershipDetails?.ifNoNameOfCoOwner || "",
        },
        verificationOfDetails: {
          confirmTheApplicantFullName:
            tvrData?.verificationOfDetails?.confirmTheApplicantFullName || "",
          confirmIncomeDetails:
            tvrData?.verificationOfDetails?.confirmIncomeDetails || "",
          confirmPropertyOwnership:
            tvrData?.verificationOfDetails?.confirmPropertyOwnership || "",
          confirmLoanAmountAndPurpose:
            tvrData?.verificationOfDetails?.confirmLoanAmountAndPurpose || "",
        },
        additionalVerificationQuestions: {
          areYouAwareOfTheEMIObligationsForTheLoan:
            tvrData?.additionalVerificationQuestions
              ?.areYouAwareOfTheEMIObligationsForTheLoan || "",
          doYouHaveAnyAdditionalLoansOrDebtsAtPresent:
            tvrData?.additionalVerificationQuestions
              ?.doYouHaveAnyAdditionalLoansOrDebtsAtPresent || "",
          ifYesPleaseSpecifyTypeAndAmount:
            tvrData?.additionalVerificationQuestions
              ?.ifYesPleaseSpecifyTypeAndAmount || "",
          isYourMonthlyIncomeSufficientToCoverTheEMIs:
            tvrData?.additionalVerificationQuestions
              ?.isYourMonthlyIncomeSufficientToCoverTheEMIs || "",
          haveYouFacedAnyFinancialDifficultiesInThePastTwelveMonths:
            tvrData?.additionalVerificationQuestions
              ?.haveYouFacedAnyFinancialDifficultiesInThePastTwelveMonths || "",
          ifYesPleaseDescribe:
            tvrData?.additionalVerificationQuestions?.ifYesPleaseDescribe || "",
        },
        communicationAndFeedbackFromApplicant: {
          howDidYouFindOutAboutOurServices:
            tvrData?.communicationAndFeedbackFromApplicant
              ?.howDidYouFindOutAboutOurServices || "",
          whatMotivatedYouToApplyForOurLoan:
            tvrData?.communicationAndFeedbackFromApplicant
              ?.whatMotivatedYouToApplyForOurLoan || "",
          areYouSatisfiedWithTheLoanTermsSDiscussedDuringTheApplicationProcess:
            tvrData?.communicationAndFeedbackFromApplicant
              ?.areYouSatisfiedWithTheLoanTermsSDiscussedDuringTheApplicationProcess ||
            "",
          ifNoPleaseExplainYourConcernsOrIssues:
            tvrData?.communicationAndFeedbackFromApplicant
              ?.ifNoPleaseExplainYourConcernsOrIssues || "",
        },
        remarksFromCreditManager: {
          additionalObservations:
            tvrData?.remarksFromCreditManager?.additionalObservations || "",
          recommendationsBasedOnVerification:
            tvrData?.remarksFromCreditManager
              ?.recommendationsBasedOnVerification || "",
        },
        verificationStatus: {
          verificationCompletedByNameOfCreditManager:
            tvrData?.verificationStatus
              ?.verificationCompletedByNameOfCreditManager || "",
          overallVerificationStatus:
            tvrData?.verificationStatus?.overallVerificationStatus || "",
          ifRejectedReasonForRejection:
            tvrData?.verificationStatus?.ifRejectedReasonForRejection || "",
        },
      },
      finalSanctionDetails: {
        applicantAndCaseInformation: {
          partnerName:
            finalSanctionData?.applicantAndCaseInformation?.partnerName || "",
          branchName:
            finalSanctionData?.applicantAndCaseInformation?.branchName || "",
          caseType:
            finalSanctionData?.applicantAndCaseInformation?.caseType || "",
          applicantName:
            finalSanctionData?.applicantAndCaseInformation?.applicantName || "",
          fatherName:
            finalSanctionData?.applicantAndCaseInformation?.fatherName || "",
          contactNumber:
            finalSanctionData?.applicantAndCaseInformation?.contactNumber || "",
        },
        landmarkoanDetails: {
          loanAmount: finalSanctionData?.loanDetails?.loanAmount || "",
          loanAmountInWords:
            finalSanctionData?.loanDetails?.loanAmountInWords || "",
          principleAmount:
            finalSanctionData?.loanDetails?.principleAmount || "",
          interestAmount: finalSanctionData?.loanDetails?.interestAmount || "",
          totalAmount: finalSanctionData?.loanDetails?.totalAmount || "",
          roi: finalSanctionData?.loanDetails?.roi || "",
          tenure: finalSanctionData?.loanDetails?.tenure || "",
        },
        emiDetails: {
          emiAmount: finalSanctionData?.emiDetails?.emiAmount || "",
          emiCycleDate: finalSanctionData?.emiDetails?.emiCycleDate || "",
        },
      },
    };

    return success(res, "sanction details", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// const disbursementDetails = async (req, res) => {
//   try {
//     const { customerId } = req.query;
//     const data = await disbursementModel.findOne({ customerId });
//     const responseData = {
//       preDisbursementForm: {
//         applicantName: data?.preDisbursementForm?.applicantName || "",
//         dateOfSanction: data?.preDisbursementForm?.dateOfSanction || "",
//         sanctionLetterNumber:
//           data?.preDisbursementForm?.sanctionLetterNumber || "",
//         dateOfTheAgreement: data?.preDisbursementForm?.dateOfTheAgreement || "",
//         placeOfExecution: data?.preDisbursementForm?.placeOfExecution || "",
//       },
//       kfsDetails: {
//         processingFees: data?.kfsDetails?.processingFees || "",
//         documentsCharges: data?.kfsDetails?.documentsCharges || "",
//         insuranceCharges: data?.kfsDetails?.insuranceCharges || "",
//         cersaiCharges: data?.kfsDetails?.cersaiCharges || "",
//         preEmiinterest: data?.kfsDetails?.preEmiInterest || "",
//         benchmarkinterestRate: data?.kfsDetails?.benchmarkinterestRate || "",
//         spreadInterestRate: data?.kfsDetails?.SpreadInterestRate || "",
//         annualPercentageRateAprPercentage:
//           data?.kfsDetails?.annualPercentageRateAprPercentage || "",
//         epi: data?.kfsDetails?.epi || "",
//         noOfEpi: data?.kfsDetails?.noOfEpi || "",
//       },
//       postDisbursementDetails: {
//         applicantName: data?.postDisbursementDetails?.applicantName || "",
//         fatherName: data?.postDisbursementDetails?.fatherName || "",
//         loanNumber: data?.postDisbursementDetails?.loanNumber || "",
//         actualPreEmi: data?.postDisbursementDetails?.actualPreEmi || "",
//         dateOfDisbursement:
//           data?.postDisbursementDetails?.dateOfDisbursement || "",
//         dateOfFirstEmi: data?.postDisbursementDetails?.dateOfFirstEmi || "",
//         utrNumberOne: data?.postDisbursementDetails?.utrNumberOne || "",
//         utrNumberTwo: data?.postDisbursementDetails?.utrNumberTwo || "",
//         disbursementDoneBy:
//           data?.postDisbursementDetails?.disbursementDoneBy || "",
//       },
//     };
//     return success(res, "loan type details", {
//       data: responseData,
//     });
//   } catch (error) {
//     console.log(error);
//     return unknownError(res, error);
//   }
// };

const disbursementDetails = async (req, res) => {
  try {
    const { customerId } = req.query;

    // Validate customerId
    if (!customerId) {
      return notFound(res, "Customer ID is required");
    }

    // Fetch data with specific projection to avoid path collision
    const data = await disbursementModel.findOne({ customerId: customerId });
    const internalLegalDetails = await internalLegalModel.findOne({
      customerId,
    });

    if (!data) {
      return notFound(res, "Disbursement form not found");
    }

    // Return successful response
    success(res, "Get Detail", {data:data, internalLegalDetails});
  } catch (error) {
    console.error("Error fetching disbursement details:", error);
    unknownError(res, error);
  }
};

const inventoryManagement = async (req, res) => {
  try {
    const { customerId } = req.query;
    // jinamEntryModel,fileEnventoryModel
    const jinamEntryData = await jinamEntryModel.findOne({ customerId });
    const fileEnventoryData = await fileEnventoryModel.findOne({ customerId });
    const appData = await applicantModel.findOne({ customerId });
    const customerData = await customerModel.findOne({ _id: customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });

    const responseData = {
      jinamEntryDetails: {
        customerName: jinamEntryData?.customerName || "",
        partnerName: jinamEntryData?.partnerName || "",
        branchName: jinamEntryData?.branchName || "",
        applicantJainamProfileNo:
          jinamEntryData?.applicantJainamProfileNo || "",
        coApplicantName: jinamEntryData?.coApplicantName || "",
        coApplicantJainamProfileNo:
          jinamEntryData?.coApplicantJainamProfileNo || "",
        coApplicantTwoName: jinamEntryData?.coApplicantTwoName || "",
        coApplicantTwoJainamProfileNo:
          jinamEntryData?.coApplicantTwoJainamProfileNo || "",
        guarantorName: jinamEntryData?.guarantorName || "",
        guarantorJainamProfileNo:
          jinamEntryData?.guarantorJainamProfileNo || "",
        jainamLoanNumber: jinamEntryData?.jainamLoanNumber || "",
        caseDisbursedInjainam: jinamEntryData?.caseDisbursedInjainam || "",
      },
      fileInventoryDetails: {
        customerName: fileEnventoryData?.customerName || "",
        fatherName: fileEnventoryData?.fatherName || "",
        loanNumber: fileEnventoryData?.loanNumber || "",
        sanction: fileEnventoryData?.sanction || "",
        disbursement: fileEnventoryData?.disbursement || "",
        fileNo: fileEnventoryData?.fileNo || "",
      },
      applicantChequeInventoryDetails: {
        applicantPdcDocument: appPdcData?.applicantPdcDocument || "",
        customerName: customerData?.executiveName || "",
        bankName: appPdcData?.bankName || "",
        acHolderName: appPdcData?.acHolderName || "",
        acNumber: appPdcData?.accountNumber || "",
        ifscCode: appPdcData?.ifscCode || "",
        branchName: appPdcData?.branchName || "",
        acType: appPdcData?.accountType || "",
        totalChequeCount: appPdcData?.totalChequeCount || "",
        chequeNo1: appPdcData?.chequeNo1 || "",
        chequeNo2: appPdcData?.chequeNo2 || "",
        chequeNo3: appPdcData?.chequeNo3 || "",
        chequeNo4: appPdcData?.chequeNo4 || "",
        chequeNo5: appPdcData?.chequeNo5 || "",
        chequeNo6: appPdcData?.chequeNo6 || "",
        chequeNo7: appPdcData?.chequeNo7 || "",
        chequeNo8: appPdcData?.chequeNo8 || "",
        chequeNo9: appPdcData?.chequeNo9 || "",
        chequeNo10: appPdcData?.chequeNo10 || "",
      },
      guarantorChequeInventoryDetail: {
        guarantorPdcDocument: gtrPdcData?.guarantorPdcDocument || [],
        guarantorName: gtrPdcData?.gtrName || "",
        bankName: gtrPdcData?.bankName || "",
        acHolderName: gtrPdcData?.acHolderName || "",
        acNumber: gtrPdcData?.accountNumber || "",
        ifscCode: gtrPdcData?.ifscCode || "",
        branchName: gtrPdcData?.branchName || "",
        acType: gtrPdcData?.accountType || "",
        totalChequeCount: gtrPdcData?.totalChequeCount || "",
        chequeNo1: gtrPdcData?.chequeNo1 || "",
        chequeNo2: gtrPdcData?.chequeNo2 || "",
        chequeNo3: gtrPdcData?.chequeNo3 || "",
        chequeNo4: gtrPdcData?.chequeNo4 || "",
        chequeNo5: gtrPdcData?.chequeNo5 || "",
        chequeNo6: gtrPdcData?.chequeNo6 || "",
        chequeNo7: gtrPdcData?.chequeNo7 || "",
        chequeNo8: gtrPdcData?.chequeNo8 || "",
        chequeNo9: gtrPdcData?.chequeNo9 || "",
        chequeNo10: gtrPdcData?.chequeNo10 || "",
      },
    };
    return success(res, "inventory management details", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const addCibilDetails = async (req, res) => {
  try {
    const {
      customerId,
      applicantCibilDetail,
      applicantTotalObligation,
      applicantTotalObligationMonthly,
    } = req.body; // Destructure 'data' array from req.body

    if (
      !Array.isArray(applicantCibilDetail) ||
      applicantCibilDetail.length === 0
    ) {
      return badRequest(res, "No applicantCibilDetail provided");
    }
    let data;
    for (const record of applicantCibilDetail) {
      const {
        Institution,
        loanType,
        loanAmount,
        outstandingAmount,
        RateOfInterest,
        ownership,
        emiMonthly,
        emiAnnual,
        TotalTenure,
        BalanceTenure,
        LoanStatus,
        LoanObligated,
        ObligationConsidered,

        overDue,
        cibilScore,
        SanctionedAmount,
        CurrentBalance,
      } = record;

      const customerDetails = await cibilModel.findOne({ customerId });
      if (!customerDetails) {
        return badRequest(res, `customerId ${customerId} does not exist`);
      }

      data = await cibilModel.findOneAndUpdate(
        { customerId },
        {
          $push: {
            applicantCibilDetail: {
              Institution,
              loanType,
              loanAmount,
              outstandingAmount,
              RateOfInterest,
              ownership,
              emiMonthly,
              emiAnnual,
              TotalTenure,
              BalanceTenure,
              LoanStatus,
              LoanObligated,
              ObligationConsidered,
            },
          },
          $set: {
            applicantTotalObligation,
            applicantTotalObligationMonthly,
          },
        },
        { new: true }
      );
    }

    return success(res, "CibilDetails added successfully", { data });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// updateCibilDetails
const updateCibilDetails = async (req, res) => {
  try {
    const { customerId, applicantCibilDetail, applicantTotalObligation,applicantTotalObligationMonthly } =
      req.body; // Destructure 'data' array from req.body

    if (
      !Array.isArray(applicantCibilDetail) ||
      applicantCibilDetail.length === 0
    ) {
      return badRequest(res, "No applicantCibilDetail provided");
    }
    let data;
    for (const record of applicantCibilDetail) {
      const {
        Institution,
        loanType,
        loanAmount,
        outstandingAmount,
        RateOfInterest,
        ownership,
        emiMonthly,
        emiAnnual,
        TotalTenure,
        BalanceTenure,
        LoanStatus,
        LoanObligated,
        ObligationConsidered,

        overDue,
        cibilScore,
        SanctionedAmount,
        CurrentBalance,
      } = record;

      const customerDetails = await cibilModel.findOne({ customerId });
      if (!customerDetails) {
        return badRequest(res, `customerId ${customerId} does not exist`);
      }

      data = await cibilModel.findOneAndUpdate(
        { customerId },
        {
          $set: {
            applicantTotalObligation,
            applicantCibilDetail,
            applicantTotalObligationMonthly
          },
        },
        { new: true }
      );
    }
    if (data?.applicantCibilDetail?.length > 0) {
      // updateFields.finalSanctionDetailsFormStart = true;
      // updateFields.finalSanctionDetailsFormComplete = true;
      const update = await processModel.findOneAndUpdate(
        { customerId },
        { $set: { cibilDetailFormStart: true, cibilDetailFormComplete: true } },
        { new: true }
      );
      console.log(update, "update");
    }

    return success(res, "CibilDetails added successfully", { data });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// addCoAppCibilDetails

const addCoAppCibilDetails = async (req, res) => {
  try {
    const {
      customerId,
      coAppOneloanDetail,
      coAppTwoloanDetail,
      guarantorCibilDetail,
    } = req.body;

    if (!coAppOneloanDetail && !coAppTwoloanDetail && !guarantorCibilDetail) {
      return badRequest(res, "No loan details provided");
    }

    const customerDetails = await cibilModel.findOne({ customerId });
    if (!customerDetails) {
      return badRequest(res, `customerId ${customerId} does not exist`);
    }

    if (coAppOneloanDetail) {
      for (const record of coAppOneloanDetail) {
        const {
          loanType,
          loanAmount,
          outstandingAmount,
          overDue,
          emi,
          cibilScore,
          ownership,
          SanctionedAmount,
          CurrentBalance,
          RateOfInterest,
          TotalTenure,
          BalanceTenure,
          LoanStatus,
          LoanObligated,
          ObligationConsidered,
        } = record;

        await cibilModel.findOneAndUpdate(
          { customerId },
          {
            $push: {
              "coApplicantData.0.coApplicantCibilDetail": {
                loanType,
                loanAmount,
                outstandingAmount,
                overDue,
                emi,
                cibilScore,
                ownership,
                SanctionedAmount,
                CurrentBalance,
                RateOfInterest,
                TotalTenure,
                BalanceTenure,
                LoanStatus,
                LoanObligated,
                ObligationConsidered,
              },
            },
          },
          { new: true }
        );
      }
    }

    if (coAppTwoloanDetail) {
      for (const record of coAppTwoloanDetail) {
        const {
          loanType,
          loanAmount,
          outstandingAmount,
          overDue,
          emi,
          cibilScore,
          ownership,
          SanctionedAmount,
          CurrentBalance,
          RateOfInterest,
          TotalTenure,
          BalanceTenure,
          LoanStatus,
          LoanObligated,
          ObligationConsidered,
        } = record;

        await cibilModel.findOneAndUpdate(
          { customerId },
          {
            $push: {
              "coApplicantData.1.coApplicantCibilDetail": {
                loanType,
                loanAmount,
                outstandingAmount,
                overDue,
                emi,
                cibilScore,
                ownership,
                SanctionedAmount,
                CurrentBalance,
                RateOfInterest,
                TotalTenure,
                BalanceTenure,
                LoanStatus,
                LoanObligated,
                ObligationConsidered,
              },
            },
          },
          { new: true }
        );
      }
    }

    if (guarantorCibilDetail) {
      for (const record of guarantorCibilDetail) {
        const {
          loanType,
          loanAmount,
          outstandingAmount,
          overDue,
          emi,
          cibilScore,
          ownership,
          SanctionedAmount,
          CurrentBalance,
          RateOfInterest,
          TotalTenure,
          BalanceTenure,
          LoanStatus,
          LoanObligated,
          ObligationConsidered,
        } = record;

        await cibilModel.findOneAndUpdate(
          { customerId },
          {
            $push: {
              guarantorCibilDetail: {
                loanType,
                loanAmount,
                outstandingAmount,
                overDue,
                emi,
                cibilScore,
                ownership,
                SanctionedAmount,
                CurrentBalance,
                RateOfInterest,
                TotalTenure,
                BalanceTenure,
                LoanStatus,
                LoanObligated,
                ObligationConsidered,
              },
            },
          },
          { new: true }
        );
      }
    }

    return success(res, "CIBIL Details added successfully");
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const processPdfAndUpload = async (customerId, logo, uploadUrl) => {
  const sectionData = await sectionLatter(customerId, logo);
  // console.log(sectionData,"sectionData in contorller log")
  const applicantData = await applicantLatter(customerId, logo);
  const rcplLoanAgreementData = await rcplLoanAgreement(customerId);

  // console.log(sectionData,"sectionData")

  const sectionObj = {
    fileName: sectionData,
    // file: doc.toString('base64')
  };
  const sectionEsign = await initESign(sectionObj);

  const applicantObj = {
    fileName: sectionData,
    // file: doc.toString('base64')
  };
  const applicantEsign = await initESign(applicantObj);

  const rcplLoanAgreementObj = {
    fileName: sectionData,
    // file: doc.toString('base64')
  };
  const rcplLoanAgreementEsign = await initESign(rcplLoanAgreementObj);

  const processFile = async (filePath) => {
    let resolvedPath = path
      .resolve(__dirname, `../../../..${filePath}`)
      .replace(/\\/g, "/");
    const formData = new FormData();
    formData.append("image", fs.createReadStream(resolvedPath));
    const response = await axios.post(uploadUrl, formData, {
      headers: { ...formData.getHeaders() },
    });
    return response.data?.items;
  };

  const uploadedSectionUrl = await processFile(sectionData);
  const uploadedApplicantUrl = await processFile(applicantData);
  const uploadedAgreementUrl = await processFile(rcplLoanAgreementData);

  if (!uploadedSectionUrl || !uploadedApplicantUrl || !uploadedAgreementUrl) {
    throw new Error("One or more uploaded file URLs are undefined.");
  }

  // fs.unlinkSync(path.resolve(__dirname, `../../../..${sectionData}`));
  // fs.unlinkSync(path.resolve(__dirname, `../../../..${applicantData}`));

  return { uploadedSectionUrl, uploadedApplicantUrl, uploadedAgreementUrl };
};

// ratna fin send to partner
const sendToPartner = async (req, res) => {
  try {
    const { partnerId, customerId } = req.body;
    const partnerModel = await lendersModel.findOne({ _id: partnerId });

    const partnerConfigs = {
      "FIN COOPERS CAPITAL PVT LTD": FinpdfLogo,
      "RATNAAFIN CAPITAL PVT LTD": RatnapdfLogo,
    };

    const partnerLogo = partnerConfigs[partnerModel.partnerName];
    if (!partnerLogo) throw new Error("Unsupported partner.");

    const uploadUrl = "https://stageapi.fincooper.in/v1/formData/ImageUpload";
    const { uploadedSectionUrl, uploadedApplicantUrl, uploadedAgreementUrl } =
      await processPdfAndUpload(customerId, partnerLogo, uploadUrl);

    const BASEURL = process.env.BASE_URL;
    const attachments = [
      {
        path: `${BASEURL}${uploadedSectionUrl.image}`,
        filename: uploadedSectionUrl.image.split("/").pop(),
        contentType: "application/pdf",
      },
      {
        path: `${BASEURL}${uploadedApplicantUrl.image}`,
        filename: uploadedApplicantUrl.image.split("/").pop(),
        contentType: "application/pdf",
      },
      {
        path: `${BASEURL}${uploadedAgreementUrl.image}`,
        filename: uploadedAgreementUrl.image.split("/").pop(),
        contentType: "application/pdf",
      },
    ];

    // console.log("Attachments:", attachments);

    const emailContent = `
      <div style="font-family: Arial, sans-serif; line-height: 1.6;">
        <p>Dear Sir,</p>
        <p>Caption case Report is for final approval.</p>
        <p>Need your immediate action in this case.</p>
        <p>Regards,</p>
        <p>Team FinCoopers</p>
        <div>All PDFs are attached in this email.</div>
      </div>
    `;

    await sendEmail(
      [partnerModel.email],
      ["raikwar@yopmail.com"],
      `Final approval email for review`,
      emailContent,
      attachments
    );

    return success(res, "Email sent successfully with uploaded files.");
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// grow money send to partner
const growMonetProcessPdfAndUpload = async (customerId, logo, uploadUrl) => {
  const pgDeedData = await generatePgDeedSangitaPdf(customerId, logo);
  // console.log(pgDeedData,"pgDeedData in contorller log")
  const sanctionData = await generateSanctionLetterPdf(customerId, logo);
  const rcplLoanAgreementData = await rcplLoanAgreement(customerId);

  // console.log(sectionData,"sectionData")

  const pgDeedObj = {
    fileName: pgDeedData,
    // file: doc.toString('base64')
  };
  // const sectionEsign = await initESign(pgDeedObj)

  const applicantObj = {
    fileName: sanctionData,
    // file: doc.toString('base64')
  };
  //  const applicantEsign = await initESign(applicantObj)

  const rcplLoanAgreementObj = {
    fileName: rcplLoanAgreementData,
    // file: doc.toString('base64')
  };
  //  const growMoneyAgreementEsign = await initESign(rcplLoanAgreementObj)

  const processFile = async (filePath) => {
    let resolvedPath = path
      .resolve(__dirname, `../../../..${filePath}`)
      .replace(/\\/g, "/");
    const formData = new FormData();
    formData.append("image", fs.createReadStream(resolvedPath));
    const response = await axios.post(uploadUrl, formData, {
      headers: { ...formData.getHeaders() },
    });
    return response.data?.items;
  };

  const uploadedPgDeedUrl = await processFile(pgDeedData);
  const uploadedSanctionUrl = await processFile(sanctionData);
  const uploadedAgreementUrl = await processFile(rcplLoanAgreementData);

  if (!uploadedPgDeedUrl || !uploadedAgreementUrl || !uploadedSanctionUrl) {
    throw new Error("One or more uploaded file URLs are undefined.");
  }

  // fs.unlinkSync(path.resolve(__dirname, `../../../..${sectionData}`));
  // fs.unlinkSync(path.resolve(__dirname, `../../../..${applicantData}`));

  return { uploadedPgDeedUrl, uploadedAgreementUrl, uploadedSanctionUrl };
};

const growMonetSendToPartner = async (req, res) => {
  try {
    const { partnerId, customerId } = req.body;
    // console.log(partnerId, customerId, "partnerId, customerId")
    const partnerModel = await lendersModel.findOne({ _id: partnerId });

    const partnerConfigs = {
      "FIN COOPERS CAPITAL PVT LTD": FinpdfLogo,
    };

    const partnerLogo = partnerConfigs[partnerModel.partnerName];
    // console.log("partnerLogo",partnerLogo);
    if (!partnerLogo) throw new Error("Unsupported partner.");

    const uploadUrl = "https://stageapi.fincooper.in/v1/formData/ImageUpload";
    const { uploadedPgDeedUrl, uploadedAgreementUrl, uploadedSanctionUrl } =
      await growMonetProcessPdfAndUpload(customerId, partnerLogo, uploadUrl);

    const BASEURL = process.env.BASE_URL;
    const attachments = [
      {
        path: `${BASEURL}${uploadedPgDeedUrl.image}`,
        filename: uploadedPgDeedUrl.image.split("/").pop(),
        contentType: "application/pdf",
      },
      {
        path: `${BASEURL}${uploadedSanctionUrl.image}`,
        filename: uploadedSanctionUrl.image.split("/").pop(),
        contentType: "application/pdf",
      },
      {
        path: `${BASEURL}${uploadedAgreementUrl.image}`,
        filename: uploadedAgreementUrl.image.split("/").pop(),
        contentType: "application/pdf",
      },
    ];

    // console.log("Attachments:", attachments);

    const emailContent = `
      <div style="font-family: Arial, sans-serif; line-height: 1.6;">
        <p>Dear Sir,</p>
        <p>Caption case Report is for final approval.</p>
        <p>Need your immediate action in this case.</p>
        <p>Regards,</p>
        <p>Team FinCoopers</p>
        <div>All PDFs are attached in this email.</div>
      </div>
    `;

    await sendEmail(
      [partnerModel.email],
      ["raikwar@yopmail.com"],
      `Final approval email for review`,
      emailContent,
      attachments
    );

    return success(res, "Email sent successfully with uploaded files.");
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const excelSheetData = async (req, res) => {
  try {
    const { customerId } = req.query;
    // const customerId = '6697ba1fdea34ac072366fee';
    // console.log("tokenId", tokenId);

    // Find employee by token ID
    const customerData = await customerModel.findById({ _id: customerId });
    if (!customerData) {
      return notFound(res, "customer not found", []);
    }

    const customerFinId = customerData?.customerFinId;
    // console.log("employeUniqueId", customerFinId);
    // Check if employeUniqueId is empty
    // if (!customerFinId) {
    //   return notFound(res, "customerFinId not found", []);
    // }

    const spreadsheetId = "1K9EnCErm-NfZCg7--TJtkfOqzPyGc-c5eLrWELS3kMA"; //process.env.VISIT_GOOGLE_SHEET_KEY;
    const sheetName = "Sheet1"; //process.env.EMIOVERALL_SHEET;
    const auth = new google.auth.GoogleAuth({
      credentials,
      scopes: ["https://www.googleapis.com/auth/spreadsheets"],
    });
    const authClient = await auth.getClient();
    const sheets = google.sheets({ version: "v4", auth: authClient });

    const response = await sheets.spreadsheets.values.get({
      spreadsheetId,
      range: sheetName,
    });

    const rows = response.data.values;
    // console.log(rows,"rows<><><><><><>")

    // Get headers and data rows
    const [headers, ...dataRows] = rows;

    // Find the row matching the customerFinId
    const matchingRow = dataRows.find(
      (row) => row[headers.indexOf("customerFinId")] === customerFinId
    );

    // if (!matchingRow) {
    //   return notFound(
    //     res,
    //     "No matching data(customerFinId) found in the sheet",
    //     []
    //   );
    // }
    // const responseData = {
    //   // 1st api
    //   customerLoanType: {
    //     LoanAmountRequested:
    //     matchingRow ?  matchingRow[headers.indexOf("LoanAmountRequested")] : "NA",
    //     LoanTenureRequested:
    //     matchingRow ? matchingRow[headers.indexOf("LoanTenureRequested")] : "NA",
    //     LoanPurpose: matchingRow ? matchingRow[headers.indexOf("LoanPurpose")] : "NA",
    //     LoanType: matchingRow ? matchingRow[headers.indexOf("LoanType")] : "NA",
    //     roi: matchingRow ? matchingRow[headers.indexOf("Roi")] : "NA",
    //     emi: matchingRow ? matchingRow[headers.indexOf("Emi")] : "NA",
    //   },}

    const responseData = {
      // 1st api
      customerLoanType: {
        LoanAmountRequested: matchingRow
          ? matchingRow[headers.indexOf("LoanAmountRequested")]
          : "",
        LoanTenureRequested: matchingRow
          ? matchingRow[headers.indexOf("LoanTenureRequested")]
          : "",
        LoanPurpose: matchingRow
          ? matchingRow[headers.indexOf("LoanPurpose")]
          : "",
        LoanType: matchingRow ? matchingRow[headers.indexOf("LoanType")] : "",
        roi: matchingRow ? matchingRow[headers.indexOf("Roi")] : "",
        emi: matchingRow ? matchingRow[headers.indexOf("Emi")] : "",
      },
      _id: customerId, // Include customer _id
      employeId: "",
      productId: "",
      customerFinId: matchingRow ? customerFinId : "",
      mobileNo: matchingRow ? matchingRow[headers.indexOf("MobileNo")] : "",
      loanAmount: matchingRow
        ? matchingRow[headers.indexOf("LoanAmountRequested")]
        : "",
      roi: matchingRow ? matchingRow[headers.indexOf("Roi")] : "",
      tenure: matchingRow
        ? matchingRow[headers.indexOf("LoanTenureRequested")]
        : "",
      emi: matchingRow ? matchingRow[headers.indexOf("Emi")] : "",
      executiveName: matchingRow
        ? matchingRow[headers.indexOf("ExecutiveName")]
        : "",
      createdAt: "",
      updatedAt: "",
      productData: {
        productName: matchingRow
          ? matchingRow[headers.indexOf("ProductName")]
          : "",
      },
      applicantDetail: {
        fullName: matchingRow ? matchingRow[headers.indexOf("FullName")] : "",
        applicantPhoto: matchingRow
          ? matchingRow[headers.indexOf("ApplicantPhoto")]
          : "",
      },
      cibildetailDetail: {
        applicantCibilScore: matchingRow
          ? matchingRow[headers.indexOf("ApplicantCibilScore")]
          : "",
      },
      tvrDetails: {
        income: matchingRow ? matchingRow[headers.indexOf("Income")] : "",
        propertyValue: matchingRow
          ? matchingRow[headers.indexOf("PropertyValue")]
          : "",
        foir: matchingRow ? matchingRow[headers.indexOf("Foir")] : "",
        ltv: matchingRow ? matchingRow[headers.indexOf("ltv")] : "",
      },
      ApplicantDetails: {
        ApplicantType: matchingRow
          ? matchingRow[headers.indexOf("ApplicantType")]
          : "",
        bussinessType: matchingRow
          ? matchingRow[headers.indexOf("BussinessType")]
          : "",
        fullName: matchingRow ? matchingRow[headers.indexOf("FullName")] : "",
        fatherName: matchingRow
          ? matchingRow[headers.indexOf("FatherName")]
          : "",
        motherName: matchingRow
          ? matchingRow[headers.indexOf("MotherName")]
          : "",
        spouseName: matchingRow
          ? matchingRow[headers.indexOf("SpouseName")]
          : "",
        dob: matchingRow ? matchingRow[headers.indexOf("Dob")] : "",
        age: matchingRow ? matchingRow[headers.indexOf("Age")] : "",
        gender: matchingRow ? matchingRow[headers.indexOf("Gender")] : "",
        maritalStatus: matchingRow
          ? matchingRow[headers.indexOf("MaritalStatus")]
          : "",
        educationalDetails: matchingRow
          ? matchingRow[headers.indexOf("EducationalDetails")]
          : "",
        religion: matchingRow ? matchingRow[headers.indexOf("Religion")] : "",
        nationality: matchingRow
          ? matchingRow[headers.indexOf("Nationality")]
          : "",
        category: matchingRow ? matchingRow[headers.indexOf("Category")] : "",
        caste: matchingRow ? matchingRow[headers.indexOf("Caste")] : "",
        noOfDependentWithCustomer: matchingRow
          ? matchingRow[headers.indexOf("noOfDependentWithCustomer")]
          : "",
      },
      kycDetailsOf: {
        panNo: matchingRow ? matchingRow[headers.indexOf("PanNo")] : "",
        aadharNo: matchingRow ? matchingRow[headers.indexOf("AadharNo")] : "",
        voterIdNo: matchingRow ? matchingRow[headers.indexOf("VoterIdNo")] : "",
        udyamRegistrationNo: matchingRow
          ? matchingRow[headers.indexOf("UdyamRegistrationNo")]
          : "",
      },
      contactInformation: {
        mobileNo: matchingRow ? matchingRow[headers.indexOf("MobileNo")] : "",
        mobileNoTwo: matchingRow
          ? matchingRow[headers.indexOf("MobileNoTwo")]
          : "",
        email: matchingRow ? matchingRow[headers.indexOf("Email")] : "",
      },
      persnalDetails: {
        religion: matchingRow ? matchingRow[headers.indexOf("Religion")] : "",
        nationality: matchingRow
          ? matchingRow[headers.indexOf("Nationality")]
          : "",
        category: matchingRow ? matchingRow[headers.indexOf("Category")] : "",
      },
      permanentInformation: {
        fullAddress: matchingRow
          ? matchingRow[headers.indexOf("PermanentFullAddress")]
          : "",
        presentAddress: matchingRow
          ? matchingRow[headers.indexOf("PermanentPresentAddress")]
          : "",
        landmark: matchingRow
          ? matchingRow[headers.indexOf("PermanentLandmark")]
          : "",
        city: matchingRow ? matchingRow[headers.indexOf("PermanentCity")] : "",
        state: matchingRow
          ? matchingRow[headers.indexOf("PermanentState")]
          : "",
        district: matchingRow
          ? matchingRow[headers.indexOf("PermanentDistrict")]
          : "",
        pinCode: matchingRow
          ? matchingRow[headers.indexOf("PermanentPinCode")]
          : "",
        noOfyearsAtCurrentAddress: matchingRow
          ? matchingRow[headers.indexOf("PermanentNoOfyearsAtCurrentAddress")]
          : "",
        country: "India",
      },
      presentInformation: {
        addressAsPerAdhar: matchingRow
          ? matchingRow[headers.indexOf("PresentAddressAsPerAdhar")]
          : "",
        landmark: matchingRow
          ? matchingRow[headers.indexOf("PresentLandmark")]
          : "",
        city: matchingRow ? matchingRow[headers.indexOf("PresentCity")] : "",
        state: matchingRow ? matchingRow[headers.indexOf("PresentState")] : "",
        district: matchingRow
          ? matchingRow[headers.indexOf("PresentDistrict")]
          : "",
        pinCode: matchingRow
          ? matchingRow[headers.indexOf("PresentPincode")]
          : "",
        noOfyearsAtCurrentAddress: matchingRow
          ? matchingRow[headers.indexOf("PresentNoOfyearsAtCurrentAddress")]
          : "",
        country: matchingRow
          ? matchingRow[headers.indexOf("PresentCountry")]
          : "India",
        residenceType: matchingRow
          ? matchingRow[headers.indexOf("PresentResidenceType")]
          : "",
      },
      educationAndOccupation: {
        education: matchingRow ? matchingRow[headers.indexOf("education")] : "",
        occupation: matchingRow
          ? matchingRow[headers.indexOf("occupation")]
          : "",
        monthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("monthlyIncome")]
          : "",
        otherMonthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("otherMonthlyIncome")]
          : "",
        sourceOfOtherIncome: matchingRow
          ? matchingRow[headers.indexOf("sourceOfOtherIncome")]
          : "",
        annualIncome: matchingRow
          ? matchingRow[headers.indexOf("annualIncome")]
          : "",
        totalHouseHoldExpenses: matchingRow
          ? matchingRow[headers.indexOf("totalHouseHoldExpenses")]
          : "",
      },
      // co-applicant
      coApplicantDetails: [
        {
          ApplicantType: matchingRow
            ? matchingRow[headers.indexOf("coApplicantTypeOne")]
            : "",
          bussinessType: matchingRow
            ? matchingRow[headers.indexOf("coApplicantBussinessTypeOne")]
            : "",
          fullName: matchingRow
            ? matchingRow[headers.indexOf("coApplicantFullNameOne")]
            : "",
          fatherName: matchingRow
            ? matchingRow[headers.indexOf("coApplicantFatherNameOne")]
            : "",
          motherName: matchingRow
            ? matchingRow[headers.indexOf("coApplicantMotherNameOne")]
            : "",
          dob: matchingRow
            ? matchingRow[headers.indexOf("coApplicantDobOne")]
            : "",
          age: matchingRow
            ? matchingRow[headers.indexOf("coApplicantAgeOne")]
            : "",
          gender: matchingRow
            ? matchingRow[headers.indexOf("coApplicantGenderOne")]
            : "",
          maritalStatus: matchingRow
            ? matchingRow[headers.indexOf("coApplicantMaritalStatusOne")]
            : "",
          educationDetails: matchingRow
            ? matchingRow[headers.indexOf("coApplicantEducationDetailsOne")]
            : "",
          relationWithApplicant: matchingRow
            ? matchingRow[
                headers.indexOf("coApplicantRelationWithApplicantOne")
              ]
            : "",
          religion: matchingRow
            ? matchingRow[headers.indexOf("coApplicantReligionOne")]
            : "",
          nationality: matchingRow
            ? matchingRow[headers.indexOf("coApplicantNationalityOne")]
            : "",
          category: matchingRow
            ? matchingRow[headers.indexOf("coApplicantCategoryOne")]
            : "",
          caste: matchingRow
            ? matchingRow[headers.indexOf("coApplicantCasteOne")]
            : "",

          contactInformation: {
            mobileNo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantMobileNoOne")]
              : "",
            mobileNoTwo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantMobileNoTwoOne")]
              : "",
            email: matchingRow
              ? matchingRow[headers.indexOf("coApplicantEmailOne")]
              : "",
          },

          kycDetails: {
            udyamRegistrationNo: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantUdyamRegistrationNoOne")
                ]
              : "",
            docType: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDocTypeOne")]
              : "",
            aadharNo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantAadharNoOne")]
              : "",
            docNo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDocNoOne")]
              : "",
          },

          permanentAddressInformation: {
            addressAsPerAdhar: matchingRow
              ? matchingRow[headers.indexOf("coApplicantAddressAsPerAdharOne")]
              : "",
            landmark: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLandmarkOne")]
              : "",
            nameOfCity: matchingRow
              ? matchingRow[headers.indexOf("coApplicantNameOfCityOne")]
              : "",
            city: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCityOne")]
              : "",
            state: matchingRow
              ? matchingRow[headers.indexOf("coApplicantStateOne")]
              : "",
            districtName: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDistrictNameOne")]
              : "",
            pinCode: matchingRow
              ? matchingRow[headers.indexOf("coApplicantPinCodeOne")]
              : "",
            noOfyearsAtCurrentAddress: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantNoOfyearsAtCurrentAddressOne")
                ]
              : "",
            country: "India",
            residenceType: matchingRow
              ? matchingRow[headers.indexOf("coApplicantResidenceTypeOne")]
              : "",
          },

          presentAddressInformation: {
            presentAddress: matchingRow
              ? matchingRow[headers.indexOf("coApplicantPresentAddressOne")]
              : "",
            fullAddress: matchingRow
              ? matchingRow[headers.indexOf("coApplicantFullAddressOne")]
              : "",
            landmark: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLandmarkOne")]
              : "",
            nameOfCity: matchingRow
              ? matchingRow[headers.indexOf("coApplicantNameOfCityOne")]
              : "",
            addressLine1: matchingRow
              ? matchingRow[headers.indexOf("coApplicantaddressLine1One")]
              : "",
            addressLine2: matchingRow
              ? matchingRow[headers.indexOf("coApplicantaddressLine2One")]
              : "",
            city: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCityOne")]
              : "",
            state: matchingRow
              ? matchingRow[headers.indexOf("coApplicantStateOne")]
              : "",
            districtName: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDistrictNameOne")]
              : "",
            pinCode: matchingRow
              ? matchingRow[headers.indexOf("coApplicantPinCodeOne")]
              : "",
            noOfyearsAtCurrentAddress: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantNoOfyearsAtCurrentAddressOne")
                ]
              : "",
            country: "India",
          },

          employeDetails: {
            education: matchingRow
              ? matchingRow[headers.indexOf("coApplicantEducationOne")]
              : "",
            occupation: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOccupationOne")]
              : "",
            monthlyIncome: matchingRow
              ? matchingRow[headers.indexOf("coApplicantMonthlyIncomeOne")]
              : "",
            otherMonthlyIncome: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOtherMonthlyIncomeOne")]
              : "",
            sourceOfOtherIncome: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantSourceOfOtherIncomeOne")
                ]
              : "",
            annualIncome: matchingRow
              ? matchingRow[headers.indexOf("coApplicantAnnualIncomeOne")]
              : "",
            totalHouseHoldExpenses: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantTotalHouseHoldExpensesOne")
                ]
              : "",
          },
        },
        {
          ApplicantType: matchingRow
            ? matchingRow[headers.indexOf("coApplicantTypeTwo")]
            : "",
          bussinessType: matchingRow
            ? matchingRow[headers.indexOf("coApplicantBussinessTypeTwo")]
            : "",
          fullName: matchingRow
            ? matchingRow[headers.indexOf("coApplicantFullNameTwo")]
            : "",
          fatherName: matchingRow
            ? matchingRow[headers.indexOf("coApplicantFatherNameTwo")]
            : "",
          motherName: matchingRow
            ? matchingRow[headers.indexOf("coApplicantMotherNameTwo")]
            : "",
          dob: matchingRow
            ? matchingRow[headers.indexOf("coApplicantDobTwo")]
            : "",
          age: matchingRow
            ? matchingRow[headers.indexOf("coApplicantAgeTwo")]
            : "",
          gender: matchingRow
            ? matchingRow[headers.indexOf("coApplicantGenderTwo")]
            : "",
          maritalStatus: matchingRow
            ? matchingRow[headers.indexOf("coApplicantMaritalStatusTwo")]
            : "",
          educationDetails: matchingRow
            ? matchingRow[headers.indexOf("coApplicantEducationDetailsTwo")]
            : "",
          relationWithApplicant: matchingRow
            ? matchingRow[
                headers.indexOf("coApplicantRelationWithApplicantTwo")
              ]
            : "",
          religion: matchingRow
            ? matchingRow[headers.indexOf("coApplicantReligionTwo")]
            : "",
          nationality: matchingRow
            ? matchingRow[headers.indexOf("coApplicantNationalityTwo")]
            : "",
          category: matchingRow
            ? matchingRow[headers.indexOf("coApplicantCategoryTwo")]
            : "",
          caste: matchingRow
            ? matchingRow[headers.indexOf("coApplicantCasteTwo")]
            : "",

          contactInformation: {
            mobileNo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantMobileNoTwo")]
              : "",
            mobileNoTwo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantMobileNoTwoTwo")]
              : "",
            email: matchingRow
              ? matchingRow[headers.indexOf("coApplicantEmailTwo")]
              : "",
          },

          kycDetails: {
            udyamRegistrationNo: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantUdyamRegistrationNoTwo")
                ]
              : "",
            docType: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDocTypeTwo")]
              : "",
            aadharNo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantAadharNoTwo")]
              : "",
            docNo: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDocNoTwo")]
              : "",
          },

          permanentAddressInformation: {
            addressAsPerAdhar: matchingRow
              ? matchingRow[headers.indexOf("coApplicantAddressAsPerAdharTwo")]
              : "",
            landmark: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLandmarkTwo")]
              : "",
            nameOfCity: matchingRow
              ? matchingRow[headers.indexOf("coApplicantNameOfCityTwo")]
              : "",
            city: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCityTwo")]
              : "",
            state: matchingRow
              ? matchingRow[headers.indexOf("coApplicantStateTwo")]
              : "",
            districtName: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDistrictNameTwo")]
              : "",
            pinCode: matchingRow
              ? matchingRow[headers.indexOf("coApplicantPinCodeTwo")]
              : "",
            noOfyearsAtCurrentAddress: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantNoOfyearsAtCurrentAddressTwo")
                ]
              : "",
            country: "India",
            residenceType: matchingRow
              ? matchingRow[headers.indexOf("coApplicantResidenceTypeTwo")]
              : "",
          },

          presentAddressInformation: {
            presentAddress: matchingRow
              ? matchingRow[headers.indexOf("coApplicantPresentAddressTwo")]
              : "",
            fullAddress: matchingRow
              ? matchingRow[headers.indexOf("coApplicantFullAddressTwo")]
              : "",
            landmark: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLandmarkTwo")]
              : "",
            nameOfCity: matchingRow
              ? matchingRow[headers.indexOf("coApplicantNameOfCityTwo")]
              : "",
            addressLine1: matchingRow
              ? matchingRow[headers.indexOf("coApplicantaddressLine1Two")]
              : "",
            addressLine2: matchingRow
              ? matchingRow[headers.indexOf("coApplicantaddressLine2Two")]
              : "",
            city: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCityTwo")]
              : "",
            state: matchingRow
              ? matchingRow[headers.indexOf("coApplicantStateTwo")]
              : "",
            districtName: matchingRow
              ? matchingRow[headers.indexOf("coApplicantDistrictNameTwo")]
              : "",
            pinCode: matchingRow
              ? matchingRow[headers.indexOf("coApplicantPinCodeTwo")]
              : "",
            noOfyearsAtCurrentAddress: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantNoOfyearsAtCurrentAddressTwo")
                ]
              : "",
            country: "India",
          },

          employeDetails: {
            education: matchingRow
              ? matchingRow[headers.indexOf("coApplicantEducationTwo")]
              : "",
            occupation: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOccupationTwo")]
              : "",
            monthlyIncome: matchingRow
              ? matchingRow[headers.indexOf("coApplicantMonthlyIncomeTwo")]
              : "",
            otherMonthlyIncome: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOtherMonthlyIncomeTwo")]
              : "",
            sourceOfOtherIncome: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantSourceOfOtherIncomeTwo")
                ]
              : "",
            annualIncome: matchingRow
              ? matchingRow[headers.indexOf("coApplicantAnnualIncomeTwo")]
              : "",
            totalHouseHoldExpenses: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantTotalHouseHoldExpensesTwo")
                ]
              : "",
          },
        },
      ],

      //     // api 4
      guarantorInformation: {
        name: matchingRow ? matchingRow[headers.indexOf("guarantorName")] : "",
        fatherName: matchingRow
          ? matchingRow[headers.indexOf("guarantorFatherName")]
          : "",
        motherName: matchingRow
          ? matchingRow[headers.indexOf("guarantorMotherName")]
          : "",
        relationWithApplicant: matchingRow
          ? matchingRow[headers.indexOf("guarantorRelationWithApplicant")]
          : "",
        GuarantorType: matchingRow
          ? matchingRow[headers.indexOf("guarantorGuarantorType")]
          : "",
        businessType: matchingRow
          ? matchingRow[headers.indexOf("guarantorBusinessType")]
          : "",
        dob: matchingRow ? matchingRow[headers.indexOf("guarantorDob")] : "",
        age: matchingRow ? matchingRow[headers.indexOf("guarantorAge")] : "",
        gender: matchingRow
          ? matchingRow[headers.indexOf("guarantorGender")]
          : "",
        marritalStatus: matchingRow
          ? matchingRow[headers.indexOf("guarantorMarritalStatus")]
          : "",
        educationalDetails: matchingRow
          ? matchingRow[headers.indexOf("guarantorEducationalDetails")]
          : "",
        religion: matchingRow
          ? matchingRow[headers.indexOf("guarantorReligion")]
          : "",
        nationality: matchingRow
          ? matchingRow[headers.indexOf("guarantorNationality")]
          : "",
        category: matchingRow
          ? matchingRow[headers.indexOf("guarantorCategory")]
          : "",
        caste: matchingRow
          ? matchingRow[headers.indexOf("guarantorCaste")]
          : "",
      },
      kycDetails: {
        panNumber: matchingRow
          ? matchingRow[headers.indexOf("guarantorPanNumber")]
          : "",
        adharNumber: matchingRow
          ? matchingRow[headers.indexOf("guarantorAdharNumber")]
          : "",
        docType: matchingRow
          ? matchingRow[headers.indexOf("guarantorDocType")]
          : "", //base on the type
        docNo: matchingRow
          ? matchingRow[headers.indexOf("guarantorDocNo")]
          : "",
      },
      contactInformation: {
        mobileNo: matchingRow
          ? matchingRow[headers.indexOf("guarantorMobileNo")]
          : "",
        MobileNoTwo: matchingRow
          ? matchingRow[headers.indexOf("guarantorMobileNoTwo")]
          : "",
        email: matchingRow
          ? matchingRow[headers.indexOf("guarantorEmail")]
          : "",
      },
      permanentAddressInformation: {
        addressAsPerAdhar: matchingRow
          ? matchingRow[headers.indexOf("guarantorAddressAsPerAdhar")]
          : "",
        presentAddress: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddress")]
          : "",
        landmark: matchingRow
          ? matchingRow[headers.indexOf("guarantorLandmark")]
          : "",
        city: matchingRow ? matchingRow[headers.indexOf("guarantorCity")] : "",
        state: matchingRow
          ? matchingRow[headers.indexOf("guarantorState")]
          : "",
        district: matchingRow
          ? matchingRow[headers.indexOf("guarantorDistrict")]
          : "",
        pinCode: matchingRow
          ? matchingRow[headers.indexOf("guarantorPinCode")]
          : "",
        noOfyearsAtCurrentAddress: matchingRow
          ? matchingRow[headers.indexOf("guarantorNoOfyearsAtCurrentAddress")]
          : "",
        country: "India",
      },
      presentAddressInformation: {
        fullAddress: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressFullAddress")]
          : "",
        presentAddressAsPerAdhar: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressAsPerAdhar")]
          : "",
        landmark: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressLandmark")]
          : "",
        city: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressCity")]
          : "",
        state: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressState")]
          : "",
        district: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressDistrict")]
          : "",
        pinCode: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressPinCode")]
          : "",
        noOfyearsAtCurrentAddress: matchingRow
          ? matchingRow[
              headers.indexOf(
                "guarantorPresentAddressNoOfyearsAtCurrentAddress"
              )
            ]
          : "",
        country: "India",
        residenceType: matchingRow
          ? matchingRow[headers.indexOf("guarantorPresentAddressResidenceType")]
          : "",
      },
      persnalDetails: {
        education: matchingRow
          ? matchingRow[headers.indexOf("guarantorEducation")]
          : "",
        occupation: matchingRow
          ? matchingRow[headers.indexOf("guarantorOccupation")]
          : "",
        monthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("guarantorMonthlyIncome")]
          : "",
        otherMonthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("guarantorOtherMonthlyIncome")]
          : "",
        sourceOfOtherIncome: matchingRow
          ? matchingRow[headers.indexOf("guarantorSourceOfOtherIncome")]
          : "",
        annualIncome: matchingRow
          ? matchingRow[headers.indexOf("guarantorAnnualIncome")]
          : "",
        totalHouseHoldExpenses: matchingRow
          ? matchingRow[headers.indexOf("guarantorTotalHouseHoldExpenses")]
          : "",
      },
      // api 5
      referenceDetails: [
        {
          name: matchingRow
            ? matchingRow[headers.indexOf("referenceNameOne")]
            : "",
          address: matchingRow
            ? matchingRow[headers.indexOf("referenceAddressOne")]
            : " ",
          relation: matchingRow
            ? matchingRow[headers.indexOf("referenceRelationOne")]
            : " ",
          mobileNumber: matchingRow
            ? matchingRow[headers.indexOf("referenceMobileNumberOne")]
            : " ",
        },
        {
          name: matchingRow
            ? matchingRow[headers.indexOf("referenceNameTwo")]
            : " ",
          address: matchingRow
            ? matchingRow[headers.indexOf("referenceAddressTwo")]
            : " ",
          relation: matchingRow
            ? matchingRow[headers.indexOf("referenceRelationTwo")]
            : " ",
          mobileNumber: matchingRow
            ? matchingRow[headers.indexOf("referenceMobileNumberTwo")]
            : " ",
        },
      ],
      //     // api 6
      //     // cibilDetails:{
      applicantData: {
        applicantCibilReportPdf: matchingRow
          ? matchingRow[headers.indexOf("applicantCibilReportPdf")]
          : "",
        customerName: matchingRow
          ? matchingRow[headers.indexOf("applicantCustomerName")]
          : "",
        applicantCibilScore: matchingRow
          ? matchingRow[headers.indexOf("applicantCibilScore")]
          : "",
        totalAccounts: matchingRow
          ? matchingRow[headers.indexOf("applicantTotalAccounts")]
          : "",
        overdueAccount: matchingRow
          ? matchingRow[headers.indexOf("applicantOverdueAccount")]
          : "",
        zeroBalanceAccount: matchingRow
          ? matchingRow[headers.indexOf("applicantZeroBalanceAccount")]
          : "",
        totalNumberOfEnquiry: matchingRow
          ? matchingRow[headers.indexOf("applicantTotalNumberOfEnquiry")]
          : "",
        appFinancialOverview: {
          HighCreditAndSanctionAmount: matchingRow
            ? matchingRow[
                headers.indexOf("applicantHighCreditAndSanctionAmount")
              ]
            : "",
          TotalCurrentOutstanding: matchingRow
            ? matchingRow[headers.indexOf("applicantTotalCurrentOutstanding")]
            : "",
          TotalOverdueAmount: matchingRow
            ? matchingRow[headers.indexOf("applicantTotalOverdueAmount")]
            : "",
          TotalNumberOfEnquiry: matchingRow
            ? matchingRow[headers.indexOf("applicantTotalNumberOfEnquiry")]
            : "",
        },
        applicantCibilDetail: [
          {
            loanType: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanTypeOne")]
              : "",
            loanAmount: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanAmountOne")]
              : "",
            outstandingAmount: matchingRow
              ? matchingRow[headers.indexOf("applicantOutstandingAmountOne")]
              : "",
            overDue: matchingRow
              ? matchingRow[headers.indexOf("applicantOverDueOne")]
              : "",
            emi: matchingRow
              ? matchingRow[headers.indexOf("applicantEmiOne")]
              : "",
            cibilScore: matchingRow
              ? matchingRow[headers.indexOf("applicantCibilScoreOne")]
              : "",
            ownership: matchingRow
              ? matchingRow[headers.indexOf("applicantOwnershipOne")]
              : "",
            SanctionedAmount: matchingRow
              ? matchingRow[headers.indexOf("applicantSanctionedAmountOne")]
              : "",
            CurrentBalance: matchingRow
              ? matchingRow[headers.indexOf("applicantCurrentBalanceOne")]
              : "",
            RateOfInterest: matchingRow
              ? matchingRow[headers.indexOf("applicantRateOfInterestOne")]
              : "",
            TotalTenure: matchingRow
              ? matchingRow[headers.indexOf("applicantTotalTenureOne")]
              : "",
            BalanceTenure: matchingRow
              ? matchingRow[headers.indexOf("applicantBalanceTenureOne")]
              : "",
            LoanStatus: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanStatusOne")]
              : "",
            LoanObligated: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanObligatedOne")]
              : "",
            ObligationConsidered: matchingRow
              ? matchingRow[headers.indexOf("applicantObligationConsideredOne")]
              : "",
          },
          {
            loanType: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanTypeTwo")]
              : "",
            loanAmount: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanAmountTwo")]
              : "",
            outstandingAmount: matchingRow
              ? matchingRow[headers.indexOf("applicantOutstandingAmountTwo")]
              : "",
            overDue: matchingRow
              ? matchingRow[headers.indexOf("applicantOverDueTwo")]
              : "",
            emi: matchingRow
              ? matchingRow[headers.indexOf("applicantEmiTwo")]
              : "",
            cibilScore: matchingRow
              ? matchingRow[headers.indexOf("applicantCibilScoreTwo")]
              : "",
            ownership: matchingRow
              ? matchingRow[headers.indexOf("applicantOwnershipTwo")]
              : "",
            SanctiTwodAmount: matchingRow
              ? matchingRow[headers.indexOf("applicantSanctionedAmountTwo")]
              : "",
            CurrentBalance: matchingRow
              ? matchingRow[headers.indexOf("applicantCurrentBalanceTwo")]
              : "",
            RateOfInterest: matchingRow
              ? matchingRow[headers.indexOf("applicantRateOfInterestTwo")]
              : "",
            TotalTenure: matchingRow
              ? matchingRow[headers.indexOf("applicantTotalTenureTwo")]
              : "",
            BalanceTenure: matchingRow
              ? matchingRow[headers.indexOf("applicantBalanceTenureTwo")]
              : "",
            LoanStatus: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanStatusTwo")]
              : "",
            LoanObligated: matchingRow
              ? matchingRow[headers.indexOf("applicantLoanObligatedTwo")]
              : "",
            ObligationConsidered: matchingRow
              ? matchingRow[headers.indexOf("applicantObligationConsideredTwo")]
              : "",
          },
        ],
      },
      coAppData: {
        coApplicantCibilReportPdf: matchingRow
          ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
          : [],
        coApplicantName: matchingRow
          ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
          : [],
        coApplicantCibilScore: matchingRow
          ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
          : "",
        totalAccount: matchingRow
          ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
          : "",
        zeroBalanceAccount: matchingRow
          ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
          : "",
        overdueAccount: matchingRow
          ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
          : "",
        appFinancialOverview: {
          HighCreditAndSanctionAmount: matchingRow
            ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
            : "",
          TotalCurrentOutstanding: matchingRow
            ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
            : "",
          TotalOverdueAmount: matchingRow
            ? matchingRow[headers.indexOf("coApplicantCibilReportPdf")]
            : "",
        },
        coApplicantCibilDetail: [
          {
            loanType: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanTypeOne")]
              : "",
            loanAmount: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanAmountOne")]
              : "",
            outstandingAmount: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOutstandingAmountOne")]
              : "",
            overDue: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOverDueOne")]
              : "",
            emi: matchingRow
              ? matchingRow[headers.indexOf("coApplicantEmiOne")]
              : "",
            cibilScore: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCibilScoreOne")]
              : "",
            ownership: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOwnershipOne")]
              : "",
            SanctionedAmount: matchingRow
              ? matchingRow[headers.indexOf("coApplicantSanctionedAmountOne")]
              : "",
            CurrentBalance: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCurrentBalanceOne")]
              : "",
            RateOfInterest: matchingRow
              ? matchingRow[headers.indexOf("coApplicantRateOfInterestOne")]
              : "",
            TotalTenure: matchingRow
              ? matchingRow[headers.indexOf("coApplicantTotalTenureOne")]
              : "",
            BalanceTenure: matchingRow
              ? matchingRow[headers.indexOf("coApplicantBalanceTenureOne")]
              : "",
            LoanStatus: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanStatusOne")]
              : "",
            LoanObligated: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanObligatedOne")]
              : "",
            ObligationConsidered: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantObligationConsideredOne")
                ]
              : "",
          },
          {
            loanType: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanTypeTwo")]
              : "",
            loanAmount: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanAmountTwo")]
              : "",
            outstandingAmount: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOutstandingAmountTwo")]
              : "",
            overDue: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOverDueTwo")]
              : "",
            emi: matchingRow
              ? matchingRow[headers.indexOf("coApplicantEmiTwo")]
              : "",
            cibilScore: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCibilScoreTwo")]
              : "",
            ownership: matchingRow
              ? matchingRow[headers.indexOf("coApplicantOwnershipTwo")]
              : "",
            SanctiTwodAmount: matchingRow
              ? matchingRow[headers.indexOf("coApplicantSanctionedAmountTwo")]
              : "",
            CurrentBalance: matchingRow
              ? matchingRow[headers.indexOf("coApplicantCurrentBalanceTwo")]
              : "",
            RateOfInterest: matchingRow
              ? matchingRow[headers.indexOf("coApplicantRateOfInterestTwo")]
              : "",
            TotalTenure: matchingRow
              ? matchingRow[headers.indexOf("coApplicantTotalTenureTwo")]
              : "",
            BalanceTenure: matchingRow
              ? matchingRow[headers.indexOf("coApplicantBalanceTenureTwo")]
              : "",
            LoanStatus: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanStatusTwo")]
              : "",
            LoanObligated: matchingRow
              ? matchingRow[headers.indexOf("coApplicantLoanObligatedTwo")]
              : "",
            ObligationConsidered: matchingRow
              ? matchingRow[
                  headers.indexOf("coApplicantObligationConsideredTwo")
                ]
              : "",
          },
        ],
        guarantorData: {
          guarantorCibilReportPdf: matchingRow
            ? matchingRow[headers.indexOf("guarantorLoanTypeTwo")]
            : "",
          guarantorName: matchingRow
            ? matchingRow[headers.indexOf("guarantorLoanTypeTwo")]
            : [],
          guarantorCibilScore: matchingRow
            ? matchingRow[headers.indexOf("guarantorLoanTypeTwo")]
            : [],
        },
      },
      //     // api 7
      bankDetail: {
        bankApplicantDetails: {
          applicantPdcDocument: matchingRow
            ? matchingRow[headers.indexOf("applicantPdcDocument")]
            : "",
          nameOfBankApplicant: matchingRow
            ? matchingRow[headers.indexOf("nameOfBankApplicant")]
            : "",
          acHolderName: matchingRow
            ? matchingRow[headers.indexOf("acHolderName")]
            : "",
          bankBranch: matchingRow
            ? matchingRow[headers.indexOf("bankBranch")]
            : "",
          accountNumber: matchingRow
            ? matchingRow[headers.indexOf("accountNumber")]
            : "",
          accountType: matchingRow
            ? matchingRow[headers.indexOf("accountType")]
            : "",
          ifscCode: matchingRow ? matchingRow[headers.indexOf("ifscCode")] : "",
          bankName: matchingRow ? matchingRow[headers.indexOf("bankName")] : "",
        },
        guarantorRepaymentDetails: {
          guarantorPdcDocument: matchingRow
            ? matchingRow[headers.indexOf("guarantorPdcDocument")]
            : "",
          nameOfBankApplicant: matchingRow
            ? matchingRow[headers.indexOf("guarantorNameOfBankApplicant")]
            : "",
          acHolderName: matchingRow
            ? matchingRow[headers.indexOf("guarantorAcHolderName")]
            : "",
          bankBranch: matchingRow
            ? matchingRow[headers.indexOf("guarantorBankBranch")]
            : "",
          accountNumber: matchingRow
            ? matchingRow[headers.indexOf("guarantorAccountNumber")]
            : "",
          accountType: matchingRow
            ? matchingRow[headers.indexOf("guarantorAccountType")]
            : "",
          ifscCode: matchingRow
            ? matchingRow[headers.indexOf("guarantorIfscCode")]
            : "",
          bankName: matchingRow
            ? matchingRow[headers.indexOf("guarantorBankName")]
            : "",
        },
      },
      //     // api customercollateralDetail
      bankDetails: {
        propertyHolderInformation: {
          nameOfDocumentHolder: matchingRow
            ? matchingRow[headers.indexOf("nameOfDocumentHolder")]
            : "",
          fatherName: matchingRow
            ? matchingRow[headers.indexOf("fatherName")]
            : "",
          relationWithApplicant: matchingRow
            ? matchingRow[headers.indexOf("relationWithApplicant")]
            : "",
        },
        PropertyLocationDetails: {
          houseNo: matchingRow ? matchingRow[headers.indexOf("houseNo")] : "",
          surveyNo: matchingRow ? matchingRow[headers.indexOf("surveyNo")] : "",
          patwariHalkaNo: matchingRow
            ? matchingRow[headers.indexOf("patwariHalkaNo")]
            : "",
          wardNo: matchingRow ? matchingRow[headers.indexOf("wardNo")] : "",
          villageName: matchingRow
            ? matchingRow[headers.indexOf("villageName")]
            : "",
          gramPanchayat: matchingRow
            ? matchingRow[headers.indexOf("gramPanchayat")]
            : "",
          tehsil: matchingRow
            ? matchingRow[headers.indexOf("PropertyTehsil")]
            : "",
          district: matchingRow
            ? matchingRow[headers.indexOf("PropertyDistrict")]
            : "",
          state: matchingRow
            ? matchingRow[headers.indexOf("PropertyState")]
            : "",
        },
        propertyAddressAndLandmark: {
          propertyLandMark: matchingRow
            ? matchingRow[headers.indexOf("propertyLandMark")]
            : "",
          fullAddressOfProperty: matchingRow
            ? matchingRow[headers.indexOf("fullAddressOfProperty")]
            : "",
          latitude: matchingRow ? matchingRow[headers.indexOf("latitude")] : "",
          longitude: matchingRow
            ? matchingRow[headers.indexOf("longitude")]
            : "",
        },
        propertySpecifications: {
          typeOfProperty: matchingRow
            ? matchingRow[headers.indexOf("typeOfProperty")]
            : "",
          totalLandAreaInSqFt: matchingRow
            ? matchingRow[headers.indexOf("totalLandAreaInSqFt")]
            : "",
          totalBuiltUpAreaInSqFt: matchingRow
            ? matchingRow[headers.indexOf("totalBuiltUpAreaInSqFt")]
            : "",
          typeOfConstruction: matchingRow
            ? matchingRow[headers.indexOf("typeOfConstruction")]
            : "",
          qualityOfConstruction: matchingRow
            ? matchingRow[headers.indexOf("qualityOfConstruction")]
            : "",
          ageOfProperty: matchingRow
            ? matchingRow[headers.indexOf("ageOfProperty")]
            : "",
        },
        PropertyBoundaries: {
          eastBoundary: matchingRow
            ? matchingRow[headers.indexOf("eastBoundary")]
            : "",
          westBoundary: matchingRow
            ? matchingRow[headers.indexOf("westBoundary")]
            : "",
          northBoundary: matchingRow
            ? matchingRow[headers.indexOf("northBoundary")]
            : "",
          southBoundary: matchingRow
            ? matchingRow[headers.indexOf("southBoundary")]
            : "",
        },
        PropertyValuation: {
          landValue: matchingRow
            ? matchingRow[headers.indexOf("landValue")]
            : "",
          constructionValue: matchingRow
            ? matchingRow[headers.indexOf("constructionValue")]
            : "",
          fairMarketValueOfLand: matchingRow
            ? matchingRow[headers.indexOf("fairMarketValueOfLand")]
            : "",
          realizableValue: matchingRow
            ? matchingRow[headers.indexOf("realizableValue")]
            : "",
        },
      },
      //     // api 9
      // loanAgreement:{
      bankGuarantorDetails: {
        guarantorPdcDocument: matchingRow
          ? matchingRow[headers.indexOf("guarantorPdcDocument")]
          : "",
        nameOfBankGuarantor: matchingRow
          ? matchingRow[headers.indexOf("guarantorNameOfBankApplicant")]
          : "",
        acHolderName: matchingRow
          ? matchingRow[headers.indexOf("guarantorAcHolderName")]
          : "",
        bankBranch: matchingRow
          ? matchingRow[headers.indexOf("guarantorBankBranch")]
          : "",
        accountNumber: matchingRow
          ? matchingRow[headers.indexOf("guarantorAccountNumber")]
          : "",
        accountType: matchingRow
          ? matchingRow[headers.indexOf("guarantorAccountType")]
          : "",
        ifscCode: matchingRow
          ? matchingRow[headers.indexOf("guarantorIfscCode")]
          : "",
        bankName: matchingRow
          ? matchingRow[headers.indexOf("guarantorBankName")]
          : "",
        chequeNoOfGuarantor: matchingRow
          ? matchingRow[headers.indexOf("chequeNoOfGuarantor")]
          : "",
      },
      bankApplicantDetails: {
        applicantPdcDocument: matchingRow
          ? matchingRow[headers.indexOf("applicantPdcDocument")]
          : "",
        nameOfBankApplicant: matchingRow
          ? matchingRow[headers.indexOf("nameOfBankApplicant")]
          : "",
        acHolderName: matchingRow
          ? matchingRow[headers.indexOf("acHolderName")]
          : "",
        bankBranch: matchingRow
          ? matchingRow[headers.indexOf("bankBranch")]
          : "",
        accountNumber: matchingRow
          ? matchingRow[headers.indexOf("accountNumber")]
          : "",
        accountType: matchingRow
          ? matchingRow[headers.indexOf("accountType")]
          : "",
        ifscCode: matchingRow ? matchingRow[headers.indexOf("ifscCode")] : "",
        bankName: matchingRow ? matchingRow[headers.indexOf("bankName")] : "",
        chequeNoOfapplicant: matchingRow
          ? matchingRow[headers.indexOf("chequeNoOfapplicant")]
          : "",
      },
      boundariesOfProperty: {
        onorTowardsNorth: matchingRow
          ? matchingRow[headers.indexOf("northBoundary")]
          : "",
        onorTowardsSouth: matchingRow
          ? matchingRow[headers.indexOf("southBoundary")]
          : "",
        onorTowardsEast: matchingRow
          ? matchingRow[headers.indexOf("eastBoundary")]
          : "",
        onorTowardswest: matchingRow
          ? matchingRow[headers.indexOf("westBoundary")]
          : "",
      },
      loanAgreementDetails: {
        dateOfTheAgreement: matchingRow
          ? matchingRow[headers.indexOf("loanAgreementDateOfTheAgreement")]
          : "",
        placeOfExecution: matchingRow
          ? matchingRow[headers.indexOf("loanAgreementPlaceOfExecution")]
          : "",
      },
      //     // }
      //    // pdDetails
      LoanDetail: {
        customerDemandLoanAmount: matchingRow
          ? matchingRow[headers.indexOf("customerDemandLoanAmount")]
          : "",
        approvedAmount: matchingRow
          ? matchingRow[headers.indexOf("approvedAmount")]
          : "",
        roi: matchingRow ? matchingRow[headers.indexOf("Roi")] : "",
        tenure: matchingRow ? matchingRow[headers.indexOf("tenure")] : "",
        emi: matchingRow ? matchingRow[headers.indexOf("Emi")] : "",
        finalDecision: matchingRow
          ? matchingRow[headers.indexOf("finalDecision")]
          : "",
        endUseOfLoan: matchingRow
          ? matchingRow[headers.indexOf("endUseOfLoan")]
          : "",
      },
      pdfLink: matchingRow ? matchingRow[headers.indexOf("pdfLink")] : "",
      accommodationDetails: {
        groundFloor: matchingRow
          ? matchingRow[headers.indexOf("groundFloor")]
          : "",
        firstFloor: matchingRow
          ? matchingRow[headers.indexOf("firstFloor")]
          : "",
        actualUsageProperty: matchingRow
          ? matchingRow[headers.indexOf("actualUsageProperty")]
          : "",
        structureType: matchingRow
          ? matchingRow[headers.indexOf("structureType")]
          : "",
        plotLocation: matchingRow
          ? matchingRow[headers.indexOf("plotLocation")]
          : "",
        builtUpArea: matchingRow
          ? matchingRow[headers.indexOf("builtUpArea")]
          : "",
        occupancy: matchingRow ? matchingRow[headers.indexOf("occupancy")] : "",
        electricityGasConnection: matchingRow
          ? matchingRow[headers.indexOf("electricityGasConnection")]
          : "",
        surroundingAreaDevelopment: matchingRow
          ? matchingRow[headers.indexOf("surroundingAreaDevelopment")]
          : "",
        totalBuiltUpArea: matchingRow
          ? matchingRow[headers.indexOf("totalBuiltUpArea")]
          : "",
        qualityOfConstruction: matchingRow
          ? matchingRow[headers.indexOf("qualityOfConstruction")]
          : "",
        propertyAge: matchingRow
          ? matchingRow[headers.indexOf("propertyAge")]
          : "",
        propertyMaintenance: matchingRow
          ? matchingRow[headers.indexOf("propertyMaintenance")]
          : "",
        projectedLifeYear: matchingRow
          ? matchingRow[headers.indexOf("projectedLifeYear")]
          : "",
        constructionType: matchingRow
          ? matchingRow[headers.indexOf("constructionType")]
          : "",
        landRatePerSQFT: matchingRow
          ? matchingRow[headers.indexOf("landRatePerSQFT")]
          : "",
        totalConsAreaSQFT: matchingRow
          ? matchingRow[headers.indexOf("totalConsAreaSQFT")]
          : "",
        uploadImage: {
          selfieWithCostumer: matchingRow
            ? matchingRow[headers.indexOf("selfieWithCostumer")]
            : "",
          photoWithLatlong: matchingRow
            ? matchingRow[headers.indexOf("photoWithLatlong")]
            : "",
          frontPhoto: matchingRow
            ? matchingRow[headers.indexOf("frontPhoto")]
            : "",
          leftSide: matchingRow ? matchingRow[headers.indexOf("leftSide")] : "",
          rightSide: matchingRow
            ? matchingRow[headers.indexOf("rightSide")]
            : "",
          approachRoad: matchingRow
            ? matchingRow[headers.indexOf("approachRoad")]
            : "",
          mainRoad: matchingRow ? matchingRow[headers.indexOf("mainRoad")] : "",
          inferiorRoad: matchingRow
            ? matchingRow[headers.indexOf("inferiorRoad")]
            : "",
          addImage: matchingRow ? matchingRow[headers.indexOf("addImage")] : "",
        },
      },
      //due diligence
      allPdf: {
        rcuPdf: matchingRow ? matchingRow[headers.indexOf("rcuPdf")] : [],
        legalPdf: matchingRow ? matchingRow[headers.indexOf("legalPdf")] : [],
        technicalPdf: matchingRow
          ? matchingRow[headers.indexOf("technicalPdf")]
          : [],
        rmPdf: matchingRow ? matchingRow[headers.indexOf("rmPdf")] : [],
        pdPdf: matchingRow ? matchingRow[headers.indexOf("pdPdf")] : "",
      },
      rcuReport: {
        reportRecievedDate: matchingRow
          ? matchingRow[headers.indexOf("rcuReportRecievedDate")]
          : "",
        reportStatus: matchingRow
          ? matchingRow[headers.indexOf("rcuReportStatus")]
          : "",
      },
      technicalReport: {
        statusOfReport: matchingRow
          ? matchingRow[headers.indexOf("technicalStatusOfReport")]
          : "",
        reciveDate: matchingRow
          ? matchingRow[headers.indexOf("technicalReciveDate")]
          : "",
      },
      legalReport: {
        statusOfReport: matchingRow
          ? matchingRow[headers.indexOf("legalStatusOfReport")]
          : "",
        reciveDate: matchingRow
          ? matchingRow[headers.indexOf("legalReciveDate")]
          : "",
        documentDetails: matchingRow
          ? matchingRow[headers.indexOf("legaldocumentDetails")]
          : {},
      },
      // // branch pendecy
      agriculture: {
        agricultureDocument: matchingRow
          ? matchingRow[headers.indexOf("agricultureDocument")]
          : [],
        LD: matchingRow ? matchingRow[headers.indexOf("agricultureLD")] : "",
        incomeType: matchingRow
          ? matchingRow[headers.indexOf("agricultureincomeType")]
          : "",
        agriDetails: matchingRow
          ? matchingRow[headers.indexOf("agricultureagriDetails")]
          : "",
        agriIncome: matchingRow
          ? matchingRow[headers.indexOf("agriIncome")]
          : "",
        availableLand: matchingRow
          ? matchingRow[headers.indexOf("agricultureavailableLand")]
          : "",
        agriLandAddressAsPerPavati: matchingRow
          ? matchingRow[headers.indexOf("agriLandAddressAsPerPavati")]
          : "",
        agriLandSurveyNo: matchingRow
          ? matchingRow[headers.indexOf("agriLandSurveyNo")]
          : "",
        LandOwnerName: matchingRow
          ? matchingRow[headers.indexOf("agricultureLandOwnerName")]
          : "",
        relationWithApplicant: matchingRow
          ? matchingRow[headers.indexOf("agriculturRrelationWithApplicant")]
          : "",
        cropCultivated: matchingRow
          ? matchingRow[headers.indexOf("agricultureCropCultivated")]
          : "",
        yearOfExprience: matchingRow
          ? matchingRow[headers.indexOf("agricultureyearOfExprience")]
          : "",
        yearlyIncome: matchingRow
          ? matchingRow[headers.indexOf("agricultureyearlyIncome")]
          : "",
        monthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("agriculturemonthlyIncome")]
          : "",
        monthlyExpence: matchingRow
          ? matchingRow[headers.indexOf("agriculturemonthlyExpence")]
          : "",
        TotalNoOfAGRILand: matchingRow
          ? matchingRow[headers.indexOf("TotalNoOfAGRILand")]
          : "",
        NoOfAgricultureOwner: matchingRow
          ? matchingRow[headers.indexOf("NoOfAgricultureOwner")]
          : "",
      },
      MilkBusiness: {
        milkDocument: matchingRow
          ? matchingRow[headers.indexOf("milkDocument")]
          : [],
        yearOfExperience: matchingRow
          ? matchingRow[headers.indexOf("milkYearOfExperience")]
          : "",
        TotalCattle: matchingRow
          ? matchingRow[headers.indexOf("milkTotalCattle")]
          : "",
        MilkGivingCattle: matchingRow
          ? matchingRow[headers.indexOf("MilkGivingCattle")]
          : "",
        AverageDailyMilkQuantitIinLitters: matchingRow
          ? matchingRow[headers.indexOf("AverageDailyMilkQuantitIinLitters")]
          : "",
        DairyName: matchingRow ? matchingRow[headers.indexOf("DairyName")] : "",
        DairyAddress: matchingRow
          ? matchingRow[headers.indexOf("DairyAddress")]
          : "",
        DairyOwnerContact: matchingRow
          ? matchingRow[headers.indexOf("DairyOwnerContact")]
          : "",
        YearProvdingToDairy: matchingRow
          ? matchingRow[headers.indexOf("YearProvdingToDairy")]
          : "",
        Expenses: matchingRow
          ? matchingRow[headers.indexOf("milkExpenses")]
          : "",
        MonthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("MonthlyIncome")]
          : "",
        annualIncome: matchingRow
          ? matchingRow[headers.indexOf("annualIncome")]
          : "",
        monthlyExpence: matchingRow
          ? matchingRow[headers.indexOf("milkMonthlyExpence")]
          : "",
      },
      SalaryIncome: {
        otherIncomeDocument: matchingRow
          ? matchingRow[headers.indexOf("otherIncomeDocument")]
          : [],
        LD: matchingRow ? matchingRow[headers.indexOf("otherIncomeLD")] : "",
        incomeType3: matchingRow
          ? matchingRow[headers.indexOf("otherIncomeIncomeType3")]
          : "",
        salaryOtherIncomeSource: matchingRow
          ? matchingRow[headers.indexOf("salaryOtherIncomeSource")]
          : "",
        companyName: matchingRow
          ? matchingRow[headers.indexOf("otherIncomecompanyName")]
          : "",
        adressOfSalaryProvider: matchingRow
          ? matchingRow[headers.indexOf("adressOfSalaryProvider")]
          : "",
        mobNoOfSalaryProvider: matchingRow
          ? matchingRow[headers.indexOf("mobNoOfSalaryProvider")]
          : "",
        doingFromNoYears: matchingRow
          ? matchingRow[headers.indexOf("doingFromNoYears")]
          : "",
        monthlyIncomeEarned: matchingRow
          ? matchingRow[headers.indexOf("monthlyIncomeEarned")]
          : "",
      },
      OthersBusinessIncome: {
        otherBusinessDocument: matchingRow
          ? matchingRow[headers.indexOf("otherBusinessDocument")]
          : [],
        YearOfExperience: matchingRow
          ? matchingRow[headers.indexOf("otherIncomeYearOfExperience")]
          : "",
        NatureOfBusiness: matchingRow
          ? matchingRow[headers.indexOf("otherIncomeNatureOfBusiness")]
          : "",
        NameOfBusines: matchingRow
          ? matchingRow[headers.indexOf("NameOfBusines")]
          : "",
        MonthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("otherIncomeMonthlyIncome")]
          : "",
      },
      RMPayment: {
        rmPaymentDocument: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentDocument")]
          : [],
        LD: matchingRow ? matchingRow[headers.indexOf("rmPaymentLD")] : "",
        CutomerName: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentCutomerName")]
          : "",
        ContactNo: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentContactNo")]
          : "",
        BranchName: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentBranchName")]
          : "",
        AmountDeposited: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentAmountDeposited")]
          : "",
        UTRAndReferenceNo: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentUTRAndReferenceNo")]
          : "",
        DateOfDeposition: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentDateOfDeposition")]
          : "",
        DepositedBy: matchingRow
          ? matchingRow[headers.indexOf("rmPaymentDepositedBy")]
          : "",
        agricultureIncome: matchingRow
          ? matchingRow[headers.indexOf("agriIncome")]
          : "",
        IncomeFromMilk: matchingRow
          ? matchingRow[headers.indexOf("annualIncome")]
          : "",
        incomeFromOtherSourceSalary: matchingRow
          ? matchingRow[headers.indexOf("salaryOtherIncomeSource")]
          : "",
        totalIncome: matchingRow
          ? matchingRow[headers.indexOf("rmTotalIncome")]
          : "",
        totalExpence: matchingRow
          ? matchingRow[headers.indexOf("rmTotalExpence")]
          : "",
      },
      // // tvr details
      applicantInformation: {
        applicationNumber: matchingRow
          ? matchingRow[headers.indexOf("applicationNumber")]
          : "",
        dateOfVerification: matchingRow
          ? matchingRow[headers.indexOf("dateOfVerification")]
          : "",
        timeOfCall: matchingRow
          ? matchingRow[headers.indexOf("timeOfCall")]
          : "",
        applicantName: matchingRow
          ? matchingRow[headers.indexOf("applicantName")]
          : "",
      },

      finalSanctionDetails: {
        applicantAndCaseInformation: {
          partnerName: matchingRow
            ? matchingRow[headers.indexOf("partnerName")]
            : "",
          branchName: matchingRow
            ? matchingRow[headers.indexOf("branchName")]
            : "",
          caseType: matchingRow ? matchingRow[headers.indexOf("caseType")] : "",
          applicantName: matchingRow
            ? matchingRow[headers.indexOf("Name")]
            : "",
          fatherName: matchingRow
            ? matchingRow[headers.indexOf("FatherName")]
            : "",
          contactNumber: matchingRow
            ? matchingRow[headers.indexOf("MobileNo")]
            : "",
        },
        landmarkoanDetails: {
          loanAmount: matchingRow
            ? matchingRow[headers.indexOf("LoanAmountRequested")]
            : "",
          loanAmountInWords: matchingRow
            ? matchingRow[headers.indexOf("loanAmountInWords")]
            : "",
          principleAmount: matchingRow
            ? matchingRow[headers.indexOf("principleAmount")]
            : "",
          interestAmount: matchingRow
            ? matchingRow[headers.indexOf("interestAmount")]
            : "",
          totalAmount: matchingRow
            ? matchingRow[headers.indexOf("totalAmount")]
            : "",
          roi: matchingRow ? matchingRow[headers.indexOf("Roi")] : "",
          tenure: matchingRow
            ? matchingRow[headers.indexOf("LoanTenureRequested")]
            : "",
        },
        emiDetails: {
          emiAmount: matchingRow
            ? matchingRow[headers.indexOf("confortableEmiAmountForCustomer")]
            : "",
          emiCycleDate: matchingRow
            ? matchingRow[headers.indexOf("emiCycleDate")]
            : "",
        },
      },
      contactVerification: {
        primaryContactNumberOfApplicant: matchingRow
          ? matchingRow[headers.indexOf("primaryContactNumberOfApplicant")]
          : "",
        alternativeContactNumber: matchingRow
          ? matchingRow[headers.indexOf("alternativeContactNumber")]
          : "",
      },
      personalAndFamilyInformation: {
        familyDetails: {
          name: matchingRow ? matchingRow[headers.indexOf("familyName")] : "",
          relation: matchingRow
            ? matchingRow[headers.indexOf("familyRelation")]
            : "",
        },
        applicantDateOfBirth: matchingRow
          ? matchingRow[headers.indexOf("Dob")]
          : "",
        numberOfDependentsInHousehold: matchingRow
          ? matchingRow[headers.indexOf("noOfDependentWithCustomer")]
          : "",
        relationshipStatus: matchingRow
          ? matchingRow[headers.indexOf("MaritalStatus")]
          : "",
        areThereAnyOtherFamilyMembersInvolvedInPayingTheEMI: matchingRow
          ? matchingRow[
              headers.indexOf(
                "areThereAnyOtherFamilyMembersInvolvedInPayingTheEMI"
              )
            ]
          : "",
      },
      employmentAndIncomeDetails: {
        agriLand: matchingRow
          ? matchingRow[headers.indexOf("agricultureavailableLand")]
          : "",
        numberOfCattles: matchingRow
          ? matchingRow[headers.indexOf("MilkGivingCattle")]
          : "",
        dairyNameWhereMilkSupplied: matchingRow
          ? matchingRow[headers.indexOf("DairyName")]
          : "",
        phoneNumberOfDairyOwner: matchingRow
          ? matchingRow[headers.indexOf("DairyOwnerContact")]
          : "",
        monthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("MonthlyIncome")]
          : "",
        additionalSourcesOfIncome: [
          {
            source: matchingRow
              ? matchingRow[headers.indexOf("additionalSource")]
              : "",
            amount: matchingRow
              ? matchingRow[headers.indexOf("additionalSourceAmount")]
              : "",
            _id: "",
          },
        ],
        totalMonthlyIncome: matchingRow
          ? matchingRow[headers.indexOf("totalMonthlyIncome")]
          : "",
      },
      loanDetails: {
        loanAmountRequested: matchingRow
          ? matchingRow[headers.indexOf("loanAmountRequested")]
          : 0,
        purposeOfLoan: matchingRow
          ? matchingRow[headers.indexOf("purposeOfLoan")]
          : "",
        tenureRequestedInMonths: matchingRow
          ? matchingRow[headers.indexOf("tenureRequestedInMonths")]
          : 0,
        confortableEmiAmountForCustomer: matchingRow
          ? matchingRow[headers.indexOf("confortableEmiAmountForCustomer")]
          : 20000,
        justificationOnNeedForFundsWithBifurcation: matchingRow
          ? matchingRow[
              headers.indexOf("justificationOnNeedForFundsWithBifurcation")
            ]
          : "",
      },
      financialSatisfactionDetails: {
        kyaAapLoanAmountSeSantustHai: matchingRow
          ? matchingRow[headers.indexOf("kyaAapLoanAmountSeSantustHai")]
          : "",
        KyaAapROISeSantustHai: matchingRow
          ? matchingRow[headers.indexOf("KyaAapROISeSantustHai")]
          : "",
        KyaAapTenureSeSantustHai: matchingRow
          ? matchingRow[headers.indexOf("KyaAapTenureSeSantustHai")]
          : "",
        KyaAapMonthlyEMISeSantustHai: matchingRow
          ? matchingRow[headers.indexOf("KyaAapMonthlyEMISeSantustHai")]
          : "",
        fasalkharabHogiTabkaiseEMIBharenge: matchingRow
          ? matchingRow[headers.indexOf("fasalkharabHogiTabkaiseEMIBharenge")]
          : "",
        panchTarikhKiEMIDateHaiAapkoChaarTareekSeBalanceMaintainKarnaPdegaKrPaenge:
          matchingRow
            ? matchingRow[
                headers.indexOf(
                  "panchTarikhKiEMIDateHaiAapkoChaarTareekSeBalanceMaintainKarnaPdegaKrPaenge"
                )
              ]
            : "",
        coOwnershipAlterKarniHogiKarwaPaenge: matchingRow
          ? matchingRow[headers.indexOf("coOwnershipAlterKarniHogiKarwaPaenge")]
          : "",
        branchJakarLDSignKarniHogiKrPaenge: matchingRow
          ? matchingRow[headers.indexOf("branchJakarLDSignKarniHogiKrPaenge")]
          : "",
        aapkoRMPaymentJamaKarnaPadegakrPaenge: matchingRow
          ? matchingRow[
              headers.indexOf("aapkoRMPaymentJamaKarnaPadegakrPaenge")
            ]
          : "",
      },
      propertyOwnershipDetails: {
        coOwnerDetails: {
          name: matchingRow ? matchingRow[headers.indexOf("coOwnerName")] : "",
          relationship: matchingRow
            ? matchingRow[headers.indexOf("coOwnerRelationship")]
            : "",
        },
        propertyAddress: matchingRow
          ? matchingRow[headers.indexOf("propertyAddress")]
          : "",
        typeOfProperty: matchingRow
          ? matchingRow[headers.indexOf("typeOfProperty")]
          : "",
        estimatedMarketValueOfProperty: matchingRow
          ? matchingRow[headers.indexOf("estimatedMarketValueOfProperty")]
          : 0,
        isThePropertyOwnedSolelyByTheApplicant: matchingRow
          ? matchingRow[headers.indexOf("coOwnerRelationship")]
          : "",
      },
      verificationOfDetails: {
        confirmTheApplicantFullName: matchingRow
          ? matchingRow[headers.indexOf("confirmTheApplicantFullName")]
          : "",
        confirmIncomeDetails: matchingRow
          ? matchingRow[headers.indexOf("confirmIncomeDetails")]
          : "",
        confirmPropertyOwnership: matchingRow
          ? matchingRow[headers.indexOf("confirmPropertyOwnership")]
          : "",
        confirmLoanAmountAndPurpose: matchingRow
          ? matchingRow[headers.indexOf("confirmLoanAmountAndPurpose")]
          : "",
      },
      additionalVerificationQuestions: {
        areYouAwareOfTheEMIObligationsForTheLoan: matchingRow
          ? matchingRow[
              headers.indexOf("areYouAwareOfTheEMIObligationsForTheLoan")
            ]
          : "",
        doYouHaveAnyAdditionalLoansOrDebtsAtPresent: matchingRow
          ? matchingRow[
              headers.indexOf("doYouHaveAnyAdditionalLoansOrDebtsAtPresent")
            ]
          : "",
        ifYesPleaseSpecifyTypeAndAmount: matchingRow
          ? matchingRow[headers.indexOf("ifYesPleaseSpecifyTypeAndAmount")]
          : "",
        isYourMonthlyIncomeSufficientToCoverTheEMIs: matchingRow
          ? matchingRow[
              headers.indexOf("isYourMonthlyIncomeSufficientToCoverTheEMIs")
            ]
          : "",
        haveYouFacedAnyFinancialDifficultiesInThePastTwelveMonths: matchingRow
          ? matchingRow[
              headers.indexOf(
                "haveYouFacedAnyFinancialDifficultiesInThePastTwelveMonths"
              )
            ]
          : "",
        ifYesPleaseDescribe: matchingRow
          ? matchingRow[headers.indexOf("ifYesPleaseDescribe")]
          : "",
      },
      communicationAndFeedbackFromApplicant: {
        howDidYouFindOutAboutOurServices: matchingRow
          ? matchingRow[headers.indexOf("howDidYouFindOutAboutOurServices")]
          : "",
        whatMotivatedYouToApplyForOurLoan: matchingRow
          ? matchingRow[headers.indexOf("whatMotivatedYouToApplyForOurLoan")]
          : "",
        areYouSatisfiedWithTheLoanTermsSDiscussedDuringTheApplicationProcess:
          matchingRow
            ? matchingRow[
                headers.indexOf(
                  "areYouSatisfiedWithTheLoanTermsSDiscussedDuringTheApplicationProcess"
                )
              ]
            : "",
        ifNoPleaseExplainYourConcernsOrIssues: matchingRow
          ? matchingRow[
              headers.indexOf("ifNoPleaseExplainYourConcernsOrIssues")
            ]
          : "",
      },
      remarksFromCreditManager: {
        additionalObservations: matchingRow
          ? matchingRow[headers.indexOf("additionalObservations")]
          : "",
        recommendationsBasedOnVerification: matchingRow
          ? matchingRow[headers.indexOf("recommendationsBasedOnVerification")]
          : "",
        creditManagerName: matchingRow
          ? matchingRow[headers.indexOf("creditManagerName")]
          : "",
        dateOfRemark: matchingRow
          ? matchingRow[headers.indexOf("dateOfRemark")]
          : "",
      },
      verificationStatus: {
        verificationCompletedByNameOfCreditManager: matchingRow
          ? matchingRow[
              headers.indexOf("verificationCompletedByNameOfCreditManager")
            ]
          : "",
        overallVerificationStatus: matchingRow
          ? matchingRow[headers.indexOf("overallVerificationStatus")]
          : "",
        ifRejectedReasonForRejection: matchingRow
          ? matchingRow[headers.indexOf("ifRejectedReasonForRejection")]
          : "",
      },
      // disbursementDetails
      preDisbursementForm: {
        applicantName: matchingRow
          ? matchingRow[headers.indexOf("applicantName")]
          : "",
        dateOfSanction: matchingRow
          ? matchingRow[headers.indexOf("dateOfSanction")]
          : "",
        sanctionLetterNumber: matchingRow
          ? matchingRow[headers.indexOf("sanctionLetterNumber")]
          : "",
        dateOfTheAgreement: matchingRow
          ? matchingRow[headers.indexOf("dateOfTheAgreement")]
          : "",
        placeOfExecution: matchingRow
          ? matchingRow[headers.indexOf("placeOfExecution")]
          : "",
      },
      kfsDetails: {
        processingFees: matchingRow
          ? matchingRow[headers.indexOf("processingFees")]
          : "",
        documentsCharges: matchingRow
          ? matchingRow[headers.indexOf("documentsCharges")]
          : "",
        insuranceCharges: matchingRow
          ? matchingRow[headers.indexOf("insuranceCharges")]
          : "",
        cersaiCharges: matchingRow
          ? matchingRow[headers.indexOf("cersaiCharges")]
          : "",
        preEmiinterest: matchingRow
          ? matchingRow[headers.indexOf("preEmiinterest")]
          : "",
        benchmarkinterestRate: matchingRow
          ? matchingRow[headers.indexOf("benchmarkinterestRate")]
          : "",
        spreadInterestRate: matchingRow
          ? matchingRow[headers.indexOf("spreadInterestRate")]
          : "",
        annualPercentageRateAprPercentage: matchingRow
          ? matchingRow[headers.indexOf("annualPercentageRateAprPercentage")]
          : "",
        epi: matchingRow ? matchingRow[headers.indexOf("epi")] : "",
        noOfEpi: matchingRow ? matchingRow[headers.indexOf("noOfEpi")] : "",
      },
      postDisbursementDetails: {
        applicantName: matchingRow
          ? matchingRow[headers.indexOf("applicantName")]
          : "",
        fatherName: matchingRow
          ? matchingRow[headers.indexOf("FatherName")]
          : "",
        loanNumber: matchingRow
          ? matchingRow[headers.indexOf("loanNumber")]
          : "",
        actualPreEmi: matchingRow
          ? matchingRow[headers.indexOf("actualPreEmi")]
          : "",
        dateOfDisbursement: matchingRow
          ? matchingRow[headers.indexOf("dateOfDisbursement")]
          : "",
        dateOfFirstEmi: matchingRow
          ? matchingRow[headers.indexOf("dateOfFirstEmi")]
          : "",
        utrNumberOne: matchingRow
          ? matchingRow[headers.indexOf("utrNumberOne")]
          : "",
        utrNumberTwo: matchingRow
          ? matchingRow[headers.indexOf("utrNumberTwo")]
          : "",
        disbursementDoneBy: matchingRow
          ? matchingRow[headers.indexOf("disbursementDoneBy")]
          : "",
      },
    };
    return success(res, "sheet Data", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// ratna fin send email

// ratna fin send to partner
const ratnaFinSendToPartner = async (req, res) => {
  try {
    let { customerId, selections } = req.query;
    if (!selections || typeof selections !== "string") {
      selections = "ac";
    }
    const sectionData = await sectionLatter(customerId);
    const applicantData = await applicantLatter(customerId, selections);
    const LdAndPdDeedData = await LdAndPdDeed(customerId, selections);

    const uploadUrl = "https://stageapi.fincooper.in/v1/formData/ImageUpload";

    const processFile = async (filePath) => {
      let resolvedPath = path
        .resolve(__dirname, `../../../..${filePath}`)
        .replace(/\\/g, "/");
      const formData = new FormData();
      formData.append("image", fs.createReadStream(resolvedPath));
      const response = await axios.post(uploadUrl, formData, {
        headers: { ...formData.getHeaders() },
      });
      return response.data?.items;
    };

    const uploadedSectionUrl = await processFile(sectionData);
    const uploadedApplicantUrl = await processFile(applicantData);
    const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);

    return success(res, "Email sent successfully with uploaded files.", {
      sectionLatter: `https://stageapi.fincooper.in/${uploadedSectionUrl.image}`,
      LdAndPdDeed: `https://stageapi.fincooper.in/${uploadedLdAndPdDeedUrl.image}`,
      applicantionLatter: `https://stageapi.fincooper.in/${uploadedApplicantUrl.image}`,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// ratna fin send email
const ratnaFinSendEmail = async (req, res) => {
  try {
    let { customerId, selections } = req.query;
    if (!selections || typeof selections !== "string") {
      selections = "ac";
    }
    console.log(req.query, "<><><><><><><><>");
    const partnerModel = await lendersModel.findOne({ userName: "RATNAAFIN" });
    const sectionData = await sectionLatter(customerId);
    const applicantData = await applicantLatter(customerId, selections);
    const LdAndPdDeedData = await LdAndPdDeed(customerId, selections);

    const uploadUrl = "https://stageapi.fincooper.in/v1/formData/ImageUpload";

    const processFile = async (filePath) => {
      let resolvedPath = path
        .resolve(__dirname, `../../../..${filePath}`)
        .replace(/\\/g, "/");
      const formData = new FormData();
      formData.append("image", fs.createReadStream(resolvedPath));
      const response = await axios.post(uploadUrl, formData, {
        headers: { ...formData.getHeaders() },
      });
      return response.data?.items;
    };

    const uploadedSectionUrl = await processFile(sectionData);
    const uploadedApplicantUrl = await processFile(applicantData);
    const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);

    const BASEURL = process.env.BASE_URL;

    // Attachments for the email
    const attachments = [
      {
        path: uploadedSectionUrl,
        contentType: "application/pdf",
      },
      {
        path: uploadedApplicantUrl,
        contentType: "application/pdf",
      },
      {
        path: uploadedLdAndPdDeedUrl,
        contentType: "application/pdf",
      },
    ];
    console.log(attachments, "attachmentsattachmentsattachments");
    // Generate eSign link for each document
    const documents = [
      { fileName: LdAndPdDeedData, key: "LdAndPdData" },
      { fileName: applicantData, key: "applicantDataa" },
      { fileName: sectionData, key: "section" },
    ];

    const emailContent = `
      <div style="font-family: Arial, sans-serif; line-height: 1.6;">
        <p>Dear Sir,</p>
        <p>Caption case Report is for final approval.</p>
        <p>Need your immediate action in this case.</p>
        <p>Regards,</p>
        <p>Team FinCoopers</p>
      </div>
    `;

    // Sending email with eSign links in the email body
    await sendEmail(
      [partnerModel.email],
      ["raikwar@yopmail.com"],
      `Final approval email for review`,
      emailContent,
      attachments
    );

    // Responding with eSign links and success message
    return success(
      res,
      "Esign link generated and email sent successfully"
      //   {
      //   ...esignLinks,
      // }
    );
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

//ratna fin genrerate esign link
const ratnaFinGenerateEsign = async (req, res) => {
  try {
    let { customerId, SectionUrl, LdAndPdDeedUrl, ApplicantUrl, selections } =
      req.query;
    // console.log(req.query, "<><><><><><><><>");
    if (!selections || typeof selections !== "string") {
      selections = "ac";
    }
    const partnerModel = await lendersModel.findOne({ userName: "RATNAAFIN" });
    const sectionData = await sectionLatter(customerId);
    const applicantData = await applicantLatter(customerId, selections);
    const LdAndPdDeedData = await LdAndPdDeed(customerId, selections);
    const BASEURL = process.env.BASE_URL;
    // console.log(sectionData,"sectionData",applicantData,"applicantDataapplicantData",LdAndPdDeedData,"LdAndPdDeedData")
    // Attachments for the email
    const attachments = [
      {
        path: SectionUrl,
        contentType: "application/pdf",
      },
      {
        path: ApplicantUrl,
        contentType: "application/pdf",
      },
      {
        path: LdAndPdDeedUrl,
        contentType: "application/pdf",
      },
    ];

    // Generate eSign link for each document
    const documents = [
      { fileName: LdAndPdDeedData, key: "LdAndPdData" },
      { fileName: applicantData, key: "applicantData" },
      { fileName: sectionData, key: "sectionData" },
    ];

    const esignLinks = {};
    let esignLinkHtml = ""; // String to store the eSign links as HTML

    for (const doc of documents) {
      console.log(doc, "docdoc");
      const esignResult = await initESign({ fileName: doc.fileName });
      const signUrl = esignResult.data.invitees[0]?.signUrl; // Only take the first invitee's sign URL

      if (signUrl) {
        esignLinks[doc.key] = signUrl;

        // Building the HTML content for the email body with eSign link
        esignLinkHtml += `
          <p><strong>${doc.key}</strong> eSign link:</p>
          <p><a href="${signUrl}" target="_blank">Click to Sign</a></p>
          <hr />
        `;
      }
    }
    console.log(esignLinks, "esignLinksesignLinks<><><><>");
    //   const externalVendorFormData = await externalVendorFormModel.findOneAndUpdate({
    //     customerId,
    //   },
    // {
    //   $set:{
    //     branchRequiredDocument.appEsignLink: esignLinks
    //   }
    // }
    // );
    // // Email content with eSign links

    const emailContent = `
      <div style="font-family: Arial, sans-serif; line-height: 1.6;">
        <p>Dear Sir,</p>
        <p>Caption case Report is for final approval.</p>
        <p>Need your immediate action in this case.</p>
        <p>Regards,</p>
        <p>Team FinCoopers</p>
        <div>All PDFs are attached in this email.</div>
        <div>
          <p><strong>eSign Links for each document:</strong></p>
          ${esignLinkHtml}
        </div>
      </div>
    `;

    // Sending email with eSign links in the email body
    await sendEmail(
      [partnerModel.email],
      ["raikwar@yopmail.com"],
      `Final approval email for review`,
      emailContent,
      attachments
    );

    // Responding with eSign links and success message
    return success(res, "Esign link generated and email sent successfully", {
      ...esignLinks,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

//grow money and fcpl send to partner api
const growMoneySendToPartner = async (req, res) => {
  try {
    const { customerId, partnerId } = req.query;

    // Fetch partner information
    const partnerModel = await lendersModel.findOne({ _id: partnerId });
    if (!partnerModel) throw new Error("Partner not found.");

    const partnerConfigs = {
      "FIN COOPERS CAPITAL PVT LTD": FinpdfLogo,
      "GROW MONEY CAPITAL PVT LTD": growPdfLogo,
    };

    // Normalize partner name for matching
    const normalizedPartnerName = (partnerModel.partnerName || "")
      .trim()
      .toUpperCase();
    const partnerLogo = partnerConfigs[normalizedPartnerName];

    if (!partnerLogo)
      throw new Error(`Unsupported partner: ${partnerModel.partnerName}`);

    // Map function names to the correct functions
    const pdfFunctions = {
      growSanctionLetterPdf,
      growApplicantPdf,
      growPgDeedPdf,
      rcplLoanAgreement,
    };

    // Call each function dynamically with the partner's logo
    const pdfData = {};

    for (const [key, func] of Object.entries(pdfFunctions)) {
      const pdfResult = await func(
        customerId,
        partnerLogo,
        partnerModel.partnerName
      );
      pdfData[key] = pdfResult;
    }

    // Log the results to ensure data is returned
    console.log(pdfData);

    // Now you can process and send the response with the uploaded files
    const uploadUrl = "https://stageapi.fincooper.in/v1/formData/ImageUpload";

    // Function to process file uploads
    const processFile = async (filePath) => {
      const resolvedPath = path
        .resolve(__dirname, `../../../..${filePath}`)
        .replace(/\\/g, "/");
      const formData = new FormData();
      formData.append("image", fs.createReadStream(resolvedPath));
      const response = await axios.post(uploadUrl, formData, {
        headers: { ...formData.getHeaders() },
      });
      return response.data?.items;
    };

    // Upload each PDF and get the URLs
    const uploadedUrls = {};
    for (const [key, data] of Object.entries(pdfData)) {
      const uploadedUrl = await processFile(data);
      uploadedUrls[key] = `https://stageapi.fincooper.in/${uploadedUrl.image}`;
    }

    // Return success response with uploaded URLs
    return success(
      res,
      "Email sent successfully with uploaded files.",
      uploadedUrls
    );
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

//grow money and fcpl genrerate esign link

const growMoneyGenerateEsign = async (req, res) => {
  try {
    const {
      customerId,
      partnerId,
      SectionUrl,
      LdAndPdDeedUrl,
      ApplicantUrl,
      loanAgreementUrl,
    } = req.query;

    const partnerModel = await lendersModel.findOne({ _id: partnerId });
    if (!partnerModel) throw new Error("Partner not found.");

    const partnerConfigs = {
      "FIN COOPERS CAPITAL PVT LTD": FinpdfLogo,
      "GROW MONEY CAPITAL PVT LTD": growPdfLogo,
    };

    // Normalize partner name for matching
    const normalizedPartnerName = (partnerModel.partnerName || "")
      .trim()
      .toUpperCase();
    const partnerLogo = partnerConfigs[normalizedPartnerName];

    // if (!partnerLogo) throw new Error(`Unsupported partner: ${partnerModel.partnerName}`);

    // // Map function names to the correct functions
    const pdfFunctions = {
      growSanctionLetterPdf,
      growApplicantPdf,
      growPgDeedPdf,
      rcplLoanAgreement,
    };

    // Call each function dynamically with the partner's logo
    const pdfData = {};
    const esignData = {};

    for (const [key, func] of Object.entries(pdfFunctions)) {
      // Generate the PDF
      const pdfResult = await func(
        customerId,
        partnerLogo,
        partnerModel.partnerName
      );
      pdfData[key] = pdfResult;

      // Generate the eSign link for the generated PDF
      const esignResult = await initESign({ fileName: pdfResult });
      const signUrl = esignResult.data.invitees[0]?.signUrl; // Fetch the first invitee's sign URL

      if (signUrl) {
        esignData[key + "EsignLink"] = signUrl;
      }
    }

    // Combine PDF and eSign link data for response
    const combinedData = Object.entries(pdfData).map(([key, pdfPath]) => {
      const esignLink = esignData[key + "EsignLink"];
      return {
        pdf: pdfPath,
        esignLink: esignLink, // Only sending one link per document
      };
    });

    // Log the combined data for debugging
    // console.log("Combined Response Data:", combinedData);

    // Generate the email content
    const emailLinks = combinedData
      .map(({ pdf, esignLink }) => {
        return `<div>
        <h4>eSign Details for </h4>
        <p><strong>eSign Link:</strong> <a href="${esignLink}" target="_blank">Click to Sign</a></p>
      </div>`;
      })
      .join("");

    // // Email body content

    const emailContent = `
      <div style="font-family: Arial, sans-serif; line-height: 1.6;">
        <p>Dear Sir,</p>
        <p>Caption case Report is for final approval.</p>
        <p>Need your immediate action in this case.</p>
        <p>Regards,</p>
        <p>Team FinCoopers</p>
        <div>All PDFs are attached in this email.</div>
         <div>
          <p><strong>eSign Links for each document:</strong></p>
          ${emailLinks}
        </div>
      </div>
    `;

    // Attachments for the email
    const attachments = [
      { path: SectionUrl, contentType: "application/pdf" },
      { path: ApplicantUrl, contentType: "application/pdf" },
      { path: LdAndPdDeedUrl, contentType: "application/pdf" },
      { path: loanAgreementUrl, contentType: "application/pdf" },
    ];

    // Send email with eSign links and attachments
    await sendEmail(
      [partnerModel.email],
      ["raikwar@yopmail.com"],
      `Final approval email for review`,
      emailContent,
      attachments
    );

    // Respond with PDF and eSign data
    //combinedData
    return success(
      res,
      "Esign link generated and email sent successfully",
      combinedData
    );
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const allDocuments = async (req, res) => {
  try {
    const { customerId } = req.query;
    // console.log(customerId, "customerIdcustomerId");
    const externalVendorFormData = await externalVendorFormModel.findOne({
      customerId,
    });
    const creditPdData = await creditPdModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const disbursementData = await disbursementModel.findOne({ customerId });
    const coApplicantData = await coApplicantModel.find({ customerId });
    const applicantData = await applicantModel.findOne({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const allData = await cibilModel.aggregate([
      {
        $match: { customerId: new ObjectId(customerId) }, // Ensure matching format if customerId is an ObjectId
      },
      {
        $project: {
          applicantPdf: { $ifNull: ["$applicantCibilReport", ""] },
          guarantorPdf: { $ifNull: ["$guarantorCibilReport", ""] },

          // Conditional handling for coApplicantPdf
          coApplicantPdf: {
            $cond: {
              if: { $isArray: "$coApplicantData" }, // Check if coApplicantData is an array
              then: {
                $filter: {
                  input: {
                    $concatArrays: [
                      {
                        $map: {
                          input: "$coApplicantData", // Array of coApplicants
                          as: "coApplicant",
                          in: {
                            $ifNull: [
                              "$$coApplicant.coApplicantCibilReport",
                              "",
                            ],
                          }, // Extract coApplicantCibilReport or return empty string
                        },
                      },
                      [
                        { $ifNull: ["$coApplicantCibilReport", ""] }, // Add direct coApplicantCibilReport if present
                      ],
                    ],
                  },
                  as: "report",
                  cond: { $ne: ["$$report", ""] }, // Filter out empty strings
                },
              },
              else: [
                { $ifNull: ["$coApplicantCibilReport", ""] }, // Direct field if no array
              ],
            },
          },
        },
      },
    ]);
    const cibilData = await cibilModel.findOne({ customerId });
    const loanDocumentData = await loanDocumentModel.findOne({ customerId });
    const SignKycDetails = await SignKycModel.findOne({ customerId });
    const finalData = await finalModel.findOne({ customerId })

    const customerObjectId = mongoose.Types.ObjectId.isValid(customerId)
      ? new ObjectId(customerId)
      : customerId;

    // console.log(finalData, "finalDatafinalDatafinalData")
    const customerDocumentDetails = await customerDocumentModel.findOne({ customerId: customerObjectId });
    const loanDocument = await loanDocumentModel.findOne({ customerId });
    const bankStatementData = await bankStatementModel.findOne({ customerId })
    const propertyPaperData = await internalLegalModel.findOne({ customerId });
    
    const btDetailsExist = await btDetailsModel.findOne({customerId})

    let matchingBankDetail;
    if (bankStatementData) {
      matchingBankDetail = bankStatementData.bankDetails.find(detail => {
        if (detail.E_Nach_Remarks === "true") {
          // Clean the arrays by removing empty strings
          if (Array.isArray(detail.bankDetailsPdc)) {
            detail.bankDetailsPdc = detail.bankDetailsPdc.filter(item => item !== "");
          }
          if (Array.isArray(detail.bankDetailsBsv)) {
            detail.bankDetailsBsv = detail.bankDetailsBsv.filter(item => item !== "");
          }
          if (Array.isArray(detail.bankStatementPdf)) {
            detail.bankStatementPdf = detail.bankStatementPdf.filter(item => item !== "");
          }
    
          // Now check the cleaned arrays
          return (
            (detail.bankDetailsPdc && detail.bankDetailsPdc.length > 0) ||
            (detail.bankDetailsBsv && detail.bankDetailsBsv.length > 0) ||
            (detail.bankStatementPdf && detail.bankStatementPdf.length > 0)
          );
        }
      });
    }

    let matchingBankStatements = [];
    if (bankStatementData) {
      matchingBankStatements = bankStatementData.bankDetails.filter(detail => {
        console.log(detail,"detail")
        // Clean the arrays by removing empty strings
        if (Array.isArray(detail.bankStatementPdf)) {
          detail.bankStatementPdf = detail.bankStatementPdf.filter(item => item !== "");
        }
        // Return only those with non-empty bankStatementPdf
        return detail.bankStatementPdf && detail.bankStatementPdf.length > 0;
      });
    }
    
    // E_Nach_Remarks
    console.log(matchingBankStatements, "matchingBankStatements");
    
    //udhyamKycModel
    const udhyamKycData = await udhyamKycModel.findOne({ customerId })
    let links = (finalData?.signEsignLink && Object.keys(finalData.signEsignLink).length > 0)
      ? finalData.signEsignLink
      : finalData?.esignLinks;

    const gtrrBankDetails = await guarantorStatementDetails.findOne({customerId})  
   
    let newGuarantorPDC = [];
    let newGuarantorBSV = [];
    
    if (gtrrBankDetails && gtrrBankDetails.bankDetails) {
        const gtrBankDetail = gtrrBankDetails.bankDetails.filter(detail => detail.Type === "guarantor");
    
        const guarantorPDC = gtrBankDetail.flatMap(detail => detail.bankDetailsPdc || []);
        const guarantorBSV = gtrBankDetail.flatMap(detail => detail.bankDetailsBSV || []);
    
        // Assign values inside the if block
        newGuarantorPDC = guarantorPDC.length > 0 ? guarantorPDC : [];
        newGuarantorBSV = guarantorBSV.length > 0 ? guarantorBSV : [];
    }
  
      const existingData = await internalLegalModel.findOne({ customerId });
    
      let allFiles = [];

      // List of fields that contain `file` arrays
      const fileFields = [
          "SealandSignedBy",
          "pramanPatra",
          "taxReceipt",
          "co_ownership_deed",
          "EM_DEED",
          "RM_DEED",
          "gramPanchayat",
          "Noc_certificate",
          "Buliding_Permission_Certificate",
          "Mutation_Certificate",
          "Owner_Certificate",
          "Property_Tax_Reciept"
      ];

// Extract all `file` arrays into `allFiles`
      if (existingData) {
          fileFields.forEach(field => {
              if (existingData[field]?.file) {
                  allFiles = allFiles.concat(existingData[field].file);
              }
          });
      }
    // console.log(customerDocumentDetails, "customerDocumentDetails")
    const rcuVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rcu"
    );
    const legalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "legal"
    );
    const technicalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "technical"
    );
    const rmVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rm"
    );
    const taggingVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "tagging"
    );

    // Function to extract all income source photos
    const extractIncomeSourcePhotos = (creditPdData) => {
      const allPhotos = [];
      
      if (creditPdData?.incomeSource && Array.isArray(creditPdData.incomeSource)) {
        creditPdData.incomeSource.forEach(source => {
          // Extract agriculture photos
          if (source.agricultureBusiness?.agriculturePhotos && Array.isArray(source.agricultureBusiness.agriculturePhotos)) {
            allPhotos.push(...source.agricultureBusiness.agriculturePhotos);
          }
          
          // Extract milk business photos (milk photos and animal photos)
          if (source.milkBusiness) {
            if (source.milkBusiness.milkPhotos && Array.isArray(source.milkBusiness.milkPhotos)) {
              allPhotos.push(...source.milkBusiness.milkPhotos);
            }
            if (source.milkBusiness.animalPhotos && Array.isArray(source.milkBusiness.animalPhotos)) {
              allPhotos.push(...source.milkBusiness.animalPhotos);
            }
          }
          
          // Extract salary income photos
          if (source.salaryIncome) {
            if (source.salaryIncome.last3MonthSalarySlipPhotos && Array.isArray(source.salaryIncome.last3MonthSalarySlipPhotos)) {
              allPhotos.push(...source.salaryIncome.last3MonthSalarySlipPhotos);
            }
            if (source.salaryIncome.salaryPhotos && Array.isArray(source.salaryIncome.salaryPhotos)) {
              allPhotos.push(...source.salaryIncome.salaryPhotos);
            }
            if (source.salaryIncome.bankStatementPhoto) {
              allPhotos.push(source.salaryIncome.bankStatementPhoto);
            }
            if (source.salaryIncome.salaryCredited6Month) {
              allPhotos.push(source.salaryIncome.salaryCredited6Month);
            }
          }
          
          // Extract other business photos
          if (source.other?.incomeOtherImages && Array.isArray(source.other.incomeOtherImages)) {
            allPhotos.push(...source.other.incomeOtherImages);
          }
        });
      }
      
      // Remove duplicates and filter out empty values
      return [...new Set(allPhotos)].filter(photo => photo);
    };

    // Extract income source photos
    const incomeSourcePhotos = extractIncomeSourcePhotos(creditPdData);

    // let legalIsApproved = legalReportDetails?.status === 'approve'
    // const technicalIsApproved = technicalData?.status === 'approve';//coApplicantData
    const responseData = {
      SanctionCheckList: {
        // login check list
         utilityBillDocument:
          customerDocumentDetails?.incomeDocument?.utilityBillDocument || [],
         utilityBillDocumentDetails: "Recive from sales form",

        newUtilityBillDocument:
        creditPdData?.electricityBillPhoto || "",
        utilityBillDocumentDetails: "Recive from residance form",

        familyCardDocument:
          customerDocumentDetails?.incomeDocument?.familyCardDocument || [],
        familyCardDocumentDetails: "Recive from sales form",
        NewfamilyCardDocument:
        creditPdData?.samagraIdDetail?.samagraIdDoc || "",
        NewfamilyCardDocumentDetails: "Recive from family card form",
        udyamCertificate:
          customerDocumentDetails?.incomeDocument?.udyamCertificateDocument ||
          [],
        udyamCertificateDetails: "Recive from sales form",
        newUdyamCertificate:
        udhyamKycData?.udhyamKycDocument ||
        [],
        newUdyamCertificateDetails: "Recive from udhyam form",
        bankStatement:
          customerDocumentDetails?.incomeDocument?.bankStatementDocument || [],
        bankStatementDetails: "Recive from sales form",//matchingBankDetail
        newBankStatement: matchingBankStatements.flatMap(item =>
          (item.bankStatementPdf || []).filter(pdf => pdf !== "")
        ),        
        newBankStatementDetails: "Recive from bank form",
        incomeDocument:
          customerDocumentDetails?.incomeDocument?.incomeStatemenDocument || [],
        incomeDocumentDetails: "Recive from sales form",

        newIncomeDocument:
        [
          ...(finalData?.agricultureIncomeNew?.agriDocument || []),
          ...(finalData?.milkIncomeCalculationNew?.milkDocument || []),
          ...(finalData?.otherIncomeNew?.uploadOtherIncomeDocument || [])
        ],
        newIncomeDocumentDetails: "Recive from income form",

        propertyDocument:
          customerDocumentDetails?.propertyDocuments?.propertyDocument || [],
        propertyDocumentDetails: "Recive from sales form",

        newPropertyDocument: [
          ...(propertyPaperData?.customDocument || []),
          ...(propertyPaperData?.otherDocuments || []),
          ...(propertyPaperData?.SealandSignedBy?.file || []),
          ...(propertyPaperData?.pramanPatra?.file || []),
          ...(propertyPaperData?.taxReceipt?.file || []),
          ...(propertyPaperData?.co_ownership_deed?.file || []),
          ...(propertyPaperData?.EM_DEED?.file || []),
          ...(propertyPaperData?.RM_DEED?.file || []),
          ...(propertyPaperData?.gramPanchayat?.file || []),
          ...(propertyPaperData?.Noc_certificate?.file || []),
          ...(propertyPaperData?.Buliding_Permission_Certificate?.file || []),
          ...(propertyPaperData?.Mutation_Certificate?.file || []),
          ...(propertyPaperData?.Owner_Certificate?.file || []),
          ...(propertyPaperData?.Property_Tax_Reciept?.file || []),
          ...(propertyPaperData?.draftingDocument?.file || []),
          ...(propertyPaperData?.thirteenYearChainDocument?.file || []),
          ...(propertyPaperData?.registry?.file || []),

        ],
        newPropertyDocumentDetails: "Recive from property form",


        signApplicantKyc: customerDocumentDetails?.signApplicantKyc || [],
        propertyDocumentDetails: "Recive from sales form",
        signCoApplicantKyc: customerDocumentDetails?.signCoApplicantKyc || [],
        signCoApplicantKycDetails: "Recive from sales form",
        signCoTwoApplicantKyc:
          customerDocumentDetails?.signCoTwoApplicantKyc || [],
        signCoTwoApplicantKycDetails: "Recive from sales form",
        signGurantorKyc: customerDocumentDetails?.signGurantorKyc || [],
        signGurantorKycDetails: "Recive from sales form",
        //
        electricityBill: creditPdData?.utilityBillDocument || [],
        electricityBillDetails: "Recive from electricity form",
        SamagraId: creditPdData?.SSSMPhoto || [],
        SamagraIdDetails: "Recive from SamagraId form",
        // gasDiaryDocument:,
        // gasDiaryDocumentDetails:"",
        applicantPhoto: applicantData?.applicantPhoto || "",
        applicantPhotoDetails: "Recive from login form",
        coApplicantPhoto: coApplicantData[0]?.coApplicantPhoto || "",
        coApplicantPhotoDetails: "Recive from login form",
        coApplicantPhotoTwo: coApplicantData[1]?.coApplicantPhoto || "",
        coApplicantPhotoTwoDetails: "Recive from login form",
        guarantorPhoto: guarantorData?.guarantorPhoto || "",
        guarantorPhotoDetails: "Recive from login form",
        applicantKycOsv: SignKycDetails?.ApplicantSignDocument || "",
        applicantKycOsvDetails: "Recive from branch",
        coApplicantKycOsv: SignKycDetails?.coApplicantSignDocument || "",
        coApplicantKycOsvDetails: "Recive from branch",
        gurantorKycOsv: SignKycDetails?.guarantorSignDocument || "",
        gurantorKycOsv: "Recive from branch",
        applicantKyc: {
          applicantAadharFrontImage:
            applicantData?.kycUpload?.aadharFrontImage || "",
          applicantAadharBackImage:
            applicantData?.kycUpload?.aadharBackImage || "",
          applicantPanFrontImage: applicantData?.kycUpload?.panFrontImage || "",
          applicantDrivingLicenceImage:
            applicantData?.kycUpload?.drivingLicenceImage || "",
          applicantVoterIdImage: applicantData?.kycUpload?.voterIdImage || "",
        },
        applicantKycDetails: "Recive from login form",
        coApplicantKyc: {
          coApplicantKycAadharFrontImage:
            coApplicantData[0]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycAadharBackImage:
            coApplicantData[0]?.kycUpload?.aadharBackImage || "",
          // coApplicantKycDocType:coApplicantData[0]?.kycUpload?.docImage || "",
          coApplicantKycDocImage: coApplicantData[0]?.kycUpload?.docImage || "",
        },
        coApplicantKycDetails: "Recive from login form",
        coApplicantKycTwo: {
          coApplicantKycTwoAadharFrontImage:
            coApplicantData[1]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycTwoAadharBackImage:
            coApplicantData[1]?.kycUpload?.aadharBackImage || "",
          coApplicantKycTwoDocImage:
            coApplicantData[1]?.kycUpload?.docImage || "",
        },
        coApplicantKycTwoDetails: "Recive from login form",
        gurantorKyc: {
          gurantorAadharFrontImage:
            guarantorData?.kycUpload?.aadharFrontImage || "",
          gurantorAadharBackImage:
            guarantorData?.kycUpload?.aadharBackImage || "",
          gurantorDocImage: guarantorData?.kycUpload?.docImage || "",
        },
        gurantorKycDetails: "Recive from login form",
        applicantCibilReport: cibilData?.applicantFetchHistory?.slice(-1)[0]?.cibilReport || "",
        applicantCibilReportDetails: "Recive from cibil form",
        coApplicantCibilReport:
          Array.isArray(cibilData?.coApplicantData[0]?.coApplicantFetchHistory)
            ? cibilData?.coApplicantData[0]?.coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        coApplicantCibilReportDetails: "Recive from cibil form",
        coApplicantTwoCibilReport:
          Array.isArray(cibilData?.coApplicantData[1]?.coApplicantFetchHistory)
            ? cibilData?.coApplicantData[0]?.coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        coApplicantTwoCibilReportDetails: "Recive from cibil form",
        guarantorCibilReport: cibilData?.guarantorFetchHistory?.slice(-1)[0]?.cibilReport || "",
        guarantorCibilReportDetails: "Recive from cibil form",
        pdReport: creditPdData?.pdfLink || "",
        pdReportDetails: "Recive from creditPd form",
        rcuReport: rcuVendor?.uploadProperty || [],
        rcuReportDetails: "Recive from externalVendor form",
        legalReport: legalVendor?.uploadProperty || [],
        legalReportDetails: "Recive from externalVendor form",
        technicalReport: technicalVendor?.uploadProperty || [],
        technicalReportDetails: "Recive from externalVendor form",
        technicalEstimateDocument: technicalVendor?.estimateDocument || [],
        estimateDocumentDetails: "Recive from externalVendor form",
        taggingReport: taggingVendor?.uploadProperty || [],
        taggingReportDetails: "Recive from externalVendor form",
        housePhotos: [
          ...(Array.isArray(creditPdData?.fourBoundaryPhotos)
            ? creditPdData?.fourBoundaryPhotos
            : [creditPdData?.fourBoundaryPhotos]),
          ...(Array.isArray(creditPdData?.houseInsidePhoto)
            ? creditPdData?.houseInsidePhoto
            : [creditPdData?.houseInsidePhoto]),
          ...(Array.isArray(creditPdData?.propertyOtherPhotos)
            ? creditPdData?.propertyOtherPhotos
            : [creditPdData?.propertyOtherPhotos]),
          creditPdData?.selfiWithCustomer || "",
          creditPdData?.photoWithLatLong || "",
          creditPdData?.front || "",
          creditPdData?.leftSide || "",
          creditPdData?.rightSide || "",
          creditPdData?.approachRoad || "",
          creditPdData?.mainRoad || "",
          creditPdData?.interiorRoad || "",
          creditPdData?.selfieWithProperty || "",
          creditPdData?.landmarkPhoto || "",
          creditPdData?.latLongPhoto || "",
        ].filter(Boolean),
        housePhotosDetails: "Recive from creditPd form",
        // workPhotos: creditPdData?.workPhotos || [],
        // workPhotosDetails: "Recive from creditPd form",
        workPhotos: creditPdData?.workPhotos || [],
        workPhotosDetails: "Recive from creditPd incomeSource data",
        camReport: loanDocument?.camReport || "",
        camReportDetails: "Recive from cam form",
      },
      disbursmentCheckList: {
        dualNameDeclaration: loanDocumentData?.dualNameDeclaration || "",
        dualNameDeclarationDetails: "Recive at the time of final approval",
        dualSignDeclaration: loanDocumentData?.dualSignDeclaration || "",
        dualSignDeclarationDetails: "Recive at the time of final approval",
        dualDoBDeclaration: loanDocumentData?.dualDoBDeclaration || "",
        dualDoBDeclarationDetails: "Recive at the time of final approval",
        applicantPDC: appPdcData?.applicantPdcDocument || [],
        applicantPDCDetails: "Recive from appPdc form",
        newApplicantPDC: matchingBankDetail?.bankDetailsPdc || [],
        newApplicantPDCDetails: "Recive from app bank form",
        applicantBSV: loanDocumentData?.applicantBSV || "",
        applicantBSVDetails: "Recive at the time of final approval",
        newApplicantBSV: matchingBankDetail?.bankDetailsBsv || [],
        newApplicantBSVDetails: "Recive from app bank form",
        guarantorPDC: gtrPdcData?.guarantorPdcDocument || [],
        guarantorPDCDetails: "Recive from gtrPdc form",
        newGuarantorPDC: newGuarantorPDC || [],
        newGuarantorPDCDetails: "Recive from gtr bank details form",
        guarantorBSV: loanDocumentData?.guarantorBSV || [],
        guarantorBSVDetails: "Recive at the time of final approval",
        newGuarantorBSV: newGuarantorBSV || [],
        newGuarantorBSVDetails: "Recive from gtr bank details form",
        coOwnershipDeed: loanDocumentData?.coOwnershipDeed || "",
        eStampUpload:
          disbursementData?.estampRequirement?.flatMap(
            (stamp) => stamp.eStampUpload || []
          ) || [],

        estampRequirementDetail: "Recive at the time of final approval",
        // ratnaPdfUrls: finalSanctionData?.ratnaPdfUrls || {},
        // fcplPdfUrls: finalSanctionData?.fcplPdfUrls || {},
        // growMoneyPdfUrls: finalSanctionData?.growMoneyPdfUrls || {},

        insuranceForm: loanDocumentData?.insuranceForm || "",
        insuranceFormDetails: "Recive at the time of final approval",
        emOrRmDeed: loanDocumentData?.emOrRmDeed || "",
        emOrRmDeedDetails: "Recive at the time of final approval",
        finalLegal: legalVendor?.finalLegalUpload || [],
        finalLegalDetails: "Recive at the time of final approval",

        vettingReport: loanDocument?.vettingReport || [],
        vettingReportDetails: "Recive at the time of final approval",

        newVettingReport: legalVendor?.vettingLegalUpload || [],
        newVettingReportDetails: "Recive at the time of final approval",

        nachLink: bankStatementData?.Nachlink?.trim() ? bankStatementData.Nachlink : disbursementData?.eNachLinkSentToBranch || "",
        nachLinkDetails: "Recive from nach form",
        eNachLinkSignUpload: disbursementData?.eNachLinkSignUpload || "",
        nachLinkSignDetails: "Recive from nach  signsture Complete",
        eSignatureDocuments: disbursementData?.eSignatureDocuments || "",
        eSignatureDocumentsDetails: "Recive from nach  signsture Complete",
        appKycDocument: loanDocument?.appKycDocument || [],
        appKycDocumentDetails: "Recive at the time of final approval",
        coAppKycDocument: loanDocument?.coAppKycDocument || [],
        form60: loanDocument?.form60 || [],
        coApplicantPhotoDetails: "Recive at the time of final approval",
        stampPdf: loanDocumentData?.stampPdf || [],
        sanctionZipUrl: finalData?.sanctionZipUrl || [],
        disbursementZipUrl: finalData?.disbursementZipUrl || [],
        incomeSectionLatterUrl: finalData?.incomesectionLatterUrl || "",
        esignLinks: links || {}
      },
      btDocument:{
        Foreclosure_Letter: btDetailsExist?.Foreclosure_Letter || [],
        SOA: btDetailsExist?.SOA || [],
        LOD: btDetailsExist?.LOD || [],
        BT_Bank_Sanction_Letter: btDetailsExist?.BT_Bank_Sanction_Letter || [],
      }
    };
    return success(res, "All documents link", responseData);
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

async function getAllDocumentDashboard(req, res) {
  try {
    const { 
      regionalBranch,
      branch,
      product,
      selfAssignEmployee,
      startDateFilter,
      endDateFilter,
      finalApproverStatus,
      fileProcessStatus,
      searchQuery,
      sanctionStage
    } = req.query;
    
    // Handle pagination
    const page = parseInt(req.query.page) || 1;
    const limit = parseInt(req.query.limit) || 10;
    const skip = (page - 1) * limit;
    
    // Date filtering logic
    const today = new Date();
    const defaultStartDate = new Date(today.setHours(0, 0, 0, 0));
    const defaultEndDate = new Date(today.setHours(23, 59, 59, 999));
    
    function formatDateToISO(date) {
      return new Date(date).toISOString();
    }
    
    let formattedStart = startDateFilter && startDateFilter !== "all"
      ? new Date(new Date(startDateFilter).setHours(0, 0, 0, 0))
      : defaultStartDate;
    
    let formattedEnd = endDateFilter && endDateFilter !== "all"
      ? new Date(new Date(endDateFilter).setHours(23, 59, 59, 999))
      : defaultEndDate;
    
    if (startDateFilter && endDateFilter && startDateFilter === endDateFilter) {
      formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
      formattedEnd = new Date(new Date(startDateFilter).setHours(23, 59, 59, 999));
    }
    
    formattedStart = formatDateToISO(formattedStart);
    formattedEnd = formatDateToISO(formattedEnd);
    
    // Prepare filter conditions for MongoDB query
    const filterConditions = {};
    
    // Add Status filter - this is the base filter for all queries
    filterConditions.statusByCreditPd = { $in: ["complete", "approve"] };
    
    // Date range filter
    if (startDateFilter && endDateFilter && startDateFilter !== "all" && endDateFilter !== "all") {
      filterConditions.creditPdCompleteDate = {
        $gte: formattedStart,
        $lte: formattedEnd
      };
    }
    
    // Get all externalVendorForm data with applied filters
    const externalVendorFormData = await externalVendorFormModel.find(filterConditions).lean();
    
    // Extract customerIds from the externalVendorFormData
    let customerIds = externalVendorFormData.map(vendor => vendor.customerId);
    
    // Apply post-fetch filters
    // We'll collect all the necessary data first, then filter it
    const customerDetailsMap = new Map();
    
    // Fetch all customer details in bulk for efficiency
    for (const customerId of customerIds) {
      try {
        const customerObjectId = mongoose.Types.ObjectId.isValid(customerId)
          ? new ObjectId(customerId)
          : customerId;
        
        // Fetch customer details
        const customerDetailData = await customerModel.findOne({ _id: customerObjectId }).lean();
        if (!customerDetailData) continue;
        
        // Fetch employee (sales person) data
        const salesPerson = await employeModel.findOne({ _id: customerDetailData.employeId }).lean();
        
        // Fetch branch data
        let branchDetails = null;
        let regionalBranchDetails = null;
        
        if (salesPerson?.branchId) {
          branchDetails = await newBranchModel.findOne({ _id: salesPerson.branchId }).lean();
          
          if (branchDetails?.regionalBranchId) {
            regionalBranchDetails = await newBranchModel.findOne({ _id: branchDetails.regionalBranchId }).lean();
          }
        }
        
        // Fetch applicant details
        const applicantDetails = await applicantModel.findOne({ customerId: customerObjectId }).lean();
        
        // Fetch final sanction details
        const finalsanctionData = await newfinalSanctionModel.findOne({ customerId: customerObjectId }).lean();
        
        // Find vendor form data for this customer
        const vendorFormData = externalVendorFormData.find(vendor => 
          vendor.customerId && vendor.customerId.toString() === customerId.toString()
        );
        
        // Store all the details together
        customerDetailsMap.set(customerId.toString(), {
          customerId,
          customerDetailData,
          salesPerson,
          branchDetails,
          regionalBranchDetails,
          applicantDetails,
          finalsanctionData,
          vendorFormData
        });
      } catch (error) {
        console.error(`Error fetching details for customer ${customerId}:`, error);
      }
    }
    
    // Now apply the post-fetch filters
    let filteredCustomerIds = Array.from(customerDetailsMap.keys());
    
    // Apply search filter
    if (searchQuery) {
      filteredCustomerIds = filteredCustomerIds.filter(customerId => {
        const details = customerDetailsMap.get(customerId);
        if (!details) return false;
        
        const { applicantDetails, customerDetailData } = details;
        
        // Check if any of the search fields match
        return (
          (applicantDetails?.mobileNo && String(applicantDetails.mobileNo).includes(searchQuery)) ||
          (applicantDetails?.fullName && String(applicantDetails.fullName).toLowerCase().includes(searchQuery.toLowerCase())) ||
          (applicantDetails?.fatherName && String(applicantDetails.fatherName).toLowerCase().includes(searchQuery.toLowerCase())) ||
          (customerDetailData?.customerFinId && String(customerDetailData.customerFinId).includes(searchQuery))
        );
      });
    }
    
    // Apply branch filter
    if (branch && branch !== "all") {
      const branchIds = Array.isArray(branch) ? branch : branch.split(",");
      
      filteredCustomerIds = filteredCustomerIds.filter(customerId => {
        const details = customerDetailsMap.get(customerId);
        if (!details || !details.branchDetails) return false;
        
        return branchIds.includes(details.branchDetails._id.toString());
      });
    }
    
    // Apply regional branch filter
    if (regionalBranch && regionalBranch !== "all") {
      const regionalBranchIds = Array.isArray(regionalBranch) ? regionalBranch : regionalBranch.split(",");
      
      filteredCustomerIds = filteredCustomerIds.filter(customerId => {
        const details = customerDetailsMap.get(customerId);
        if (!details || !details.regionalBranchDetails) return false;
        
        return regionalBranchIds.includes(details.regionalBranchDetails._id.toString());
      });
    }
    
    // Apply product filter
    if (product && product !== "all") {
      const productIds = Array.isArray(product) ? product : product.split(",");
      
      filteredCustomerIds = filteredCustomerIds.filter(customerId => {
        const details = customerDetailsMap.get(customerId);
        if (!details || !details.customerDetailData || !details.customerDetailData.productId) return false;
        
        return productIds.includes(details.customerDetailData.productId.toString());
      });
    }
    
    // Apply sanctionStage filter
    if (sanctionStage) {
      filteredCustomerIds = filteredCustomerIds.filter(customerId => {
        const details = customerDetailsMap.get(customerId);
        if (!details) return false;
        
        if (sanctionStage === "partnerNotSelect") {
          return !details.finalsanctionData || !details.finalsanctionData.partnerId;
        } 
        else if (sanctionStage === "sanctionDetailNotComplete") {
          const vendors = details.vendorFormData?.vendors || [];
          
          const legalVendor = vendors.find(v => v.vendorType === "legal");
          const technicalVendor = vendors.find(v => v.vendorType === "technical");
          const rcuVendor = vendors.find(v => v.vendorType === "rcu");
          
          return (
            (legalVendor && legalVendor.statusByVendor !== "approve") ||
            (technicalVendor && technicalVendor.statusByVendor !== "complete") ||
            (rcuVendor && rcuVendor.statusByVendor !== "notRequired")
          );
        } 
        else if (sanctionStage === "sanctionDetailComplete") {
          const vendors = details.vendorFormData?.vendors || [];
          
          const legalVendor = vendors.find(v => v.vendorType === "legal");
          const technicalVendor = vendors.find(v => v.vendorType === "technical");
          const rcuVendor = vendors.find(v => v.vendorType === "rcu");
          
          const legalComplete = !legalVendor || legalVendor.statusByVendor === "approve";
          const technicalComplete = !technicalVendor || technicalVendor.statusByVendor === "complete";
          const rcuComplete = !rcuVendor || rcuVendor.statusByVendor === "notRequired";
          
          const sanctionNotSent = !details.finalsanctionData || 
                                 details.finalsanctionData.sendToPartnerSanctionStatus !== "complete";
          
          return legalComplete && technicalComplete && rcuComplete && sanctionNotSent;
        }
        
        return true; // If not a recognized sanctionStage, include it
      });
    }
    
    // Apply finalApproverStatus filter
    if (finalApproverStatus) {
      if (finalApproverStatus === "partnerNotSelect") {
        filteredCustomerIds = filteredCustomerIds.filter(customerId => {
          const details = customerDetailsMap.get(customerId);
          return !details.finalsanctionData || !details.finalsanctionData.partnerId;
        });
      } else {
        const statusKeys = finalApproverStatus.split(",");
        
        filteredCustomerIds = filteredCustomerIds.filter(customerId => {
          const details = customerDetailsMap.get(customerId);
          if (!details || !details.finalsanctionData) return false;
          
          // All specified status keys must be "complete"
          return statusKeys.every(key => 
            details.finalsanctionData[key] === "complete"
          );
        });
      }
    }
    
    // Apply fileProcessStatus filter
    if (fileProcessStatus) {
      const statusKeys = fileProcessStatus.split(",");
      
      filteredCustomerIds = filteredCustomerIds.filter(customerId => {
        const details = customerDetailsMap.get(customerId);
        if (!details || !details.finalsanctionData) return false;
        
        // All specified status keys must be "complete"
        return statusKeys.every(key => 
          details.finalsanctionData[key] === "complete"
        );
      });
    }
    
    // Apply selfAssignEmployee filter
    if (selfAssignEmployee && selfAssignEmployee !== "all") {
      const employeeIds = Array.isArray(selfAssignEmployee) ? selfAssignEmployee : selfAssignEmployee.split(",");
      
      filteredCustomerIds = filteredCustomerIds.filter(customerId => {
        const details = customerDetailsMap.get(customerId);
        if (!details || !details.finalsanctionData || !details.finalsanctionData.employeeId) return false;
        
        return employeeIds.includes(details.finalsanctionData.employeeId.toString());
      });
    }
    
    // Apply exclusion for specific products when no product filter
    if (!product || product === "all") {
      // This assumes you have a list of product IDs to exclude - the original code had an empty array
      const excludedProductIds = [];
      
      if (excludedProductIds.length > 0) {
        filteredCustomerIds = filteredCustomerIds.filter(customerId => {
          const details = customerDetailsMap.get(customerId);
          if (!details || !details.customerDetailData || !details.customerDetailData.productId) return true;
          
          return !excludedProductIds.includes(details.customerDetailData.productId.toString());
        });
      }
    }
    
    // Get total count for pagination
    const totalCustomers = filteredCustomerIds.length;
    
    // Apply pagination to the filtered customer IDs
    const paginatedCustomerIds = filteredCustomerIds.slice(skip, skip + limit);
    
    // Fetch additional customer information for each customer
    const additionalCustomerInfo = await Promise.all(
      paginatedCustomerIds.map(async (customerId) => {
        try {
          const details = customerDetailsMap.get(customerId);
          if (!details) return { customerId, additionalInfo: null };
          
          const {
            customerDetailData,
            salesPerson,
            branchDetails,
            regionalBranchDetails,
            applicantDetails,
            finalsanctionData,
            vendorFormData
          } = details;
          
          // Fetch PD employee details
          const pdEmployeeDetail = vendorFormData?.creditPdId 
            ? await employeModel.findOne({ _id: vendorFormData.creditPdId }).lean()
            : null;
          
          // Fetch product details
          const productDetailData = customerDetailData?.productId
            ? await productModel.findOne({ _id: customerDetailData.productId }).lean()
            : null;
          
          // Fetch partner (lender) details
          const partnerDetails = finalsanctionData?.partnerId
            ? await lenderModel.findOne({ _id: finalsanctionData.partnerId }).lean()
            : null;
          
          // Fetch reporting manager (sales person manager)
          const reportingManager = salesPerson?.reportingManagerId 
            ? await employeModel.findOne({ _id: salesPerson.reportingManagerId }).lean()
            : null;
          
          return {
            customerId,
            additionalInfo: {
              customerFinId: customerDetailData.customerFinId || "",
              loginDate: customerDetailData.createdAt || "",
              branchName: branchDetails?.name || "",
              productName: productDetailData?.productName || "",
              partnerName: partnerDetails?.fullName || "",
              regionalBranchName: regionalBranchDetails?.name || "",
              salesPersonName: salesPerson?.employeName || "",
              customerFullName: applicantDetails?.fullName || "",
              customerFatherName: applicantDetails?.fatherName || "",
              mobileNo: applicantDetails?.mobileNo || "",
              salesPersonManagerName: reportingManager?.employeName || "",
              pdPersonName: pdEmployeeDetail?.employeName || "",
              creditPdCompleteDate: vendorFormData?.creditPdCompleteDate || "",
              statusByCreditPd: vendorFormData?.statusByCreditPd || "",
              roi: finalsanctionData?.roi || "",
              tenureInMonth: finalsanctionData?.tenureInMonth || "",
              finalLoanAmount: finalsanctionData?.finalLoanAmount || ""
            }
          };
        } catch (error) {
          console.error(`Error fetching additional info for customer ${customerId}:`, error);
          return { customerId, additionalInfo: null };
        }
      })
    );
    
    // Helper function to check if data exists and return "Yes" or "No"
    const dataExists = (data) => {
      if (Array.isArray(data)) {
        return data.length > 0 ? "Yes" : "No";
      } else if (typeof data === 'object' && data !== null) {
        return Object.keys(data).length > 0 && Object.values(data).some(val => val) ? "Yes" : "No";
      } else {
        return data ? "Yes" : "No";
      }
    };

    // Prepare the response array
    const allCustomersData = [];
    
    // Process each customer
    for (const customerId of paginatedCustomerIds) {
      try {
        // Get the customer details we already fetched
        const details = customerDetailsMap.get(customerId);
        if (!details) continue;
        
        const vendorFormData = details.vendorFormData;
        
        // Get additional info for this customer
        const customerAdditionalInfo = additionalCustomerInfo.find(
          info => info.customerId.toString() === customerId.toString()
        )?.additionalInfo || {};
        
        const rcuVendor = vendorFormData?.vendors?.find(
          (vendor) => vendor.vendorType === "rcu"
        );
        const legalVendor = vendorFormData?.vendors?.find(
          (vendor) => vendor.vendorType === "legal"
        );
        const technicalVendor = vendorFormData?.vendors?.find(
          (vendor) => vendor.vendorType === "technical"
        );
        const taggingVendor = vendorFormData?.vendors?.find(
          (vendor) => vendor.vendorType === "tagging"
        );
        
        // Continue fetching other data for this customer
        const applicantData   = await applicantModel.findOne({ customerId });
        const coApplicantData = await coApplicantModel.find({ customerId });
        const guarantorData   = await guarantorModel.findOne({ customerId });
        const cibilData       = await cibilModel.findOne({ customerId });
        const creditPdData    = await creditPdModel.findOne({ customerId });
        const gtrPdcData      = await gtrPdcModel.findOne({ customerId });
        const appPdcData      = await appPdcModel.findOne({ customerId });
        const disbursementData = await disbursementModel.findOne({ customerId });
        const loanDocumentData = await loanDocumentModel.findOne({ customerId });
        const SignKycDetails   = await SignKycModel.findOne({ customerId });
        const finalData        = await finalModel.findOne({ customerId });
        
        // Make sure customerId is properly formatted for querying
        const customerObjectId = mongoose.Types.ObjectId.isValid(customerId)
          ? new mongoose.Types.ObjectId(customerId)
          : customerId;
        
        const customerDocumentDetails = await customerDocumentModel.findOne({ 
          customerId: customerObjectId 
        });
        const loanDocument = await loanDocumentModel.findOne({ customerId });
        const bankStatementData = await bankStatementModel.findOne({ customerId });

        let links = (finalData?.signEsignLink && Object.keys(finalData.signEsignLink).length > 0)
          ? finalData.signEsignLink
          : finalData?.esignLinks;

        // Function to extract all income source photos
        const extractIncomeSourcePhotos = (creditPdData) => {
          const allPhotos = [];
          
          if (creditPdData?.incomeSource && Array.isArray(creditPdData.incomeSource)) {
            creditPdData.incomeSource.forEach(source => {
              // Extract agriculture photos
              if (source.agricultureBusiness?.agriculturePhotos && Array.isArray(source.agricultureBusiness.agriculturePhotos)) {
                allPhotos.push(...source.agricultureBusiness.agriculturePhotos);
              }
              
              // Extract milk business photos
              if (source.milkBusiness) {
                if (source.milkBusiness.milkPhotos && Array.isArray(source.milkBusiness.milkPhotos)) {
                  allPhotos.push(...source.milkBusiness.milkPhotos);
                }
                if (source.milkBusiness.animalPhotos && Array.isArray(source.milkBusiness.animalPhotos)) {
                  allPhotos.push(...source.milkBusiness.animalPhotos);
                }
              }
              
              // Extract salary income photos
              if (source.salaryIncome) {
                if (source.salaryIncome.last3MonthSalarySlipPhotos && Array.isArray(source.salaryIncome.last3MonthSalarySlipPhotos)) {
                  allPhotos.push(...source.salaryIncome.last3MonthSalarySlipPhotos);
                }
                if (source.salaryIncome.salaryPhotos && Array.isArray(source.salaryIncome.salaryPhotos)) {
                  allPhotos.push(...source.salaryIncome.salaryPhotos);
                }
                if (source.salaryIncome.bankStatementPhoto) {
                  allPhotos.push(source.salaryIncome.bankStatementPhoto);
                }
                if (source.salaryIncome.salaryCredited6Month) {
                  allPhotos.push(source.salaryIncome.salaryCredited6Month);
                }
              }
              
              // Extract other business photos
              if (source.other?.incomeOtherImages && Array.isArray(source.other.incomeOtherImages)) {
                allPhotos.push(...source.other.incomeOtherImages);
              }
            });
          }
          
          // Remove duplicates and filter out empty values
          return [...new Set(allPhotos)].filter(photo => photo);
        };

        // Extract income source photos
        const incomeSourcePhotos = extractIncomeSourcePhotos(creditPdData);
        
        // Construct customer data object with Yes/No indicators
        const customerData = {
          customerId: customerId.toString(),
          customerFinId: customerAdditionalInfo.customerFinId || "",
          customerName: applicantData?.fullName || "",
          mobileNo: customerAdditionalInfo.mobileNo || applicantData?.mobileNo || "",
          customerFatherName: customerAdditionalInfo.customerFatherName || applicantData?.fatherName || "",
          loginDate: customerAdditionalInfo.loginDate || "",
          branchName: customerAdditionalInfo.branchName || "",
          productName: customerAdditionalInfo.productName || "",
          partnerName: customerAdditionalInfo.partnerName || "",
          regionalBranchName: customerAdditionalInfo.regionalBranchName || "",
          salesPersonName: customerAdditionalInfo.salesPersonName || "",
          salesPersonManagerName: customerAdditionalInfo.salesPersonManagerName || "",
          pdPersonName: customerAdditionalInfo.pdPersonName || "",
          creditPdCompleteDate: customerAdditionalInfo.creditPdCompleteDate || vendorFormData?.creditPdCompleteDate || "",
          statusByCreditPd: customerAdditionalInfo.statusByCreditPd || vendorFormData?.statusByCreditPd || "",
          roi: customerAdditionalInfo.roi || "",
          tenureInMonth: customerAdditionalInfo.tenureInMonth || "",
          finalLoanAmount: customerAdditionalInfo.finalLoanAmount || "",
          SanctionCheckList: {
            // Login check list
            utilityBillDocument: dataExists(customerDocumentDetails?.incomeDocument?.utilityBillDocument),
            familyCardDocument: dataExists(customerDocumentDetails?.incomeDocument?.familyCardDocument),
            udyamCertificate: dataExists(customerDocumentDetails?.incomeDocument?.udyamCertificateDocument),
            bankStatement: dataExists(customerDocumentDetails?.incomeDocument?.bankStatementDocument),
            incomeDocument: dataExists(customerDocumentDetails?.incomeDocument?.incomeStatemenDocument),
            propertyDocument: dataExists(customerDocumentDetails?.propertyDocuments?.propertyDocument),
            signApplicantKyc: dataExists(customerDocumentDetails?.signApplicantKyc),
            signCoApplicantKyc: dataExists(customerDocumentDetails?.signCoApplicantKyc),
            signCoTwoApplicantKyc: dataExists(customerDocumentDetails?.signCoTwoApplicantKyc),
            signGurantorKyc: dataExists(customerDocumentDetails?.signGurantorKyc),
            
            electricityBill: dataExists(creditPdData?.utilityBillDocument),
            SamagraId: dataExists(creditPdData?.SSSMPhoto),

            applicantPhoto: dataExists(applicantData?.applicantPhoto),
            coApplicantPhoto: dataExists(coApplicantData[0]?.coApplicantPhoto),
            coApplicantPhotoTwo: dataExists(coApplicantData[1]?.coApplicantPhoto),
            guarantorPhoto: dataExists(guarantorData?.guarantorPhoto),
            applicantKycOsv: dataExists(SignKycDetails?.ApplicantSignDocument),
            coApplicantKycOsv: dataExists(SignKycDetails?.coApplicantSignDocument),
            gurantorKycOsv: dataExists(SignKycDetails?.guarantorSignDocument),
            
            applicantKyc: dataExists({
              applicantAadharFrontImage: applicantData?.kycUpload?.aadharFrontImage || "",
              applicantAadharBackImage: applicantData?.kycUpload?.aadharBackImage || "",
              applicantPanFrontImage: applicantData?.kycUpload?.panFrontImage || "",
              applicantDrivingLicenceImage: applicantData?.kycUpload?.drivingLicenceImage || "",
              applicantVoterIdImage: applicantData?.kycUpload?.voterIdImage || ""
            }),
            
            coApplicantKyc: dataExists({
              coApplicantKycAadharFrontImage: coApplicantData[0]?.kycUpload?.aadharFrontImage || "",
              coApplicantKycAadharBackImage: coApplicantData[0]?.kycUpload?.aadharBackImage || "",
              coApplicantKycDocImage: coApplicantData[0]?.kycUpload?.docImage || ""
            }),
            
            coApplicantKycTwo: dataExists({
              coApplicantKycTwoAadharFrontImage: coApplicantData[1]?.kycUpload?.aadharFrontImage || "",
              coApplicantKycTwoAadharBackImage: coApplicantData[1]?.kycUpload?.aadharBackImage || "",
              coApplicantKycTwoDocImage: coApplicantData[1]?.kycUpload?.docImage || ""
            }),
            
            gurantorKyc: dataExists({
              gurantorAadharFrontImage: guarantorData?.kycUpload?.aadharFrontImage || "",
              gurantorAadharBackImage: guarantorData?.kycUpload?.aadharBackImage || "",
              gurantorDocImage: guarantorData?.kycUpload?.docImage || ""
            }),
            
            applicantCibilReport: dataExists(cibilData?.applicantFetchHistory?.slice(-1)[0]?.cibilReport),
            
            coApplicantCibilReport: dataExists(
              Array.isArray(cibilData?.coApplicantData?.[0]?.coApplicantFetchHistory)
                ? cibilData.coApplicantData[0].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
                : ""
            ),
            
            coApplicantTwoCibilReport: dataExists(
              Array.isArray(cibilData?.coApplicantData?.[1]?.coApplicantFetchHistory)
                ? cibilData.coApplicantData[1].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
                : ""
            ),
            
            guarantorCibilReport: dataExists(cibilData?.guarantorFetchHistory?.slice(-1)[0]?.cibilReport),
            
            pdReport: dataExists(creditPdData?.pdfLink),
            
            rcuReport: dataExists(rcuVendor?.uploadProperty),
            
            legalReport: dataExists(legalVendor?.uploadProperty),
            
            technicalReport: dataExists(technicalVendor?.uploadProperty),
            
            technicalEstimateDocument: dataExists(technicalVendor?.estimateDocument),
            
            taggingReport: dataExists(taggingVendor?.uploadProperty),
            
            housePhotos: dataExists([
              ...(Array.isArray(creditPdData?.fourBoundaryPhotos) ? creditPdData?.fourBoundaryPhotos : [creditPdData?.fourBoundaryPhotos]),
              ...(Array.isArray(creditPdData?.houseInsidePhoto) ? creditPdData?.houseInsidePhoto : [creditPdData?.houseInsidePhoto]),
              ...(Array.isArray(creditPdData?.propertyOtherPhotos) ? creditPdData?.propertyOtherPhotos : [creditPdData?.propertyOtherPhotos]),
              creditPdData?.selfiWithCustomer || "",
              creditPdData?.photoWithLatLong || "",
              creditPdData?.front || "",
              creditPdData?.leftSide || "",
              creditPdData?.rightSide || "",
              creditPdData?.approachRoad || "",
              creditPdData?.mainRoad || "",
              creditPdData?.interiorRoad || "",
              creditPdData?.selfieWithProperty || "",
              creditPdData?.landmarkPhoto || "",
              creditPdData?.latLongPhoto || ""
            ].filter(Boolean)),
            
            workPhotos: dataExists(incomeSourcePhotos),
            
            camReport: dataExists(loanDocument?.camReport),
          },
          disbursmentCheckList: {
            dualNameDeclaration: dataExists(loanDocumentData?.dualNameDeclaration),
            
            dualSignDeclaration: dataExists(loanDocumentData?.dualSignDeclaration),
            
            dualDoBDeclaration: dataExists(loanDocumentData?.dualDoBDeclaration),
            
            applicantPDC: dataExists(appPdcData?.applicantPdcDocument),
            
            guarantorPDC: dataExists(gtrPdcData?.guarantorPdcDocument),
            
            applicantBSV: dataExists(loanDocumentData?.applicantBSV),
            
            guarantorBSV: dataExists(loanDocumentData?.guarantorBSV),
            
            coOwnershipDeed: dataExists(loanDocumentData?.coOwnershipDeed),
            
            eStampUpload: dataExists(
              disbursementData?.estampRequirement?.flatMap(
                (stamp) => stamp.eStampUpload || []
              ) || []
            ),
            
            insuranceForm: dataExists(loanDocumentData?.insuranceForm),
            
            emOrRmDeed: dataExists(loanDocumentData?.emOrRmDeed),
            
            finalLegal: dataExists(legalVendor?.finalLegalUpload),
            
            vettingReport: dataExists(loanDocument?.vettingReport),
            
            nachLink: dataExists(bankStatementData?.Nachlink?.trim() ? bankStatementData.Nachlink : disbursementData?.eNachLinkSentToBranch),
            
            eNachLinkSignUpload: dataExists(disbursementData?.eNachLinkSignUpload),
            
            eSignatureDocuments: dataExists(disbursementData?.eSignatureDocuments),
            
            appKycDocument: dataExists(loanDocument?.appKycDocument),
            
            coAppKycDocument: dataExists(loanDocument?.coAppKycDocument),
            
            stampPdf: dataExists(loanDocumentData?.stampPdf),
            sanctionZipUrl: dataExists(finalData?.sanctionZipUrl),
            disbursementZipUrl: dataExists(finalData?.disbursementZipUrl),
            incomeSectionLatterUrl: dataExists(finalData?.incomesectionLatterUrl),
            esignLinks: dataExists(links)
          }
        };
        
        // Add to the array of all customers data
        allCustomersData.push(customerData);
      } catch (error) {
        console.error(`Error processing customer ${customerId}:`, error);
        // Continue with next customer instead of failing the entire request
        continue;
      }
    }
    
    return success(res, "All Document For Dashboard Successfully", {
      data: allCustomersData,
      pagination: {
        currentPage: page,
        totalPages: Math.ceil(totalCustomers / limit),
        totalCustomers: totalCustomers,
        limit: limit
      }
    });
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
}

const uploadDocuments = async (req, res) => {
  try {
    const { customerId, nachLink } = req.body;
    const fileData = req.files;

    if (!customerId || !fileData) {
      return badRequest(res, "Customer ID and files are required.");
    }

    // Prepare document fields with file paths
    const documentFields = {};
    Object.keys(fileData).forEach((key) => {
      if (fileData[key] && fileData[key][0]) {
        documentFields[key] = fileData[key].map(
          (file) => `uploads/${file.filename}`
        ); // Add 'uploads/' prefix
      }
    });
    // console.log(documentFields,"documentFields")
    // Update or create loanDocumentModel
    try {
      const existingDocument = await loanDocumentModel.findOne({ customerId });
      if (existingDocument) {
        await loanDocumentModel.updateOne(
          { customerId },
          { $set: documentFields }
        );
      } else {
        await loanDocumentModel.create({ customerId, ...documentFields });
      }
    } catch (error) {
      console.error("Error updating loanDocumentModel:", error);
    }

    // Bulk updates for different models
    const modelUpdates = [
      {
        model: disbursementModel,
        field: "eNachLinkSignUpload",
        key: "eNachLinkSignUpload",
      },
      { model: applicantModel, field: "applicantPhoto", key: "applicantPhoto" },
      {
        model: coApplicantModel,
        field: "coApplicantPhoto",
        key: "coApplicantPhoto",
      },
      { model: guarantorModel, field: "guarantorPhoto", key: "guarantorPhoto" },
      {
        model: cibilModel,
        field: "applicantCibilReport",
        key: "applicantCibilReport",
      },
      {
        model: cibilModel,
        field: "guarantorCibilScore",
        key: "guarantorCibilReport",
      },
      {
        //1
        model: customerDocumentModel,
        field: "incomeDocument.utilityBillDocument",
        key: "utilityBillDocument",
      },
      {
        model: customerDocumentModel,
        field: "incomeDocument.familyCardDocument",
        key: "familyCardDocument",
      },
      {
        model: customerDocumentModel,
        field: "incomeDocument.udyamCertificateDocument",
        key: "udyamCertificate",
      },
      {
        model: customerDocumentModel,
        field: "incomeDocument.bankStatementDocument",
        key: "bankStatement",
      },
      {
        model: customerDocumentModel,
        field: "incomeDocument.incomeDocument",
        key: "incomeDocument",
      },
      {
        model: customerDocumentModel,
        field: "incomeDocument.electricityBillPhoto",
        key: "electricityBill",
      },
      {
        model: customerDocumentModel,
        field: "signApplicantKyc",
        key: "signApplicantKyc",
      },
      {
        model: customerDocumentModel,
        field: "signCoApplicantKyc",
        key: "signCoApplicantKyc",
      },
      {
        model: customerDocumentModel,
        field: "signCoTwoApplicantKyc",
        key: "signCoTwoApplicantKyc",
      },
      {
        model: customerDocumentModel,
        field: "signGurantorKyc",
        key: "signGurantorKyc",
      },
      {
        //1
        model: customerDocumentModel,
        field: "propertyDocument.document",
        key: "propertyDocument",
      },
      { model: creditPdModel, field: "samagraIdDocument", key: "SamagraId" },
      { model: creditPdModel, field: "pdfLink", key: "pdReport" },
      { model: creditPdModel, field: "fourBoundaryPhotos", key: "housePhotos" },
      { model: creditPdModel, field: "workPhotos", key: "workPhotos" },
      {
        model: appPdcModel,
        field: "applicantPdcDocument",
        key: "applicantPDC",
      },
      {
        model: gtrPdcModel,
        field: "guarantorPdcDocument",
        key: "guarantorPDC",
      },
    ];

    await Promise.allSettled(
      modelUpdates.map(async ({ model, field, key }) => {
        if (documentFields[key]) {
          try {
            return await model.findOneAndUpdate(
              { customerId },
              { $set: { [field]: documentFields[key] } },
              { upsert: true }
            );
          } catch (error) {
            console.error(
              `Error updating ${field} in ${model.modelName}:`,
              error
            );
          }
        }
      })
    );
    await disbursementModel.findOneAndUpdate(
      { customerId },
      { $set: { eNachLinkSentToBranch: nachLink } },
      { upsert: true, new: true }
    );
    await disbursementModel.findOneAndUpdate(
      { customerId },
      {
        $set: {
          eNachLinkSignUpload: documentFields["eNachLinkSignUpload"]?.[0],
        },
      },
      { upsert: true, new: true }
    );

    await creditPdModel.findOneAndUpdate(
      { customerId },
      { $set: { pdfLink: documentFields["pdReport"]?.[0] } },
      { upsert: true, new: true }
    );
    await applicantModel.findOneAndUpdate(
      { customerId },
      { $set: { applicantPhoto: documentFields["applicantPhoto"]?.[0] } },
      { upsert: true, new: true }
    );

    await guarantorModel.findOneAndUpdate(
      { customerId },
      { $set: { guarantorPhoto: documentFields["guarantorPhoto"]?.[0] } },
      { upsert: true, new: true }
    );
    const bankUpdate = await bankStatementModel.findOneAndUpdate(
      { customerId },
      { $set: { bankStatementDocument: documentFields["bankDetails"] } },
      { upsert: true, new: true }
    );
    // console.log("Bank Statement Update Result:", bankUpdate);
    await cibilModel.findOneAndUpdate(
      { customerId },
      {
        $set: {
          applicantCibilReport: documentFields["applicantCibilReport"],
          "coApplicantData.0.coApplicantCibilReport":
            documentFields["coApplicantCibilReport"],
          "coApplicantData.1.coApplicantCibilReport":
            documentFields["coApplicantTwoCibilReport"],
          // coApplicantCibilReport: documentFields["coApplicantCibilReport"]?.[0],
          guarantorCibilReport: documentFields["guarantorCibilReport"],
        },
      },
      { upsert: true, new: true }
    );

    // Update kycUpload fields for applicants and guarantors
    const applicantUpdate = applicantModel.findOneAndUpdate(
      { customerId },
      {
        $set: {
          "kycUpload.aadharFrontImage":
            documentFields["applicantAadharFrontImage"]?.[0],
          "kycUpload.aadharBackImage":
            documentFields["applicantAadharBackImage"]?.[0],
          "kycUpload.panFrontImage":
            documentFields["applicantPanFrontImage"]?.[0],
          "kycUpload.drivingLicenceImage":
            documentFields["applicantDrivingLicenceImage"]?.[0],
          "kycUpload.voterIdImage":
            documentFields["applicantVoterIdImage"]?.[0],
        },
      },
      { new: true }
    );

    if (documentFields.nachDocument && documentFields.nachDocument.length > 0) {
      const bankDetails = await bankStatementModel.findOne({ customerId });

      if (!bankDetails) {
        throw new Error("Bank details not found.");
      }

      // Find the specific bank detail to update
      const bankDetailToUpdate = bankDetails.bankDetails.find(
        (detail) => detail.E_Nach_Remarks === "true"
      );

      if (!bankDetailToUpdate) {
        return badRequest(
          res,
          "No bank detail found with E_Nach_Remarks = true."
        );
      }

      // Update the `uploadpdf` field for the matched bank detail
      bankDetailToUpdate.uploadpdf = Array.isArray(documentFields.nachDocument)
        ? documentFields.nachDocument.flat()
        : [documentFields.nachDocument]; // Ensure it's a flat array

      await bankDetails.save();
      console.log("NACH document updated successfully.");
    } else {
      console.log("No valid NACH document provided for update.");
    }

    const guarantorUpdate = guarantorModel.findOneAndUpdate(
      { customerId },
      {
        $set: {
          "kycUpload.aadharFrontImage":
            documentFields["gurantorAadharFrontImage"]?.[0],
          "kycUpload.aadharBackImage":
            documentFields["gurantorAadharBackImage"]?.[0],
          "kycUpload.docImage": documentFields["gurantorDocImage"]?.[0],
        },
      },
      { new: true }
    );

    await Promise.allSettled([applicantUpdate, guarantorUpdate]);

    // Update co-applicants
    const existingCoApplicants = await coApplicantModel.find({ customerId });

    const coApplicantUpdate = existingCoApplicants.map((coApplicant, index) => {
      const photoField =
        index === 0
          ? documentFields["coApplicantPhoto"]?.[0]
          : documentFields["coApplicantPhotoTwo"]?.[0];

      return coApplicantModel.findOneAndUpdate(
        { _id: coApplicant._id },
        {
          $set: {
            coApplicantPhoto: photoField,
          },
        },
        { new: true }
      );
    });

    await Promise.allSettled(coApplicantUpdate);

    const coApplicantUpdates = existingCoApplicants.map(
      (coApplicant, index) => {
        const prefix = index === 0 ? "coApplicantKyc" : "coApplicantKycTwo";
        return coApplicantModel.findOneAndUpdate(
          { _id: coApplicant._id },
          {
            $set: {
              "kycUpload.aadharFrontImage":
                documentFields[`${prefix}AadharFrontImage`]?.[0],
              "kycUpload.aadharBackImage":
                documentFields[`${prefix}AadharBackImage`]?.[0],
              "kycUpload.docImage": documentFields[`${prefix}DocImage`]?.[0],
            },
          },
          { new: true }
        );
      }
    );

    await Promise.allSettled(coApplicantUpdates);

    // Vendor reports update
    const vendorReports = [
      { type: "rcu", documents: documentFields["rcuReport"] },
      { type: "legal", documents: documentFields["legalReport"] },
      { type: "technical", documents: documentFields["technicalReport"] },
      { type: "tagging", documents: documentFields["taggingReport"] },
    ];

    const vendorUpdateResults = await Promise.allSettled(
      vendorReports.map(async ({ type, documents }) => {
        if (documents) {
          try {
            // Check if the vendor exists
            const vendor = await externalVendorFormModel.findOne({
              customerId,
              "vendors.vendorType": type,
            });
            if (!vendor) {
              success(res, `Vendor with type ${type} not found`);
              // throw new Error(`Vendor with type ${type} not found`);
            }

            // If vendor exists, proceed with update
            return await externalVendorFormModel.findOneAndUpdate(
              { customerId, "vendors.vendorType": type },
              { $set: { "vendors.$.assignDocuments": documents } },
              { new: true, upsert: true }
            );
          } catch (error) {
            console.error(
              `Error updating vendor ${type} documents:`,
              error.message
            );
            return { error: error.message }; // Return error message in case of failure
          }
        }
      })
    );

    // const vendorUpdateResults = await Promise.allSettled(
    //   vendorReports.map(async ({ type, documents }) => {
    //     if (documents) {
    //       try {
    //         return await externalVendorFormModel.findOneAndUpdate(
    //           { customerId, "vendors.vendorType": type },
    //           {
    //             $set: { "vendors.$.assignDocuments": documents },
    //             $setOnInsert: { customerId, "vendors": [{ vendorType: type, assignDocuments: documents }] }
    //           },
    //           { new: true, upsert: true }
    //         );
    //       } catch (error) {
    //         console.error(`Error updating vendor ${type} documents:`, error);
    //       }
    //     }
    //   })
    // );

    // console.log("Vendor update results:", vendorUpdateResults);

    success(res, "Documents updated successfully.");
    // await finalApprovalSheet(customerId);
  } catch (error) {
    console.error("Unhandled error in uploadDocuments:", error);
    return unknownError(res, error);
  }
};

const newUploadDocuments = async (req,res) => {
  try{
   const { 
    customerId,
    utilityBillDocument,
    familyCardDocument,
    udyamCertificate,
    bankStatement,
    incomeDocument,
    propertyDocument,
    signApplicantKyc,
    signCoApplicantKyc,
    signCoTwoApplicantKyc,
    signGurantorKyc,
    SamagraId,
    applicantPhoto,
    coApplicantPhoto,
    coApplicantPhotoTwo,
    guarantorPhoto,
    applicantKycOsv,
    coApplicantKycOsv,
    gurantorKycOsv,
    applicantAadharFrontImage,
    applicantAadharBackImage,
    applicantPanFrontImage,
    applicantDrivingLicenceImage,
    applicantVoterIdImage,
    coApplicantKycAadharFrontImage,
    coApplicantKycAadharBackImage,
    coApplicantKycDocImage,
    coApplicantKycTwoAadharFrontImage,
    coApplicantKycTwoAadharBackImage,
    coApplicantKycTwoDocImage,
    gurantorAadharFrontImage,
    gurantorAadharBackImage,
    gurantorDocImage,
    applicantCibilReport,
    coApplicantCibilReport,
    coApplicantTwoCibilReport,
    guarantorCibilReport,
    pdReport,
    rcuReport,
    legalReport,
    technicalReport,
    taggingReport,
    housePhotos,
    workPhotos,
    camReport,
    dualNameDeclaration,
    dualSignDeclaration,
    dualDoBDeclaration,
    applicantPDC,
    guarantorPDC,
    applicantBSV,
    guarantorBSV,
    coOwnershipDeed,
    eStampUpload,
    insuranceForm,
    emOrRmDeed,
    vettingReport,
    nachLink,
    eNachLinkSignUpload,
    appKycDocument,
    coAppKycDocument,
    stampPdf,
    sanctionZipUrl,
    disbursementZipUrl,
    eSignatureDocuments,
    form60,
    NewfamilyCardDocument,
    newUdyamCertificate
   } = req.body
   const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");
   const customerDetails = await customerModel.findById(customerId)
   if(!customerDetails){
    return notFound(res , "customer not found")
   }
  //  console.log( req.body,"req.body<><><><><>");
   const loanData = await loanDocumentModel.findOne({ customerId })
   const loanDocumentData = await loanDocumentModel.findOneAndUpdate(
    { customerId },
    {
      $set:{
        dualNameDeclaration : dualNameDeclaration ? dualNameDeclaration : loanData?.dualNameDeclaration,
        dualSignDeclaration : dualSignDeclaration ? dualSignDeclaration : loanData?.dualSignDeclaration,
        dualDoBDeclaration : dualDoBDeclaration ? dualDoBDeclaration : loanData?.dualDoBDeclaration,
        applicantBSV : applicantBSV ? applicantBSV : loanData?.applicantBSV,
        guarantorBSV : guarantorBSV ? guarantorBSV : loanData?.guarantorBSV,
        insuranceForm : insuranceForm ? insuranceForm : loanData?.insuranceForm,
        emOrRmDeed : emOrRmDeed ? emOrRmDeed : loanData?.emOrRmDeed,
        vettingReport : vettingReport ? vettingReport : loanData?.vettingReport,
        // camReport,
        coOwnershipDeed : coOwnershipDeed ? coOwnershipDeed : loanData?.coOwnershipDeed,
        appKycDocument : appKycDocument? appKycDocument: loanData?.appKycDocument,
        coAppKycDocument : coAppKycDocument? coAppKycDocument: loanData?.coAppKycDocument,
        form60 : form60? form60: loanData?.form60,
        insuranceForm : insuranceForm? insuranceForm: loanData?.insuranceForm,
        emOrRmDeed : emOrRmDeed? emOrRmDeed: loanData?.emOrRmDeed,
        vettingReport : vettingReport ? vettingReport : loanData?.vettingReport,
        camReport: camReport? camReport : loanData?.camReport
      }
    },
    {
      new:true,upsert:true
    }
  );
  // console.log(loanDocumentData,"<><>" )
  const customerData = await customerDocumentModel.findOne({ customerId})
  const customerDocumentDetails = await customerDocumentModel.findOneAndUpdate(
    {customerId},
  {
    $set:{
      "incomeDocument.utilityBillDocument": utilityBillDocument ? utilityBillDocument : customerData?.utilityBillDocument,
      "incomeDocument.familyCardDocument":familyCardDocument ? familyCardDocument : customerData?.familyCardDocument,
      "incomeDocument.udyamCertificateDocument":udyamCertificate ? udyamCertificate : customerData?.udyamCertificate,
      "incomeDocument.bankStatementDocument":bankStatement ? bankStatement : customerData?.bankStatement,
      "incomeDocument.incomeStatemenDocument": incomeDocument ?? customerData?.incomeDocument?.incomeStatemenDocument,
      "propertyDocuments.propertyDocument": propertyDocument ? propertyDocument: customerData?.propertyDocument,
      signApplicantKyc:signApplicantKyc ? signApplicantKyc : customerData?.signApplicantKyc,
      signCoApplicantKyc:signCoApplicantKyc ? signCoApplicantKyc : customerData?.signCoApplicantKyc,
      signCoTwoApplicantKyc:signCoTwoApplicantKyc ? signCoTwoApplicantKyc : customerData?.signCoTwoApplicantKyc,
      signGurantorKyc:signGurantorKyc ? signGurantorKyc : customerData?.signGurantorKyc,
    }
  },
  {
    new:true,upsert:true
  }
  );
//  console.log(customerDocumentDetails,"customerDocumentDetails")
  const cibilAllData = await cibilModel.findOne({ customerId })
  const cibilData = await cibilModel.findOneAndUpdate(
    { customerId },
    {
      $set:{
        applicantCibilReport: applicantCibilReport ? applicantCibilReport : cibilAllData?.applicantCibilReport,
        guarantorCibilReport: guarantorCibilReport ? guarantorCibilReport : cibilAllData?.guarantorCibilReport,
        "coApplicantData.0.coApplicantCibilReport": coApplicantCibilReport ? coApplicantCibilReport: cibilAllData?.coApplicantData[0]?.coApplicantCibilReport,
        "coApplicantData.1.coApplicantCibilReport": coApplicantTwoCibilReport ? coApplicantTwoCibilReport: cibilAllData?.coApplicantData[1]?.coApplicantTwoCibilReport,
      }
    },
    {
      new:true,upsert:true
    }
  );

  // console.log(cibilData,"cibilData")
  const applicantData = await applicantModel.findOne({ customerId });
   await applicantModel.findOneAndUpdate(
    { customerId },
    { $set: {
      kycUpload: {
        aadharFrontImage:applicantAadharFrontImage ? applicantAadharFrontImage : applicantData?.kycUpload?.aadharFrontImage ,
        aadharBackImage:applicantAadharBackImage ? applicantAadharBackImage : applicantData?.kycUpload?.aadharBackImage,
        panFrontImage: applicantPanFrontImage ? applicantPanFrontImage : applicantData?.kycUpload?.panFrontImage,
        drivingLicenceImage: applicantDrivingLicenceImage ? applicantDrivingLicenceImage : applicantData?.kycUpload?.drivingLicenceImage,
        voterIdImage: applicantVoterIdImage ? applicantVoterIdImage : applicantData?.kycUpload?.voterIdImage
      }
    }},
    {
      new:true,
      upsert:true
    }
  );

  const guarantorData = await guarantorModel.findOne({ customerId });
   await guarantorModel.findOneAndUpdate(
    { customerId },
    { $set: {
      kycUpload: {
        aadharFrontImage:gurantorAadharFrontImage ? gurantorAadharFrontImage : guarantorData?.kycUpload?.aadharFrontImage ,
        aadharBackImage:gurantorAadharBackImage ? gurantorAadharBackImage : guarantorData?.kycUpload?.aadharBackImage,
        docImage: gurantorDocImage ? gurantorDocImage : guarantorData?.kycUpload?.docImage
      }
    }},
    {
      new:true,
      upsert:true
    }
  );

  const coApplicants = await coApplicantModel.find({ customerId });

  if (coApplicants.length > 0) {
    // Update the first co-applicant
    if (coApplicants[0]) {
      await coApplicantModel.updateOne(
        { _id: coApplicants[0]._id },
        {
          $set: {
            "kycUpload.aadharFrontImage": coApplicantKycAadharFrontImage || coApplicants[0]?.kycUpload?.aadharFrontImage,
            "kycUpload.aadharBackImage": coApplicantKycAadharBackImage || coApplicants[0]?.kycUpload?.aadharBackImage,
            "kycUpload.docImage": coApplicantKycDocImage || coApplicants[0]?.kycUpload?.docImage,
          }
        },
        
      );
    }
  
    // Update the second co-applicant
    if (coApplicants[1]) {
      await coApplicantModel.updateOne(
        { _id: coApplicants[1]._id },
        {
          $set: {
            "kycUpload.aadharFrontImage": coApplicantKycTwoAadharFrontImage || coApplicants[1]?.kycUpload?.aadharFrontImage,
            "kycUpload.aadharBackImage": coApplicantKycTwoAadharBackImage || coApplicants[1]?.kycUpload?.aadharBackImage,
            "kycUpload.docImage": coApplicantKycTwoDocImage || coApplicants[1]?.kycUpload?.docImage,
          }
        }
      );
    }
  }
  

 const appPdcData = await appPdcModel.findOne({ customerId });
 await appPdcModel.findOneAndUpdate(
  { customerId },
  {
    $set:{
      applicantPdcDocument:applicantPDC ? applicantPDC : appPdcData?.applicantPdcDocument
    }
  },
  {
    new:true,
    upsert:true
  }
);

const gtrPdcData = await gtrPdcModel.findOne({ customerId });
 const dd = await gtrPdcModel.findOneAndUpdate(
  { customerId },
  {
    $set:{
      guarantorPdcDocument : guarantorPDC ? guarantorPDC : gtrPdcData?.guarantorPdcDocument
    }
  },
  {
    new:true,
    upsert:true
  }
);


const creditPdData = await creditPdModel.findOne({ customerId });
console.log(pdReport,"pdReportpdReport")
 const ss = await creditPdModel.findOneAndUpdate(
  { customerId },
  {
    $set:{
      pdfLink : pdReport ? pdReport :creditPdData?.pdReport,
      workPhotos : workPhotos ? workPhotos : creditPdData?.workPhotos,
      fourBoundaryPhotos: housePhotos ? housePhotos : creditPdData?.housePhotos,
      "samagraIdDetail.samagraIdDoc": NewfamilyCardDocument 
    }
  },
  {
    new:true,
    upsert:true
  }
);

const udhyamKycData = await udhyamKycModel.findOne({ customerId })
await udhyamKycModel.findOneAndUpdate(
  { customerId },
  {
    $set:{
      udhyamKycDocument : newUdyamCertificate ? newUdyamCertificate :udhyamKycData?.udhyamKycDocument
    }
  },
  {
    new:true,
    upsert:true
  }
);

if(Array.isArray(housePhotos) && housePhotos.length === 0){
  console.log("in if block")
   await creditPdModel.findOneAndUpdate(
    { customerId },
    {
      $set:{
        houseInsidePhoto : [],
        propertyOtherPhotos : [],
        selfiWithCustomer: "",
        photoWithLatLong: "",
        leftSide: "" ,
        front: "",
        rightSide: "",
        approachRoad: "", 
        mainRoad: "",
        interiorRoad: "",
        selfieWithProperty: "",
        landmarkPhoto: "",
        latLongPhoto: ""
      }
    },
    {
      new:true,
      upsert:true
    }
  );
}

const vendorReports = [
  { type: "rcu", documents: rcuReport },
  { type: "legal", documents: legalReport },
  { type: "technical", documents: technicalReport },
  { type: "tagging", documents: taggingReport },
];

const vendorUpdateResults = await Promise.allSettled(
  vendorReports.map(async ({ type, documents }) => {
    if (documents) {
      try {
        // Check if the vendor exists
        const vendor = await externalVendorFormModel.findOne({
          customerId,
          "vendors.vendorType": type,
        });

        if (!vendor) {
          return { error: `Vendor with type ${type} not found` };
        }

        // If vendor exists, update assignDocuments field
        return await externalVendorFormModel.findOneAndUpdate(
          { customerId, "vendors.vendorType": type },
          { $set: { "vendors.$.uploadProperty": documents } },
          { new: true }
        );
      } catch (error) {
        console.error(`Error updating vendor ${type} documents:`, error.message);
        return { error: error.message };
      }
    }
  })
);

const disbursementData = await disbursementModel.findOne({ customerId });
await disbursementModel.findOneAndUpdate(
  { customerId },
  {
    $set:{
      eNachLinkSignUpload : eNachLinkSignUpload ,
      eSignatureDocuments: eSignatureDocuments 
    }
  },
  {
    new:true,
    upsert:true
  }
);


const getPartner = await finalModel.findOne(
  { customerId },
).select('partnerId');


const lender = await lenderModel.findOne({
  _id: getPartner?.partnerId,
  "venders.branch": new ObjectId(customerDetails?.branch),
  "venders.reportType": "technical",
});


return success(res, "document updated Successfully");

  }
  catch (error) {
    console.error("Unhandled error in uploadDocuments:", error);
    return unknownError(res, error);
  }
}

// add loan aditional document
const addLoanDocuments = async (req, res) => {
  const { fileName, customerId, file } = req.body;

  if (!customerId) {
    return badRequest(res, "Customer ID and file data are required.");
  }
  try {
    // Prepare the object to push with 'uploads/' prefix
    const docObjtEntry = {
      name: fileName || "",
      file: file, 
    };

    // Update the document, pushing the new object into the docObjt array,
    // or create a new document if customerId doesn't exist
    const data = await loanDocumentModel.updateOne(
      { customerId },
      { $push: { docObjt: docObjtEntry } },
      { upsert: true } // Create a new document if no match is found
    );

    // Check if a new document was created or an existing document was updated
    const message =
      data.upsertedCount > 0
        ? "New document created successfully."
        : "Document updated successfully.";

     success(res, message);
      await fileProcessSheet(customerId)
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

// update aditional document
const updateDocument = async (req, res) => {
  const { documentId, fileId, fileName } = req.body;
  const fileData = req.file;

  if (!documentId || !fileId || !fileData) {
    return badRequest(res, "Document ID, file ID, and file data are required.");
  }

  try {
    const document = await loanDocumentModel.findOne(
      { _id: documentId, "docObjt._id": fileId },
      { "docObjt.$": 1 }
    );

    if (!document) {
      return notFound(res, "Document or nested file not found.");
    }

    const existingFileName = document.docObjt[0]?.name;

    const data = await loanDocumentModel.updateOne(
      {
        _id: documentId,
        "docObjt._id": fileId,
      },
      {
        $set: {
          "docObjt.$.name": fileName || existingFileName,
          "docObjt.$.file": fileData.filename,
        },
      }
    );

    return success(res, "Document updated successfully.");
  } catch (error) {
    console.error("Error during update:", error);
    return unknownError(res, error);
  }
};

const partnerDocumentRequest = async (req, res) => {
  try {
    const tokenId = new ObjectId(req.Id);
    const { documentName, customerId } = req.body;

    const data = await loanDocumentModel.updateOne(
      { customerId },
      {
        $push: {
          requestedDoc: {
            requestedBy: tokenId,
            name: documentName,
          },
        },
      },
      { new: true }
    );

    return success(res, "Document request sent successfully.");
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const uploadRequestDocument = async (req, res) => {
  try {
    const { customerId, documentId } = req.body;
    const fileData = req.file;

    const data = await loanDocumentModel.updateOne(
      {
        customerId,
        "requestedDoc._id": documentId, // Find the document by its `_id` within `requestedDoc` array
      },
      {
        $set: {
          "requestedDoc.$.file": fileData.filename, // Update the specific `file` field in the array
        },
      }
    );

    return success(res, "Document updated successfully.");
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const requestDocumentList = async (req, res) => {
  try {
    const { customerId } = req.query;

    const data = await loanDocumentModel.findOne({ customerId });

    return success(res, "Document updated successfully.", {
      data: data?.requestedDoc,
    });
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

// const addDocumetsList = async (req, res) => {
//   try {
//     const { customerId } = req.query;
//     const queryDocList = await queryFormModel.find({ customerId })
//     console.log(queryDocList,"queryDocListqueryDocListqueryDocList")
//     const data = await loanDocumentModel.findOne({ customerId });
//     return success(res, "Document updated successfully.", {
//       _id: data?._id,
//       data: data?.docObjt,
//     });
//   } catch (error) {
//     console.error(error);
//     return unknownError(res, error);
//   }
// };

const addDocumetsList = async (req, res) => {
  try {
    const { customerId } = req.query;

    // Fetch and filter data based on `type: "Document"`
    const queryDocList = await queryFormModel.find(
      { customerId, type: "Document" }, // Filter by customerId and type
      { queryDetail: 1, docUpload: 1, _id: 0 } // Project only required fields
    );

    console.log(queryDocList, "Filtered queryDocList");

    const data = await loanDocumentModel.findOne({ customerId });

    // Merge `data` and `queryDocList` into a single array
    const mergedData = [
      ...(data?.docObjt || []).map((item) => ({
        name: item.name,
        file: item.file,
      })),
      ...queryDocList.map((item) => ({
        name: item.queryDetail, // Using `queryDetail` as `name`
        file: item.docUpload,
      })),
    ];

    return success(res, "Document updated successfully.", {
      _id: data?._id,
      items: mergedData, // Combined array in `items`
    });
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const uploadkycDocument = async (req, res) => {
  try {
    const { customerId } = req.body;
    const fileData = req.files;

    if (!customerId || !fileData) {
      return badRequest(res, "Customer ID and files are required.");
    }

    const documentFields = {};
    ["appKycDocument", "coAppKycDocument"].forEach((key) => {
      if (fileData[key] && fileData[key][0]) {
        // Add the 'uploads/' prefix to the filename
        documentFields[key] = `uploads/${fileData[key][0].filename}`;
      }
    });

    if (Object.keys(documentFields).length === 0) {
      return badRequest(
        res,
        "Please provide at least one document: 'appKycDocument' or 'coAppKycDocument'."
      );
    }

    const existingDocument = await loanDocumentModel.findOne({ customerId });

    if (!existingDocument) {
      return badRequest(res, "Customer does not exist.");
    }

    await loanDocumentModel.updateOne({ customerId }, { $set: documentFields });

    return success(res, "Documents updated successfully.");
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const sanctionPendency = async (req, res) => {
  try {
    const {
      customerId,
      queryDetails,
      sanctionDate,
      partnerLoanNo,
      loanAgreementDate,
      partnerCustomerId,
    } = req.body;

    const updateFields = {};
    if (sanctionDate) updateFields.sanctionDate = sanctionDate;
    if (partnerLoanNo) updateFields.partnerLoanNo = partnerLoanNo;
    if (loanAgreementDate) updateFields.loanAgreementDate = loanAgreementDate;
    if (partnerCustomerId) updateFields.partnerCustomerId = partnerCustomerId;

    const sanctionData = await sanctionPendencyModel.findOneAndUpdate(
      { customerId }, // Filter
      {
        $push: { queryDetails: { $each: queryDetails || [] } },
        $set: updateFields,
      },
      { upsert: true, new: true }
    );

    console.log("Sanction pendency details updated:", partnerLoanNo);
    console.log("Sanction pendency details updated:", sanctionDate);
    console.log("Sanction pendency details updated:", loanAgreementDate);
    console.log("Sanction pendency details updated:", partnerCustomerId);

    if (
      partnerLoanNo ||
      sanctionDate ||
      loanAgreementDate ||
      partnerCustomerId
    ) {
      await DissionBox({
        customerId,
        employeeId: req.Id,
        finalSanction: "completed",
      });
    } else {
      await DissionBox({
        customerId,
        employeeId: req.Id, // Replace with dynamic employeeId if required
        finalSanction: "pending",
      });
    }
    const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");

    await finalModel.findOneAndUpdate(
      { customerId },
      { $set: { finalSanctionStatus : "complete",
        finalSanctionStatusDate:todayDate
       } }
    );

    return success(
      res,
      "Sanction pendency details updated successfully",
      sanctionData
    );
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const sanctionPendencyDetails = async (req, res) => {
  try {
    const { customerId } = req.query;
    const sanctionData = await sanctionPendencyModel.findOne({ customerId });
    const loanDocumentData = await loanDocumentModel.findOne({ customerId });

    const data = await disbursementModel.findOne({ customerId });

    const responseData = {
      sanctionPendency: {
        queryDetails: sanctionData?.queryDetails || [],
        sanctionDate: sanctionData?.sanctionDate || "",
        partnerLoanNo: sanctionData?.partnerLoanNo || "",
        loanAgreementDate: sanctionData?.loanAgreementDate || "",
        partnerCustomerId: sanctionData?.partnerCustomerId || "",
      },
      chargesDetails: {
        processingFees: data?.kfsDetails?.processingFees || "",
        documentsCharges: data?.kfsDetails?.documentsCharges || "",
        cersaiCharges: data?.kfsDetails?.cersaiCharges || "",
        insuranceCharges: data?.kfsDetails?.insuranceCharges || "",
        preEmiInterest: data?.kfsDetails?.preEmiInterest || "",
      },
      kfsDetails: {
        benchmarkinterestRate: data?.kfsDetails?.benchmarkinterestRate || "",
        SpreadInterestRate: data?.kfsDetails?.SpreadInterestRate || "",
        annualPercentageRateAprPercentage:
          data?.kfsDetails?.annualPercentageRateAprPercentage || "",
        epi: data?.kfsDetails?.epi || "",
        noOfEpi: data?.kfsDetails?.noOfEpi || "",
      },
      postDisbursementDetails: {
        loanNumber: data?.postDisbursementDetails?.loanNumber || "",
        actualPreEmi: data?.postDisbursementDetails?.actualPreEmi || "",
        dateOfDisbursement:
          data?.postDisbursementDetails?.dateOfDisbursement || "",
        dateOfFirstEmi: data?.postDisbursementDetails?.dateOfFirstEmi || "",
        utrNumberOne: data?.postDisbursementDetails?.utrNumberOne || "",
        utrNumberTwo: data?.postDisbursementDetails?.utrNumberTwo || "",
        disbursementDoneBy:
          data?.postDisbursementDetails?.disbursementDoneBy || "",
        // applicantName: { type: String, default: "" },
        // fatherName: { type: String, default: "" },
      },
      applicantForm: {
        bankName: data?.applicantForm?.bankName || "",
        AccountHolderName: data?.applicantForm?.AccountHolderName || "",
        AccountNumber: data?.applicantForm?.AccountNumber || "",
        IFSCCode: data?.applicantForm?.IFSCCode || "",
        accountType: data?.applicantForm?.accountType || "",
        branchName: data?.applicantForm?.branchName || "",
        remark: data?.applicantForm?.remark || "",
        totalChequeCount: data?.applicantForm?.totalChequeCount || "",
        chequeOne: data?.applicantForm?.chequeOne || "",
        chequeTwo: data?.applicantForm?.chequeTwo || "",
        chequeThree: data?.applicantForm?.chequeThree || "",
        chequeFour: data?.applicantForm?.chequeFour || "",
        chequeFive: data?.applicantForm?.chequeFive || "",
        chequeSix: data?.applicantForm?.chequeSix || "",
        chequeSeven: data?.applicantForm?.chequeSeven || "",
        chequeEight: data?.applicantForm?.chequeEight || "",
        chequeNine: data?.applicantForm?.chequeNine || "",
        chequeTen: data?.applicantForm?.chequeTen || "",
      },
      guarantorForm: {
        guarantorName: data?.guarantorForm?.guarantorName || "",
        bankName: data?.guarantorForm?.bankName || "",
        AccountHolderName: data?.guarantorForm?.AccountHolderName || "",
        AccountNumber: data?.guarantorForm?.AccountNumber || "",
        IFSCCode: data?.guarantorForm?.IFSCCode || "",
        accountType: data?.guarantorForm?.accountType || "",
        branchName: data?.guarantorForm?.branchName || "",
        remark: data?.guarantorForm?.remark || "",
        totalChequeCount: data?.guarantorForm?.totalChequeCount || "",
        chequeOne: data?.guarantorForm?.chequeOne || "",
        chequeTwo: data?.guarantorForm?.chequeTwo || "",
        chequeThree: data?.guarantorForm?.chequeThree || "",
        chequeFour: data?.guarantorForm?.chequeFour || "",
        chequeFive: data?.guarantorForm?.chequeFive || "",
        chequeSix: data?.guarantorForm?.chequeSix || "",
        chequeSeven: data?.guarantorForm?.chequeSeven || "",
        chequeEight: data?.guarantorForm?.chequeEight || "",
        chequeNine: data?.guarantorForm?.chequeNine || "",
        chequeTen: data?.guarantorForm?.chequeTen || "",
      },
      stampPdf: loanDocumentData?.stampPdf || [],
    };

    success(res, "sanction pendency details", responseData);
    await processModel.findOneAndUpdate(
      { customerId },
      { $set: {
        sanctionDetailFromPartner:true
      } },
      { new: true }
  );
  await finalApprovalSheet(customerId)
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const downloadSanctionDocument = async (req, res) => {
  try {
    return success(res, "sanction pendency details", responseData);
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

// const sendToPartnernew = async (req, res) => {
//   try {
//     const { customerId } = req.query;

//     const partnerData = await finalModel.findOne({ customerId });

//     if (!partnerData) {
//       return badRequest(res, "partner's is required.");
//     }
//     const partnerModel = await lendersModel.findOne({
//       _id: partnerData.partnerId,
//     });
//     if (!partnerModel) {
//       return badRequest(res, "Partner not found.");
//     }

//     const normalizedPartnerName = (partnerModel.fullName || "")
//       .trim()
//       .toLowerCase();

//     if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
//       // Ratna logic
//       let selectionData = partnerData?.pdfSelection || "acg";
//       console.log(selectionData, "selectionDataselectionData");
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const sectionData = await sectionLatter(customerId);
//       if (!sectionData) {
//         return badRequest(res, "sectionData not found.");
//       }
//       const applicantData = await applicantLatter(customerId, selectionData);
//       if (!applicantData) {
//         return badRequest(res, "applicantData not found.");
//       }
//       const LdAndPdDeedData = await LdAndPdDeed(customerId, selectionData);
//       if (!LdAndPdDeedData) {
//         return badRequest(res, "LdAndPdDeedData not found.");
//       }

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;
//       console.log(uploadUrl, "uploadUrl");
//       // console.log(uploadUrl,"uploadUrluploadUrl")

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         // console.log("Resolved File Path: ", resolvedPath);
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         // console.log("File Stream: ", fs.existsSync(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         // console.log("Upload Response: ", response.data);

//         return response.data?.items;
//       };

//       // console.log("Section Data Path: ", sectionData);
//       const uploadedSectionUrl = await processFile(sectionData);
//       // console.log("Applicant Data Path: ", applicantData);
//       const uploadedApplicantUrl = await processFile(applicantData);
//       // console.log("LdAndPdDeed Data Path: ", LdAndPdDeedData);
//       const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);

//       return success(res, "pdf urls are", {
//         sectionLatter: `${process.env.BASE_URL}${uploadedSectionUrl.image}`,
//         LdAndPdDeed: `${process.env.BASE_URL}${uploadedLdAndPdDeedUrl.image}`,
//         applicantionLatter: `${process.env.BASE_URL}${uploadedApplicantUrl.image}`,

//         //new upload
//         // sectionLatter: `${uploadedSectionUrl.image}`,
//         // LdAndPdDeed: `${uploadedLdAndPdDeedUrl.image}`,
//         // applicantionLatter: `${uploadedApplicantUrl.image}`,
//       });
//     } else if (normalizedPartnerName === "fin coopers capital pvt ltd") {
//       // Fin Cooper logic with selection handling
//       let selectionData = partnerData?.pdfSelection || "acg";
//       console.log(selectionData, "selectionDataselectionData");
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const logo = FinpdfLogo;

//       const pdfFunctions = {
//         growSanctionLetterPdf,
//         growApplicantPdf,
//         growPgDeedPdf,
//         rcplLoanAgreement,
//       };

//       const pdfData = {};
//       for (const [key, func] of Object.entries(pdfFunctions)) {
//         const pdfResult = await func(
//           customerId,
//           logo,
//           partnerModel.fullName,
//           selectionData // Pass selection to all functions
//         );
//         pdfData[key] = pdfResult;
//       }

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedUrls = {};
//       for (const [key, data] of Object.entries(pdfData)) {
//         const uploadedUrl = await processFile(data);
//         // Replace "grow" or "rcpl" with "fincooper" in the URL
//         let processedUrl = `${process.env.BASE_URL}${uploadedUrl.image}`;
//         // processedUrl = processedUrl.replace(/grow|rcpl/gi, "fincooper");
//         const newKey = key.replace(/grow|rcpl/gi, "fincooper");

//         uploadedUrls[newKey] = processedUrl;
//       }

//       return success(res, "pdf urls are", uploadedUrls);
//     } else if (normalizedPartnerName === "grow money capital pvt ltd") {
//       // Grow Money logic with selection handling
//       let selectionData = partnerData?.pdfSelection || "acg";
//       console.log(selectionData, "selectionDataselectionData");
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const partnerLogo = growPdfLogo;

//       const pdfFunctions = {
//         growSanctionLetterPdf,
//         growApplicantPdf,
//         growPgDeedPdf,
//         rcplLoanAgreement,
//       };

//       const pdfData = {};
//       for (const [key, func] of Object.entries(pdfFunctions)) {
//         const pdfResult = await func(
//           customerId,
//           partnerLogo,
//           partnerModel.fullName,
//           selectionData // Pass selection to all functions
//         );
//         pdfData[key] = pdfResult;
//       }

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedUrls = {};
//       for (const [key, data] of Object.entries(pdfData)) {
//         const uploadedUrl = await processFile(data);
//         uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
//       }

//       return success(res, "pdf urls are", uploadedUrls);
//     } else {
//       return badRequest(res, `Unsupported partner: ${partnerModel.fullName}`);
//     }
//   } catch (error) {
//     console.error(error);
//     return unknownError(res, error);
//   }
// };

const sendToPartnernew = async (req, res) => {
  try {
    // const { customerId } = req.query;
    const customerId = req.query.customerId?.trim();



    
    const partnerData = await finalModel.findOne({ customerId });
    //bankStatementModel

    const applicant = await applicantModel.findOne({ customerId });
    const coapplicant = await coApplicantModel.findOne({ customerId });
    const secondRecord = await coApplicantModel.findOne({ customerId }).sort({ createdAt: 1 }).skip(1);

    const cibilData = await cibilModel.findOne({ customerId });
    const customerDetails = await customerModel.findById({ _id: (customerId) });

    const technicalData = await technicalApproveFormModel.findOne({ customerId });

  const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    
   console.log(secondRecord,"secondRecord")
    const gauranter = await guarantorModel.findOne({ customerId });

    const bankData = await bankStatementModel.findOne({ customerId });
    //disbursementModel
    const kfsData = await disbursementModel.findOne({ customerId });
//sanctionPendencyModel
const sanctionPendencyData = await sanctionPendencyModel.findOne({ customerId });

  const branchUdhyam = await   udyamModel.findOne({ customerId });


 
    if (!partnerData) {
      return badRequest(res, "partner's is required.");
    }

    const partnerModel = await lendersModel.findOne({
      _id: partnerData.partnerId,
    });
    if (!partnerModel) {
      return badRequest(res, "Partner not found.");
    }

    const normalizedPartnerName = (partnerModel.fullName || "")
      .trim()
      .toLowerCase();

    //       console.log("Customer ID:", customerId);
    // console.log("Partner Data:", partnerData);
    // console.log("Partner Model:", partnerModel);
    console.log("Normalized Partner Name:", normalizedPartnerName);

    if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
      let selectionData = partnerData?.pdfSelection || "acg";
      if (!selectionData || typeof selectionData !== "string") {
        selectionData;
      }

      const sectionData = await sectionLatter(customerId);
      if (!sectionData) {
        return badRequest(res, "sectionData not found.");
      }
      const applicantData = await applicantLatter(customerId, selectionData);
      if (!applicantData) {
        return badRequest(res, "applicantData not found.");
      } 
      const LdAndPdDeedData = await LdAndPdDeed(customerId, selectionData);
      if (!LdAndPdDeedData) {
        return badRequest(res, "LdAndPdDeedData not found.");
      }

      // const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

      // const processFile = async (filePath) => {
      //   const resolvedPath = path
      //     .resolve(__dirname, `../../../..${filePath}`)
      //     .replace(/\\/g, "/");
      //   const formData = new FormData();
      //   formData.append("image", fs.createReadStream(resolvedPath));
      //   const response = await axios.post(uploadUrl, formData, {
      //     headers: { ...formData.getHeaders() },
      //   });
      //   return response.data?.items;
      // };

      // const uploadedSectionUrl = await processFile(sectionData);
      // const uploadedApplicantUrl = await processFile(applicantData);
      // const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);

      // const ratnaPdfUrls = {
      //   sectionLatter: `${process.env.BASE_URL}${uploadedSectionUrl.image}`,
      //   LdAndPdDeed: `${process.env.BASE_URL}${uploadedLdAndPdDeedUrl.image}`,
      //   applicantionLatter: `${process.env.BASE_URL}${uploadedApplicantUrl.image}`,
      // };

      // // Save the URLs to the customer model
      // await newfinalSanctionModel.findOneAndUpdate(
      //   { customerId },
      //   { $set: { ratnaPdfUrls: ratnaPdfUrls } },
      //   { new: true, upsert: true }
      // );

      return success(res, "pdf urls are", {
        ...sectionData,
        ...LdAndPdDeedData,
        ...applicantData,
      });
    } else if (normalizedPartnerName === "fin coopers capital pvt ltd") {
      let selectionData = partnerData?.pdfSelection || "acg";
      if (!selectionData || typeof selectionData !== "string") {
        selectionData;
      }

      console.log(selectionData,"selectionDataselectionData")
      const partnerLogo = FinpdfLogo;
      partnerName=partnerModel.fullName
      console.log(partnerName,"partnerName")

      const sectionData = await FincooperSanctionLetterPdf(customerId,partnerLogo,partnerName);
      if (!sectionData) {
        return badRequest(res, "sectionData not found.");
      }
      const applicantData = await FincooperApplicantionPdf(customerId,partnerLogo,partnerName);
      if (!applicantData) {
        return badRequest(res, "applicantData not found.");
      }
      const LdAndPdDeedData = await FincooperLoanAgreement(customerId,partnerLogo,partnerName, selectionData,);
      if (!LdAndPdDeedData) {
        return badRequest(res, "LdAndPdDeedData not found.");
      }
      const PdDeedData = await FincooperPgDeedPdf(customerId,partnerLogo,partnerName);
      if (!PdDeedData) {
        return badRequest(res, "LdAndPdDeedData not found.");
      }

      // const pdfFunctions = {
      //   growSanctionLetterPdf,
      //   growApplicantPdf,
      //   growPgDeedPdf,
      //   rcplLoanAgreement,
      // };

      // const pdfData = {};
      // for (const [key, func] of Object.entries(pdfFunctions)) {
      //   const pdfResult = await func(
      //     customerId,
      //     partnerLogo,
      //     partnerModel.fullName,
      //     selectionData
      //   );
      //   pdfData[key] = pdfResult;
      // }

      // const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

      // const processFile = async (filePath) => {
      //   const resolvedPath = path
      //     .resolve(__dirname, `../../../..${filePath}`)
      //     .replace(/\\/g, "/");
      //   const formData = new FormData();
      //   formData.append("image", fs.createReadStream(resolvedPath));
      //   const response = await axios.post(uploadUrl, formData, {
      //     headers: { ...formData.getHeaders() },
      //   });
      //   return response.data?.items;
      // };

      // const uploadedUrls = {};
      // for (const [key, data] of Object.entries(pdfData)) {
      //   const uploadedUrl = await processFile(data);
      //   uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
      // }

      // // Save the URLs to the customer model
      // await newfinalSanctionModel.findOneAndUpdate(
      //   { customerId },
      //   { $set: { growMoneyPdfUrls: uploadedUrls } },
      //   { new: true, upsert: true }
      // );

      return success(res, "pdf urls are", {
        ...applicantData,
        ...sectionData,
        ...LdAndPdDeedData,
        ...PdDeedData
      });
    } else if (normalizedPartnerName === "grow money capital pvt ltd") {
      let selectionData = partnerData?.pdfSelection || "acg";
      if (!selectionData || typeof selectionData !== "string") {
        selectionData;
      }

      console.log(selectionData,"selectionDataselectionData")

      const partnerLogo = growPdfLogo;
      partnerName=partnerModel.fullName
      console.log(partnerName,"partnerName")

      const sectionData = await growSanctionLetterPdf(customerId,partnerLogo,partnerName);
      if (!sectionData) {
        return badRequest(res, "sectionData not found.");
      }
      const applicantData = await growApplicantPdf(customerId,partnerLogo,partnerName);
      if (!applicantData) {
        return badRequest(res, "applicantData not found.");
      }
      const LdAndPdDeedData = await rcplLoanAgreement(customerId,partnerLogo,partnerName, selectionData,);
      if (!LdAndPdDeedData) {
        return badRequest(res, "LdAndPdDeedData not found.");
      }
      const PdDeedData = await growPgDeedPdf(customerId,partnerLogo,partnerName);
      if (!PdDeedData) {
        return badRequest(res, "LdAndPdDeedData not found.");
      }

      // const pdfFunctions = {
      //   growSanctionLetterPdf,
      //   growApplicantPdf,
      //   growPgDeedPdf,
      //   rcplLoanAgreement,
      // };

      // const pdfData = {};
      // for (const [key, func] of Object.entries(pdfFunctions)) {
      //   const pdfResult = await func(
      //     customerId,
      //     partnerLogo,
      //     partnerModel.fullName,
      //     selectionData
      //   );
      //   pdfData[key] = pdfResult;
      // }

      // const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

      // const processFile = async (filePath) => {
      //   const resolvedPath = path
      //     .resolve(__dirname, `../../../..${filePath}`)
      //     .replace(/\\/g, "/");
      //   const formData = new FormData();
      //   formData.append("image", fs.createReadStream(resolvedPath));
      //   const response = await axios.post(uploadUrl, formData, {
      //     headers: { ...formData.getHeaders() },
      //   });
      //   return response.data?.items;
      // };

      // const uploadedUrls = {};
      // for (const [key, data] of Object.entries(pdfData)) {
      //   const uploadedUrl = await processFile(data);
      //   uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
      // }

      // // Save the URLs to the customer model
      // await newfinalSanctionModel.findOneAndUpdate(
      //   { customerId },
      //   { $set: { growMoneyPdfUrls: uploadedUrls } },
      //   { new: true, upsert: true }
      // );

      return success(res, "pdf urls are", {
        ...applicantData,
        ...sectionData,
        ...LdAndPdDeedData,
        ...PdDeedData
      });
    } else if (normalizedPartnerName === "namdev finvest pvt ltd") {
      let selectionData = partnerData?.pdfSelection || "acg";
      if (!selectionData || typeof selectionData !== "string") {
        selectionData;
      }


      // Fetch section letter, applicant letter, and LD/PD deed
      const sectionData = await namdevSectionLatter(customerId);
      if (!sectionData) {
        return badRequest(res, "Section Data not found.");
      }
      const applicantData = await namDevApplicantLatter(
        customerId,
        selectionData
      );
      if (!applicantData) {
        return badRequest(res, "Applicant Data not found.");
      }
      const loanData = await namdevLoanPdf(customerId);
      if (!sectionData) {
        return badRequest(res, "loan Data not found.");
      }

      // const namdevpdfUrls={
      //   sectionData,
      //   applicantData ,
      // }
      // console.log(namdevpdfUrls,"namdevpdfUrls")
      // const updatedDocument = await newfinalSanctionModel.findOneAndUpdate(
      //   { customerId },
      //   { $set: { "naamDevPdfUrls.sectionData": sectionData, "naamDevPdfUrls.applicantData": applicantData } },        { new: true, upsert: true }
      // );

      // if (!updatedDocument) {
      //   return badRequest(res, "Failed to update Namdev PDF URLs.");
      // }
      
      // console.log(updatedDocument, "Updated Document");

      
      return success(res, "PDF URLs are", {
        ...sectionData,
        // ...loanData,
        ...applicantData ,
      });
    } else {
      return badRequest(res, `Unsupported partner: ${partnerModel.fullName}`);
    }
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};


const PartnerValidation = async (req,res)=>{
  try {
    const { customerId } = req.query;


    
    const partnerData = await finalModel.findOne({ customerId });
    //bankStatementModel

    const applicant = await applicantModel.findOne({ customerId });
    const coapplicant = await coApplicantModel.findOne({ customerId });
    const secondRecord = await coApplicantModel.findOne({ customerId }).sort({ createdAt: 1 }).skip(1);

    const cibilData = await cibilModel.findOne({ customerId });
    const customerDetails = await customerModel.findById({ _id: (customerId) });

    const technicalData = await technicalApproveFormModel.findOne({ customerId });

  const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    
   console.log(secondRecord,"secondRecord")
    const gauranter = await guarantorModel.findOne({ customerId });

    const bankData = await bankStatementModel.findOne({ customerId });
    //disbursementModel
    const kfsData = await disbursementModel.findOne({ customerId });
//sanctionPendencyModel
const sanctionPendencyData = await sanctionPendencyModel.findOne({ customerId });

  const branchUdhyam = await   udyamModel.findOne({ customerId });




    
    const bankStatementrequiredFields = [
      "bankName",
      "accountNumber",
      "acHolderName",
      "ifscCode",
      "branchName",
      "accountType",
    ];

    const chargesrequiredFields = [
      "processingFees",
      "documentsCharges",
      "insuranceCharges",
      "cersaiCharges",
      // "preEmiInterest",
      "benchmarkinterestRate",
      "SpreadInterestRate",
      "annualPercentageRateAprPercentage",
      "epi",
      "noOfEpi"
    ];
    
//----------------------------------------Applicant validation ----------------------------
    const applicantrequiredFields = [
      "applicantPhoto",
      "aadharNo",
      "panNo",
      "fullName",
      "fatherName",
      "motherName",
      "gender",
      "mobileNo",
      "maritalStatus",
      "email",
      "dob",
      "age",
      "religion",
      "education",
      "category",
      "voterIdNo",
      "applicantType",
      "businessType",
      "occupation",
      "alternateMobileNo",
      "noOfyearsAtCurrentAddress",
      "noOfDependentWithCustomer",
      "residenceType"

    ];

    const ApplicantAdressrequiredFields = [
      "addressLine1",
      "addressLine2",
      "city",
      "state",
      "district",
      "pinCode"
    ];


    const errors = []; 
  
   applicantrequiredFields.forEach((field) => {
      if (!applicant?.[field] || String(applicant[field]).trim() === "") {
        errors.push(`Applicant ${field} is required.`);
      }
    });

    ApplicantAdressrequiredFields.forEach((field) => {
      if (!applicant?.localAddress?.[field] || String(applicant?.localAddress[field]).trim() === "") {
        errors.push(`Applicant ${field} is required.`);
      }
    });

    //----------------------------Co Applicant Validation---------------------------------
    const coapplicantrequiredFields = [
      "coApplicantPhoto",
      "aadharNo",
      "docType",
      "docNo",
      "fullName",
      "fatherName",
      "motherName",
      "gender",
      "mobileNo",
      "maritalStatus",
      "email",
      "dob",
      "age",
      "religion",
      "education",
      "category",
      "coApplicantType",
      "businessType",
      "occupation",
      "alternateMobileNo",
      "noOfyearsAtCurrentAddress",      
      "residenceType"

    ];

    const coApplicantAdressrequiredFields = [
      "addressLine1",
      "addressLine2",
      "city",
      "state",
      "district",
      "pinCode"
    ];


    
   coapplicantrequiredFields.forEach((field) => {
      if (!coapplicant?.[field] || String(coapplicant[field]).trim() === "") {
        errors.push(`CoApplicant-1 ${field} is required.`);
      }
    });

    coApplicantAdressrequiredFields.forEach((field) => {
      if (!coapplicant?.localAddress?.[field] || String(coapplicant?.localAddress[field]).trim() === "") {
        errors.push(`CoApplicant-1 ${field} is required.`);
      }
    });

    //----------------------coaPPLIcant 2 ---------------------------

    if (partnerData?.pdfSelection === "accg" || partnerData?.pdfSelection === "acc") {
      coApplicantAdressrequiredFields.forEach((field) => {
        if (!secondRecord?.localAddress?.[field] || String(secondRecord?.localAddress[field]).trim() === "") {
          errors.push(`CoApplicant-2 ${field} is required.`);
        }
      });
      }

      if (partnerData?.pdfSelection === "accg" || partnerData?.pdfSelection === "acc") {
        coapplicantrequiredFields.forEach((field) => {
          if (!secondRecord?.[field] || String(secondRecord[field]).trim() === "") {
            errors.push(`CoApplicant-2 ${field} is required.`);
          }
        });
        }

        //----------------------------Gauranter Validation---------------------------------
    const GauranterRequiredFields = [
      "guarantorPhoto",
      "aadharNo",
      "docType",
      "docNo",
      "fullName",
      "fatherName",
      "motherName",
      "gender",
      "mobileNo",
      "maritalStatus",
      "email",
      "dob",
      "age",
      "religion",
      "education",
      "category",
      "guarantorType",
      "businessType",
      "occupation",
      "alternateMobileNo",
      "noOfyearsAtCurrentAddress",
      "residenceType"

    ];

    const gauranterrequiredFields = [
      "addressLine1",
      "addressLine2",
      "city",
      "state",
      "district",
      "pinCode"
    ];

    // GauranterRequiredFields.forEach((field) => {
    //   if (!gauranter?.[field] || String(gauranter[field]).trim() === "") {
    //     errors.push(`Gauranter ${field} is required.`);
    //   }
    // });

    // gauranterrequiredFields.forEach((field) => {
    //   if (!gauranter?.localAddress?.[field] || String(gauranter?.localAddress[field]).trim() === "") {
    //     errors.push(`Gauranter ${field} is required.`);
    //   }
    // });

    ///condi

    if (partnerData?.pdfSelection === "accg" || partnerData?.pdfSelection === "acg") {
      GauranterRequiredFields.forEach((field) => {
        if (!gauranter?.[field] || String(gauranter[field]).trim() === "") {
          errors.push(`Gauranter ${field} is required.`);
        }
      });
      }

      if (partnerData?.pdfSelection === "accg" || partnerData?.pdfSelection === "acg") {
        gauranterrequiredFields.forEach((field) => {
          if (!gauranter?.localAddress?.[field] || String(gauranter?.localAddress[field]).trim() === "") {
            errors.push(`Gauranter ${field} is required.`);
          }
        });
        }


    //--------------------udhyam details ------------------------


    const requiredFieldsMap = {
      branchUdhyam: [
        "udhyamRegistrationNo",
        "OrganisationName",
        "typeOfOrganisation",
        "natureOfBusiness",
        "MsmeClassification",
      ],
      "branchUdhyam.AddressOfFirm": [
        "fullAddress",
        "landmark",
        "city",
        "districtName",
        "state",
        "pinCode",
        "mobileNumber",
        "emailId",
      ],
    };
    
    Object.entries(requiredFieldsMap).forEach(([path, fields]) => {
      fields.forEach((field) => {
        const value = path.split('.').reduce((obj, key) => obj?.[key], { branchUdhyam });
        if (!value?.[field] || String(value[field]).trim() === "") {
          errors.push(`Udhyam ${field} is required.`);
        }
      });
    });

    //--------------------------final sanction details----------------------
    
    const finalSanctionrequiredFields ={
      partnerData:[
      "EndUseOfLoan",
      "finalLoanAmount",
      "loanAmountInWords",
      "tenureInMonth",
      "roi",
      "emiAmount",
      "emiCycle",
    
    ]
    
  };

    Object.entries(finalSanctionrequiredFields).forEach(([path, fields]) => {
      fields.forEach((field) => {
        const value = path.split('.').reduce((obj, key) => obj?.[key], { partnerData });
        if (!value?.[field] || String(value[field]).trim() === "") {
          errors.push(`Final Sanction ${field} field is required.`);
        }
      });
    });

     if (!partnerData?.netCalculationNew?.overAllTotalNetMonthlyIncome || partnerData?.netCalculationNew?.overAllTotalNetMonthlyIncome === "") {
      errors.push("Final Sanction totalNetMonthlyIncome is required.");
    }

    if (!partnerData?.netCalculationNew?.foir || partnerData?.netCalculationNew?.foir === "") {
      errors.push("Final Sanction foir is required.");
    }

    
    const propertyPaperrequiredFields ={
      technicalData:[
      // "nameOfDocumentHolder",
      // "fatherName",
      "relationWithApplicant",
      "fullAddressOfProperty",
      "propertyType",
      "totalLandArea",
      "fairMarketValueOfLand",
      "propertyAge"
    ]
  };


    Object.entries(propertyPaperrequiredFields).forEach(([path, fields]) => {
      fields.forEach((field) => {
        const value = path.split('.').reduce((obj, key) => obj?.[key], { technicalData });
        if (!value?.[field] || String(value[field]).trim() === "") {
          errors.push(`property Details ${field} field is required.`);
        }
      });
    });


    //-------------applicant bank details and cheque --------------------------
    const bankKycsDetails = await bankDeatilsKycs.findOne({ customerId });
    const bankDetail = bankKycsDetails?.bankDetails?.find(
      (detail) => detail.E_Nach_Remarks === "true"
    ) || {};
   
    const bankRequiredFields = ["bankName", "accNo","ifsc","branchName","accountType","cheque1","cheque2","cheque3","cheque4","cheque5"];

    const bankDetails = {
      bankName: bankDetail?.bankName ,
      accNo: bankDetail?.accountNumber,
      ifsc: bankDetail?.ifscCode,
      branchName: bankDetail?.branchName,
      accountType: bankDetail?.accountType,
      cheque1: bankDetail?.chequeDetail?.[0],
      cheque2: bankDetail?.chequeDetail?.[1],
      cheque3: bankDetail?.chequeDetail?.[2],
      cheque4: bankDetail?.chequeDetail?.[3],
      cheque5: bankDetail?.chequeDetail?.[4]
    };
    
    bankRequiredFields.forEach((field) => {
      if (!bankDetails[field] || String(bankDetails[field]).trim() === "") {
        errors.push(`Bank Applicant ${field} is required.`);
      }
    });


    //------------------------------sanction Pendency details --------------------

    const partnerModel = await lendersModel.findOne({
      _id: partnerData.partnerId,
    });
    if (!partnerModel) {
      // return badRequest(res, "Partner not found.");
      errors.push(`Partner data is required.`);
    }
    const sanctionPendencyrequiredFields = [
      "sanctionDate",
      "partnerLoanNo",
      "loanAgreementDate",
      "partnerCustomerId",
    ];


if (errors.length > 0) {
  return badRequestwitherror(res, `Failed to generate partner PDF`, errors,); 
}

    success(res, `Validation successful. No errors found.`);

    const normalizedPartnerName = (partnerModel.fullName || "")
      .trim()
      .toLowerCase();

    //       console.log("Customer ID:", customerId);
    // console.log("Partner Data:", partnerData);
    // console.log("Partner Model:", partnerModel);
    console.log("Normalized Partner Name:", normalizedPartnerName);

   
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
}

// const sendEmailToPartner = async (req, res) => {
//   try {
//     const { customerId, selections } = req.query;

//     const partnerData = await finalModel.findOne({ customerId });

//     if (!partnerData) {
//       return badRequest(res, "partner is required.");
//     }

//     const partnerModel = await lendersModel.findOne({
//       _id: partnerData.partnerId,
//     });
//     if (!partnerModel) {
//       return badRequest(res, "Partner not found.");
//     }

//     const normalizedPartnerName = (partnerModel.fullName || "")
//       .trim()
//       .toLowerCase();

//     if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
//       // Ratna logic
//       let selectionData = partnerData?.pdfSelection || "acg";
//       // console.log(selectionData,"selectionDataselectionData")
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const sectionData = await sectionLatter(customerId);

//       const applicantData = await applicantLatter(customerId, selectionData);

//       const LdAndPdDeedData = await LdAndPdDeed(customerId, selectionData);

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         console.log("Resolved File Path: ", resolvedPath);
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));

//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedSectionUrl = await processFile(sectionData);
//       const uploadedApplicantUrl = await processFile(applicantData);
//       const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);
//       const BASEURL = process.env.BASE_URL;
//       // Attachments for the email
//       const attachments = [
//         {
//           path: `${BASEURL}${uploadedSectionUrl.image}`,
//           contentType: "sanction/pdf",
//         },
//         {
//           path: `${BASEURL}${uploadedApplicantUrl.image}`,
//           contentType: "application/pdf",
//         },
//         {
//           path: `${BASEURL}${uploadedLdAndPdDeedUrl.image}`,
//           contentType: "ldAndPdDeed/pdf",
//         },
//       ];

//       const emailContent = `
//       <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//         <p>Dear Sir,</p>
//         <p>Caption case Report is for final approval.</p>
//         <p>Need your immediate action in this case.</p>
//         <p>Regards,</p>
//         <p>Team FinCoopers</p>
//         <div>All PDFs are attached in this email.</div>
//       </div>
//     `;
//       // Sending email with eSign links in the email body
//       await sendEmail(
//         [partnerModel.sanctionEmailTo],
//         ["raikwar@yopmail.com"],
//         `Final approval email for review`,
//         emailContent,
//         attachments
//       );

//       return success(res, "Email sent successfully");
//     } else if (normalizedPartnerName === "grow money capital pvt ltd") {
//       // Grow Money logic
//       const partnerLogo = growPdfLogo;
//       let selectionData = partnerData?.pdfSelection || "acg";
//       console.log(selectionData, "selectionDataselectionData");
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const pdfFunctions = {
//         growSanctionLetterPdf,
//         growApplicantPdf,
//         growPgDeedPdf,
//         rcplLoanAgreement,
//       };

//       const pdfData = {};
//       for (const [key, func] of Object.entries(pdfFunctions)) {
//         const pdfResult = await func(
//           customerId,
//           partnerLogo,
//           partnerModel.fullName,
//           selectionData
//         );
//         pdfData[key] = pdfResult;
//       }

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedUrls = {};
//       for (const [key, data] of Object.entries(pdfData)) {
//         const uploadedUrl = await processFile(data);
//         uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
//       }
//       // console.log(uploadedUrls, "uploadedUrlsuploadedUrls");
//       const attachments = [
//         {
//           path: uploadedUrls?.growSanctionLetterPdf,
//           contentType: "growSanctionLetterPdf/pdf",
//         },
//         {
//           path: uploadedUrls?.growApplicantPdf,
//           contentType: "growApplicantPdf/pdf",
//         },
//         { path: uploadedUrls?.growPgDeedPdf, contentType: "growPgDeedPdf/pdf" },
//         {
//           path: uploadedUrls?.rcplLoanAgreement,
//           contentType: "rcplLoanAgreement/pdf",
//         },
//       ];

//       const emailContent = `
//       <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//         <p>Dear Sir,</p>
//         <p>Caption case Report is for final approval.</p>
//         <p>Need your immediate action in this case.</p>
//         <p>Regards,</p>
//         <p>Team FinCoopers</p>
//       </div>
//     `;

//       // Send email with eSign links and attachments
//       await sendEmail(
//         [partnerModel.sanctionEmailTo],
//         ["raikwar@yopmail.com"],
//         `Final approval email for review`,
//         emailContent,
//         attachments
//       );

//       return success(res, "Email sent successfully");
//     } else if (normalizedPartnerName === "fin coopers capital pvt ltd") {
//       // Fin Cooper logic, replicating Grow Money functionality
//       const partnerLogo = FinpdfLogo;
//       let selectionData = partnerData?.pdfSelection || "acg";
//       console.log(selectionData, "selectionDataselectionData");
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const pdfFunctions = {
//         growSanctionLetterPdf,
//         growApplicantPdf,
//         growPgDeedPdf,
//         rcplLoanAgreement,
//       };

//       const pdfData = {};
//       for (const [key, func] of Object.entries(pdfFunctions)) {
//         const pdfResult = await func(
//           customerId,
//           partnerLogo,
//           partnerModel.fullName,
//           selectionData
//         );
//         pdfData[key] = pdfResult;
//       }

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedUrls = {};
//       for (const [key, data] of Object.entries(pdfData)) {
//         const uploadedUrl = await processFile(data);
//         uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
//       }
//       // console.log("uploadedUrls",uploadedUrls)
//       const attachments = [
//         {
//           path: uploadedUrls?.growSanctionLetterPdf,
//           contentType: "growSanctionLetterPdf/pdf",
//         },
//         {
//           path: uploadedUrls?.growApplicantPdf,
//           contentType: "growApplicantPdf/pdf",
//         },
//         { path: uploadedUrls?.growPgDeedPdf, contentType: "growPgDeedPdf/pdf" },
//         {
//           path: uploadedUrls?.rcplLoanAgreement,
//           contentType: "rcplLoanAgreement/pdf",
//         },
//       ];

//       const emailContent = `
//       <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//         <p>Dear Sir,</p>
//         <p>Caption case Report is for final approval.</p>
//         <p>Need your immediate action in this case.</p>
//         <p>Regards,</p>
//         <p>Team FinCoopers</p>
//       </div>
//     `;

//       // Send email with eSign links and attachments
//       await sendEmail(
//         [partnerModel.sanctionEmailTo],
//         ["raikwar@yopmail.com"],
//         `Final approval email for review`,
//         emailContent,
//         attachments
//       );

//       return success(res, "Email sent successfully.");
//     } else if (normalizedPartnerName === "namdev finvest pvt ltd") {
//       // Ratna logic
//       let selectionData = partnerData?.pdfSelection || "acg";
//       // console.log(selectionData,"selectionDataselectionData")
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const sectionData = await namdevSectionLatter(customerId);

//       const applicantData = await namDevApplicantLatter(
//         customerId,
//         selectionData
//       );

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         console.log("Resolved File Path: ", resolvedPath);
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));

//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedSectionUrl = await processFile(sectionData);
//       const uploadedApplicantUrl = await processFile(applicantData);
//       const BASEURL = process.env.BASE_URL;
//       // Attachments for the email
//       const attachments = [
//         {
//           path: `${BASEURL}${uploadedSectionUrl.image}`,
//           contentType: "sanction/pdf",
//         },
//         {
//           path: `${BASEURL}${uploadedApplicantUrl.image}`,
//           contentType: "application/pdf",
//         },
//       ];

//       const emailContent = `
//       <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//         <p>Dear Sir,</p>
//         <p>Caption case Report is for final approval.</p>
//         <p>Need your immediate action in this case.</p>
//         <p>Regards,</p>
//         <p>Team FinCoopers</p>
//         <div>All PDFs are attached in this email.</div>
//       </div>
//     `;
//       // Sending email with eSign links in the email body
//       await sendEmail(
//         [partnerModel.sanctionEmailTo],
//         ["akashsharma199425@gmail.com"],
//         `Final approval email for review`,
//         emailContent,
//         attachments
//       );

//       return success(res, "Email sent successfully");
//     } else {
//       return badRequest(res, `Unsupported partner: ${partnerModel.fullName}`);
//     }
//   } catch (error) {
//     console.error(error);
//     return unknownError(res, error);
//   }
// };



// const sendEmailToPartner = async (req, res) => {
//   try {
//     const { customerId } = req.query;

//     // Step 1: Fetch partner and customer data
//     const partnerData = await finalModel.findOne({ customerId });
//     if (!partnerData) {
//       return badRequest(res, "Partner data is required.");
//     }

//     const partnerModel = await lendersModel.findOne({ _id: partnerData.partnerId });
//     if (!partnerModel) {
//       return badRequest(res, "Partner not found.");
//     }

//     const normalizedPartnerName = (partnerModel.fullName || "").trim().toLowerCase();
//     const generatedPdfPaths = [];

//     // Step 2: Generate PDFs based on partner name
//     if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
//       const sectionData = await sectionLatter(customerId);
//       const applicantData = await applicantLatter(customerId, partnerData?.pdfSelection || "acg");
//       const deedData = await LdAndPdDeed(customerId, partnerData?.pdfSelection || "acg");

//      const uploadedFileUrls= generatedPdfPaths.push(sectionData, applicantData, deedData);
//     } else if (normalizedPartnerName === "grow money capital pvt ltd") {
//       const partnerLogo = growPdfLogo;
//       const pdfFunctions = {
//         growSanctionLetterPdf,
//         growApplicantPdf,
//         growPgDeedPdf,
//         rcplLoanAgreement,
//       };

//       for (const func of Object.values(pdfFunctions)) {
//         const pdfPath = await func(customerId, partnerLogo, partnerModel.fullName, partnerData?.pdfSelection || "acg");
//        const uploadedFileUrls = generatedPdfPaths.push(pdfPath);
//       }
//     }
    
//     // Step 4: Send Email with attachments
//     const BASEURL = process.env.BASE_URL;
//     const attachmentUrls = uploadedFileUrls.map((url) => `${url}`);

//     const emailContent = `
//       <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//         <p>Dear Sir/Madam,</p>
//         <p>Please find the attached documents for your review and approval.</p>
//         <p>Regards,</p>
//         <p>Team FinCoopers</p>
//       </div>
//     `;

//     const emailAttachments = attachmentUrls.map((url) => ({
//       path: url,
//       contentType: "application/pdf",
//     }));

//     await sendEmail(
//       [partnerModel.sanctionEmailTo],
//       ["akashsharma199425@gmail.com"], // Add CC recipients if needed
//       "Partner Document Submission",
//       emailContent,
//       emailAttachments
//     );

//     return success(res, "PDFs generated and email sent successfully.");
//   } catch (error) {
//     console.error(error);
//     return unknownError(res, error);
//   }
// };

const sendEmailToPartner = async (req, res) => {
  try {
    const { customerId } = req.query;

    // Step 1: Fetch partner and customer data
    const partnerData = await finalModel.findOne({ customerId });
    if (!partnerData) {
      return badRequest(res, "Partner data is required.");
    }

    const partnerModel = await lendersModel.findOne({ _id: partnerData.partnerId });
    if (!partnerModel) {
      return badRequest(res, "Partner not found.");
    }

    const normalizedPartnerName = (partnerModel.fullName || "").trim().toLowerCase();
    const generatedPdfPaths = [];

    // Step 2: Generate PDFs based on partner name
    if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
      const sectionData = await sectionLatter(customerId);
      const applicantData = await applicantLatter(customerId, partnerData?.pdfSelection || "acg");
      const deedData = await LdAndPdDeed(customerId, partnerData?.pdfSelection || "acg");

      // Push the URLs into the array
      if (sectionData?.sectionLatter) generatedPdfPaths.push(sectionData.sectionLatter);
      if (applicantData?.applicantionLatter) generatedPdfPaths.push(applicantData.applicantionLatter);
      if (deedData?.LdAndPdDeed) generatedPdfPaths.push(deedData.LdAndPdDeed);
    } else if (normalizedPartnerName === "grow money capital pvt ltd") {
      const partnerLogo = growPdfLogo;
      const pdfFunctions = {
        growSanctionLetterPdf,
        growApplicantPdf,
        growPgDeedPdf,
        rcplLoanAgreement,
      };

      for (const func of Object.values(pdfFunctions)) {
        const pdfPath = await func(customerId, partnerLogo, partnerModel.fullName, partnerData?.pdfSelection || "acg");
        if (pdfPath) generatedPdfPaths.push(pdfPath);
      }
    }

    // Validate generatedPdfPaths
    if (!generatedPdfPaths.length) {
      return badRequest(res, "No PDFs were generated.");
    }

    console.log("Generated PDF Paths: ", generatedPdfPaths);

    // Step 3: Prepare email content and attachments
    const emailContent = `
      <div style="font-family: Arial, sans-serif; line-height: 1.6;">
        <p>Dear Sir/Madam,</p>
        <p>Please find the attached documents for your review and approval.</p>
        <p>Regards,</p>
        <p>Team FinCoopers</p>
      </div>
    `;

    const emailAttachments = generatedPdfPaths.map((url) => {
      if (!url || typeof url !== "string") {
        console.error("Invalid URL detected in generatedPdfPaths: ", url);
        throw new Error(`Invalid URL: ${url}`);
      }
      return {
        path: url, // Direct URL or file path
        contentType: "application/pdf",
      };
    });

    // Step 4: Send the email
    await sendEmail(
      [partnerModel.sanctionEmailTo],
      ["akashsharma199425@gmail.com"], // Add CC recipients if needed
      "Partner Document Submission",
      emailContent,
      emailAttachments
    );

    return success(res, "PDFs generated and email sent successfully.");
  } catch (error) {
    console.error("Error in sendEmailToPartner: ", error);
    return unknownError(res, error);
  }
};


// const sendEmailToPartnerForEsign = async (req, res) => {
//   try {
//     const { customerId, partnerId, selections } = req.query;
//     const partnerData = await finalModel.findOne({ customerId });
//     // console.log(partnerData,"partnerDatapartnerDatapartnerData")
//     if (!partnerData) {
//       return badRequest(res, "partner is required.");
//     }

//     const partnerModel = await lendersModel.findOne({
//       _id: partnerData.partnerId,
//     });
//     if (!partnerModel) {
//       return badRequest(res, "Partner not found.");
//     }

//     const normalizedPartnerName = (partnerModel.fullName || "")
//       .trim()
//       .toLowerCase();

//     if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
//       if (
//         partnerData?.esignLink &&
//         Object.keys(partnerData.esignLink).length > 0
//       ) {
//         return success(
//           res,
//           "esignLinks and combinedData generated successfully",
//           {
//             combinedData: partnerData.esignLink,
//           }
//         );
//       } else {
//         let selectionData = partnerData?.pdfSelection || "acg";

//         if (!selectionData || typeof selectionData !== "string") {
//           selectionData;
//         }

//         const sectionData = await sectionLatter(customerId);
//         const applicantData = await applicantLatter(customerId, selectionData);
//         const LdAndPdDeedData = await LdAndPdDeed(customerId, selectionData);

//         const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//         const processFile = async (filePath) => {
//           try {
//             const resolvedPath = path
//               .resolve(__dirname, `../../../..${filePath}`)
//               .replace(/\\/g, "/");
//             const formData = new FormData();
//             formData.append("image", fs.createReadStream(resolvedPath));
//             const response = await axios.post(uploadUrl, formData, {
//               headers: { ...formData.getHeaders() },
//             });
//             return response.data?.items;
//           } catch (error) {
//             console.error("Error uploading file:", filePath, error);
//             throw new Error("File upload failed");
//           }
//         };

//         const uploadedSectionUrl = await processFile(sectionData);
//         const uploadedApplicantUrl = await processFile(applicantData);
//         const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);

//         const documents = [
//           {
//             fileName: LdAndPdDeedData,
//             key: "LdAndPdData",
//             pdfName: "growPgDeedPdf",
//           },
//           {
//             fileName: applicantData,
//             key: "applicantData",
//             pdfName: "growApplicantPdf",
//           },
//           {
//             fileName: sectionData,
//             key: "sectionData",
//             pdfName: "growSanctionLetterPdf",
//           },
//         ];

//         const esignLinks = {};
//         const combinedData = []; // Final response structure

//         for (const doc of documents) {
//           try {
//             const esignResult = await initESign({ fileName: doc.fileName });
//             const signUrl = esignResult?.data?.invitees?.[0]?.signUrl;

//             if (signUrl) {
//               esignLinks[doc.key] = signUrl;

//               // Add data to combinedData array
//               combinedData.push({
//                 pdfName: doc.key,
//                 pdf: `/uploads/pdf/${path.basename(doc.fileName)}`,
//                 esignLink: signUrl,
//               });
//             }
//           } catch (error) {
//             console.error(
//               "Error generating eSign link for:",
//               doc.fileName,
//               error
//             );
//             continue;
//           }
//         }

//         // console.log(esignLinks, "esignLinks generated");
//         // console.log(combinedData, "combinedData generated");

//         const data = await finalModel.findOneAndUpdate(
//           { customerId },
//           {
//             $set: { esignLink: combinedData },
//           },
//           { new: true, upsert: true }
//         );
//         // console.log(data,"datadatadatadatadata")
//         return success(
//           res,
//           "esignLinks and combinedData generated successfully",
//           {
//             combinedData,
//           }
//         );
//       }
//     } else if (normalizedPartnerName === "grow money capital pvt ltd") {
//       try {
//         // Check for existing eSign links
//         if (
//           partnerData?.esignLink &&
//           Object.keys(partnerData.esignLink).length > 0
//         ) {
//           return success(
//             res,
//             "esignLinks and combinedData generated successfully",
//             {
//               combinedData: partnerData.esignLink,
//             }
//           );
//         }

//         const partnerLogo = growPdfLogo;
//         let selectionData = partnerData?.pdfSelection || "acg";
//         if (!selectionData || typeof selectionData !== "string") {
//           selectionData = "acg"; // Default value
//         }

//         const pdfFunctions = {
//           growSanctionLetterPdf,
//           growApplicantPdf,
//           growPgDeedPdf,
//           rcplLoanAgreement,
//         };

//         const pdfData = {};
//         const esignData = {};

//         // Generate PDFs and eSign links
//         for (const [key, func] of Object.entries(pdfFunctions)) {
//           try {
//             const pdfResult = await func(
//               customerId,
//               partnerLogo,
//               partnerModel.fullName,
//               selectionData
//             );
//             pdfData[key] = pdfResult;

//             // Generate eSign link
//             const esignResult = await initESign({ fileName: pdfResult });
//             const signUrl = esignResult?.data?.invitees?.[0]?.signUrl;
//             if (signUrl) {
//               esignData[key + "EsignLink"] = signUrl;
//             } else {
//               console.error(`No eSign URL generated for ${key}`);
//             }
//           } catch (error) {
//             console.error(`Error processing ${key}:`, error);
//           }
//         }

//         // Combine PDF and eSign link data for response
//         const combinedData = Object.entries(pdfData).map(([key, pdfPath]) => ({
//           pdfName: key,
//           pdf: pdfPath,
//           esignLink: esignData[key + "EsignLink"] || null,
//         }));

//         console.log("Combined Data:", combinedData);

//         const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//         // Upload PDFs and generate URLs
//         const uploadedUrls = {};
//         await Promise.all(
//           Object.entries(pdfData).map(async ([key, pdfPath]) => {
//             try {
//               const resolvedPath = path
//                 .resolve(__dirname, `../../../..${pdfPath}`)
//                 .replace(/\\/g, "/");
//               const formData = new FormData();
//               formData.append("image", fs.createReadStream(resolvedPath));
//               const response = await axios.post(uploadUrl, formData, {
//                 headers: { ...formData.getHeaders() },
//               });
//               uploadedUrls[
//                 key
//               ] = `${process.env.BASE_URL}${response.data?.items?.image}`;
//             } catch (error) {
//               console.error(`Error uploading ${key}:`, error);
//             }
//           })
//         );

//         console.log("Uploaded URLs:", uploadedUrls);

//         // Generate email content
//         const emailLinks = combinedData
//           .map(({ pdf, esignLink }) => {
//             if (!esignLink) {
//               console.error(`Missing eSign link for PDF: ${pdf}`);
//             }
//             return `
//                 <div>
//                   <h4>eSign Details for ${pdf}</h4>
//                   <p><strong>eSign Link:</strong> <a href="${esignLink}" target="_blank">Click to Sign</a></p>
//                 </div>`;
//           })
//           .join("");

//         const emailContent = `
//             <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//               <p>Dear Sir,</p>
//               <p>Caption case Report is for final approval.</p>
//               <p>Need your immediate action in this case.</p>
//               <p>Regards,</p>
//               <p>Team FinCoopers</p>
//               <div>All PDFs are attached in this email.</div>
//               <div>
//                 <p><strong>eSign Links for each document:</strong></p>
//                 ${emailLinks}
//               </div>
//             </div>
//           `;

//         const attachments = Object.entries(uploadedUrls).map(([key, path]) => ({
//           path,
//           contentType: "application/pdf",
//         }));

//         // Send email
//         await sendEmail(
//           [partnerModel.sanctionEmailTo],
//           ["akashsharma199425@gmail.com"],
//           "Final approval email for review",
//           emailContent,
//           attachments
//         );

//         // Save eSign links to the database
//         const data = await finalModel.findOneAndUpdate(
//           { customerId },
//           { $set: { esignLink: combinedData } },
//           { new: true, upsert: true }
//         );

//         return success(
//           res,
//           "eSign links and combined data generated successfully",
//           {
//             combinedData,
//           }
//         );
//       } catch (error) {
//         console.error("Error in Grow Money Capital flow:", error);
//         return failure(res, "An error occurred while processing the request.");
//       }
//     } else if (normalizedPartnerName === "fin coopers capital pvt ltd") {
//       if (
//         partnerData?.esignLink &&
//         Object.keys(partnerData.esignLink).length > 0
//       ) {
//         return success(
//           res,
//           "esignLinks and combinedData generated successfully",
//           {
//             combinedData: partnerData.esignLink,
//           }
//         );
//       }
//       // Fin Cooper logic, replicating Grow Money functionality
//       const partnerLogo = FinpdfLogo;
//       let selectionData = partnerData?.pdfSelection || "acg";
//       console.log(selectionData, "selectionDataselectionData");
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData;
//       }

//       const pdfFunctions = {
//         growSanctionLetterPdf,
//         growApplicantPdf,
//         growPgDeedPdf,
//         rcplLoanAgreement,
//       };

//       const pdfData = {};
//       const esignData = {};

//       for (const [key, func] of Object.entries(pdfFunctions)) {
//         try {
//           const pdfResult = await func(
//             customerId,
//             partnerLogo,
//             partnerModel.fullName,
//             selectionData
//           );
//           pdfData[key] = pdfResult;

//           // Generate the eSign link for the generated PDF
//           const esignResult = await initESign({ fileName: pdfResult });
//           console.log(`eSign Result for ${key}:`, esignResult); // Debugging eSign result

//           const signUrl = esignResult?.data?.invitees[0]?.signUrl; // Fetch the first invitee's sign URL
//           if (signUrl) {
//             esignData[key + "EsignLink"] = signUrl;
//           } else {
//             console.error(`No sign URL found for ${key}`);
//           }
//         } catch (error) {
//           console.error(
//             `Error generating PDF or eSign link for ${key}:`,
//             error
//           );
//         }
//       }

//       // Combine PDF and eSign link data for response
//       const combinedData = Object.entries(pdfData).map(([key, pdfPath]) => {
//         const esignLink = esignData[key + "EsignLink"];
//         return {
//           pdfName: key,
//           pdf: pdfPath,
//           esignLink: esignLink, // Only sending one link per document
//         };
//       });

//       // Generate the email content
//       const emailLinks = combinedData
//         .map(({ pdf, esignLink }) => {
//           if (!esignLink) {
//             console.error(`Missing eSign link for PDF: ${pdf}`);
//           }
//           return `<div>
//               <h4>eSign Details for PDF</h4>
//               <p><strong>eSign Link:</strong> <a href="${esignLink}" target="_blank">Click to Sign</a></p>
//             </div>`;
//         })
//         .join("");

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedUrls = {};
//       for (const [key, data] of Object.entries(pdfData)) {
//         const uploadedUrl = await processFile(data);
//         uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
//       }
//       // console.log("uploadedUrls",uploadedUrls)
//       const attachments = [
//         {
//           path: uploadedUrls?.growSanctionLetterPdf,
//           contentType: "growSanctionLetterPdf/pdf",
//         },
//         {
//           path: uploadedUrls?.growApplicantPdf,
//           contentType: "growApplicantPdf/pdf",
//         },
//         { path: uploadedUrls?.growPgDeedPdf, contentType: "growPgDeedPdf/pdf" },
//         {
//           path: uploadedUrls?.rcplLoanAgreement,
//           contentType: "rcplLoanAgreement/pdf",
//         },
//       ];

//       const emailContent = `
//       <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//         <p>Dear Sir,</p>
//         <p>Caption case Report is for final approval.</p>
//         <p>Need your immediate action in this case.</p>
//         <p>Regards,</p>
//         <p>Team FinCoopers</p>
//           <div>All PDFs are attached in this email.</div>
//           <div>
//             <p><strong>eSign Links for each document:</strong></p>
//             ${emailLinks}
//           </div>
//       </div>
//     `;

//       // Send email with eSign links and attachments
//       await sendEmail(
//         [partnerModel.sanctionEmailTo],
//         ["raikwar@yopmail.com"],
//         `Final approval email for review`,
//         emailContent,
//         attachments
//       );
//       const data = await finalModel.findOneAndUpdate(
//         { customerId },
//         {
//           $set: { esignLink: combinedData },
//         },
//         { new: true, upsert: true }
//       );

//       return success(res, "esignLinks generated successfully", {
//         combinedData,
//       });
//     } else if (normalizedPartnerName === "namdev finvest pvt ltd") {
//       if (
//         partnerData?.esignLink &&
//         Object.keys(partnerData.esignLink).length > 0
//       ) {
//         return success(
//           res,
//           "esignLinks and combinedData generated successfully",
//           {
//             combinedData: partnerData.esignLink,
//           }
//         );
//       } else {
//         let selectionData = partnerData?.pdfSelection || "acg";

//         if (!selectionData || typeof selectionData !== "string") {
//           selectionData;
//         }

//         const namdevsectionData = await namdevSectionLatter(customerId);
//         const namdevapplicantData = await namDevApplicantLatter(
//           customerId,
//           selectionData
//         );

//         const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//         const processFile = async (filePath) => {
//           try {
//             const resolvedPath = path
//               .resolve(__dirname, `../../../..${filePath}`)
//               .replace(/\\/g, "/");
//             const formData = new FormData();
//             formData.append("image", fs.createReadStream(resolvedPath));
//             const response = await axios.post(uploadUrl, formData, {
//               headers: { ...formData.getHeaders() },
//             });
//             return response.data?.items;
//           } catch (error) {
//             console.error("Error uploading file:", filePath, error);
//             throw new Error("File upload failed");
//           }
//         };

//         const uploadedSectionUrl = await processFile(namdevsectionData);
//         const uploadedApplicantUrl = await processFile(namdevapplicantData);

//         const documents = [
//           {
//             fileName: namdevapplicantData,
//             key: "namdevapplicantData",
//             pdfName: "namdevAplicantpdf",
//           },
//           {
//             fileName: namdevsectionData,
//             key: "namdevsectionData",
//             pdfName: "namdevSanctionLetterPdf",
//           },
//         ];

//         const esignLinks = {};
//         const combinedData = []; // Final response structure

//         for (const doc of documents) {
//           try {
//             const esignResult = await initESign({ fileName: doc.fileName });
//             const signUrl = esignResult?.data?.invitees?.[0]?.signUrl;

//             if (signUrl) {
//               esignLinks[doc.key] = signUrl;

//               // Add data to combinedData array
//               combinedData.push({
//                 pdfName: doc.key,
//                 pdf: `/uploads/pdf/${path.basename(doc.fileName)}`,
//                 esignLink: signUrl,
//               });
//             }
//           } catch (error) {
//             console.error(
//               "Error generating eSign link for:",
//               doc.fileName,
//               error
//             );
//             continue;
//           }
//         }

//         // console.log(esignLinks, "esignLinks generated");
//         // console.log(combinedData, "combinedData generated");

//         const data = await finalModel.findOneAndUpdate(
//           { customerId },
//           {
//             $set: { esignLink: combinedData },
//           },
//           { new: true, upsert: true }
//         );
//         // console.log(data,"datadatadatadatadata")
//         return success(
//           res,
//           "esignLinks and combinedData generated successfully",
//           {
//             combinedData,
//           }
//         );
//       }
//     } else {
//       return badRequest(res, `Unsupported partner: ${partnerModel.fullName}`);
//     }
//   } catch (error) {
//     console.error(error);
//     return unknownError(res, error);
//   }
// };



const sendEmailToPartnerForEsign = async (req, res) => {
  try {
    const { customerId } = req.query;

    // Step 1: Fetch Partner Data
    const partnerData = await finalModel.findOne({ customerId });
    if (!partnerData) return badRequest(res, "Partner data is required.");

    const partnerModel = await lendersModel.findOne({ _id: partnerData.partnerId });
    if (!partnerModel) return badRequest(res, "Partner not found.");

    const normalizedPartnerName = (partnerModel.fullName || "").trim().toLowerCase();

    if (partnerData?.esignLink && Object.keys(partnerData.esignLink).length > 0) {
      return success(res, "eSign links already exist.", { combinedData: partnerData.esignLink });
    }

    // Step 2: Generate PDFs and Logic for Partner
    let documents = [];
    if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
      const sectionData = await sectionLatter(customerId);
      const applicantData = await applicantLatter(customerId, "acg");
      const LdAndPdDeedData = await LdAndPdDeed(customerId, "acg");

      documents = [
        { fileName: sectionData, key: "sectionData", pdfName: "growSanctionLetterPdf" },
        { fileName: applicantData, key: "applicantData", pdfName: "growApplicantPdf" },
        { fileName: LdAndPdDeedData, key: "LdAndPdData", pdfName: "growPgDeedPdf" },
      ];
    } else if (
      normalizedPartnerName === "grow money capital pvt ltd" ||
      normalizedPartnerName === "fin coopers capital pvt ltd"
    ) {
      const partnerLogo =
        normalizedPartnerName === "grow money capital pvt ltd" ? growPdfLogo : FinpdfLogo;
      const selectionData = partnerData?.pdfSelection || "acg";

      documents = [
        {
          fileName: await growSanctionLetterPdf(customerId, partnerLogo, partnerModel.fullName, selectionData),
          key: "sanctionLetter",
          pdfName: "growSanctionLetterPdf",
        },
        {
          fileName: await growApplicantPdf(customerId, partnerLogo, partnerModel.fullName, selectionData),
          key: "applicantData",
          pdfName: "growApplicantPdf",
        },
        {
          fileName: await growPgDeedPdf(customerId, partnerLogo, partnerModel.fullName, selectionData),
          key: "pgDeed",
          pdfName: "growPgDeedPdf",
        },
      ];
    } else {
      return badRequest(res, "Partner logic not implemented for this partner.");
    }

    // Step 3: Generate eSign Links
    const combinedData = [];
    for (const doc of documents) {
      try {
        const esignResult = await initESign({ fileName: doc.fileName });
        const signUrl = esignResult?.data?.invitees?.[0]?.signUrl;

        if (signUrl) {
          combinedData.push({
            pdfName: doc.key,
            pdf: `${(doc.fileName)}`,
            esignLink: signUrl,
          });
        }
      } catch (error) {
        console.error(`Error generating eSign link for ${doc.key}:`, error);
      }
    }

    // Step 4: Save Links to Database
    await finalModel.findOneAndUpdate(
      { customerId },
      { $set: { esignLink: combinedData } },
      { new: true, upsert: true }
    );

    // Step 5: Send Email to Partner
    const emailContent = `
      <p>Dear ${partnerModel.fullName},</p>
      <p>Please find below the eSign links for the required documents:</p>
      <ul>
        ${combinedData
          .map(
            (doc) =>
              `<li><strong>${doc.pdfName}:</strong> <a href="${doc.esignLink}" target="_blank">Click here to sign</a></li>`
          )
          .join("")}
      </ul>
      <p>Regards,<br/>Team</p>
    `;

    const attachments = combinedData.map((doc) => ({
      filename: path.basename(doc.pdf),
      path: doc.pdf,
    }));

    // const emailSent = await sendEmail(
    //   [partnerModel.sanctionEmailTo], // toEmails
    //   ["akashsharma19925.com"], // ccEmails
    //   "Final approval email for review", // subject
    //   emailContent, // html content
    //   attachments // attachments
    // );

    // if (!emailSent) {
    //   return badRequest(res, "Failed to send email to partner.");
    // }

    return success(res, "eSign links generated and email sent successfully.", { combinedData });
  } catch (error) {
    console.error("Error in sendEmailToPartnerForEsign:", error);
    return unknownError(res,error, "An error occurred while processing the request.");
  }
};





const sendEmailToCustomerForEsign = async (req, res) => {
  try {
    const { customerId, partnerId } = req.query;

    // Get all required data
    const customerDetail = await applicantModel.findOne({ customerId });
    const partnerData = await finalModel.findOne({
      customerId: new ObjectId(customerId),
    });
    const lenderDocumentData = await lenderDocumentModel.findOne({
      customerId: customerId,
      lenderId: partnerData?.partnerId,
    });
    lenderDocumentData.esignDocument.forEach((doc) => {
      console.log(`${doc.documentName}: ${doc.serialNo}`);
    });
    if (!partnerData) {
      return badRequest(res, "Partner is required.");
    }

    const partnerModel = await lendersModel.findOne({
      _id: partnerData.partnerId,
    });

    if (!partnerModel) {
      return badRequest(res, "Partner not found.");
    }

    // Helper function for sending emails
    const sendEmailWithDocuments = async (documents) => {
      try {
        // Create email links from documents
        const emailLinks = documents
          .map((doc) => {
            const esignLink = doc.url[1] || doc.esignLink;
            const docName = doc.documentName || doc.pdfName;

            return `
            <div>
              <h4>eSign Details for ${docName}</h4>
              <p><strong>eSign Link:</strong> <a href="${esignLink}" target="_blank">Click to Sign</a></p>
            </div>`;
          })
          .join("");

        const emailContent = `
          <div style="font-family: Arial, sans-serif; line-height: 1.6;">
            <p>Dear ${customerDetail.fullName},</p>
            <p>Caption case Report is for final approval.</p>
            <p>Need your immediate action in this case.</p>
            <p>Regards,</p>
            <p>Team FinCoopers</p>
            <div>All PDFs are attached in this email.</div>
            <div>
              <p><strong>eSign Links for each document:</strong></p>
              ${emailLinks}
            </div>
          </div>
        `;

        // Prepare attachments
        const attachments = documents.map((doc) => ({
          path: doc.url?.[0] || doc.pdf,
          contentType: "application/pdf",
          filename: `${doc.documentName || doc.pdfName}.pdf`,
        }));

        // Send email
        await sendEmail(
          [customerDetail.email],
          ["sagarsamediya17@gmail.com"],
          "Final approval email for review",
          emailContent,
          attachments
        );

        return true;
      } catch (error) {
        console.error("Email sending failed:", error);
        return false;
      }
    };

    const normalizedPartnerName = (partnerModel.fullName || "")
      .trim()
      .toLowerCase();

    // Handle partners
    if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
      // Generate new documents
      const sectionData = await sectionLatter(customerId);
      const applicantData = await applicantLatter(customerId);
      const LdAndPdDeedData = await LdAndPdDeed(customerId);

      // Upload documents
      const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;
      const processFile = async (filePath) => {
        try {
          const resolvedPath = path
            .resolve(__dirname, `../../../..${filePath}`)
            .replace(/\\/g, "/");
          const formData = new FormData();
          formData.append("image", fs.createReadStream(resolvedPath));
          const response = await axios.post(uploadUrl, formData, {
            headers: { ...formData.getHeaders() },
          });
          return response.data?.items;
        } catch (error) {
          console.error("Error uploading file:", error);
          throw new Error("File upload failed");
        }
      };

      const documents = [
        {
          fileName: LdAndPdDeedData,
          documentName: "LdAndPdDeed",
          // serialNo: doc.serialNo
        },
        {
          fileName: applicantData,
          documentName: "applicantionLatter",
          // serialNo: doc.serialNo
        },
        {
          fileName: sectionData,
          documentName: "sectionLatter",
          // serialNo: doc.serialNo
        },
      ];

      const esignDocuments = [];

      // Process each document
      for (const doc of documents) {
        try {
          const uploadedFile = await processFile(doc.fileName);
          const esignResult = await initESign({ fileName: doc.fileName });
          const signUrl = esignResult?.data?.invitees?.[0]?.signUrl;

          if (uploadedFile && signUrl) {
            esignDocuments.push({
              serialNo: doc.serialNo,
              documentName: doc.documentName,
              url: [`${process.env.BASE_URL}${uploadedFile.image}`],
              esignLink: signUrl,
            });
          }
        } catch (error) {
          console.error("Error processing document:", error);
        }
      }

      // Save documents
      await lenderDocumentModel.findOneAndUpdate(
        {
          customerId,
          lenderId: partnerData.partnerId,
        },
        {
          $set: { esignDocument: esignDocuments },
        },
        { new: true, upsert: true }
      );

      // Send email
      const emailSent = await sendEmailWithDocuments(esignDocuments);
      if (!emailSent) {
        return failure(res, "Failed to send email with new documents");
      }

      return success(res, "Ratna Documents generated and sent successfully", {
        combinedData: esignDocuments,
      });
    }

    // Similar structure for other partners
    else if (normalizedPartnerName === "grow money capital pvt ltd") {
      // Check existing documents
      if (lenderDocumentData?.esignDocument?.length > 0) {
        const emailSent = await sendEmailWithDocuments(
          lenderDocumentData.esignDocument
        );
        if (!emailSent) {
          return failure(res, "Failed to send email with existing documents");
        }
        return success(res, "Grow Documents sent successfully", {
          combinedData: lenderDocumentData.esignDocument,
        });
      }

      const partnerLogo = growPdfLogo;
      const pdfFunctions = {
        growSanctionLetterPdf: { func: growSanctionLetterPdf, serialNo: 1 },
        growApplicantPdf: { func: growApplicantPdf, serialNo: 2 },
        growPgDeedPdf: { func: growPgDeedPdf, serialNo: 3 },
        rcplLoanAgreement: { func: rcplLoanAgreement, serialNo: 4 },
      };

      const esignDocuments = [];

      for (const [key, details] of Object.entries(pdfFunctions)) {
        try {
          const pdfResult = await details.func(
            customerId,
            partnerLogo,
            partnerModel.fullName
          );

          // Upload PDF
          const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;
          const resolvedPath = path
            .resolve(__dirname, `../../../..${pdfResult}`)
            .replace(/\\/g, "/");
          const formData = new FormData();
          formData.append("image", fs.createReadStream(resolvedPath));
          const uploadResponse = await axios.post(uploadUrl, formData, {
            headers: { ...formData.getHeaders() },
          });

          // Generate eSign
          const esignResult = await initESign({ fileName: pdfResult });
          const signUrl = esignResult?.data?.invitees?.[0]?.signUrl;

          if (uploadResponse.data?.items?.image && signUrl) {
            esignDocuments.push({
              serialNo: details.serialNo,
              documentName: key,
              url: [
                `${process.env.BASE_URL}${uploadResponse.data.items.image}`,
              ],
              esignLink: signUrl,
            });
          }
        } catch (error) {
          console.error(`Error processing ${key}:`, error);
        }
      }
      console.log("ds", esignDocuments);
      // Save and send
      await lenderDocumentModel.findOneAndUpdate(
        { customerId, lenderId: partnerData.partnerId },
        { $set: { esignDocument: esignDocuments } },
        { new: true, upsert: true }
      );

      const emailSent = await sendEmailWithDocuments(esignDocuments);
      if (!emailSent) {
        return failure(res, "Failed to send email with new documents");
      }

      return success(res, "Documents generated and sent successfully", {
        combinedData: esignDocuments,
      });
    } else if (normalizedPartnerName === "fin coopers capital pvt ltd") {
      // Similar to "grow money capital" with different logo
      if (lenderDocumentData?.esignDocument?.length > 0) {
        const emailSent = await sendEmailWithDocuments(
          lenderDocumentData.esignDocument
        );
        if (!emailSent) {
          return failure(res, "Failed to send email with existing documents");
        }
        return success(res, "Fin Documents sent successfully", {
          combinedData: lenderDocumentData.esignDocument,
        });
      }

      // Rest of the code similar to "grow money capital" but with FinpdfLogo
      // ... implementation similar to grow money capital ...
    } else {
      return badRequest(res, `Unsupported partner: ${partnerModel.fullName}`);
    }
  } catch (error) {
    console.error("Error in sendEmailToCustomerForEsign:", error);
    return unknownError(res, error);
  }
};

const eSignGenerate = async (req, res) => {
  try {
    const { customerId } = req.query;

    const customerDetail = await applicantModel.findOne({ customerId });
    const partnerData = await finalModel.findOne({
      customerId: new ObjectId(customerId),
    });
    const lenderDocumentData = await lenderDocumentModel.findOne({
      customerId: customerId,
      lenderId: partnerData?.partnerId,
    });
    const lender = await lendersModel.findById({
      _id: new ObjectId(lenderDocumentData.lenderId),
    });

    if (!lenderDocumentData || !lenderDocumentData.esignDocument?.length) {
      return badRequest(res, "No documents found for eSign");
    }

    // Create a new PDF document
    const mergedPdf = await PDFDocument.create();

    // Process each document
    for (const doc of lenderDocumentData.esignDocument) {
      try {
        const filePath = doc.url[0].replace(`${process.env.BASE_URL}`, "");
        const fullPath = path.resolve(__dirname, `../../../..${filePath}`);

        console.log("Processing file:", fullPath);

        if (fs.existsSync(fullPath)) {
          // Read the PDF file
          const existingPdfBytes = fs.readFileSync(fullPath);

          // Load the PDF document
          const pdfDoc = await PDFDocument.load(existingPdfBytes);

          // Copy all pages from the current document
          const copiedPages = await mergedPdf.copyPages(
            pdfDoc,
            pdfDoc.getPageIndices()
          );
          copiedPages.forEach((page) => mergedPdf.addPage(page));
        } else {
          console.log("File not found:", fullPath);
        }
      } catch (err) {
        console.error("Error processing file:", err);
        continue;
      }
    }

    // Create uploads directory if it doesn't exist
    const uploadsDir = path.resolve(__dirname, "../../../../uploads/");
    if (!fs.existsSync(uploadsDir)) {
      fs.mkdirSync(uploadsDir, { recursive: true });
    }

    // Save the merged PDF
    const outputFileName = `${customerDetail.fullName}_${Date.now()}.pdf`;
    const outputPath = path.join(uploadsDir, outputFileName);

    const mergedPdfBytes = await mergedPdf.save();
    fs.writeFileSync(outputPath, mergedPdfBytes);

    // Generate eSign link using existing initESign function
    const esignResponse = await initESign({
      fileName: `/uploads/${outputFileName}`,
    });

    if (!esignResponse?.data?.invitees?.[0]?.signUrl) {
      return failure(res, "Failed to generate eSign link");
    }

    // Create new esign document object
    const newEsignDoc = {
      partnerName: lender.fullName,
      pdf: `${process.env.BASE_URL}/uploads/${outputFileName}`,
      esignLinkUrl: esignResponse.data.invitees[0].signUrl,
      createdAt: moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A"),
    };

    // Update document record - push to esignLinks array
    const updatedDoc = await finalModel.findOneAndUpdate(
      { customerId },
      {
        $push: {
          esignLink: newEsignDoc, // Using $push to add to array
        },
      },
      { new: true }
    );

    if (!updatedDoc) {
      return failure(res, "Failed to update document record");
    }

    return success(res, "Combined eSign link generated successfully", {
      combinedEsign: newEsignDoc,
    });
  } catch (error) {
    console.error("Error in customerEsignDocument:", error);
    return unknownError(res, error.message);
  }
};

const addOrUpdateGoogleSheetData = async (req, res) => {
  try {
    const {
      loanAmount,
      tenure,
      emi,
      roi,
      customerFinId,
      ApplicantDetails,
      kycDetailsOf,
      contactInformation,
      permanentInformation,
      presentInformation,
      basicInformation,
      accountSummary,
      financialOverview,
      educationAndOccupation,
      referance,
      bankApplicantDetails,
      coApplicantDetails_1,
      coApplicantDetails_2,
      guarantorInformation,
      bankDetails,
      legalReport,
      technicalReport,
      LoanDetail,
      // propertyHolderInformation,
      // PropertyLocationDetails,
      // propertyAddressAndLandmark,
      // propertySpecifications,
      // PropertyBoundaries,
      // PropertyValuation
    } = req.body;
    console.log(
      guarantorInformation,
      "guarantorInformationguarantorInformation"
    );
    if (!customerFinId) {
      return res.status(400).json({ error: "customerFinId is required" });
    }

    const spreadsheetId = "1K9EnCErm-NfZCg7--TJtkfOqzPyGc-c5eLrWELS3kMA"; // Replace with your spreadsheet ID
    const sheetName = "Sheet1"; // Replace with your sheet name

    const auth = new google.auth.GoogleAuth({
      credentials, // Add your credentials here
      scopes: ["https://www.googleapis.com/auth/spreadsheets"],
    });
    const authClient = await auth.getClient();
    const sheets = google.sheets({ version: "v4", auth: authClient });

    // Step 1: Fetch data from the sheet
    const response = await sheets.spreadsheets.values.get({
      spreadsheetId,
      range: sheetName,
    });

    const rows = response.data.values;

    if (!rows || rows.length === 0) {
      return res.status(404).json({ error: "No data found in the sheet" });
    }

    // Step 2: Extract headers and data rows
    const [headers, ...dataRows] = rows;
    const customerFinIdIndex = headers.indexOf("customerFinId");

    if (customerFinIdIndex === -1) {
      return res.status(400).json({
        error: "Required header 'customerFinId' is missing",
      });
    }

    // Step 3: Create a mapping of request keys to Google Sheets headers
    const keyMapping = {
      loanAmount: "LoanAmountRequested",
      tenure: "LoanTenureRequested",
      emi: "Emi",
      roi: "Roi",
      customerFinId: "customerFinId",
      "ApplicantDetails.ApplicantType": "ApplicantType",
      "ApplicantDetails.bussinessType": "BussinessType",
      "ApplicantDetails.fullName": "FullName",
      "ApplicantDetails.fatherName": "FatherName",
      "ApplicantDetails.motherName": "MotherName",
      "ApplicantDetails.spouseName": "SpouseName",
      "ApplicantDetails.age": "Age",
      "ApplicantDetails.gender": "Gender",
      "ApplicantDetails.maritalStatus": "MaritalStatus",
      "ApplicantDetails.educationalDetails": "EducationalDetails",
      "ApplicantDetails.dob": "Dob",
      "ApplicantDetails.religion": "Religion",
      "ApplicantDetails.nationality": "Nationality",
      "ApplicantDetails.category": "Category",
      "ApplicantDetails.caste": "Caste",
      "ApplicantDetails.noOfDependentWithCustomer": "noOfDependentWithCustomer",
      "kycDetailsOf.panNo": "PanNo",
      "kycDetailsOf.aadharNo": "AadharNo",
      "kycDetailsOf.voterIdNo": "VoterIdNo",
      "kycDetailsOf.udyamRegistrationNo": "UdyamRegistrationNo",
      "contactInformation.mobileNo": "MobileNo",
      "contactInformation.mobileNoTwo": "MobileNoTwo",
      "contactInformation.email": "Email",
      "permanentInformation.fullAddress": "PermanentFullAddress",
      "permanentInformation.presentAddress": "PermanentPresentAddress",
      "permanentInformation.landmark": "PermanentLandmark",
      "permanentInformation.city": "PermanentCity",
      "permanentInformation.state": "PermanentState",
      "permanentInformation.district": "PermanentDistrict",
      "permanentInformation.pinCode": "PermanentPinCode",
      "permanentInformation.noOfyearsAtCurrentAddress":
        "PermanentNoOfyearsAtCurrentAddress",
      "permanentInformation.country": "PermanentPinCode",
      "presentInformation.fullAddress": "PresentAddressAsPerAdhar",
      "presentInformation.presentAddress": "PresentAddressAsPerAdhar",
      "presentInformation.landmark": "PresentLandmark",
      "presentInformation.city": "PresentCity",
      "presentInformation.state": "PresentState",
      "presentInformation.district": "PresentDistrict",
      "presentInformation.pinCode": "PresentPincode",
      "presentInformation.noOfyearsAtCurrentAddress":
        "PresentNoOfyearsAtCurrentAddress",
      "presentInformation.country": "PresentCountry",
      "presentInformation.residenceType": "PresentResidenceType",
      "basicInformation.applicantCibilScore": "ApplicantCibilScore",
      "accountSummary.totalAccounts": "applicantTotalAccounts",
      "accountSummary.overDueAccounts": "applicantOverdueAccount",
      "accountSummary.zeroBalanceAccount": "applicantZeroBalanceAccount",
      "financialOverview.HighCreditAndSanctionAmount":
        "applicantHighCreditAndSanctionAmount",
      "financialOverview.TotalCurrentOutstanding":
        "applicantTotalCurrentOutstanding",
      "financialOverview.TotalOverdueAmount": "applicantTotalOverdueAmount",
      "financialOverview.totalNoOfEnquiry": "noOfEpi",
      "educationAndOccupation.education": "EducationalDetails",
      "educationAndOccupation.occupation": "occupation",
      "educationAndOccupation.monthlyIncome": "monthlyIncome",
      "educationAndOccupation.otherMonthlyIncome": "otherMonthlyIncome",
      "educationAndOccupation.sourceOfOtherIncome": "sourceOfOtherIncome",
      "educationAndOccupation.annualIncome": "annualIncome",
      "educationAndOccupation.totalHouseHoldExpenses": "totalHouseHoldExpenses",
      "referance[0].name": "referenceNameOne",
      "referance[0].address": "referenceAddressOne",
      "referance[0].relation": "referenceRelationOne",
      "referance[0].mobileNumber": "referenceMobileNumberOne",
      "referance[1].name": "referenceNameTwo",
      "referance[1].address": "referenceAddressTwo",
      "referance[1].relation": "referenceRelationTwo",
      "referance[1].mobileNumber": "referenceMobileNumberTwo",
      "bankApplicantDetails.nameOfBankApplicant": "nameOfBankApplicant",
      "bankApplicantDetails.acHolderName": "acHolderName",
      "bankApplicantDetails.bankBranch": "bankBranch",
      "bankApplicantDetails.accountNumber": "accountNumber",
      "bankApplicantDetails.accountType": "accountType",
      "bankApplicantDetails.ifscCode": "ifscCode",
      "bankApplicantDetails.bankName": "nameOfBankApplicant",
      "coApplicantDetails_1.ApplicantType": "coApplicantTypeOne",
      "coApplicantDetails_1.bussinessType": "coApplicantBussinessTypeOne",
      "coApplicantDetails_1.fullName": "coApplicantFullNameOne",
      "coApplicantDetails_1.fatherName": "coApplicantFatherNameOne",
      "coApplicantDetails_1.motherName": "coApplicantMotherNameOne",
      "coApplicantDetails_1.dob": "coApplicantDobOne",
      "coApplicantDetails_1.age": "coApplicantAgeOne",
      "coApplicantDetails_1.gender": "coApplicantGenderOne",
      "coApplicantDetails_1.maritalStatus": "coApplicantMaritalStatusOne",
      "coApplicantDetails_1.educationDetails": "coApplicantEducationDetailsOne",
      "coApplicantDetails_1.relationWithApplicant":
        "coApplicantRelationWithApplicantOne",
      "coApplicantDetails_1.religion": "coApplicantReligionOne",
      "coApplicantDetails_1.nationality": "coApplicantNationalityOne",
      "coApplicantDetails_1.category": "coApplicantCategoryOne",
      "coApplicantDetails_1.caste": "coApplicantCasteOne",
      "coApplicantDetails_1.contactInformation.mobileNo":
        "coApplicantMobileNoOne",
      "coApplicantDetails_1.contactInformation.mobileNoTwo":
        "coApplicantMobileNoTwoOne",
      "coApplicantDetails_1.contactInformation.email": "coApplicantEmailOne",
      "coApplicantDetails_1.kycDetails.udyamRegistrationNo":
        "coApplicantUdyamRegistrationNoOne",
      "coApplicantDetails_1.kycDetails.docType": "coApplicantDocTypeOne",
      "coApplicantDetails_1.kycDetails.aadharNo": "coApplicantAadharNoOne",
      "coApplicantDetails_1.kycDetails.docNo": "coApplicantDocNoOne",
      "coApplicantDetails_1.permanentAddressInformation.presentAddress":
        "coApplicantAddressAsPerAdharOne",
      "coApplicantDetails_1.permanentAddressInformation.landmark":
        "coApplicantLandmarkOne",
      "coApplicantDetails_1.permanentAddressInformation.nameOfCity":
        "coApplicantNameOfCityOne",
      "coApplicantDetails_1.permanentAddressInformation.city":
        "coApplicantCityOne",
      "coApplicantDetails_1.permanentAddressInformation.state":
        "coApplicantStateOne",
      "coApplicantDetails_1.permanentAddressInformation.districtName":
        "coApplicantDistrictNameOne",
      "coApplicantDetails_1.permanentAddressInformation.pinCode":
        "coApplicantPinCodeOne",
      "coApplicantDetails_1.permanentAddressInformation.noOfyearsAtCurrentAddress":
        "coApplicantNoOfyearsAtCurrentAddressOne",
      "coApplicantDetails_1.permanentAddressInformation.country": "",
      "coApplicantDetails_1.presentAddressInformation.AddressAsPerAdhar":
        "coApplicantPresentAddressOne",
      "coApplicantDetails_1.presentAddressInformation.fullAddress":
        "coApplicantPresentAddressFullAddressOne",
      "coApplicantDetails_1.presentAddressInformation.landmark":
        "coApplicantPresentAddressLandmarkOne",
      "coApplicantDetails_1.presentAddressInformation.city":
        "coApplicantPresentAddressNameOfCityOne",
      "coApplicantDetails_1.presentAddressInformation.state":
        "coApplicantPresentAddressStateOne",
      "coApplicantDetails_1.presentAddressInformation.districtName":
        "coApplicantPresentAddressDistrictNameOne",
      "coApplicantDetails_1.presentAddressInformation.pinCode":
        "coApplicantPresentAddressPinCodeOne",
      "coApplicantDetails_1.presentAddressInformation.noOfyearsAtCurrentAddress":
        "coApplicantPresentAddressNoOfyearsAtCurrentAddressOne",
      "coApplicantDetails_1.presentAddressInformation.country": "",
      "coApplicantDetails_1.presentAddressInformation.residenceType":
        "coApplicantPresentAddressResidenceTypeOne",
      "coApplicantDetails_1.employeDetails.education":
        "coApplicantEducationDetailsOne",
      "coApplicantDetails_1.employeDetails.occupation":
        "coApplicantOccupationOne",
      "coApplicantDetails_1.employeDetails.udyamRegistrationNo":
        "coApplicantUdyamRegistrationNoOne",
      "coApplicantDetails_1.employeDetails.monthlyIncome":
        "coApplicantMonthlyIncomeOne",
      "coApplicantDetails_1.employeDetails.otherMonthlyIncome":
        "coApplicantOtherMonthlyIncomeOne",
      "coApplicantDetails_1.employeDetails.sourceOfOtherIncome":
        "coApplicantSourceOfOtherIncomeOne",
      "coApplicantDetails_2.ApplicantType": "coApplicantTypeTwo",
      "coApplicantDetails_2.bussinessType": "coApplicantBussinessTypeTwo",
      "coApplicantDetails_2.fullName": "coApplicantFullNameTwo",
      "coApplicantDetails_2.fatherName": "coApplicantFatherNameTwo",
      "coApplicantDetails_2.motherName": "coApplicantMotherNameTwo",
      "coApplicantDetails_2.dob": "coApplicantDobTwo",
      "coApplicantDetails_2.age": "coApplicantAgeTwo",
      "coApplicantDetails_2.gender": "coApplicantGenderTwo",
      "coApplicantDetails_2.maritalStatus": "coApplicantMaritalStatusTwo",
      "coApplicantDetails_2.educationDetails": "coApplicantEducationDetailsTwo",
      "coApplicantDetails_2.relationWithApplicant":
        "coApplicantRelationWithApplicantTwo",
      "coApplicantDetails_2.religion": "coApplicantReligionTwo",
      "coApplicantDetails_2.nationality": "coApplicantNationalityTwo",
      "coApplicantDetails_2.category": "coApplicantCategoryTwo",
      "coApplicantDetails_2.caste": "coApplicantCasteTwo",
      "coApplicantDetails_2.contactInformation.mobileNo":
        "coApplicantMobileNoTwo",
      "coApplicantDetails_2.contactInformation.mobileNoTwo":
        "coApplicantMobileNoTwoTwo",
      "coApplicantDetails_2.contactInformation.email": "coApplicantEmailTwo",
      "coApplicantDetails_2.kycDetails.udyamRegistrationNo":
        "coApplicantUdyamRegistrationNoTwo",
      "coApplicantDetails_2.kycDetails.docType": "coApplicantDocTypeTwo",
      "coApplicantDetails_2.kycDetails.aadharNo": "coApplicantAadharNoTwo",
      "coApplicantDetails_2.kycDetails.docNo": "coApplicantDocNoTwo",
      "coApplicantDetails_2.permanentAddressInformation.presentAddress":
        "coApplicantAddressAsPerAdharTwo",
      "coApplicantDetails_2.permanentAddressInformation.landmark":
        "coApplicantLandmarkTwo",
      "coApplicantDetails_2.permanentAddressInformation.nameOfCity":
        "coApplicantNameOfCityTwo",
      "coApplicantDetails_2.permanentAddressInformation.city":
        "coApplicantCityTwo",
      "coApplicantDetails_2.permanentAddressInformation.state":
        "coApplicantStateTwo",
      "coApplicantDetails_2.permanentAddressInformation.districtName":
        "coApplicantDistrictNameTwo",
      "coApplicantDetails_2.permanentAddressInformation.pinCode":
        "coApplicantPinCodeTwo",
      "coApplicantDetails_2.permanentAddressInformation.noOfyearsAtCurrentAddress":
        "coApplicantNoOfyearsAtCurrentAddressTwo",
      "coApplicantDetails_2.permanentAddressInformation.country": "",
      "coApplicantDetails_2.presentAddressInformation.AddressAsPerAdhar":
        "coApplicantPresentAddressTwo",
      "coApplicantDetails_2.presentAddressInformation.fullAddress":
        "coApplicantFullAddressTwo",
      "coApplicantDetails_2.presentAddressInformation.landmark":
        "coApplicantLandmarkTwo",
      "coApplicantDetails_2.presentAddressInformation.city":
        "coApplicantNameOfCityTwo",
      "coApplicantDetails_2.presentAddressInformation.state":
        "coApplicantStateTwo",
      "coApplicantDetails_2.presentAddressInformation.districtName":
        "coApplicantDistrictNameTwo",
      "coApplicantDetails_2.presentAddressInformation.pinCode":
        "coApplicantPinCodeTwo",
      "coApplicantDetails_2.presentAddressInformation.noOfyearsAtCurrentAddress":
        "coApplicantNoOfyearsAtCurrentAddressTwo",
      "coApplicantDetails_2.presentAddressInformation.country": "",
      "coApplicantDetails_2.presentAddressInformation.residenceType":
        "coApplicantPresentAddressResidenceTypeOne",
      "coApplicantDetails_2.employeDetails.education":
        "coApplicantEducationTwo",
      "coApplicantDetails_2.employeDetails.occupation":
        "coApplicantOccupationTwo",
      "coApplicantDetails_2.employeDetails.monthlyIncome":
        "coApplicantMonthlyIncomeTwo",
      "coApplicantDetails_2.employeDetails.otherMonthlyIncome":
        "coApplicantOtherMonthlyIncomeTwo",
      "coApplicantDetails_2.employeDetails.sourceOfOtherIncome":
        "coApplicantSourceOfOtherIncomeTwo",
      "coApplicantDetails_2.employeDetails.annualIncome":
        "coApplicantAnnualIncomeTwo",
      "coApplicantDetails_2.employeDetails.totalHouseHoldExpenses":
        "coApplicantTotalHouseHoldExpensesTwo",
      "guarantorInformation.GuarantorType": "guarantorGuarantorType", // guarantor
      "guarantorInformation.bussinessType": "guarantorBusinessType",
      "guarantorInformation.name": "guarantorName",
      "guarantorInformation.fatherName": "guarantorFatherName",
      "guarantorInformation.motherName": "guarantorMotherName",
      "guarantorInformation.spouseName": "guarantorSpouseName",
      "guarantorInformation.age": "guarantorAge",
      "guarantorInformation.gender": "guarantorGender",
      "guarantorInformation.maritalStatus": "guarantorMarritalStatus",
      "guarantorInformation.educationalDetails": "guarantorEducationalDetails",
      "guarantorInformation.dob": "guarantorDob",
      "guarantorInformation.religion": "guarantorReligion",
      "guarantorInformation.nationality": "guarantorNationality",
      "guarantorInformation.category": "guarantorCategory",
      "guarantorInformation.caste": "guarantorCaste",
      "guarantorInformation.contactInformation.mobileNo": "guarantorMobileNo",
      "guarantorInformation.contactInformation.mobileNoTwo":
        "guarantorMobileNoTwo",
      "guarantorInformation.contactInformation.email": "guarantorEmail",
      "guarantorInformation.permanentInformation.addressAsPerAdhar":
        "guarantorAddressAsPerAdhar",
      "guarantorInformation.permanentInformation.presentAddress":
        "guarantorPresentAddress",
      "guarantorInformation.permanentInformation.landmark": "guarantorLandmark",
      "guarantorInformation.permanentInformation.city": "guarantorCity",
      "guarantorInformation.permanentInformation.state": "guarantorState",
      "guarantorInformation.permanentInformation.district": "guarantorDistrict",
      "guarantorInformation.permanentInformation.pinCode": "guarantorPinCode",
      "guarantorInformation.permanentInformation.noOfyearsAtCurrentAddress":
        "guarantorNoOfyearsAtCurrentAddress",
      "guarantorInformation.permanentInformation.country": "guarantorCountry",
      "guarantorInformation.presentInformation.fullAddress":
        "guarantorPresentAddressFullAddress",
      "guarantorInformation.presentInformation.presentAddressAsPerAdhar":
        "guarantorPresentAddressAsPerAdhar",
      "guarantorInformation.presentInformation.landmark":
        "guarantorPresentAddressLandmark",
      "guarantorInformation.presentInformation.city":
        "guarantorPresentAddressCity",
      "guarantorInformation.presentInformation.state":
        "guarantorPresentAddressState",
      "guarantorInformation.presentInformation.district":
        "guarantorPresentAddressDistrict",
      "guarantorInformation.presentInformation.pinCode":
        "guarantorPresentAddressPinCode",
      "guarantorInformation.presentInformation.noOfyearsAtCurrentAddress":
        "guarantorPresentAddressNoOfyearsAtCurrentAddress",
      "guarantorInformation.presentInformation.country": "PresentCountry",
      "guarantorInformation.presentInformation.residenceType":
        "guarantorPresentAddressResidenceType",
      "propertyHolderInformation.nameOfDocumentHolder": "",
      "propertyHolderInformation.fatherName": "",
      "propertyHolderInformation.relationWithApplicant": "",
      "bankDetails.PropertyLocationDetails.houseNo": "houseNo",
      "bankDetails.PropertyLocationDetails.surveyNo": "surveyNo",
      "bankDetails.PropertyLocationDetails.patwariHalkaNo": "patwariHalkaNo",
      "bankDetails.PropertyLocationDetails.wardNo": "wardNo",
      "bankDetails.PropertyLocationDetails.villageName": "villageName",
      "bankDetails.PropertyLocationDetails.gramPanchayat": "gramPanchayat",
      "bankDetails.PropertyLocationDetails.tehsil": "PropertyTehsil",
      "bankDetails.PropertyLocationDetails.district": "PropertyDistrict",
      "bankDetails.PropertyLocationDetails.state": "PropertyState",
      "bankDetails.PropertyLocationDetails.fullAddressOfProperty":
        "fullAddressOfProperty",
      "bankDetails.propertyAddressAndLandmark.propertyLandMark":
        "propertyLandMark",
      "bankDetails.propertyAddressAndLandmark.fullAddressOfProperty":
        "fullAddressOfProperty",
      "bankDetails.propertyAddressAndLandmark.latitude": "latitude",
      "bankDetails.propertyAddressAndLandmark.longitude": "longitude",
      "bankDetails.propertySpecifications.typeOfProperty": "typeOfProperty",
      "bankDetails.propertySpecifications.totalLandAreaInSqFt":
        "totalLandAreaInSqFt",
      "bankDetails.propertySpecifications.totalBuiltUpAreaInSqFt":
        "totalBuiltUpAreaInSqFt",
      "bankDetails.propertySpecifications.typeOfConstruction":
        "typeOfConstruction",
      "bankDetails.propertySpecifications.qualityOfConstruction":
        "qualityOfConstruction",
      "bankDetails.propertySpecifications.ageOfProperty": "ageOfProperty",
      "bankDetails.PropertyBoundaries.eastBoundary": "eastBoundary",
      "bankDetails.PropertyBoundaries.westBoundary": "westBoundary",
      "bankDetails.PropertyBoundaries.northBoundary": "northBoundary",
      "bankDetails.PropertyBoundaries.southBoundary": "southBoundary",
      "bankDetails.PropertyValuation.landValue": "landValue",
      "bankDetails.PropertyValuation.constructionValue": "constructionValue",
      "bankDetails.PropertyValuation.fairMarketValueOfLand":
        "fairMarketValueOfLand",
      "bankDetails.PropertyValuation.realizableValue": "realizableValue",
      "technicalReport.receivedDate": "technicalReportReceivedDate",
      "technicalReport.status": "technicalReportStatus",
      "legalReport.receivedDate": "legalReportReceivedDate",
      "legalReport.status": "legalReportStatus",
      "legalReport.document1": "legalReportDocumentOne",
      "legalReport.document2": "legalReportDocumentTwo",
      "legalReport.document3": "legalReportDocumentThree",
      "legalReport.document4": "legalReportDocumentFour",
      "legalReport.document5": "legalReportDocumentFive",
      "legalReport.document6": "legalReportDocumentSix",
      "legalReport.document7": "legalReportDocumentSeven",
      "LoanDetail.customerDemandLoanAmount": "customerDemandLoanAmount",
      "LoanDetail.approvedAmount": "approvedAmount",
      "LoanDetail.finalDecision": "finalDecision",
      "LoanDetail.customerDemandLoanAmount": "",
      "LoanDetail.customerDemandLoanAmount": "",
      "LoanDetail.customerDemandLoanAmount": "",
      "LoanDetail.customerDemandLoanAmount": "",
    };

    // Step 4: Check if `customerFinId` exists
    const matchingRowIndex = dataRows.findIndex(
      (row) => row[customerFinIdIndex] === customerFinId
    );

    // Helper function to get column letters
    const getColumnLetter = (index) => {
      let letter = "";
      while (index >= 0) {
        letter = String.fromCharCode((index % 26) + 65) + letter;
        index = Math.floor(index / 26) - 1;
      }
      return letter;
    };

    if (matchingRowIndex !== -1) {
      // Step 5: Update the matching row in a batch
      const existingRow = dataRows[matchingRowIndex];
      const updatedRowIndex = matchingRowIndex + 2; // Adjust for header and zero-based index
      const batchUpdates = [];

      for (const [bodyKey, headerKey] of Object.entries(keyMapping)) {
        const columnIndex = headers.indexOf(headerKey);
        if (columnIndex !== -1) {
          const keys = bodyKey.split(".");
          let newValue = req.body;

          for (const key of keys) {
            if (newValue && newValue[key] !== undefined) {
              newValue = newValue[key];
            } else {
              newValue = existingRow[columnIndex] || "";
              break;
            }
          }

          batchUpdates.push({
            range: `${sheetName}!${getColumnLetter(
              columnIndex
            )}${updatedRowIndex}`,
            values: [[newValue]],
          });
        }
      }

      // Use batchUpdate to minimize API calls
      await sheets.spreadsheets.values.batchUpdate({
        spreadsheetId,
        requestBody: {
          data: batchUpdates.map((update) => ({
            range: update.range,
            values: update.values,
          })),
          valueInputOption: "RAW",
        },
      });

      return res
        .status(200)
        .json({ message: "Row updated successfully", updated: batchUpdates });
    } else {
      // Step 6: Add a new row in a batch
      const newRow = headers.map((header) => {
        const bodyKey = Object.keys(keyMapping).find(
          (key) => keyMapping[key] === header
        );

        if (bodyKey) {
          const keys = bodyKey.split(".");
          let value = req.body;

          for (const key of keys) {
            if (value && value[key] !== undefined) {
              value = value[key];
            } else {
              value = "";
              break;
            }
          }
          return value;
        }

        return "";
      });

      await sheets.spreadsheets.values.append({
        spreadsheetId,
        range: sheetName,
        valueInputOption: "RAW",
        requestBody: {
          values: [newRow],
        },
      });

      return res.status(201).json({ message: "New row added successfully" });
    }
  } catch (error) {
    console.error(error);
    return res.status(500).json({
      error: "An unknown error occurred",
      details: error.message,
    });
  }
};

// const selectPartner = async (req, res) => {
//   try {
//     const { customerId, partnerId } = req.query;

//     const customerDetails = await customerModel.findById(customerId)
//     if(!customerDetails){
//       return notFound(res , "Customer Not Found ")
//     }
    
//     const pertnerDetails = await lendersModel.findById(partnerId)
//     if(!pertnerDetails){
//       return notFound(res , "Parnter Not Found ")
//     }


//     // Find the external vendor form data by customerId
   
//     const externalVendorFormData = await externalVendorFormModel.findOne({
//       customerId,
//     });

//     await finalModel.findOneAndUpdate(
//       { customerId }, // Filter criteria
//       { partnerId }, // Update document
//       {  new: true, upsert:true } 
//     );

// success(res , "Vendor status updated successfully", partnerId );

//       await processModel.findOneAndUpdate(
//         { customerId },
//         { $set: {
//           partnerSelection:true
//         } },
//         { new: true }
//     ); 

//       await fileProcessSheet(customerId)
//   } catch (error) {
//     console.error(error);
//     return res
//       .status(500)
//       .json({ error: "An unknown error occurred", details: error.message });
//   }
// };

const selectPartner = async (req, res) => {
  try {
    const { customerId, partnerId } = req.query;
    const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");

    const customer = await customerModel.findById(customerId).lean();
    if (!customer) {
      return notFound(res, "Customer not found");
    }

    const partnerDetails = await lendersModel.findById(partnerId).select("fullName");
    if (!partnerDetails) {
      return notFound(res, "Partner Not Found");
    }

    await finalModel.findOneAndUpdate(
      { customerId },
      { partnerId },
      { new: true, upsert: true }
    );


    const lender = await lenderModel.findOne({
      _id: partnerId,
      "venders.branch": new ObjectId(customer.branch),
      "venders.reportType": "rcu",
    });

    let responseMessage = "Partner Selected Successfully"; // Default response
    let rcuAssigned = false;

    if (lender) {

      for (let vender of lender.venders) {
        if (
          String(vender.branch) === String(customer.branch) &&
          vender.reportType === "rcu"
        ) {
          const vendorDetail = await vendorModel.findById(vender.vender);
          if (!vendorDetail || vendorDetail.status !== "active") {
            continue;
          }


          const externalVendor = await externalVendorFormModel.findOne({
            customerId: customer._id,
            "vendors.vendorType": "rcu",
          });

          if (externalVendor) {
            let vendorIndex = externalVendor.vendors.findIndex(
              (v) => v.vendorType === "rcu"
            );

            if (vendorIndex !== -1) {
              let vendorStatus = externalVendor.vendors[vendorIndex].statusByVendor;

              if (vendorStatus === "WIP") {
                // And RCU Already Assigned
                responseMessage = "Partner Selected Successfully";
              } else if (vendorStatus === "approved") {
                // And RCU Already Approved
                responseMessage = "Partner Selected Successfully";
              } else if (vendorStatus === "rejected") {
                // And RCU Already Rejected
                responseMessage = "Partner Selected Successfully";
              } else {
                await externalVendorFormModel.updateOne(
                  { customerId: customer._id, "vendors.vendorType": "rcu" },
                  {
                    $set: {
                      [`vendors.${vendorIndex}.vendorId`]: vender.vender,
                      [`vendors.${vendorIndex}.assignDate`]: todayDate,
                      [`vendors.${vendorIndex}.statusByVendor`]: "WIP",
                    },
                  }
                );
                rcuAssigned = true;
                responseMessage = "Partner Selected Successfully And RCU File Assigned";
              }
            }
          } else {
            await externalVendorFormModel.updateOne(
              { customerId: customer._id },
              {
                $push: {
                  vendors: {
                    vendorType: "rcu",
                    vendorId: vender.vender,
                    assignDocuments: [],
                    pdfRemark: "",
                    statusByVendor: "WIP",
                    assignDate: todayDate,
                  },
                },
              },
              { upsert: true }
            );
            rcuAssigned = true;
            responseMessage = "Partner Selected Successfully And RCU File Assigned";
          }

        }
      }
    }


    await processModel.findOneAndUpdate(
      { customerId },
      { $set: { partnerSelection: true } },
      { new: true }
    );


    // Send the final response after all logic runs
    success(res, responseMessage, partnerDetails);
  } catch (error) {
    console.error("Error in selectPartner:", error);
    return unknownError(res, error);
  }
};





// const selectPartner = async (req, res) => {
//   try {
//     const { customerId, partnerId } = req.query;
//     const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");

//     const customer = await customerModel.findById(customerId).lean();
//     if (!customer) {
//       return notFound(res, "Customer not found");
//     }

//     const partnerDetails = await lendersModel.findById(partnerId);

//     if (!partnerDetails) {
//       return notFound(res, "Partner Not Found");
//     }

//     console.log(' API TEST -----')

//     await finalModel.findOneAndUpdate(
//       { customerId },
//       { partnerId },
//       { new: true, upsert: true }
//     );


//     const lender = await lenderModel.findOne({
//       _id: partnerId,
//       "venders.branch": new ObjectId(customer.branch),
//       "venders.reportType": "rcu",
//     });

//     console.log('lender derail')

//     if (lender) {
//       let rcuAssigned = false;
//       for (let vender of lender.venders) {
//         if (String(vender.branch) === String(customer.branch) && vender.reportType === "rcu") {
//           const vendorDetail = await vendorModel.findById(vender.vender);
//           if (vendorDetail && vendorDetail.status === "active") {

//             const externalVendor = await externalVendorFormModel.findOne({
//               customerId: customer._id,
//               "vendors.vendorType": "rcu",
//             });

//             if (externalVendor) {
//               let vendorIndex = externalVendor.vendors.findIndex(v => v.vendorType === "rcu");

//               if (vendorIndex !== -1) {
//                 let vendorStatus = externalVendor.vendors[vendorIndex].statusByVendor;

//                 if (vendorStatus === "WIP") {
//                    success(res, "Partner Select And RCU Already Assigned",partnerDetails);
//                 } else if (vendorStatus === "approved") {
//                    success(res, "Partner Select And RCU Already Approve",partnerDetails);
//                 } else if (vendorStatus === "rejected") {
//                    success(res, "Partner Select And RCU Already Rejected",partnerDetails);
//                 } else {
//                   await externalVendorFormModel.updateOne(
//                     {
//                       customerId: customer._id,
//                       "vendors.vendorType": "rcu",
//                     },
//                     {
//                       $set: {
//                         [`vendors.${vendorIndex}.vendorId`]: vender.vender,
//                         [`vendors.${vendorIndex}.assignDate`]: todayDate,
//                         [`vendors.${vendorIndex}.statusByVendor`]: "WIP",
//                       },
//                     }
//                   );
//                   rcuAssigned = true;
//                   console.log('lender derail 2---')
//                   success(res, "Partner Select successfully And RCU File Assign",partnerDetails);
//                 }
//               }
//             } else {
//               await externalVendorFormModel.updateOne(
//                 { customerId: customer._id },
//                 {
//                   $push: {
//                     vendors: {
//                       vendorType: "rcu",
//                       vendorId: vender.vender,
//                       assignDocuments: [],
//                       pdfRemark: "",
//                       statusByVendor: "WIP",
//                       assignDate: todayDate,
//                     },
//                   },
//                 },
//                 { upsert: true }
//               );
//               rcuAssigned = true;
//             }
//             success(res, "Partner Select successfully And RCU File Assign",partnerDetails);
//           }else{
//             // And RCU Vendor Not Active
//             console.log('lender derail  3-----')
//             success(res, "Partner Select successfully",partnerDetails);
//           }
//         }
//       }

//       console.log('lender derail 1.5 -----')
//       if (rcuAssigned) {
//          success(res, "Partner Select successfully And RCU File Assign",partnerDetails);
//       }
//     } else {
//       // But No Matching Vendor Found
//       console.log('lender derail 4-----')
//        success(res, "Partner Selected Successfully", partnerDetails);
//     }

//     await processModel.findOneAndUpdate(
//       { customerId },
//       { $set: { partnerSelection: true } },
//       { new: true }
//     );

//     // await fileProcessSheet(customerId)

//   } catch (error) {
//     console.log(error);
//     return unknownError(res, error);
//   }
// };

const getPartnerDetails = async (req, res) => {
  try {
    const { customerId } = req.query;

    const customer = await customerModel.findById(customerId).select('_id fullName').lean();
    if (!customer) {
      return notFound(res, "Customer not found");
    }

    const partnerInfo = await finalModel.findOne({ customerId })
      .populate("partnerId", "_id fullName")
      .lean(); 

    if (!partnerInfo || !partnerInfo.partnerId) {
      return notFound(res, "Partner not found");
    }

    // Return the response with the necessary details
    const result = {
        customerFinId  :customer.customerFinId,
        partnerId : partnerInfo.partnerId._id,
        fullName: partnerInfo.partnerId.fullName
    };

    return success(res, "Partner Details Successfully", result);
  } catch (error) {
    console.error("Error in getPartnerDetails:", error);
    return unknownError(res, error);
  }
};




const addQuery = async (req, res) => {
  try {
    const { customerId, query, resolve, queryType, resolveType } = req.body;

    if (!customerId || !query) {
      return badRequest(res, "Customer ID, query, and query type are required");
    }

    const employee = await employeeModel.findOne({
      _id: req.Id,
      status: "active",
    });
    if (!employee) {
      return res.status(404).json({ error: "Employee not found or inactive" });
    }

    let result;

    if (resolve && resolveType) {
      console.log("Updating query with resolve details >>>>>>");

      result = await externalVendorFormModel.updateMany(
        { customerId },
        {
          $set: {
            "queryDetails.$[queryFilter].resolve": resolve,
            "queryDetails.$[queryFilter].resolveType": resolveType,
            "queryDetails.$[queryFilter].resolveEmployeeId": req.Id,
          },
        },
        {
          arrayFilters: [{ "queryFilter.query": query }],
        }
      );

      console.log("Update result >>>>>>", result);

      if (result.matchedCount === 0) {
        return res
          .status(404)
          .json({ error: "No matching query found to resolve" });
      }

      if (result.modifiedCount === 0) {
        return res
          .status(400)
          .json({ error: "Queries found but could not be updated" });
      }

      return res.status(200).json({ message: "Query resolved successfully" });
    } else {
      // Add a new query
      console.log("Adding new query >>>>>>");

      result = await externalVendorFormModel.updateOne(
        { customerId },
        {
          $push: {
            queryDetails: {
              query,
              queryType,
              queryEmployeeId: req.Id,
            },
          },
        },
        { upsert: true } // Ensure the document is created if it doesn't exist
      );

      console.log("Add query result >>>>>>", result);

      if (result.matchedCount === 0 && !result.upsertedCount) {
        return res.status(404).json({ error: "Customer not found" });
      }

      if (result.modifiedCount === 0 && !result.upsertedCount) {
        return res.status(400).json({ error: "Query could not be added" });
      }

      return res.status(200).json({ message: "Query added successfully" });
    }
  } catch (error) {
    console.error("Error in addOrUpdateQuery API >>>>>>", error);
    return res
      .status(500)
      .json({ error: "An unknown error occurred", details: error.message });
  }
};

const getQuery = async (req, res) => {
  try {
    const { customerId } = req.query;
    if (!customerId) {
      return res.status(400).json({ error: "Customer ID  are required" });
    }
    const data = await externalVendorFormModel.findOne({ customerId });
    return res
      .status(200)
      .json({ message: "Query list", data: data?.queryDetails || [] });
  } catch (error) {
    console.error("Error in addQuery API >>>>>>", error);
    console.error(error);
    return unknownError(res, error);
  }
};


async function downloadCamReport(req, res) {
  const spreadsheetId = "1K9EnCErm-NfZCg7--TJtkfOqzPyGc-c5eLrWELS3kMA"; // Your spreadsheet ID
  const sheetName = "Sheet1"; // Your sheet name

  const auth = new google.auth.GoogleAuth({
    credentials,
    scopes: ["https://www.googleapis.com/auth/spreadsheets.readonly"],
  });

  const authClient = await auth.getClient();

  // Construct the export URL for the specified spreadsheet
  const exportUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=xlsx&sheet=${sheetName}`;

  try {
    // Get the access token
    const token = await authClient.getAccessToken();

    // Download the file using Axios with the access token
    const response = await axios.get(exportUrl, {
      responseType: "stream",
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });

    // Set response headers for file download
    res.setHeader(
      "Content-Type",
      "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    );
    res.setHeader(
      "Content-Disposition",
      `attachment; filename="${sheetName}.xlsx"`
    );

    // Pipe the file stream to the response
    response.data.pipe(res);
  } catch (err) {
    console.error("Error during export:", err.message);
  }
}

const SelectSelection = async (req, res) => {
  try {
    const { selection, customerId } = req.body; // Ensure both are passed in the request body

    if (!customerId || !selection) {
      return badRequest(res, "customerId and selection are required");
    } 

    const updatedDocument = await finalModel.findOneAndUpdate(
      { customerId }, // Find by customerId
      { pdfSelection: selection }, // Update pdfSelection field
      { upsert: true, new: true } // Create new document if none exists
    );

    return success(res, "Selection updated successfully", {
      updatedDocument,
    });
  } catch (error) {
    // console.error("Error in SelectSelection API >>>>>>", error);
    console.error(error);
    return unknownError(res, error);
  }
};

// const IncomeSanctionsendToPartner = async (req, res) => {
//   try {
//     const { customerId } = req.query;

//     const partnerData = await finalModel.findOne({ customerId })

//     if (!partnerData) {
//       return badRequest(res, "partner's is required.");
//     }
//     const partnerModel = await lendersModel.findOne({ _id: partnerData.partnerId });
//     if (!partnerModel) {
//       return badRequest(res, "Partner not found.");
//     }

//     const normalizedPartnerName = (partnerModel.fullName || "")
//       .trim()
//       .toLowerCase();

//     if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
//       // Ratna logic
//       let selectionData = partnerData?.pdfSelection || 'acg';
//       console.log(selectionData,"selectionDataselectionData")
//       if (!selectionData || typeof selectionData !== "string") {
//         selectionData = "ac";
//       }

//       const sectionData = await incomeSanctionLatter(customerId);
//       if (!sectionData) {
//         return badRequest(res, "sectionData not found.");
//       }

//      const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;
//      console.log(uploadUrl,"uploadUrl")
//     // console.log(uploadUrl,"uploadUrluploadUrl")

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//           // console.log("Resolved File Path: ", resolvedPath);
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         // console.log("File Stream: ", fs.existsSync(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {

//           headers: { ...formData.getHeaders() },
//         });
//         // console.log("Upload Response: ", response.data);

//         return response.data?.items;
//       };
//       // console.log("Section Data Path: ", sectionData);
//       const uploadedSectionUrl = await processFile(sectionData);
//       // console.log("Applicant Data Path: ", applicantData);
//       // const uploadedApplicantUrl = await processFile(applicantData);
//       // console.log("LdAndPdDeed Data Path: ", LdAndPdDeedData);
//       // const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);

//       return success(res, "pdf urls are", {
//         sectionLatter: `${process.env.BASE_URL}${uploadedSectionUrl.image}`,
//         // LdAndPdDeed: `${process.env.BASE_URL}${uploadedLdAndPdDeedUrl.image}`,
//         // applicantionLatter: `${process.env.BASE_URL}${uploadedApplicantUrl.image}`,

//         //new upload
//         // sectionLatter: `${uploadedSectionUrl.image}`,
//         // LdAndPdDeed: `${uploadedLdAndPdDeedUrl.image}`,
//         // applicantionLatter: `${uploadedApplicantUrl.image}`,
//       });
//     }

//   } catch (error) {
//     console.error(error);
//     return unknownError(res, error);
//   }
// };

const IncomeSanctionsendToPartner = async (req, res) => {
  try {
    let { customerId } = req.query;

    const bankData = await bankStatementModel.findOne({ customerId });
    //disbursementModel
    const kfsData = await disbursementModel.findOne({ customerId });
    const applicant = await applicantModel.findOne({ customerId });
    const coapplicant = await coApplicantModel.findOne({ customerId });
    const secondRecord = await coApplicantModel.findOne({ customerId }).sort({ createdAt: 1 }).skip(1);
    
   console.log(secondRecord,"secondRecord")
    const gauranter = await guarantorModel.findOne({ customerId });
    const cibilData = await cibilModel.findOne({ customerId });
    const customerDetails = await customerModel.findById({ _id: (customerId) });
    
    //technicalApproveFormModel
   const technicalData = await technicalApproveFormModel.findOne({ customerId });

  const pdformdatasDetail = await creditPdModel.findOne({ customerId });

//sanctionPendencyModel
const sanctionPendencyData = await sanctionPendencyModel.findOne({ customerId });

    const finalData = await finalModel.findOne({ customerId });

    const bankKycsDEtails = await bankDeatilsKycs.findOne({ customerId });
    

    const bankDetail = bankKycsDEtails?.bankDetails?.find(
      (detail) => detail.E_Nach_Remarks === "true"
    ) || {}; // Default to an empty object if no bank details are found

    const bankDetails = {
      bankName: bankDetail?.bankName || "NA",
      accNo: bankDetail?.accountNumber || "NA",
     
    };
    const technicalrequiredFields = [
      "fullAddressOfProperty",
      "nameOfDocumentHolder",
      "totalLandArea",
      "totalBuiltUpArea",
    ];

    const customerrequiredFields = [
      "customerFinId", 
    ];
    
  
const finalSanctionrequiredFields = [
  "finalLoanAmount",
  "tenureInMonth",
  "EndUseOfLoan",
  "emiAmount",
  "roi",
  "loanAmountInWords", 
];

// finalSanctionrequiredFields.forEach((field) => {
//   if (!finalData[field] || finalData[field].trim() === "") {
//     // missingFields[field] = `${field} is required.`;
//     return badRequest(res, `final Sanction ${field} is required.`);
//   }
// });

// technicalrequiredFields.forEach((field) => {
//   if (!technicalData[field] || technicalData[field].trim() === "") {
//     // missingFields[field] = `${field} is required.`;
//     return badRequest(res, `These ${field} is required.`);

//   }
// });

// finalSanctionrequiredFields.forEach((field) => {
//   if (!customerDetails[loginFees] || customerDetails[loginFees].trim() === "") {
//     // missingFields[field] = `${field} is required.`;
//     return badRequest(res, `These ${field} is required.`);

//   }
// });

const errors = []; 
finalSanctionrequiredFields.forEach((field) => {
  if (!finalData?.[field] || String(finalData[field]).trim() === "") {
    errors.push(`final Sanction ${field} is required.`);
  }
});


technicalrequiredFields.forEach((field) => {
  if (!technicalData?.[field] || String(technicalData[field]).trim() === "") {
    errors.push(`property paper field ${field} is required.`);
  }
});

customerrequiredFields.forEach((field) => {
  if (!customerDetails?.[field] || String(customerDetails[field]).trim() === "") {
    errors.push(`Customer field ${field} is required.`);
  }
});

if (!bankDetails?.bankName || bankDetails?.bankName === "NA") {
  errors.push("applicant Bank Name is required.");
}
if (!bankDetails?.accNo || bankDetails?.accNo === "NA") {
  errors.push("applicant Bank Account Number is required.");
}
if (!applicant?.fullName || applicant?.fullName === "") {
  errors.push("applicant  Name is required.");
}

if (!applicant?.localAddress?.addressLine1 || applicant.localAddress.addressLine1 === "") {
  errors.push("applicant  address is required.");
}

// if (!gauranter?.fullName || gauranter?.fullName === "") {
//   errors.push("gauranter  Name is required.");
// }

if (!coapplicant?.fullName || coapplicant?.fullName === "") {
  errors.push("coapplicant1  Name is required.");
}
// if (!coapplicant[1].fullName || coapplicant[1].fullName === "") {
//   errors.push("applicant  Name is required.");
// }
// const  coapp2=coApplicantDetails[1]?.fullName || "NA" ;
// console.log("coapp2",coapp2)
if (finalData.pdfSelection === "accg" || finalData.pdfSelection === "acc") {
  if (!secondRecord.fullName || secondRecord.fullName === "") {
    errors.push("Co-applicant2 Name is required.");
  }
}

if (finalData.pdfSelection === "accg" || finalData.pdfSelection === "acg") {
  if (!gauranter?.fullName || gauranter?.fullName === "") {
    errors.push("Co-applicant2 Name is required.");
  }
}

// if (errors.length > 0) {
//   return badRequest(res,{ errors }); // Return all errors as an array
// }

if (errors.length > 0) {
  return badRequestwitherror(res, "Failed to generate incomeSanction PDF", errors,); // Pass errors with a descriptive structure
}



// if(customerId){
//   console.log(secondRecord,"secondRecord")

// }

    const sectionData = await incomesectionLatter(customerId);

    // call the DissionBox API //

    const disissionBoxResult = await DissionBox({
      customerId,
      employeeId: req.Id,
      IncomeSanction: "completed",
    });

    success(res, "income Sanction pdf generated successfully.",sectionData)
    await processModel.findOneAndUpdate(
      { customerId },
      { $set: {
        incomeSanctionGeneration:true
      } },
      { new: true }
  );
  await finalApprovalSheet(customerId)
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const IncomeSanctionSendEmail = async (req, res) => {
  try {
    let { customerId } = req.query;
    const partnerData = await finalModel.findOne({ customerId });
    const partnerModel = await lendersModel.findOne({
      _id: partnerData.partnerId,
    });

    console.log(req.query, "<><><><><><><><>");
    const sectionincomeData = await incomesectionLatter(customerId);

    const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;
    console.log(uploadUrl, "uploadUrl");

    const processFile = async (filePath) => {
      let resolvedPath = path
        .resolve(__dirname, `../../../..${filePath}`)
        .replace(/\\/g, "/");
      const formData = new FormData();
      formData.append("image", fs.createReadStream(resolvedPath));
      const response = await axios.post(uploadUrl, formData, {
        headers: { ...formData.getHeaders() },
      });
      return response.data?.items;
    };

    const uploadedincSectionUrl = await processFile(sectionincomeData);
    console.log(uploadedincSectionUrl, "uploadedincSectionUrl");

    const BASEURL = process.env.BASE_URL;

    // Attachments for the email
    const attachments = [
      {
        path: `${BASEURL}${uploadedincSectionUrl.image}`,
        contentType: "sanction/pdf",
      },
    ];
    console.log(attachments, "attachmentsattachmentsattachments");

    const emailContent = `
      <div style="font-family: Arial, sans-serif; line-height: 1.6;">
        <p>Dear Sir,</p>
        <p>Caption case Report is for final approval.</p>
        <p>Need your immediate action in this case.</p>
        <p>Regards,</p>
        <p>Team FinCoopers</p>
      </div>
    `;

    // Sending email with eSign links in the email body
    await sendEmail(
      [partnerModel.sanctionEmailTo],
      ["akashsharma199425@gmail.com"],
      [partnerModel.sanctionEmailCc],
      `Final approval email for review`,
      emailContent,
      attachments
    );

    // Responding with eSign links and success message
    return success(
      res,
      "email sent successfully"
      //   {
      //   ...esignLinks,
      // }
    );
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// const allLegalPdfs = async (req, res) => {
//   try {
//     let { customerId,loanType,propertyType,LegalType } = req.query;

//     if (loanType === "NEW" && propertyType === "newCoownership" && LegalType === "NewLegal") {
//     const sectionData = await legalPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const legalPdfUrl = `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     // Update the database
//     await internalLegalModel.findOneAndUpdate(
//       { customerId }, // Query to find the specific customer document
//       {
//         Generate_new_legal: "true",
//         Generate_new_legal_link: legalPdfUrl,
//       },
//       { new: true, upsert: false } // Options: Return the updated document, don't create a new one
//     );

//     return success(res, "PDF generated  successfully.", {
//       legalPdf: legalPdfUrl,
//     });
//   }else if (loanType === "NEW" && propertyType === "newCoownership" && LegalType === "FinalLegal") {
//     const sectionData = await finallegalPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const finalLegalPdfUrl=`${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId }, // Query to find the specific customer document
//       {
//         Generate_final_legal: "true",
//         Generate_final_legal_link:finalLegalPdfUrl,
//       },
//       { new: true, upsert: false } // Options: Return the updated document, don't create a new one
//     );

//     return success(res, "pdf generated successfully.", {
//       finalLegalPdf:finalLegalPdfUrl,
//     });
//   }else if (loanType === "NEW" && propertyType === "newCoownership" && LegalType === "Vetting") {
//     const sectionData = await vettingPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//    const vettingPdfUrl= `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_vetting_Report: "true",
//         Generate_vetting_Report_link:vettingPdfUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       vettingPdf: vettingPdfUrl,
//     });
//   }
//   else if (loanType === "NEW" && propertyType === "7PagerPatta" && LegalType === "FinalLegal") {
//     const sectionData = await sevenPagerpdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const  SevenPagerLegalPdfUrl= `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_final_legal: "true",
//         Generate_final_legal_link:SevenPagerLegalPdfUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       SevenPagerLegalPdf: SevenPagerLegalPdfUrl,
//     });
//   }
//   else if (loanType === "NEW" && propertyType === "7PagerPatta" && LegalType === "Vetting") {
//     const sectionData = await sevenPagervettingPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const sevenPagervettingPdfUrl =`${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_vetting_Report: "true",
//         Generate_vetting_Report_link:sevenPagervettingPdfUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       sevenPagervettingPdf: sevenPagervettingPdfUrl,
//     });
//   }
//   else if (loanType === "BT" && propertyType === "7PagerPatta" && LegalType === "FinalLegal") {
//     const sectionData = await BtsevenPagerLegalpdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const  BtSevenPagerLegalPdfUrl= `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_final_legal: "true",
//         Generate_final_legal_link:BtSevenPagerLegalPdfUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       BtsevenPagerLegalpdf: BtSevenPagerLegalPdfUrl,
//     });
//   }
//   else if (loanType === "BT" && propertyType === "7PagerPatta" && LegalType === "Vetting") {
//     const sectionData = await bt7PagervettingPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const BtsevenPagervettingPdfUrl =`${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_vetting_Report: "true",
//         Generate_vetting_Report_link:BtsevenPagervettingPdfUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       bt7Pagervetting: BtsevenPagervettingPdfUrl,
//     });
//   }
//   else if (loanType === "NEW" && propertyType === "executedCoownership" && LegalType === "FinalLegal") {
//     const sectionData = await executedfinallegalPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);
//     const  newexecutedfinallegalUrl= `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_final_legal: "true",
//         Generate_final_legal_link:newexecutedfinallegalUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       newexecutedfinallegal: newexecutedfinallegalUrl,
//     });
//   }
//   else if (loanType === "NEW" && propertyType === "executedCoownership" && LegalType === "Vetting") {
//     const sectionData = await executedvettingPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const newexecutedvettingUrl =`${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_vetting_Report: "true",
//         Generate_vetting_Report_link:newexecutedvettingUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       newexecutedvetting: newexecutedvettingUrl,
//     });
//   }
//   else if (loanType === "BT" && propertyType === "executedCoownership" && LegalType === "FinalLegal") {
//     const sectionData = await executedfinallegalPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);
//     const  BtwexecutedfinallegalUrl= `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_final_legal: "true",
//         Generate_final_legal_link:BtwexecutedfinallegalUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       btexecutedfinallegal: BtwexecutedfinallegalUrl,
//     });
//   }
//   else if (loanType === "BT" && propertyType === "executedCoownership" && LegalType === "Vetting") {
//     const sectionData = await executedvettingPdf(customerId);

//     const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     const processFile = async (filePath) => {
//       let resolvedPath = path
//         .resolve(__dirname, `../../../..${filePath}`)
//         .replace(/\\/g, "/");
//       const formData = new FormData();
//       formData.append("image", fs.createReadStream(resolvedPath));
//       const response = await axios.post(uploadUrl, formData, {
//         headers: { ...formData.getHeaders() },
//       });
//       return response.data?.items;
//     };

//     const uploadedincomeSectionUrl = await processFile(sectionData);

//     const BtexecutedvettingUrl =`${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//     await internalLegalModel.findOneAndUpdate(
//       { customerId },
//       {
//         Generate_vetting_Report: "true",
//         Generate_vetting_Report_link:BtexecutedvettingUrl,
//       },
//       { new: true, upsert: false }
//     );

//     return success(res, "pdf generated successfully.", {
//       btexecutedvetting: BtexecutedvettingUrl,
//     });
//   }
//   } catch (error) {
//     console.log(error);
//     return unknownError(res, error);
//   }

// };

const allLegalPdfs = async (req, res) => {
  try {
    // let { customerId,loanType,propertyType,LegalType } = req.body;

    const {
      customerId,
      loanType,
      LegalType,
      propertyType,
      propertyPaperType,
      selectedBuyer,
      selectedSeller,
      btBankName,
      propertyOwnerName,
      propertyOwnerFatherName,
      tableRows,
      newLegalLink,
      finalLegalLink,
      vettingReportLink,
      sellerFatherName,
      sealandSignedBy,
    } = req.body;

    // Fetch the existing record
    const existingData = await internalLegalModel.findOne({ customerId });

    // Construct updated data dynamically
    const legalData = {
      sellerFatherName:
        sellerFatherName || existingData?.sellerFatherName || null,
      // SealandSignedBy: sealandSignedBy|| existingData?.SealandSignedBy?.signedBy || null,
      LoanType: loanType || existingData?.LoanType || null,
      LegalType: LegalType || existingData?.LegalType || null,
      propertyPaperType:
        propertyPaperType || existingData?.propertyPaperType || null,
      buyerName: selectedBuyer || existingData?.buyerName || null,
      sellerName: selectedSeller || existingData?.sellerName || null,
      BT_BANK_NAME: btBankName || existingData?.BT_BANK_NAME || null,
      PropertyOwnerName:
        propertyOwnerName || existingData?.PropertyOwnerName || null,
      PropertyOwnerFatherName:
        propertyOwnerFatherName ||
        existingData?.PropertyOwnerFatherName ||
        null,
      pramanPatra: {
        no:
          tableRows?.find((row) => row.particular === "PRAMAN PATRA")?.number ||
          existingData?.pramanPatra?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "PRAMAN PATRA")?.date ||
          existingData?.pramanPatra?.date ||
          null,
      },
      taxReceipt: {
        no:
          tableRows?.find((row) => row.particular === "TAX RECEIPT")?.number ||
          existingData?.taxReceipt?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "TAX RECEIPT")?.date ||
          existingData?.taxReceipt?.date ||
          null,
      },
      co_ownership_deed: {
        no:
          tableRows?.find((row) => row.particular === "CO-OWNERSHIP DEED")
            ?.number ||
          existingData?.co_ownership_deed?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "CO-OWNERSHIP DEED")
            ?.date ||
          existingData?.co_ownership_deed?.date ||
          null,
      },
      EM_DEED: {
        no:
          tableRows?.find((row) => row.particular === "EM DEED")?.number ||
          existingData?.EM_DEED?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "EM DEED")?.date ||
          existingData?.EM_DEED?.date ||
          null,
      },
      gramPanchayat: {
        no:
          tableRows?.find((row) => row.particular === "GRAM PANCHAYAT PATTA")
            ?.number ||
          existingData?.gramPanchayat?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "GRAM PANCHAYAT PATTA")
            ?.date ||
          existingData?.gramPanchayat?.date ||
          null,
      },
      Noc_certificate: {
        no:
          tableRows?.find((row) => row.particular === "NOC CERTIFICATE")
            ?.number ||
          existingData?.Noc_certificate?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "NOC CERTIFICATE")
            ?.date ||
          existingData?.Noc_certificate?.date ||
          null,
      },
      Buliding_Permission_Certificate: {
        no:
          tableRows?.find(
            (row) => row.particular === "BUILDING PERMISSION CERTIFICATE"
          )?.number ||
          existingData?.Buliding_Permission_Certificate?.no ||
          null,
        date:
          tableRows?.find(
            (row) => row.particular === "BUILDING PERMISSION CERTIFICATE"
          )?.date ||
          existingData?.Buliding_Permission_Certificate?.date ||
          null,
      },
      Mutation_Certificate: {
        no:
          tableRows?.find((row) => row.particular === "MUTATION CERTIFICATE")
            ?.number ||
          existingData?.Mutation_Certificate?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "MUTATION CERTIFICATE")
            ?.date ||
          existingData?.Mutation_Certificate?.date ||
          null,
      },
      Owner_Certificate: {
        no:
          tableRows?.find((row) => row.particular === "OWNER CERTIFICATE")
            ?.number ||
          existingData?.Owner_Certificate?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "OWNER CERTIFICATE")
            ?.date ||
          existingData?.Owner_Certificate?.date ||
          null,
      },
      Property_Tax_Reciept: {
        no:
          tableRows?.find((row) => row.particular === "PROPERTY TAX RECEIPT")
            ?.number ||
          existingData?.Property_Tax_Reciept?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "PROPERTY TAX RECEIPT")
            ?.date ||
          existingData?.Property_Tax_Reciept?.date ||
          null,
      },
      RM_DEED: {
        no:
          tableRows?.find((row) => row.particular === "RM DEED")?.number ||
          existingData?.RM_DEED?.no ||
          null,
        date:
          tableRows?.find((row) => row.particular === "RM DEED")?.date ||
          existingData?.RM_DEED?.date ||
          null,
      },
      Generate_new_legal_link:
        newLegalLink || existingData?.Generate_new_legal_link || null,
      Generate_final_legal_link:
        finalLegalLink || existingData?.Generate_final_legal_link || null,
      Generate_vetting_Report_link:
        vettingReportLink || existingData?.Generate_vetting_Report_link || null,
    };

    if (!legalData.SealandSignedBy) {
      legalData.SealandSignedBy = {
        no: null,
        date: null,
        signedBy: null,
        file: null
      };
    }
    legalData.SealandSignedBy.signedBy = sealandSignedBy || existingData?.SealandSignedBy?.signedBy || null;
    // Save data to the database
    const savedLegalData = await internalLegalModel.findOneAndUpdate(
      { customerId }, // Query condition
      legalData, // Data to update or insert
      { upsert: true, new: true } // Options
    );

    const fileStageForms = await processModel.findOneAndUpdate(
      { customerId: req.body.customerId },  
      { $set: { 'fileStageForms.internalLegal': true } },
      { new: true }  
  );
    if (!savedLegalData) {
      return res
        .status(400)
        .json({ message: "Failed to save data to the database." });
    }

    if (
      loanType === "NEW" &&
      propertyType === "newCoownership" &&
      LegalType === "NewLegal"
    ) {
      const sectionData = await legalPdf(customerId);

      // const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

      // const processFile = async (filePath) => {
      //   let resolvedPath = path
      //     .resolve(__dirname, `../../../..${filePath}`)
      //     .replace(/\\/g, "/");
      //   const formData = new FormData();
      //   formData.append("image", fs.createReadStream(resolvedPath));
      //   const response = await axios.post(uploadUrl, formData, {
      //     headers: { ...formData.getHeaders() },
      //   });
      //   return response.data?.items;
      // };

      // const uploadedincomeSectionUrl = await processFile(sectionData);

      // const legalPdfUrl = `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

      // Update the database
      // await internalLegalModel.findOneAndUpdate(
      //   { customerId }, // Query to find the specific customer document
      //   {
      //     Generate_new_legal: "true",
      //     Generate_new_legal_link: legalPdfUrl,
      //   },
      //   { new: true, upsert: false } // Options: Return the updated document, don't create a new one
      // );

      return success(res, "PDF generated  successfully.",sectionData); 
      //   {
      //   legalPdf: legalPdfUrl,
      // });
    } else if (
      loanType === "NEW" &&
      propertyType === "newCoownership" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await finallegalPdf(customerId);

     


     

      return success(res, "pdf generated successfully.",sectionData);
      //    {
      //   finalLegalPdf: finalLegalPdfUrl,
      // });
    } else if (
      loanType === "NEW" &&
      propertyType === "newCoownership" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await vettingPdf(customerId);

    
      return success(res, "pdf generated successfully.",sectionData);
      //    {
      //   vettingPdf: vettingPdfUrl,
      // });
    } else if (
      loanType === "NEW" &&
      propertyType === "7PagerPatta" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await sevenPagerpdf(customerId);

    
      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   SevenPagerLegalPdf: SevenPagerLegalPdfUrl,
      // });
    } else if (
      loanType === "NEW" &&
      propertyType === "7PagerPatta" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await sevenPagervettingPdf(customerId);

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   sevenPagervettingPdf: sevenPagervettingPdfUrl,
      // });
    } else if (
      loanType === "BT" &&
      propertyType === "7PagerPatta" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await BtsevenPagerLegalpdf(customerId);

      

      

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   BtsevenPagerLegalpdf: BtSevenPagerLegalPdfUrl,
      // });
    } else if (
      loanType === "BT" &&
      propertyType === "7PagerPatta" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await bt7PagervettingPdf(customerId);

      

      
      return success(res, "pdf generated successfully.",sectionData);
      //  {
      //   bt7Pagervetting: BtsevenPagervettingPdfUrl,
      // });
    } else if (
      loanType === "NEW" &&
      propertyType === "executedCoownership" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await executedfinallegalPdf(customerId);

     

      return success(res, "pdf generated successfully.",sectionData)
      //   {
      //   newexecutedfinallegal: newexecutedfinallegalUrl,
      // });
    } else if (
      loanType === "NEW" &&
      propertyType === "executedCoownership" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await executedvettingPdf(customerId);

      

      return success(res, "pdf generated successfully.",sectionData)
      //    {
      //   newexecutedvetting: newexecutedvettingUrl,
      // });
    } else if (
      loanType === "BT" &&
      propertyType === "executedCoownership" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await btexecutedfinallegalPdf(customerId);

      
       

      

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   btexecutedfinallegal: BtwexecutedfinallegalUrl, 
      // });
    } else if (
      loanType === "BT" &&
      propertyType === "executedCoownership" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await btexecutedvettingPdf(customerId);

      
        

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   btexecutedvetting: BtexecutedvettingUrl,
      // });
    }
    // construction 
    else if (
      loanType === "CONSTRUCTION" &&
      propertyType === "newCoownership" &&
      LegalType === "NewLegal"
    ) {
      const sectionData = await legalPdf(customerId);

      // const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

      // const processFile = async (filePath) => {
      //   let resolvedPath = path
      //     .resolve(__dirname, `../../../..${filePath}`)
      //     .replace(/\\/g, "/");
      //   const formData = new FormData();
      //   formData.append("image", fs.createReadStream(resolvedPath));
      //   const response = await axios.post(uploadUrl, formData, {
      //     headers: { ...formData.getHeaders() },
      //   });
      //   return response.data?.items;
      // };

      // const uploadedincomeSectionUrl = await processFile(sectionData);

      // const legalPdfUrl = `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

      // Update the database
      // await internalLegalModel.findOneAndUpdate(
      //   { customerId }, // Query to find the specific customer document
      //   {
      //     Generate_new_legal: "true",
      //     Generate_new_legal_link: legalPdfUrl,
      //   },
      //   { new: true, upsert: false } // Options: Return the updated document, don't create a new one
      // );

      return success(res, "PDF generated  successfully.",sectionData); 
      //   {
      //   legalPdf: legalPdfUrl,
      // });
    } else if (
      loanType === "CONSTRUCTION" &&
      propertyType === "newCoownership" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await finallegalPdf(customerId);

     


     

      return success(res, "pdf generated successfully.",sectionData);
      //    {
      //   finalLegalPdf: finalLegalPdfUrl,
      // });
    } else if (
      loanType === "CONSTRUCTION" &&
      propertyType === "newCoownership" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await vettingPdf(customerId);

    
      return success(res, "pdf generated successfully.",sectionData);
      //    {
      //   vettingPdf: vettingPdfUrl,
      // });
    } else if (
      loanType === "CONSTRUCTION" &&
      propertyType === "7PagerPatta" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await sevenPagerpdf(customerId);

    
      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   SevenPagerLegalPdf: SevenPagerLegalPdfUrl,
      // });
    } else if (
      loanType === "CONSTRUCTION" &&
      propertyType === "7PagerPatta" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await sevenPagervettingPdf(customerId);

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   sevenPagervettingPdf: sevenPagervettingPdfUrl,
      // });
    } else if (
      loanType === "CONSTRUCTION" &&
      propertyType === "executedCoownership" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await executedfinallegalPdf(customerId);

     

      return success(res, "pdf generated successfully.",sectionData)
      //   {
      //   newexecutedfinallegal: newexecutedfinallegalUrl,
      // });
    } else if (
      loanType === "CONSTRUCTION" &&
      propertyType === "executedCoownership" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await executedvettingPdf(customerId);

      

      return success(res, "pdf generated successfully.",sectionData)
      //    {
      //   newexecutedvetting: newexecutedvettingUrl,
      // });
    } 

    //--------------------------new top u--------------p

    //-----------------7pagerpatta bt top up --------------------
    else if (
      loanType === "BT-TOPUP" &&
      propertyType === "7PagerPatta" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await BtsevenPagerLegalpdf(customerId);

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   BtsevenPagerLegalpdf: BtSevenPagerLegalPdfUrl,
      // });
    } else if (
      loanType === "BT-TOPUP" &&
      propertyType === "7PagerPatta" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await bt7PagervettingPdf(customerId);

      

      
      return success(res, "pdf generated successfully.",sectionData);
      //  {
      //   bt7Pagervetting: BtsevenPagervettingPdfUrl,
      // });
    } else if (
      loanType === "BT-TOPUP" &&
      propertyType === "executedCoownership" &&
      LegalType === "FinalLegal"
    ) {
      const sectionData = await btexecutedfinallegalPdf(customerId);

      
       

      

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   btexecutedfinallegal: BtwexecutedfinallegalUrl, 
      // });
    } else if (
      loanType === "BT-TOPUP" &&
      propertyType === "executedCoownership" &&
      LegalType === "Vetting"
    ) {
      const sectionData = await btexecutedvettingPdf(customerId);

      
        

      return success(res, "pdf generated successfully.",sectionData)
      //  {
      //   btexecutedvetting: BtexecutedvettingUrl,
      // });
    }
    
     else {
      return badRequest(
        res,
        `Unsupported  legal types:please send correct types`
      );
    }
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// const dobsignnew = async (req, res) => {
//   try {
//     const { customerId,selections } = req.query;

//     const partnerData = await finalModel.findOne({ customerId });

//     if (!partnerData) {
//       return badRequest(res, "partner's is required.");
//     }
//     const partnerModel = await lendersModel.findOne({
//       _id: partnerData.partnerId,
//     });
//     if (!partnerModel) {
//       return badRequest(res, "Partner not found.");
//     }

//     const normalizedPartnerName = (partnerModel.fullName || "")
//       .trim()
//       .toLowerCase();

//     if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
//       // Ratna logic
//       // let selectionData = partnerData?.pdfSelection || 'acg';
//       // console.log(selectionData,"selectionDataselectionData")
//       // if (!selectionData || typeof selectionData !== "string") {
//       //   selectionData = "ac";
//       // }

//       const sectionData = await ratnaDobSignForm(customerId);
//       if (!sectionData) {
//         return badRequest(res, "sectionData not found.");
//       }
//       // const applicantData = await applicantLatter(customerId, selectionData);
//       // if (!applicantData) {
//       //   return badRequest(res, "applicantData not found.");
//       // }
//       // const LdAndPdDeedData = await LdAndPdDeed(customerId, selectionData);
//       // if (!LdAndPdDeedData) {
//       //   return badRequest(res, "LdAndPdDeedData not found.");
//       // }

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;
//       console.log(uploadUrl, "uploadUrl");
//       // console.log(uploadUrl,"uploadUrluploadUrl")

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         // console.log("Resolved File Path: ", resolvedPath);
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         // console.log("File Stream: ", fs.existsSync(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         // console.log("Upload Response: ", response.data);

//         return response.data?.items;
//       };
//       // console.log("Section Data Path: ", sectionData);
//       const uploadedSectionUrl = await processFile(sectionData);
//       // console.log("Applicant Data Path: ", applicantData);
//       // const uploadedApplicantUrl = await processFile(applicantData);
//       // // console.log("LdAndPdDeed Data Path: ", LdAndPdDeedData);
//       // const uploadedLdAndPdDeedUrl = await processFile(LdAndPdDeedData);

//       return success(res, "pdf urls are", {
//         ratnaaDobform: `${process.env.BASE_URL}${uploadedSectionUrl.image}`,
//         // LdAndPdDeed: `${process.env.BASE_URL}${uploadedLdAndPdDeedUrl.image}`,
//         // applicantionLatter: `${process.env.BASE_URL}${uploadedApplicantUrl.image}`,

//         //new upload
//         // sectionLatter: `${uploadedSectionUrl.image}`,
//         // LdAndPdDeed: `${uploadedLdAndPdDeedUrl.image}`,
//         // applicantionLatter: `${uploadedApplicantUrl.image}`,
//       });
//     } else if (normalizedPartnerName === "grow money capital pvt ltd") {
//       // Fin Cooper logic with selection handling
//       // let selectionData = partnerData?.pdfSelection || 'acg';
//       // console.log(selectionData,"selectionDataselectionData")
//       // if (!selectionData || typeof selectionData !== "string") {
//       //   selectionData = "ac";
//       // }

//       const partnerLogo = FinpdfLogo;

//       const pdfFunctions = {
//         growDualNamepdf,
//         growSignaturepdf,
//       };

//       const pdfData = {};
//       for (const [key, func] of Object.entries(pdfFunctions)) {
//         const pdfResult = await func(
//           customerId,
//           partnerLogo,
//           partnerModel.fullName
//           // selectionData // Pass selection to all functions
//         );
//         pdfData[key] = pdfResult;
//       }

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         const resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });
//         return response.data?.items;
//       };

//       const uploadedUrls = {};
//       for (const [key, data] of Object.entries(pdfData)) {
//         const uploadedUrl = await processFile(data);
//         // Replace "grow" or "rcpl" with "fincooper" in the URL
//         uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
//         // processedUrl = processedUrl.replace(/grow|rcpl/gi, "fincooper"); grow money capital pvt ltd
//         // const newKey = key.replace(/grow|rcpl/gi, "fincooper");

//         // uploadedUrls[key] = processedUrl;
//       }

//       return success(res, "pdf urls are", uploadedUrls);
//     }
//     // else if (normalizedPartnerName === "fin coopers capital pvt ltd") {
//     //   // Grow Money logic with selection handling
//     //   let selectionData = partnerData?.pdfSelection || 'acg';
//     //   console.log(selectionData,"selectionDataselectionData")
//     //   if (!selectionData || typeof selectionData !== "string") {
//     //     selectionData = "ac";
//     //   }

//     //   const partnerLogo = growPdfLogo;

//     //   const pdfFunctions = {
//     //     growDualNamepdf,
//     //     growSignaturepdf,

//     //   };

//     //   const pdfData = {};
//     //   for (const [key, func] of Object.entries(pdfFunctions)) {
//     //     const pdfResult = await func(
//     //       customerId,
//     //       partnerLogo,
//     //       partnerModel.fullName,
//     //       selectionData // Pass selection to all functions
//     //     );
//     //     pdfData[key] = pdfResult;
//     //   }

//     //   const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//     //   const processFile = async (filePath) => {
//     //     const resolvedPath = path
//     //       .resolve(__dirname, `../../../..${filePath}`)
//     //       .replace(/\\/g, "/");
//     //     const formData = new FormData();
//     //     formData.append("image", fs.createReadStream(resolvedPath));
//     //     const response = await axios.post(uploadUrl, formData, {
//     //       headers: { ...formData.getHeaders() },
//     //     });
//     //     return response.data?.items;
//     //   };

//     //   const uploadedUrls = {};
//     //   for (const [key, data] of Object.entries(pdfData)) {
//     //     const uploadedUrl = await processFile(data);
//     //     uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
//     //   }

//     //   return success(res, "pdf urls are", uploadedUrls);
//     // }
//     //  else {
//     //   return badRequest(res, `Unsupported partner: ${partnerModel.fullName}`);
//     // }
//   } catch (error) {
//     console.error(error);
//     return unknownError(res, error);
//   }
// };

const dobsignnew = async (req, res) => {
  try {
    const { customerId, selections } = req.query;

    if (!selections || typeof selections !== "string") {
      selections = "applicant";
    }

    const partnerData = await finalModel.findOne({ customerId });

    if (!partnerData) {
      return badRequest(res, "partner's is required.");
    }
    const partnerModel = await lendersModel.findOne({
      _id: partnerData.partnerId,
    });
    if (!partnerModel) {
      return badRequest(res, "Partner not found.");
    }

    const normalizedPartnerName = (partnerModel.fullName || "")
      .trim()
      .toLowerCase();

    if (normalizedPartnerName === "ratnaafin capital pvt ltd") {
      // Ratna logic
      // let selectionData = partnerData?.pdfSelection || 'acg';
      // console.log(selectionData,"selectionDataselectionData")
      // if (!selectionData || typeof selectionData !== "string") {
      //   selectionData = "ac";
      // }

      const sectionData = await ratnaDobSignForm(customerId, selections);
      if (!sectionData) {
        return badRequest(res, "ratnaDualName dual pdf not found.");
      }


      return success(res, "pdf urls are",sectionData);
    } else if (normalizedPartnerName === "grow money capital pvt ltd") {
      // Fin Cooper logic with selection handling
      // let selectionData = partnerData?.pdfSelection || 'acg';
      // console.log(selectionData,"selectionDataselectionData")
      // if (!selectionData || typeof selectionData !== "string") {
      //   selectionData = "ac";
      // }

      const partnerLogo = FinpdfLogo;

      const pdfFunctions = {
        growDualNamepdf,
        growSignaturepdf,
      };

      const pdfData = {};
      for (const [key, func] of Object.entries(pdfFunctions)) {
        const pdfResult = await func(
          customerId,
          partnerLogo,
          partnerModel.fullName
          // selectionData // Pass selection to all functions
        );
        pdfData[key] = pdfResult;
      }

      const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

      const processFile = async (filePath) => {
        const resolvedPath = path
          .resolve(__dirname, `../../../..${filePath}`)
          .replace(/\\/g, "/");
        const formData = new FormData();
        formData.append("image", fs.createReadStream(resolvedPath));
        const response = await axios.post(uploadUrl, formData, {
          headers: { ...formData.getHeaders() },
        });
        return response.data?.items;
      };

      const uploadedUrls = {};
      for (const [key, data] of Object.entries(pdfData)) {
        const uploadedUrl = await processFile(data);
        // Replace "grow" or "rcpl" with "fincooper" in the URL
        uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
        // processedUrl = processedUrl.replace(/grow|rcpl/gi, "fincooper"); grow money capital pvt ltd
        // const newKey = key.replace(/grow|rcpl/gi, "fincooper");

        // uploadedUrls[key] = processedUrl;
      }

      return success(res, "pdf urls are", uploadedUrls);
    }
    // else if (normalizedPartnerName === "fin coopers capital pvt ltd") {
    //   // Grow Money logic with selection handling
    //   let selectionData = partnerData?.pdfSelection || 'acg';
    //   console.log(selectionData,"selectionDataselectionData")
    //   if (!selectionData || typeof selectionData !== "string") {
    //     selectionData = "ac";
    //   }

    //   const partnerLogo = growPdfLogo;

    //   const pdfFunctions = {
    //     growDualNamepdf,
    //     growSignaturepdf,

    //   };

    //   const pdfData = {};
    //   for (const [key, func] of Object.entries(pdfFunctions)) {
    //     const pdfResult = await func(
    //       customerId,
    //       partnerLogo,
    //       partnerModel.fullName,
    //       selectionData // Pass selection to all functions
    //     );
    //     pdfData[key] = pdfResult;
    //   }

    //   const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

    //   const processFile = async (filePath) => {
    //     const resolvedPath = path
    //       .resolve(__dirname, `../../../..${filePath}`)
    //       .replace(/\\/g, "/");
    //     const formData = new FormData();
    //     formData.append("image", fs.createReadStream(resolvedPath));
    //     const response = await axios.post(uploadUrl, formData, {
    //       headers: { ...formData.getHeaders() },
    //     });
    //     return response.data?.items;
    //   };

    //   const uploadedUrls = {};
    //   for (const [key, data] of Object.entries(pdfData)) {
    //     const uploadedUrl = await processFile(data);
    //     uploadedUrls[key] = `${process.env.BASE_URL}${uploadedUrl.image}`;
    //   }

    //   return success(res, "pdf urls are", uploadedUrls);
    // }
    //  else {
    //   return badRequest(res, `Unsupported partner: ${partnerModel.fullName}`);
    // }
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const addSelfAssign = async (req, res) => {
  try {
    const empId = req.Id; // Employee ID from the request
    const { customerId, finalSenctionFileSelfAssign, branchSelfAssign } = req.query;
    // const todayDate = checkTime.format("YYYY-MM-DDThh:mm:ss A");
   const todayDate =  moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");
    // console.log(customerId, finalSenctionFileSelfAssign, typeof branchSelfAssign, empId);

    const partnerCheck = await finalModel.findOne({ customerId });

    if (!partnerCheck && !finalSenctionFileSelfAssign) {
      return success(res, "self assigned details", {
        finalSenctionFileSelfAssign: false,
        branchSelfAssign:false
      });
    }

    if (partnerCheck && !finalSenctionFileSelfAssign && !branchSelfAssign) {
      return success(res, "self assigned details", {
        finalSenctionFileSelfAssign: partnerCheck?.finalSenctionFileSelfAssign,
        branchSelfAssign: partnerCheck?.branchSelfAssign,
      });
    }
    let updateData;
    if (customerId && finalSenctionFileSelfAssign == "true") {
      // Check if customerId is provided
      updateData = {
        customerId,
        employeeId: empId,
        selfAassignDate : todayDate,
        finalSenctionFileSelfAssign: finalSenctionFileSelfAssign, // Default to false if not provided
      };
    }
    if (customerId && finalSenctionFileSelfAssign == "false") {
      // Check if customerId is provided
      updateData = {
        customerId,
        employeeId: null,
        selfAassignDate : "",
        finalSenctionFileSelfAssign: finalSenctionFileSelfAssign, // Default to false if not provided
      };
    }
    if (customerId && branchSelfAssign == "true") {
      // Check if customerId is provided
      console.log("inside if block<<>><>>",branchSelfAssign,customerId)
      updateData = {
        customerId,
        branchSelfAssignEmpId: empId,
        branchSelfAssignDate : todayDate,
        branchSelfAssign: branchSelfAssign, // Default to false if not provided
      };
    }
    if (customerId && branchSelfAssign == "false") {
      // Check if customerId is provided
      console.log("inside if block<<>><>>",branchSelfAssign,customerId)
      updateData = {
        customerId,
        branchSelfAssignEmpId: null,
        branchSelfAssignDate : "",
        branchSelfAssign: branchSelfAssign, // Default to false if not provided
      };
    }
    // console.log(updateData,"updateDataupdateData")
    const partnerData = await finalModel.findOneAndUpdate(
      { customerId }, // Match by customerId
      { $set: updateData }, // Update or set the fields
      { new: true, upsert: true } // Create a new document if none exists
    );

     success(res, "Self-assigned successfully", {
      finalSenctionFileSelfAssign: partnerData.finalSenctionFileSelfAssign,
      branchSelfAssign: partnerData?.branchSelfAssign,
    });
    // await finalApprovalSheet(customerId)
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

// async function disbursementFormAdd(req, res) {
//   try {
//     // Validate incoming request
//     const errors = validationResult(req);
//     if (!errors.isEmpty()) {
//       return res.status(400).json({
//         errorName: "serverValidation",
//         errors: errors.array(),
//       });
//     }

//     // Validate required fields
//     const { customerId } = req.body;
//     if (!customerId) {
//       return badRequest(res, "Customer ID is required");
//     }

//     // Check if the disbursement form for the customer already exists
//     const existingDisbursement = await disbursementModel.findOne({ customerId });
//     if (existingDisbursement) {
//       return badRequest(res, "Disbursement form for this customer already exists");
//     }

//     // Create a new disbursement document
//     const disbursementDetail = await disbursementModel.create(req.body);

//     // Respond with success
//     success(res, "Disbursement Form Added Successfully", disbursementDetail);
//   } catch (error) {
//     console.error(error);
//     unknownError(res, error);
//   }
// }
const disbursementFormAdd = async (req, res) => {
  try {
    // Validate incoming request
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        errorName: "serverValidation",
        errors: errors.array(),
      });
    }

    // Validate required fields
    const { customerId } = req.body;
    if (!customerId) {
      return badRequest(res, "Customer ID is required");
    }
    const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");
    // Allowed fields for filtering request data
    const allowedFields = [
      "formFillBy",
      "customerId",
      "physicalFileCourier",
      "eNachLinkSentToBranch",
      "eNachLinkSignUpload",
      "kycAndAffidavit",
      "pdcAndBsv",
      "estampRequirement",
      "esignDocument",
      "finalDisbursementDocuments",
      "finalLegalAndVetting",
      "postDisbursement",
      "eSignatureSentToBranch"
    ];

    // Filter incoming request body to include only allowed fields
    const filteredData = Object.keys(req.body)
      .filter((key) => allowedFields.includes(key))
      .reduce((obj, key) => {
        obj[key] = req.body[key];
        return obj;
      }, {});

    console.log(filteredData, "filteredData");

    // Check if the disbursement form for the customer already exists
    let existingDisbursement = await disbursementModel.findOne({ customerId });

    if (existingDisbursement) {
      // Merge existing nested fields with the new data
      let updateFields = { ...filteredData };

      // Deep merge for nested fields like `kycAndAffidavit`
      if (
        filteredData.kycAndAffidavit &&
        filteredData.kycAndAffidavit.kycDetail
      ) {
        updateFields["kycAndAffidavit.kycDetail"] =
          existingDisbursement.kycAndAffidavit.kycDetail.map((existingKyc) => {
            const updatedKyc = filteredData.kycAndAffidavit.kycDetail.find(
              (newKyc) => newKyc.type === existingKyc.type
            );

            if (updatedKyc) {
              Object.keys(updatedKyc).forEach((key) => {
                existingKyc[key] =
                  updatedKyc[key] === "" || updatedKyc[key] === null
                    ? ""
                    : updatedKyc[key];
              });
            }
            return existingKyc;
          });
      }

      // Ensure `estampRequirement` is updated correctly
      let updateQuery = {
        $set: updateFields,
      };

      if (filteredData.estampRequirement) {
        if (Array.isArray(filteredData.estampRequirement)) {
          updateQuery.$set["estampRequirement"] = [
            ...(existingDisbursement.estampRequirement || []),
            ...filteredData.estampRequirement,
          ];
        } else {
          updateQuery.$set["estampRequirement"] = filteredData.estampRequirement;
        }
      }

      // Ensure `pdcAndBsv` merges properly instead of overwriting
      if (filteredData.pdcAndBsv) {
        updateQuery["$set"]["pdcAndBsv"] = {
          ...existingDisbursement.pdcAndBsv,
          ...filteredData.pdcAndBsv,
        };
      }

      // Update document
      const updatedDisbursement = await disbursementModel.findOneAndUpdate(
        { customerId },
        updateQuery,
        { new: true }
      );

      let statusUpdateFields = {};
      if (
        updatedDisbursement?.pdcAndBsv?.applicantChequeAndBSV?.chequeDetail
          ?.length > 0 ||
        updatedDisbursement?.pdcAndBsv?.guarantorChequeAndBSV?.chequeDetail
          ?.length > 0
      ) {
        statusUpdateFields.pdcDetailsFormStart = true;
      }
      if (
        updatedDisbursement?.pdcAndBsv?.applicantChequeAndBSV?.chequeDetail
          ?.length >= 5 ||
        updatedDisbursement?.pdcAndBsv?.guarantorChequeAndBSV?.chequeDetail
          ?.length >= 2
      ) {
        statusUpdateFields.pdcDetailsFormComplete = true;
      }

      if (
        updatedDisbursement.pdcAndBsv &&
        Object.keys(updatedDisbursement.pdcAndBsv).length > 0
      ) {
        statusUpdateFields.postDisbursementFormStart = true;
        statusUpdateFields.postDisbursementFormComplete = true;
      }

      // Update process model if required
      if (Object.keys(statusUpdateFields).length > 0) {
        await processModel.findOneAndUpdate(
          { customerId },
          { $set: statusUpdateFields },
          { new: true, upsert: true }
        );
      }

              let finalDisbursementUpdate = {
                sendToPartnerPostDisbursedStatus: "complete",
                sendToPartnerPostDisbursedDate:todayDate
              };
            if (filteredData.postDisbursement) {
              finalDisbursementUpdate.finalDisbursementStatus = "complete";
              finalDisbursementUpdate.finalDisbursementStatusDate = todayDate;
            }

        if (Object.keys(finalDisbursementUpdate).length > 0) {
          await finalModel.findOneAndUpdate(
            { customerId },
            { $set: finalDisbursementUpdate },
            { new: true, upsert: true }
          );
        }


       success( res,"Disbursement Form Updated Successfully", updatedDisbursement );
             await fileProcessSheet(customerId)
      return await finalApprovalSheet(customerId)
    } else {
      // Create a new disbursement document
      const disbursementDetail = await disbursementModel.create(filteredData);

      let statusUpdateFields = {};
      if (
        disbursementDetail?.pdcAndBsv?.applicantChequeAndBSV?.chequeDetail
          ?.length > 0 ||
        disbursementDetail?.pdcAndBsv?.guarantorChequeAndBSV?.chequeDetail
          ?.length > 0
      ) {
        statusUpdateFields.pdcDetailsFormStart = true;
      }
      if (
        disbursementDetail?.pdcAndBsv?.applicantChequeAndBSV?.chequeDetail
          ?.length >= 5 ||
        disbursementDetail?.pdcAndBsv?.guarantorChequeAndBSV?.chequeDetail
          ?.length >= 2
      ) {
        statusUpdateFields.pdcDetailsFormComplete = true;
      }

      if (
        disbursementDetail.pdcAndBsv &&
        Object.keys(disbursementDetail.pdcAndBsv).length > 0
      ) {
        statusUpdateFields.postDisbursementFormStart = true;
        statusUpdateFields.postDisbursementFormComplete = true;
      }

      // Update process model if required
      if (Object.keys(statusUpdateFields).length > 0) {
        await processModel.findOneAndUpdate(
          { customerId },
          { $set: statusUpdateFields },
          { new: true, upsert: true }
        );
      }

       success(res,"Disbursement Form Added Successfully", disbursementDetail );
       await processModel.findOneAndUpdate(
        { customerId },
        { $set: {
          enachLink: req?.body?.eNachLinkSentToBranch ? true : false,
          disbursementDetail: req?.body?.postDisbursement ? true : false,
          inventoryDetail:req?.body?.applicantChequeAndBSV ? true : false, //courierDetail
          physicalFileSendToLendor:req?.body?.courierDetail ? true : false,
          pdc:req?.body?.pdc ? true : false
        } },
        { new: true }
    );
       await fileProcessSheet(customerId)
        return await finalApprovalSheet(customerId)
    }
  } catch (error) {
    console.error(error);
    unknownError(res, error);
  }
};




// const slefAssignList = async (req, res) => {
//   try {
//     const empId = new mongoose.Types.ObjectId(req.Id);
//     const { pageLimit, pageNumber, search } = req.query;
//     const { offset, limit } = paginationData(pageLimit, pageNumber);

//     // console.log(empId,'empId')
//     // Build search filter
//     const searchFilter = {};
//     if (search) {
//       searchFilter.$or = [
//         { "nearestBranchData.name": { $regex: search, $options: "i" } }, // Branch name (case-insensitive)
//         { "applicantDetail.fullName": { $regex: search, $options: "i" } }, // Applicant name (case-insensitive)
//         { customerFinId: { $regex: search, $options: "i" } },
//         {
//           $expr: {
//             $regexMatch: {
//               input: { $toString: "$mobileNo" }, // Convert numeric field to string
//               regex: search,
//               options: "i",
//             },
//           },
//         }, // Mobile number as string (case-insensitive)
//       ];
//     }

//     const userData = await customerModel.aggregate([
//       {
//         $lookup: {
//           from: "products",
//           localField: "productId",
//           foreignField: "_id",
//           as: "productData",
//         },
//       },
//       {
//         $addFields: {
//           productData: { $arrayElemAt: ["$productData", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "employees",
//           localField: "employeId",
//           foreignField: "_id",
//           as: "employeeDetail",
//         },
//       },
//       {
//         $addFields: {
//           employeeDetail: { $arrayElemAt: ["$employeeDetail", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "employees",
//           localField: "employeeDetail.reportingManagerId",
//           foreignField: "_id",
//           as: "salesManagerDetails",
//         },
//       },
//       {
//         $addFields: {
//           salesManagerDetails: { $arrayElemAt: ["$salesManagerDetails", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "newbranches",
//           localField: "employeeDetail.branchId",
//           foreignField: "_id",
//           as: "nearestBranchData",
//         },
//       },
//       {
//         $addFields: {
//           nearestBranchData: { $arrayElemAt: ["$nearestBranchData", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "applicantdetails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "applicantDetail",
//         },
//       },
//       {
//         $addFields: {
//           applicantDetail: { $arrayElemAt: ["$applicantDetail", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "cibildetails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "cibildetailDetail",
//         },
//       },
//       {
//         $addFields: {
//           cibildetailDetail: { $arrayElemAt: ["$cibildetailDetail", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "pdformdatas",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "pdData",
//         },
//       },
//       {
//         $addFields: {
//           pdData: { $arrayElemAt: ["$pdData", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "finalsanctiondetaails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "finalSanctionData",
//         },
//       },
//       {
//         $addFields: {
//           finalSanctionData: { $arrayElemAt: ["$finalSanctionData", 0] },
//         },
//       },
//       {
//         $match: {
//           $and: [
//             {
//               $or: [{ "pdData.status": "complete" }, { "pdData.status": "approve" }],
//             },
//             { "finalSanctionData.employeeId": empId },
//             { "finalSanctionData.finalSenctionFileSelfAssign": true },
//           ],
//         },
//       },
//       {
//         $project: {
//           _id: 1,
//           employeId: 1,
//           productId: 1,
//           customerFinId: 1,
//           mobileNo: 1,
//           loanAmount: 1,
//           roi: 1,
//           tenure: 1,
//           emi: 1,
//           executiveName: 1,
//           createdAt: 1,
//           updatedAt: 1,
//           "applicantDetail.fullName": 1,
//           "applicantDetail.fatherName": 1,
//           "applicantDetail.mobileNo": 1,
//           "applicantDetail.applicantPhoto": 1,
//           "applicantDetail.applicantAddress":
//             "$applicantDetail.permanentAddress.addressLine1",
//           "cibildetailDetail.applicantCibilScore": 1,
//           "nearestBranchData.name": 1,
//           "productData.productName": 1,
//           "employeeDetail.employeName": 1,
//           "employeeDetail.userName": 1,
//           "employeeDetail.employeUniqueId": 1,
//           "salesManagerDetails.employeName": 1,
//           "salesManagerDetails.employeUniqueId": 1,
//           "salesManagerDetails.userName": 1,
//           tvrDetails: {
//             income: "7%",
//             propertyValue: "50L",
//             foir: "30%",
//             ltv: "9%",
//           },
//         },
//       },
//       { $match: searchFilter },
//       { $skip: offset },
//       { $limit: limit },
//     ]);
    

//     // Fetch total count without pagination for accurate results
//     const totalCount = await customerModel.aggregate([
//       {
//         $lookup: {
//           from: "pdformdatas",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "pdData",
//         },
//       },
//       {
//         $addFields: {
//           pdData: { $arrayElemAt: ["$pdData", 0] },
//         },
//       },
//       {
//         $lookup: {
//           from: "finalsanctiondetaails",
//           localField: "_id",
//           foreignField: "customerId",
//           as: "finalSanctionData",
//         },
//       },
//       {
//         $addFields: {
//           finalSanctionData: { $arrayElemAt: ["$finalSanctionData", 0] },
//         },
//       },
//       {
//         $match: {
//           $and: [
//             {
//               $or: [{ "pdData.status": "complete" }, { "pdData.status": "approve" }],
//             },
//             { "finalSanctionData.employeeId": empId },
//             { "finalSanctionData.finalSenctionFileSelfAssign": true },
//           ],
//         },
//       },
//     ]);

//     return success(res, "All customer details List", {
//       totalCount: totalCount.length,
//       userDataLength: userData.length,
//       userData,
//     });
//   } catch (error) {
//     console.log(error);
//     return unknownError(res, error);
//   }
// };

// ----------------Get All estampRequirement----------------------



const slefAssignList = async (req, res) => {
  try {
    console.time();
    const empId = new mongoose.Types.ObjectId(req.Id);
    const { pageLimit, pageNumber, search } = req.query;
    const { offset, limit } = paginationData(pageLimit, pageNumber);
   
    // Build search filter
    const searchFilter = {};
    if (search) {
      searchFilter.$or = [
        { "nearestBranchData.name": { $regex: search, $options: "i" } }, // Branch name (case-insensitive)
        { "applicantDetail.fullName": { $regex: search, $options: "i" } }, // Applicant name (case-insensitive)
        { customerFinId: { $regex: search, $options: "i" } },
        {
          $expr: {
            $regexMatch: {
              input: { $toString: "$mobileNo" }, // Convert numeric field to string
              regex: search,
              options: "i",
            },
          },
        }, // Mobile number as string (case-insensitive)
      ];
    }

    // Aggregation pipeline
    const userData = await customerModel.aggregate([
      // Early $match stage for filtering based on employeeId and sanction data
      {
        $lookup: {
          from: "pdformdatas",
          localField: "_id",
          foreignField: "customerId",
          as: "pdData",
        },
      },
      {
        $addFields: {
          pdData: { $arrayElemAt: ["$pdData", 0] },
        },
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          as: "finalSanctionData",
        },
      }, 
      {
        $addFields: {
          finalSanctionData: { $arrayElemAt: ["$finalSanctionData", 0] },
        },
      },
      {
        $match: {
          $and: [
            // {
            //   $or: [{ "pdData.status": "complete" }, { "pdData.status": "approve" }],
            // },
            { "finalSanctionData.employeeId": empId },
            { "finalSanctionData.finalSenctionFileSelfAssign": true },
          ],
        },
      },
      // Lookup stages
      {
        $lookup: {
          from: "products",
          localField: "productId",
          foreignField: "_id",
          as: "productData",
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "employeId",
          foreignField: "_id",
          as: "employeeDetail",
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "employeeDetail.reportingManagerId",
          foreignField: "_id",
          as: "salesManagerDetails",
        },
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "employeeDetail.branchId",
          foreignField: "_id",
          as: "nearestBranchData",
        },
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          as: "applicantDetail",
        },
      },
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          as: "cibildetailDetail",
        },
      },
      // Combining all addFields into one stage
      {
        $addFields: {
          productData: { $arrayElemAt: ["$productData", 0] },
          employeeDetail: { $arrayElemAt: ["$employeeDetail", 0] },
          salesManagerDetails: { $arrayElemAt: ["$salesManagerDetails", 0] },
          nearestBranchData: { $arrayElemAt: ["$nearestBranchData", 0] },
          applicantDetail: { $arrayElemAt: ["$applicantDetail", 0] },
          cibildetailDetail: { $arrayElemAt: ["$cibildetailDetail", 0] },
        },
      },
      {
        $project: {
          _id: 1,
          employeId: 1,
          productId: 1,
          customerFinId: 1,
          mobileNo: 1,
          loanAmount: 1,
          roi: 1,
          tenure: 1,
          emi: 1,
          executiveName: 1,
          createdAt: 1,
          updatedAt: 1,
          "applicantDetail.fullName": 1,
          "applicantDetail.fatherName": 1,
          "applicantDetail.mobileNo": 1,
          "applicantDetail.applicantPhoto": 1,
          "applicantDetail.applicantAddress":
            "$applicantDetail.permanentAddress.addressLine1",
          "cibildetailDetail.applicantCibilScore": 1,
          "nearestBranchData.name": 1,
          "productData.productName": 1,
          "employeeDetail.employeName": 1,
          "employeeDetail.userName": 1,
          "employeeDetail.employeUniqueId": 1,
          "salesManagerDetails.employeName": 1,
          "salesManagerDetails.employeUniqueId": 1,
          "salesManagerDetails.userName": 1,
          tvrDetails: {
            income: "7%",
            propertyValue: "50L",
            foir: "30%",
            ltv: "9%",
          },
        },
      },
      { $match: searchFilter },
      {
        $facet: {
          paginatedResults: [{ $skip: offset }, { $limit: limit }],
          totalCount: [{ $count: "count" }],
        },
      },
    ]);

    const totalCount = userData[0].totalCount[0]?.count || 0;
    const paginatedResults = userData[0].paginatedResults;
    console.timeEnd();

    return success(res, "All customer details List", {
      totalCount,
      userDataLength: paginatedResults.length,
      userData: paginatedResults,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};



async function getAllEstampReq(req, res) {
  try {
    // Fetch disbursement data
    const data = await disbursementModel.find(
      {},
      { customerId: 1, estampRequirement: 1 }
    );

    if (!data || data.length === 0) {
      return notFound(res, "No disbursement data found", []);
    }

    // Extract customer IDs
    const customerIds = data.map((item) => item.customerId);

    // Fetch customerFinId for each customerId
    const customerDetails = await customerModel.find(
      { _id: { $in: customerIds } },
      { _id: 1, customerFinId: 1 }
    );

    // Fetch applicant details for fullName
    const applicantDetails = await applicantModel.find(
      { customerId: { $in: customerIds } },
      { customerId: 1, fullName: 1 }
    );

    // Create maps for quick lookups
    const customerMap = customerDetails.reduce((map, customer) => {
      map[customer._id] = customer.customerFinId;
      return map;
    }, {});

    const applicantMap = applicantDetails.reduce((map, applicant) => {
      map[applicant.customerId] = applicant.fullName;
      return map;
    }, {});

    // Format the data to include required details
    const formattedData = data.map((item) => ({
      customerId: item.customerId,
      customerFinId: customerMap[item.customerId] || null,
      customerName: applicantMap[item.customerId] || null, // Fetch fullName from applicantModel
      estampRequirement: Array.isArray(item.estampRequirement) ? item.estampRequirement : [],
    }));

    // Return successful response with formatted data
    success(res, "Get Disbursement Details", formattedData);
  } catch (error) {
    console.error("Error fetching disbursement details:", error);
    unknownError(res, error);
  }
}



// --------------Get customer estampRequirement---------------------------------------

async function getEstampReq(req, res) {
  try {
    const { customerId } = req.query;
    // Fetch disbursement data
    const data = await disbursementModel
      .find(
        { customerId },
        {
          customerId: 1,
          estampRequirement: 1,
        }
      )
      .populate("estampRequirement.partnerName", "fullName userName") // Populates the partnerName field from lender
      .populate("estampRequirement.vendorName", "fullName userName");

    // Return successful response with formatted data
    success(res, "Get stamp Details", data);
    
  } catch (error) {
    console.error("Error fetching disbursement details:", error);
    unknownError(res, error);
  }
}

// ---------------Update EstampUpload By Branch OR Other Departmenet----------
const eStampUploadApi = async (req, res) => {
  try {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        errorName: "serverValidation",
        errors: errors.array(),
      });
    }

    const tokenId = new ObjectId(req.Id); // eStampUploadBy
    const { customerId, estampRequirementId, eStampUpload } = req.body;

    const customerDetail = await disbursementModel.findOne({
      customerId: new ObjectId(req.body.customerId),
    });
    if (!customerDetail) {
      return notFound(res, "CustomerId Not Found");
    }

    if (!customerId || !estampRequirementId || !Array.isArray(eStampUpload)) {
      return badRequest(
        res,
        "Customer ID, estampRequirementId, and eStampUpload are required. eStampUpload must be an array."
      );
    }

    const updatedDisbursement = await disbursementModel.findOneAndUpdate(
      {
        customerId,
        "estampRequirement._id": estampRequirementId, // Match specific item by ID
      },
      {
        $push: {
          "estampRequirement.$.eStampUpload": { $each: eStampUpload }, // Append eStampUpload array
        },
        $set: {
          "estampRequirement.$.eStampUploadBy": tokenId,
        },
      },
      { new: true }
    );

    if (!updatedDisbursement) {
      return notFound(res, "EstampRequirement not found for the provided IDs.");
    }

    success(
      res,
      "E-stamp uploaded and updated successfully.",
      updatedDisbursement.estampRequirement
    );
  } catch (error) {
    console.error(error);
    unknownError(res, error);
  }
};

// --------------Partner Name List By CustomerId -----------------
async function getPartnerDetailByCustomerId(req, res) {
  try {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        errorName: "serverValidation",
        errors: errors.array(),
      });
    }

    const customerId = req.query.customerId;

    const partnerDetail = await finalModel.aggregate([
      { $match: { customerId: new ObjectId(customerId) } },
      {
        $lookup: {
          from: "lenders",
          localField: "partnerId",
          foreignField: "_id",
          as: "partnerDetail",
        },
      },
      {
        $project: {
          partnerDetail:1
          // "partnerDetail.fullName": 1, // Include only the partnerName field
          // "partnerDetail._id": 1,
          // "partnerDetail.partnerUniqueId": 1,
          // _id:0                    // Optionally exclude the _id field if not needed
        },
      },
    ]);

    success(res, "Partner Detail Retrieved", partnerDetail);
  } catch (error) {
    console.log(error);
    unknownError(res, error);
  }
}

// ------------Esign Document Gate From Final Model------------
const getCustomerEsignDocument = async (req, res) => {
  try {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        errorName: "serverValidation",
        errors: errors.array(),
      });
    }
    const { customerId, lenderId } = req.query;

    // Validate the required query parameters
    if (!customerId || !lenderId) {
      return badRequest(res, "Customer ID and Lender ID are required.");
    }

    // Fetch the document based on customerId and lenderId
    const customerEsignDocument = await lenderDocumentModel.findOne({
      customerId: new ObjectId(customerId),
      lenderId: lenderId,
    });

    // If no document is found, return a not found response
    if (!customerEsignDocument) {
      return notFound(res, "CustomerId and lenderId Not Match", []);
    }

    const esignDocuments = (customerEsignDocument.esignDocument || []).sort(
      (a, b) => a.serialNo - b.serialNo
    );

    success(res, "Esign Document Customer List", esignDocuments);
  } catch (error) {
    console.error(error);
    unknownError(res, error);
  }
};

// ------------Esign Document Gate From Lender Document Model------------
const getCustomerEsignUrl = async (req, res) => {
  try {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        errorName: "serverValidation",
        errors: errors.array(),
      });
    }
    const { customerId, partnerId } = req.query;

    // Validate the required query parameters
    if (!customerId || !partnerId) {
      return notFound(res, "Customer ID and Partner ID are required.", []);
    }

    // Fetch the document based on customerId and lenderId
    const customerEsignDocument = await finalModel.findOne({
      customerId: new ObjectId(customerId),
      partnerId: partnerId,
    });

    // If no document is found, return a not found response
    if (!customerEsignDocument) {
      return notFound(res, "CustomerId and lenderId Not Match", []);
    }

    const esignDocuments = customerEsignDocument.esignLink || [];

    success(res, "E-Sign Document URL for Customer", esignDocuments);
  } catch (error) {
    console.error(error);
    unknownError(res, error);
  }
};

const updatePropertyDetails = async (req, res) => {
  try {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        errorName: "serverValidation",
        errors: errors.array(),
      });
    }
    const { documentName, documentId, customerId } = req.body;
    console.log(req.body, "<<>>><<>><<>><<>>");
    const fileData = req.file;

    if (!customerId) {
      return res.status(400).json({ message: "Customer ID is required." });
    }

    // Find the customer document details
    const customerDocumentDetails = await customerDocumentModel.findOne({
      customerId,
    });

    if (!customerDocumentDetails) {
      return res.status(404).json({ message: "Customer not found." });
    }

    let updatedDocument;

    if (documentId) {
      // Update the existing document (documentName and/or propertyDocument)
      updatedDocument = await customerDocumentModel.findOneAndUpdate(
        {
          customerId,
          "propertyDocument.document._id": documentId,
        },
        {
          $set: {
            "propertyDocument.document.$.documentName": documentName,
            "propertyDocument.document.$.propertyDocument": fileData?.filename
              ? [`uploads/${fileData.filename}`]
              : [],
          },
        },
        { new: true }
      );
    } else {
      // Push a new document
      updatedDocument = await customerDocumentModel.findOneAndUpdate(
        { customerId },
        {
          $push: {
            "propertyDocument.document": {
              documentName,
              propertyDocument: fileData?.filename
                ? [`uploads/${fileData?.filename}`]
                : [],
            },
          },
        },
        { new: true }
      );
    }

    success(
      res,
      "Document updated successfully",
      updatedDocument?.propertyDocument
    );
  } catch (error) {
    console.log(error, "error");
    console.error(error);
    unknownError(res, error.message);
  }
};

// Reject by Ho //
const RejectByHo = async (req, res) => {
  console.log(req.Id);
  try {
    const { customerId, remark } = req.query;
    if (!customerId || customerId.trim() === "") {
      return badRequest(res, "CustomerId is required");
    }

    const employeeData = await employeModel.findOne({ _id: req.Id });
    if (!employeeData) {
      return badRequest(res, "Employee not found");
    }

    const customer = await customerModel.findById(customerId);
    if (!customer) {
      return notFound(res, "Customer not found");
    }

    const inactiveStatus = "inactive";

    const updatedCustomer = await externalVendorFormModel.findOneAndUpdate(
      { customerId: customerId }, // Query filter
      {
        $set: {
          rejectemployeeId: employeeData._id,
          rejectRemark: remark,
          fileStatus: inactiveStatus,
        },
      },
      { new: true } // Return the updated document
    );

    if (!updatedCustomer) {
      return unknownError(
        res,
        "Failed to update customer status in externalVendorFormModel"
      );
    }

    // Update the PD model with rejection status
    const updatedPd = await creditPdModel.findOneAndUpdate(
      { customerId: customerId }, // Query filter
      {
        $set: {
          status: "rejectByHo",
        },
      },
      { new: true } // Return the updated document
    );

    if (!updatedPd) {
      return unknownError(
        res,
        "Failed to update customer status in creditPdModel"
      );
    }

    // Respond with the updated customer details
    return success(res, "Customer status updated to 'Rejected by HO'");
  } catch (error) {
    console.error("Error in RejectByHo:", error);
    return unknownError(res, error.message || "An unexpected error occurred");
  }
};

// update status by HO(complete,reject)
// update this api
const updateStatusByHo = async (req, res) => {
  // console.log(req.Id)
  try {
    const { customerId, remark, status, type } = req.body;
    if (!customerId || customerId.trim() === "") {
      return badRequest(res, "CustomerId is required");
    }

    // const employeeData = await employeModel.findOne({ _id: req.Id });
    // if (!employeeData) {
    //     return badRequest(res, "Employee not found");
    // }
    const customer = await customerModel.findById(customerId);
    if (!customer) {
      return notFound(res, "Customer not found");
    }
    const partnerCheck = await finalModel.findOne({ customerId });
    const coApplicantData = await coApplicantModel.find({ customerId });
    const applicantData = await applicantModel.findOne({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const cibilData = await cibilModel.findOne({ customerId });
    const SignKycDetails = await SignKycModel.findOne({ customerId });
    const customerDocumentDetails = await customerDocumentModel.findOne({
      customerId,
    });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const loanDocumentData = await loanDocumentModel.findOne({ customerId });


    if (type === "finalSanction") {
      // console.log(
      //   // partnerCheck.fileProcessSanctionStatus,
      //   // coApplicantData.length > 0 && coApplicantData[0].kycUpload && Object.keys(coApplicantData[0].kycUpload).length,
      //   // // coApplicantData.length > 0 && coApplicantData[1]?.kycUpload && Object.keys(coApplicantData[0]?.kycUpload).length ,
      //   // guarantorData.kycUpload && Object.keys(guarantorData.kycUpload).length,
      //   // cibilData?.coApplicantData[0]?.coApplicantCibilReport.length,
      //   // // cibilData?.coApplicantData[1]?.coApplicantCibilReport?.length,
      //   // cibilData?.guarantorCibilReport.length ,
      //   customerDocumentDetails.signApplicantKyc.length
      // )
      if(  partnerCheck.fileProcessSanctionStatus === "complete" &&
        applicantData.kycUpload && Object.keys(applicantData.kycUpload).length > 0 &&
        coApplicantData.length > 0 && coApplicantData[0].kycUpload && Object.keys(coApplicantData[0].kycUpload).length > 0 &&
        // coApplicantData.length > 0 && coApplicantData[1]?.kycUpload && Object.keys(coApplicantData[0]?.kycUpload).length > 0 &&
        guarantorData.kycUpload && Object.keys(guarantorData.kycUpload).length > 0 &&
        cibilData?.applicantCibilReport.length > 0 &&
        cibilData?.coApplicantData[0].coApplicantCibilReport?.length > 0 &&
        // cibilData?.coApplicantData[1].coApplicantCibilReport?.length > 0 &&
        cibilData?.guarantorCibilReport.length > 0 &&
        customerDocumentDetails.signApplicantKyc.length > 0 &&
        customerDocumentDetails.signCoApplicantKyc.length > 0 &&
        customerDocumentDetails.signGurantorKyc.length > 0 &&
        customerDocumentDetails.incomeDocument.utilityBillDocument?.length > 0 &&
        customerDocumentDetails.incomeDocument.familyCardDocument?.length > 0 &&
        customerDocumentDetails.incomeDocument.udyamCertificateDocument?.length > 0 &&
        customerDocumentDetails.incomeDocument.bankStatementDocument?.length > 0 &&
        customerDocumentDetails.incomeDocument.incomeStatemenDocument?.length > 0 &&
        customerDocumentDetails.propertyDocument.propertyDocument?.length > 0
      )
      {
        const updatedPd = await creditPdModel.findOneAndUpdate(
          { customerId: customerId }, // Query filter
          {
            $set: {
              branchStatus: status,
              hoRemark: remark,
            },
          },
          { new: true } // Return the updated document
        );
         await finalModel.findOneAndUpdate(
          { customerId: customerId }, // Query filter
          {
            $set: {
              fileProcessSendToSanctionStatus: "complete",
            },
          },
          { new: true } // Return the updated document
        );
        // console.log(updatedPd, "updatedPd");
        if (!updatedPd) {
          return unknownError(
            res,
            "Failed to update customer status in creditPdModel"
          );
        }
         // Respond with the updated customer details
       return success(res, "sanction send successfully");
      }else {
       return badRequest(res, "please fill sanction form details and documents");
      }
    }
   
    if (type === "disbursement"){
      console.log(
        partnerCheck.fileProcessDisbursementStatus,
        appPdcData?.applicantPdcDocument?.length,
        gtrPdcData?.guarantorPdcDocument?.length,
        loanDocumentData?.applicantBSV?.length,
        loanDocumentData?.guarantorBSV?.length
      )
      if(partnerCheck.fileProcessDisbursementStatus === "complete" &&
        appPdcData?.applicantPdcDocument?.length > 0 &&
        gtrPdcData?.guarantorPdcDocument?.length > 0 &&
        loanDocumentData?.applicantBSV?.length > 0 && 
        loanDocumentData?.guarantorBSV?.length > 0 
      ){
        const updatedPd = await creditPdModel.findOneAndUpdate(
          { customerId: customerId }, // Query filter
          {
            $set: {
              branchStatus: status,
              hoRemark: remark,
            },
          },
          { new: true } // Return the updated document
        );
        await finalModel.findOneAndUpdate(
          { customerId: customerId }, // Query filter
          {
            $set: {
              fileProcessSendDisbursementStatus: "complete",
            },
          },
          { new: true } // Return the updated document
        );
        console.log(updatedPd, "updatedPd");
        if (!updatedPd) {
          return unknownError(
            res,
            "Failed to update customer status in creditPdModel"
          );
        }
         // Respond with the updated customer details
       return success(res, "disbursement send successfully");
      }else {
       return badRequest(res, "please fill disbursement form details and documents");
      }
    }

    if (type === "reject"){
       await creditPdModel.findOneAndUpdate(
        { customerId: customerId }, // Query filter
        {
          $set: {
            branchStatus: status,
            hoRemark: remark,
          },
        },
        { new: true } // Return the updated document
      );
      return success(res, "disbursement send successfully");
    }
    
  } catch (error) {
    console.error("Error in RejectByHo:", error);
    return unknownError(res, error.message || "An unexpected error occurred");
  }
};

const signEsignDocument = async (req, res) => {
  // console.log(req.Id)
  try {
    const {
      customerId,
      applicantLink,
      coapplicantLink,
      coapplicantTwoLink,
      guarantorLink,
    } = req.body;
    // console.log(req.body,"<>><><><>")
    if (!customerId || customerId.trim() === "") {
      return badRequest(res, "CustomerId is required");
    }

    const customer = await customerModel.findById(customerId);
    if (!customer) {
      return notFound(res, "Customer not found");
    }

    // Update the PD model with rejection status
    // Dynamically construct the update object
    const updateFields = {};
    if (applicantLink)
      updateFields["signEsignLink.applicantLink"] = applicantLink;
    if (coapplicantLink)
      updateFields["signEsignLink.coapplicantLink"] = coapplicantLink;
    if (coapplicantTwoLink)
      updateFields["signEsignLink.coapplicantTwoLink"] = coapplicantTwoLink;
    if (guarantorLink)
      updateFields["signEsignLink.guarantorLink"] = guarantorLink;

    const updatedPd = await finalModel.findOneAndUpdate(
      { customerId: customerId },
      { $set: updateFields },
      { new: true }
    );

    if (!updatedPd) {
      return unknownError(
        res,
        "Failed to update customer status in creditPdModel"
      );
    }

    // Respond with the updated customer details
    return success(res, "sign esign link updated successfully", updatedPd);
  } catch (error) {
    console.error("Error in RejectByHo:", error);
    return unknownError(res, error.message || "An unexpected error occurred");
  }
};

const signEsignDocumentDetails = async (req, res) => {
  // console.log(req.Id)
  try {
    const { customerId } = req.query;
    // console.log(req.body,"<>><><><>")
    if (!customerId || customerId.trim() === "") {
      return badRequest(res, "CustomerId is required");
    }

    const customer = await customerModel.findById(customerId);
    if (!customer) {
      return notFound(res, "Customer not found");
    }

    const updatedPd = await finalModel.findOne({ customerId: customerId });

    if (!updatedPd) {
      return unknownError(
        res,
        "Failed to update customer status in creditPdModel"
      );
    }

    // let links = (updatedPd?.signEsignLink && Object.keys(updatedPd.signEsignLink).length > 0) 
    // ? updatedPd.signEsignLink 
    // : updatedPd?.esignLinks;
    let links = 
    (updatedPd?.signEsignLink && Object.values(updatedPd.signEsignLink).some(val => val)) 
    ? updatedPd.signEsignLink 
    : updatedPd?.esignLinks;



    // Respond with the updated customer details
     success(res, "sign esign link details", {links});
     await processModel.findOneAndUpdate(
      { customerId },
      { $set: {
        esign:true
      } },
      { new: true }
  );
  await finalApprovalSheet(customerId)
  } catch (error) {
    console.error("Error in RejectByHo:", error);
    return unknownError(res, error.message || "An unexpected error occurred");
  }
};

// const deedpdfs = async (req, res) => {
//   try {
//     let { customerId, conditions } = req.query;

//     if (conditions === "rmDeed") {
//       const rmDeedData = await GmRmDeedPdf(customerId);

//       const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

//       const processFile = async (filePath) => {
//         let resolvedPath = path
//           .resolve(__dirname, `../../../..${filePath}`)
//           .replace(/\\/g, "/");
//         const formData = new FormData();
//         formData.append("image", fs.createReadStream(resolvedPath));
//         const response = await axios.post(uploadUrl, formData, {
//           headers: { ...formData.getHeaders() },
//         });

//         return response.data?.items;
//       };

//       const uploadedincomeSectionUrl = await processFile(rmDeedData);

//       const rmDeedPdfUrl = `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;

//       return success(res, "PDF generated  successfully.", {
//         rmDeedPdf: rmDeedPdfUrl,
//       });
//     } else {
//       return badRequest(
//         res,
//         `Unsupported  deed types:please send correct types`
//       );
//     }
//   } catch (error) {
//     console.log(error);
//     return unknownError(res, error);
//   }
// };


const deedpdfs = async (req, res) => {
  try {
    let { customerId, conditions } = req.query;
    const partnerData = await finalModel.findOne({ customerId });
    if (!partnerData) {
      return badRequest(res, "partner's is required.");
    }
    const partnerModel = await lendersModel.findOne({
      _id: partnerData.partnerId,
    });
    if (!partnerModel) {
      return badRequest(res, "Partner not found.");
    }

    const normalizedPartnerName = (partnerModel.fullName || "")
      .trim()
      .toLowerCase();

    if (conditions === "rmDeed" &&normalizedPartnerName === "grow money capital pvt ltd") {
      const rmDeedData = await GmRmDeedPdf(customerId);

      // const uploadUrl = `${process.env.BASE_URL}v1/formData/ImageUpload`;

      // const processFile = async (filePath) => {
      //   let resolvedPath = path
      //     .resolve(__dirname, `../../../..${filePath}`)
      //     .replace(/\\/g, "/");
      //   const formData = new FormData();
      //   formData.append("image", fs.createReadStream(resolvedPath));
      //   const response = await axios.post(uploadUrl, formData, {
      //     headers: { ...formData.getHeaders() },
      //   });

      //   return response.data?.items;
      // };

      // const uploadedincomeSectionUrl = await processFile(uploadResponse.url);

      // const rmDeedPdfUrl = `${process.env.BASE_URL}${uploadedincomeSectionUrl.image}`;


      return success(res, "PDF generated  successfully.",rmDeedData);
      //   {
      //   rmDeedPdf: rmDeedData.uploadResponse,
      // });
    }
    else if (conditions === "emDeed"&&normalizedPartnerName === "grow money capital pvt ltd") {
      const rmDeedData = await GmemDeedPdf(customerId);

     


      return success(res, "PDF generated  successfully.",rmDeedData);
     
    }
      else if (conditions === "emDeed"&&normalizedPartnerName === "ratnaafin capital pvt ltd") {
          const rmDeedData = await ratnaEmDeedPdf(customerId);
          return success(res, "PDF generated  successfully.",rmDeedData);
        }
      if (conditions === "rmDeed" &&normalizedPartnerName === "fin coopers capital pvt ltd") {
      const rmDeedData = await fcplRmDeedPdf(customerId);
      return success(res, "PDF generated  successfully.",rmDeedData);
      //   {
      //   rmDeedPdf: rmDeedData.uploadResponse,
      // });
    }
     else {
      return badRequest(
        res,
        `Unsupported  partner (${partnerModel.fullName}) or Types:please send correct partner.`
      );
    }
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// --------------------------final approval update status ----------------------------------

const updateStatus = async (req, res) => {
  try {
    const { customerId, type, status, remark } = req.query;

    if (!customerId || !type) {
      return badRequest(res, "Missing required fields: customerId or type");
    }

    const processDetails = await processModel.findOne({ customerId });
    const documentData = await lenderDocumentModel.findOne({ customerId });
    const finalData = await finalModel.findOne({ customerId  })
    const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");

    if (type === "postDisbursement") {
      if (processDetails?.postDisbursementFormComplete) {
        await finalModel.findOneAndUpdate(
          { customerId },
          { $set: { sendToPartnerPostDisbursedStatus: "complete",
            sendToPartnerPostDisbursedDate:todayDate
           } },
          {new: true, upsert:true}
        );
        return success(res, "Post disbursement completed");
      } else {
        return badRequest(res, "Please complete post disbursement details");
      }
    }
    // console.log(finalData.disbursementZipUrl.length,"documentData?.sanctionZipUrl")
    if (type === "preDisbursement") {
      if (finalData.disbursementZipUrl.length > 0) {
        await finalModel.findOneAndUpdate(
          { customerId },
          { $set: { sendToPartnerPreDisbursedStatus: "complete",
            sendToPartnerPreDisbursedDate:todayDate
           } },
          {new: true, upsert:true}
        );
        return success(res, "Pre disbursement completed");
      } else {
        return badRequest(res, "Please complete pre disbursement details");
      }
    }
    if (type === "sanction") {
      // if (finalData.sanctionZipUrl.length > 0) {
        await finalModel.findOneAndUpdate(
          { customerId },
          { $set: { sendToPartnerSanctionStatus: "complete",
            sendToPartnerSanctionDate:todayDate
           } },
          {new: true, upsert:true}
        );
        // send email function
        await mailSendPartnerToSanction(customerId, req)
        return success(res, "Sanction completed");
      // } else {
      //   return badRequest(res, "Please complete sanction details");
      // }
    }
    if (type === "incomeSanction") {
      if (finalData.generateSanctionLatterStatus == "complete") {
        await finalModel.findOneAndUpdate(
          { customerId },
          { $set: { incomeSanctionStatus : "complete",
            incomeSanctionDate:todayDate
           } }
        );
        return success(res, "income Sanction completed");
      } else {
        return badRequest(res, "Please complete income sanction details");
      }
    }
    if (type === "reject") {
      
      await finalModel.findOneAndUpdate(
        { customerId },
        {
          $set: {
            fileProcessRejectStatus: status,
            fileProcessRejectDate: status === "complete"?todayDate:"",
            fileProcessRejectRemark: status === "complete"?remark:""
          }
        }
      );
      return success(res, `File ${status === "complete"?"Reject successfully":"Return Back"}`);
    }
    return badRequest(res, "Invalid type provided");
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

const statusList = async (req, res) => {
  try {
    const { customerId } = req.query;

    if (!customerId) {
      return badRequest(res, "Missing required fields: customerId");
    }
   const finalData = await finalModel.findOne({ customerId });
   
        return success(res, "status is fetched successfully",{
          sendToPartnerSanctionStatus: finalData?.sendToPartnerSanctionStatus || "",
          sendToPartnerPreDisbursedStatus: finalData?.sendToPartnerPreDisbursedStatus || "",
          sendToPartnerPostDisbursedStatus : finalData?.sendToPartnerPostDisbursedStatus || "",
          incomeSanctionStatus : finalData?.incomeSanctionStatus || "",
          finalSanctionStatus:finalData?.incomeSanctionStatus || "",
        });
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

    const generateLegalityDocument = async (req, res) => {
     try {
    const { customerId, links } = req.body;
    
    if (!customerId || !links) {
      return res.status(400).json({ success: false, message: "customerId and links are required" });
    }

    const selectionData = await final.findOne({ customerId });
    console.log(selectionData.pdfSelection, "selectionData<<>><<>>, selectionData");
    
    if (!selectionData || !selectionData.pdfSelection) {
      return badRequest(res, "Please select selection first");
    }

    const sectionEsign = await initESign(links, customerId);
    console.log(sectionEsign,"sectionEsign")
     // Check for error in sectionEsign response
     if (sectionEsign?.data && sectionEsign?.messages?.length > 0 && sectionEsign?.status === 0) {
      return badRequest(res, sectionEsign.messages[0].message || "Error in eSign process");
    }

    await final.findOneAndUpdate(
      {customerId},
      {
        $set:{
          esignLinks:sectionEsign
      }
    }
    )
     success(res, "Link generated successfully", { sectionEsign });
     await processModel.findOneAndUpdate(
      { customerId },
      { $set: {
        esign:true
      } },
      { new: true }
  );
  // await finalApprovalSheet(customerId)
  } catch (error) {
    console.error("Error in generateLegalityDocument:", error);
    return unknownError(res, error);
  }
};


const webhookMethod = async (req, res) => {
  try {
    const { request, documentId } = req.body;
    console.log(req.body, " salt, payload");

    const applicantData = await applicantModel.findOne({ email: request.email });
    const finalData = await final.findOne({ customerId: applicantData?.customerId });

    if (!finalData) {
      return res.status(404).json({ success: false, message: 'Customer data not found' });
    }

    // Initialize update query
    let updateQuery = {};

    // Check if documentId exists in esignLinks values
    const documentExists = Object.values(finalData.esignLinks || {}).some(value => 
      value === documentId || 
      value.applicantDocumentId === documentId || 
      value.coApplicantDocumentId === documentId
    );

    // Check if invitationUrl exists in esignLinks values
    const urlExists = Object.values(finalData.esignLinks || {}).some(value => 
      value === request.invitationUrl || 
      value.applicant === request.invitationUrl || 
      value.coApplicant === request.invitationUrl
    );

    if (documentExists) {
      if (request.action === "Signed") {
        // Get existing signEsignLinks or initialize if doesn't exist
        const existingSignLinks = finalData.signEsignLinks || {};
        
        // Get existing URLs for this documentId or initialize empty array
        const existingUrlsForDoc = existingSignLinks[documentId] || [];
        
        updateQuery = {
          $set: {
            signEsignLinks: {
              ...existingSignLinks,
              [`${documentId}`]: Array.isArray(existingUrlsForDoc) 
                ? [...existingUrlsForDoc, request.invitationUrl]
                : [request.invitationUrl]
            }
          }
        };
      } 

      // Only update if updateQuery is not empty
      if (Object.keys(updateQuery).length > 0) {
        const updatedDoc = await final.findOneAndUpdate(
          { customerId: applicantData.customerId },
          updateQuery,
          { new: true }
        );

        console.log('Updated document:', updatedDoc);
      }
    }

    res.status(200).json({ 
      success: true, 
      message: 'Webhook processed successfully'
    });

  } catch (error) {
    console.error('Error processing webhook:', error);
    const errorMessage = error.message || "An unknown error occurred";
    const errorStack = error.stack || "No stack trace available";
    
    return unknownError(res, error);
  }
};


const finalApprovalDashbord = async (req, res) => {
  try {
    const {
      regionalBranch,
      branch,
      employee,
      product,
      fileProcessStatus,
      finalApprovalStatus,
      startDateFilter: startDate,
      endDateFilter: endDate,
      pageLimit = 10000,
      pageNumber = 1,
      searchQuery,
    } = req.query;
    const { offset, limit } = paginationData(
      Number(pageLimit),
      Number(pageNumber)
    );
    const employeeId = req.Id;

    // Early employee validation with lean() for better performance
    const employeeExist = await employeModel
      .findOne({ _id: employeeId, status: "active" }, { _id: 1 })
      .lean();

    if (!employeeExist) {
      return badRequest(res, "Employee Not Found");
    }

    // Build initial match conditions
    let matchConditions = {};

    if (searchQuery) {
      matchConditions.$or = [
        { "applicantDetails.mobileNo": { $regex: searchQuery, $options: "i" } },
        {
          "applicantDetails.customerFatherName": {
            $regex: searchQuery,
            $options: "i",
          },
        },
        {
          "applicantDetails.customerFullName": {
            $regex: searchQuery,
            $options: "i",
          },
        },
        {
          "customerDetailData.customerFinId": {
            $regex: searchQuery,
            $options: "i",
          },
        },
      ];
    }

    if (regionalBranch && regionalBranch !== "all") {
      matchConditions.regionalBranch = {
        $in: (Array.isArray(regionalBranch) ? regionalBranch : regionalBranch.split(",")).map(
          (id) => new ObjectId(id)
        ),
      };
    }
    if (branch && branch !== "all") {
      matchConditions.branch = {
        $in: (Array.isArray(branch) ? branch : branch.split(",")).map(
          (id) => new ObjectId(id)
        ),
      };
    }

    if (employee && employee !== "all") {
      matchConditions["employeeDetail._id"] = {
        $in: (Array.isArray(employee) ? employee : employee.split(",")).map(
          (id) => new ObjectId(id)
        ),
      };
    }

    if (product && product !== "all") {
      matchConditions.productId = {
        $in: (Array.isArray(product) ? product : product.split(",")).map(
          (id) => new ObjectId(id)
        ),
      };
    }

    //added start and end date filter
    let dateConditions = {};
    const hasAll = [startDate, endDate].includes("all");
    if ((startDate || endDate) && !hasAll) {
      dateConditions = {
        $and: [
          ...(startDate ? [{ $gte: ["$createdAt", moment(startDate).toDate()] }] : []),
          ...(endDate ? [{ $lte: ["$createdAt", moment(endDate).toDate()] }] : []),
        ],
      };
    }
    const aggregationPipeline = [
      // Initial match to filter documents early
      {
        $match: matchConditions,
      },
      // Combine related lookups and add early filtering
      {
        $lookup: {
          from: "externalvendordynamics",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$customerId", "$$customerId"] },
                    { $in: ["$statusByCreditPd", ["complete", "approve"]] },
                    { $eq: ["$fileStatus", "active"] },
                  ],
                },
              },
            },
            { $limit: 1 }, // We only need to know if it exists
          ],
          as: "externalVenderData",
        },
      },
      { $match: { "externalVenderData.0": { $exists: true } } }, // More efficient than checking array length

      // Optimize PD Form lookup
      {
        $lookup: {
          from: "pdformdatas",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$customerId", "$$customerId"] },
                    { $in: ["$status", ["complete", "approve"]] },
                  ],
                },
              },
            },
            { $project: { status: 1, bdCompleteDate: 1, pdId: 1 } },
            { $limit: 1 },
          ],
          as: "pdData",
        },
      },
      { $match: { "pdData.0": { $exists: true } } },

      // Combine employee and related lookups
      {
        $lookup: {
          from: "employees",
          let: { employeId: "$employeId" },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$employeId"] } } },
            {
              $lookup: {
                from: "employees",
                let: { reportingManagerId: "$reportingManagerId" },
                pipeline: [
                  {
                    $match: {
                      $expr: { $eq: ["$_id", "$$reportingManagerId"] },
                    },
                  },
                  {
                    $project: {
                      employeName: 1,
                      employeUniqueId: 1,
                      userName: 1,
                    },
                  },
                ],
                as: "manager",
              },
            },
            {
              $lookup: {
                from: "newbranches",
                let: { branchId: "$branchId" },
                pipeline: [
                  { $match: { $expr: { $eq: ["$_id", "$$branchId"] } } },
                  { $project: { name: 1 } },
                ],
                as: "branch",
              },
            },
            {
              $project: {
                employeName: 1,
                userName: 1,
                employeUniqueId: 1,
                manager: { $arrayElemAt: ["$manager", 0] },
                branch: { $arrayElemAt: ["$branch", 0] },
              },
            },
          ],
          as: "employeeDetail",
        },
      },

      // Optimize applicant details lookup
      {
        $lookup: {
          from: "applicantdetails",
          let: { customerId: "$_id" },
          pipeline: [
            { $match: { $expr: { $eq: ["$customerId", "$$customerId"] } } },
            {
              $project: {
                fullName: 1,
                fatherName: 1,
                mobileNo: 1,
                applicantPhoto: 1,
              },
            },
            { $limit: 1 },
          ],
          as: "applicantDetail",
        },
      },

      // Optimize final sanction lookup
      {
        $lookup: {
          from: "finalsanctiondetaails",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$customerId", "$$customerId"] }, // Apply filter here
                    dateConditions,
                  ],
                },
              },
            },
            {
              $lookup: {
                from: "lenders",
                let: { partnerId: "$partnerId" },
                pipeline: [
                  { $match: { $expr: { $eq: ["$_id", "$$partnerId"] } } },
                  { $project: { fullName: 1 } },
                  { $limit: 1 },
                ],
                as: "lendersData",
              },
            },
            {
              $project: {
                createdAt: 1,
                fileProcessSanctionStatus: 1,
                fileProcessDisbursementStatus: 1,
                fileProcessFinalDisbursementStatus: 1,
                fileProcessSendToSanctionStatus: 1,
                fileProcessSendDisbursementStatus: 1,
                sendToPartnerPostDisbursedStatus:1,
                sendToPartnerPreDisbursedStatus:1,
                sendToPartnerSanctionStatus:1,
                incomeSanctionStatus:1,
                fileProcessRejectRemark: 1,
                lenderFullName: { $arrayElemAt: ["$lendersData.fullName", 0] },
              },
            },
            { $limit: 1 },
          ],
          as: "finalSanctionData",
        },
      },
      // {
      //   $match: {
      //     "finalSanctionData.createdAt": { $exists: true },
      //   },
      // },
      {
        $match: {
          $or:
            fileProcessStatus && fileProcessStatus !== "all"
              ? (typeof fileProcessStatus === "string"
                  ? fileProcessStatus.split(",").map((s) => s.trim())
                  : fileProcessStatus
                ).map((status) => {
                  switch (status) {
                    case "sentForSanction":
                    case "sendForSanction": // Adding support for both versions
                      return {
                        "finalSanctionData.sendToPartnerSanctionStatus":
                          "complete",
                      };
                    case "sentForDisbursement":
                      return {
                        "finalSanctionData.fileProcessDisbursementStatus":
                          "complete",
                      };
                    case "finalDisbursement":
                      return {
                        "finalSanctionData.fileProcessFinalDisbursementStatus":
                          "complete",
                      };
                    case "pending":
                      return {
                        $or: [
                          { finalSanctionData: { $size: 0 } },
                          {
                            $and: [
                              { finalSanctionData: { $ne: [] } },
                              {
                                $or: [
                                  {
                                    "finalSanctionData.sendToPartnerSanctionStatus":
                                      { $ne: "complete" },
                                  },
                                  {
                                    "finalSanctionData.fileProcessDisbursementStatus":
                                      { $ne: "complete" },
                                  },
                                  {
                                    "finalSanctionData.fileProcessFinalDisbursementStatus":
                                      { $ne: "complete" },
                                  },
                                ],
                              },
                            ],
                          },
                        ],
                      };
                    default:
                      return {};
                  }
                })
              : [{}],
        },
      },
      {
        $match: {
          $or:
            finalApprovalStatus && finalApprovalStatus !== "all"
              ? (typeof finalApprovalStatus === "string"
                  ? finalApprovalStatus.split(",").map((s) => s.trim())
                  : finalApprovalStatus
                ).map((status) => {
                  switch (status) {
                    case "incomeSanction":
                    case "incomeSanction": // Adding support for both versions
                      return {
                        "finalSanctionData.incomeSanctionStatus": "complete",
                      };
                    case "sendToPartnerSanction":
                      return {
                        "finalSanctionData.sendToPartnerSanctionStatus":
                          "complete",
                      };
                    case "sendToPartnerDisbursed":
                      return {
                        "finalSanctionData.sendToPartnerPreDisbursedStatus":
                          "complete",
                      };
                    case "disbursed":
                      return {
                        "finalSanctionData.sendToPartnerPostDisbursedStatus":
                          "complete",
                      };
                    case "pending":
                      return {
                        $or: [
                          { finalSanctionData: { $size: 0 } },
                          {
                            $and: [
                              { finalSanctionData: { $ne: [] } },
                              {
                                $or: [
                                  {
                                    "finalSanctionData.incomeSanctionStatus": {
                                      $ne: "complete",
                                    },
                                  },
                                  {
                                    "finalSanctionData.sendToPartnerSanctionStatus":
                                      { $ne: "complete" },
                                  },
                                  {
                                    "finalSanctionData.sendToPartnerPreDisbursedStatus":
                                      { $ne: "complete" },
                                  },
                                  {
                                    "finalSanctionData.sendToPartnerPostDisbursedStatus":
                                      { $ne: "complete" },
                                  },
                                ],
                              },
                            ],
                          },
                        ],
                      };
                    default:
                      return {};
                  }
                })
              : [{}],
        },
      },
      // Optimize facet operation
      {
        $facet: {
          metaData: [
            {
              $group: {
                _id: null,
                totalCases: { $sum: 1 },
                Disbursement: {
                  $sum: {
                    $cond: [
                      {
                        $and: [
                          {
                            $eq: [
                              {
                                $arrayElemAt: [
                                  "$finalSanctionData.sendToPartnerPostDisbursedStatus",
                                  0,
                                ],
                              },
                              "complete",
                            ],
                          },
                          // {
                          //   $eq: [
                          //     {
                          //       $arrayElemAt: [
                          //         "$finalSanctionData.fileProcessDisbursementStatus",
                          //         0,
                          //       ],
                          //     },
                          //     "complete",
                          //   ],
                          // },
                          // {
                          //   $eq: [
                          //     {
                          //       $arrayElemAt: [
                          //         "$finalSanctionData.fileProcessFinalDisbursementStatus",
                          //         0,
                          //       ],
                          //     },
                          //     "complete",
                          //   ],
                          // },
                        ],
                      },
                      1,
                      0,
                    ],
                  },
                },
                sentForDisbursement: {
                  $sum: {
                    $cond: [
                      {
                        $and: [
                          {
                            $eq: [
                              {
                                $arrayElemAt: [
                                  "$finalSanctionData.sendToPartnerPreDisbursedStatus",
                                  0,
                                ],
                              },
                              "complete",
                            ],
                          },
                          // {
                          //   $ne: [
                          //     {
                          //       $arrayElemAt: [
                          //         "$finalSanctionData.sendToPartnerPostDisbursedStatus",
                          //         0,
                          //       ],
                          //     },
                          //     "complete",
                          //   ],
                          // },
                          // {
                          //   $ne: [
                          //     {
                          //       $arrayElemAt: [
                          //         "$finalSanctionData.sendToPartnerSanctionStatus",
                          //         0,
                          //       ],
                          //     },
                          //     "complete",
                          //   ],
                          // },
                        ],
                      },
                      1,
                      0,
                    ],
                  },
                },
                sendForSanction: {
                  $sum: {
                    $cond: [
                      {
                        $and: [
                          {
                            $eq: [
                              {
                                $arrayElemAt: [
                                  "$finalSanctionData.sendToPartnerSanctionStatus",
                                  0,
                                ],
                              },
                              "complete",
                            ],
                          },
                          // {
                          //   $ne: [
                          //     {
                          //       $arrayElemAt: [
                          //         "$finalSanctionData.sendToPartnerPostDisbursedStatus",
                          //         0,
                          //       ],
                          //     },
                          //     "complete",
                          //   ],
                          // },
                        ],
                      },
                      1,
                      0,
                    ],
                  },
                },
                incomeSanction: {
                  $sum: {
                    $cond: [
                      {
                        $and: [
                          {
                            $eq: [
                              {
                                $arrayElemAt: [
                                  "$finalSanctionData.incomeSanctionStatus",
                                  0,
                                ],
                              },
                              "complete",
                            ],
                          },
                          // {
                          //   $ne: [
                          //     {
                          //       $arrayElemAt: [
                          //         "$finalSanctionData.fileProcessDisbursementStatus",
                          //         0,
                          //       ],
                          //     },
                          //     "complete",
                          //   ],
                          // },
                        ],
                      },
                      1,
                      0,
                    ],
                  },
                },
                reject: {
                  $sum: {
                    $cond: [
                      {
                        $eq: [
                          {
                            $arrayElemAt: [
                              "$finalSanctionData.fileProcessRejectStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      1,
                      0,
                    ],
                  },
                },
              },
            },
          ],
          data: [
            { $skip: offset },
            { $limit: limit },
            {
              $project: {
                _id: 1,
                employeId: 1,
                customerFinId: 1,
                mobileNo: 1,
                branch: 1,
                createdAt: 1,
                productId: 1,
                pdData: { $arrayElemAt: ["$pdData", 0] },
                employeeDetail: {
                  $let: {
                    vars: { emp: { $arrayElemAt: ["$employeeDetail", 0] } },
                    in: {
                      _id: "$$emp._id",
                      employeName: "$$emp.employeName",
                      managerName: "$$emp.manager.employeName",
                      managerUniqueId: "$$emp.manager.employeUniqueId",
                      managerUserName: "$$emp.manager.userName",
                      branchId: "$$emp.branch._id",
                      branchName: "$$emp.branch.name",
                    },
                  },
                },
                applicantDetail: { $arrayElemAt: ["$applicantDetail", 0] },
                TAT: {
                  $let: {
                    vars: {
                      bdDate: {
                        $arrayElemAt: ["$pdData.bdCompleteDate", 0],
                      },
                    },
                    in: {
                      $cond: {
                        if: { $eq: ["$$bdDate", null] },
                        else: {
                          $dateDiff: {
                            startDate: {
                              $dateFromString: {
                                dateString: {
                                  $trim: {
                                    input: {
                                      $replaceAll: {
                                        input: {
                                          $replaceAll: {
                                            input: "$$bdDate",
                                            find: " PM",
                                            replacement: "",
                                          },
                                        },
                                        find: " AM",
                                        replacement: "",
                                      },
                                    },
                                  },
                                },
                                format: "%Y-%m-%dT%H:%M:%S",
                              },
                            },
                            endDate: "$$NOW",
                            unit: "day",
                          },
                        },
                        then: null,
                      },
                    },
                  },
                },
                finalSanctionData: {
                  $let: {
                    vars: {
                      fs: { $arrayElemAt: ["$finalSanctionData", 0] },
                    },
                    in: {
                      _id: "$$fs._id",
                      lenderFullName: "$$fs.lenderFullName",
                      fileProcessRejectRemark: "$$fs.fileProcessRejectRemark",
                      createdAt: "$$fs.createdAt",
                      fileProcessStatus: {
                        $switch: {
                          branches: [
                            {
                              case: {
                                $and: [
                                  {
                                    $eq: [
                                      "$$fs.fileProcessSanctionStatus",
                                      "complete",
                                    ],
                                  },
                                  {
                                    $eq: [
                                      "$$fs.fileProcessDisbursementStatus",
                                      "complete",
                                    ],
                                  },
                                  {
                                    $eq: [
                                      "$$fs.fileProcessFinalDisbursementStatus",
                                      "complete",
                                    ],
                                  },
                                ],
                              },
                              then: "Final Disbursement",
                            },
                            {
                              case: {
                                $and: [
                                  {
                                    $eq: [
                                      "$$fs.fileProcessSanctionStatus",
                                      "complete",
                                    ],
                                  },
                                  {
                                    $eq: [
                                      "$$fs.fileProcessDisbursementStatus",
                                      "complete",
                                    ],
                                  },
                                ],
                              },
                              then: "send for Disbursement",
                            },
                          ],
                          default: "",
                        },
                      },
                      hoStatus: {
                        $switch: {
                          branches: [
                            {
                              case: {
                                $and: [
                                  {
                                    $eq: [
                                      "$$fs.fileProcessSendToSanctionStatus",
                                      "complete",
                                    ],
                                  },
                                  {
                                    $eq: [
                                      "$$fs.fileProcessSendDisbursementStatus",
                                      "complete",
                                    ],
                                  },
                                ],
                              },
                              then: "send for Disbursement",
                            },
                            {
                              case: {
                                $eq: [
                                  "$$fs.fileProcessSendToSanctionStatus",
                                  "complete",
                                ],
                              },
                              then: "send for Sanction",
                            },
                          ],
                          default: "",
                        },
                      },
                    },
                  },
                },
              },
            },
          ],
        },
      },
    ];

    const results = await customerModel
      .aggregate(aggregationPipeline)
      .allowDiskUse(true);

    // console.timeEnd("API Execution Time");

    return success(res, "customerDetails", {
      totalCount: results[0].data.length,
      userDataLength: results[0].data.length,
      userData: results,
    });
  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


const finalApprovalDashboardUpdate = async (req, res) => {
  try {
    const {
      regionalBranch,
      branch,
      product,
      selfAssignEmployee,
      startDateFilter,
      endDateFilter,
      finalApproverStatus,
      fileProcessStatus,
      pageLimit = 10000,
      pageNumber = 1,
      searchQuery,
      sanctionStage,
    } = req.query;

    const employeeId = req.Id;

    // Basic validation
    const employeeExist = await employeModel
      .findOne({ _id: employeeId, status: "active" }, { _id: 1 })
      .lean();

    if (!employeeExist) {
      return badRequest(res, "Employee Not Found");
    }

    const today = new Date();
    const defaultStartDate = new Date(today.setHours(0, 0, 0, 0));
    const defaultEndDate = new Date(today.setHours(23, 59, 59, 999));

    function formatDateToISO(date) {
      return new Date(date).toISOString();
    }

    let formattedStart = startDateFilter && startDateFilter !== "all"
      ? new Date(new Date(startDateFilter).setHours(0, 0, 0, 0))
      : defaultStartDate;

    let formattedEnd = endDateFilter && endDateFilter !== "all"
      ? new Date(new Date(endDateFilter).setHours(23, 59, 59, 999))
      : defaultEndDate;

    if (startDateFilter && endDateFilter && startDateFilter === endDateFilter) {
      formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
      formattedEnd = new Date(new Date(startDateFilter).setHours(23, 59, 59, 999));
    }

    formattedStart = formatDateToISO(formattedStart);
    formattedEnd = formatDateToISO(formattedEnd);

    const aggregationPipeline = [
      // Initial basic match
      {
        $match: {
          fileStatus: "active",
          statusByCreditPd: { $in: ["complete", "approve"] }
        }
      },

      // All lookups first
      {
        $lookup: {
          from: "customerdetails",
          localField: "customerId",
          foreignField: "_id",
          as: "customerDetailData"
        }
      },
      { 
        $unwind: { 
          path: "$customerDetailData",
          preserveNullAndEmptyArrays: true 
        }
      },

      {
        $lookup: {
          from: "employees",
          localField: "customerDetailData.employeId",
          foreignField: "_id",
          as: "salesPerson"
        }
      },
      {
        $unwind: {
          path: "$salesPerson",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "customerDetailData.branch",
          foreignField: "_id",
          as: "branchDetails"
        }
      },
      {
        $unwind: {
          path: "$branchDetails",
          preserveNullAndEmptyArrays: true
        }
      },

      {
        $lookup: {
          from: "newbranches",
          localField: "branchDetails.regionalBranchId",
          foreignField: "_id",
          as: "regionalBranchDetails"
        }
      },
      {
        $unwind: {
          path: "$regionalBranchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "employees",
          localField: "salesPerson.reportingManagerId",
          foreignField: "_id",
          as: "reportingManager"
        }
      },
      {
        $unwind: {
          path: "$reportingManager",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "applicantDetails"
        }
      },
      {
        $unwind: {
          path: "$applicantDetails",
          preserveNullAndEmptyArrays: true
        }
      },

      {
        $lookup: {
          from: "employees",
          localField: "creditPdId",
          foreignField: "_id",
          as: "pdEmployeeDetail"
        }
      },
      {
        $unwind: {
          path: "$pdEmployeeDetail",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "products",
          localField: "customerDetailData.productId",
          foreignField: "_id",
          as: "productDetailData"
        }
      },
      {
        $unwind: {
          path: "$productDetailData",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "customerId",
          foreignField: "customerId",
          as: "finalsanctionData"
        }
      },
      {
        $unwind: {
          path: "$finalsanctionData",
          preserveNullAndEmptyArrays: true
        }
      },

      {
        $lookup: {
          from: "employees",
          localField: "finalsanctionData.employeeId",
          foreignField: "_id",
          as: "selfAssignEmployee"
        }
      },
      {
        $unwind: {
          path: "$selfAssignEmployee",
          preserveNullAndEmptyArrays: true
        }
      },

      {
        $lookup: {
          from: "lenders",
          localField: "finalsanctionData.partnerId",
          foreignField: "_id",
          as: "partnerDetails"
        }
      },
      {
        $unwind: {
          path: "$partnerDetails",
          preserveNullAndEmptyArrays: true
        }
      },

      {
        $lookup: {
          from: "bankstatementkycs",
          localField: "customerId",
          foreignField: "customerId",
          as: "bankstatementkycData"
        }
      },
      {
        $unwind: {
          path: "$bankstatementkycData",
          preserveNullAndEmptyArrays: true
        }
      },
      // Apply all filters after lookups
      {
        $match: {
          $and: [
            // Search query
            searchQuery ? {
              $or: [
                { "applicantDetails.mobileNo": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fullName": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fatherName": { $regex: searchQuery, $options: "i" } },
                { "customerDetailData.customerFinId": { $regex: searchQuery, $options: "i" } }
              ]
            } : {},

            // Branch filter
            branch && branch !== "all" ? {
              "branchDetails._id": {
                $in: (Array.isArray(branch) ? branch : branch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Regional branch filter
            regionalBranch && regionalBranch !== "all" ? {
              "regionalBranchDetails._id": {
                $in: (Array.isArray(regionalBranch) ? regionalBranch : regionalBranch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Product filter
            product && product !== "all" ? {
              "customerDetailData.productId": {
                $in: (Array.isArray(product) ? product : product.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // SanctionStage filter
            sanctionStage ? 
              sanctionStage === "partnerNotSelect" ? 
                { "finalsanctionData.partnerId": null } : 
              sanctionStage === "sanctionDetailNotComplete" ?
                {
                  $or: [
                    { "vendors.vendorType": "legal", "vendors.statusByVendor": { $ne: "approve" } },
                    { "vendors.vendorType": "technical", "vendors.statusByVendor": { $ne: "complete" } },
                    { "vendors.vendorType": "rcu", "vendors.statusByVendor": { $ne: "notRequired" } }
                  ]
                } :
              sanctionStage === "sanctionDetailComplete" ?
                {
                  $and: [
                    { $or: [
                        { "vendors.vendorType": "legal", "vendors.statusByVendor": "approve" },
                        { "vendors": { $not: { $elemMatch: { vendorType: "legal" } } } }
                      ]
                    },
                    { $or: [
                        { "vendors.vendorType": "technical", "vendors.statusByVendor": "complete" },
                        { "vendors": { $not: { $elemMatch: { vendorType: "technical" } } } }
                      ]
                    },
                    { $or: [
                        { "vendors.vendorType": "rcu", "vendors.statusByVendor": "notRequired" },
                        { "vendors": { $not: { $elemMatch: { vendorType: "rcu" } } } }
                      ]
                    },
                    { "finalsanctionData.sendToPartnerSanctionStatus": { $ne: "complete" } }
                  ]
                } : 
                {}
              : {},

            // finalApproverStatus filter
            finalApproverStatus && finalApproverStatus !== "partnerNotSelect" ? {
              $and: finalApproverStatus.split(",").map(statusKey => ({
                [`finalsanctionData.${statusKey}`]: "complete"
              }))
            } : {},

            // Special case for finalApproverStatus=partnerNotSelect
            finalApproverStatus === "partnerNotSelect" ? {
              "finalsanctionData.partnerId": null
            } : {},

            fileProcessStatus
            ? {
                $and: fileProcessStatus.split(",").map(statusKey => ({
                  [`finalsanctionData.${statusKey}`]: "complete"
                }))
              }
            : {},

            startDateFilter && endDateFilter && startDateFilter !== "all" && endDateFilter !== "all"? {
              creditPdCompleteDate: {
                $gte: formattedStart,
                $lt: formattedEnd,
              }
            }:{},
            
            selfAssignEmployee && selfAssignEmployee !=="all"?{
              "finalsanctionData.employeeId": {
                $in: (Array.isArray(selfAssignEmployee) ? selfAssignEmployee : selfAssignEmployee.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},
            
            // Exclude specific products when no product filter
            (!product || product === "all") ? {
              "customerDetailData.productId": {
                $nin: [].map(id => new ObjectId(id))
              }
            } : {}
          ].filter(condition => Object.keys(condition).length > 0)
        }
      },

      {
        $addFields: {
          vendors: [
            // RM Vendor
            {
              vendorType: "rm",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rm"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "notAssign"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rm"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // RCU Vendor
            {
              vendorType: "rcu",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rcu"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "notRequired"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rcu"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // Legal Vendor
            {
              vendorType: "legal",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "legal"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "approve"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "legal"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // Technical Vendor
            {
              vendorType: "technical",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "technical"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "complete"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "technical"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // Tagging Vendor
            {
              vendorType: "tagging",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "tagging"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "WIP"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "tagging"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            }
          ]
        }
      },
      
      
      // Add calculated fields and format vendor information
      {
        $addFields: {
          selfAssignEmployee: {$ifNull:[ "$finalsanctionData.employeeId", null]},
          esignLinks :"$finalsanctionData.esignLinks",
          esignStatus: {
            $cond: {
              if: {
                $or: [
                  { $eq: ["$finalsanctionData.esignLinks", null] },
                  { $eq: ["$finalsanctionData.esignLinks", {}] },
                  {
                    $and: [
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.applicant", ""] }, ""] },
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.coApplicant", ""] }, ""] },
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.coApplicantTwo", ""] }, ""] }
                    ]
                  }
                ]
              },
              then: "No",
              else: "Yes"
            }
          },
          Nachlink: {
            $cond: {
              if: { 
                $or: [
                  { $eq: ["$bankstatementkycData.Nachlink", null] }, 
                  { $eq: ["$bankstatementkycData.Nachlink", ""] }
                ] 
              },
              then: "NO",
              else: "YES"
            }
          },
          finalLoanAmount:{ $ifNull: [ "$finalsanctionData.finalLoanAmount", ""]},
          tenureInMonth :{ $ifNull: [ "$finalsanctionData.tenureInMonth",""]},
          roi:{ $ifNull: ["$finalsanctionData.roi",""]},
          selfAssignStatus : {$ifNull :["$finalsanctionData.finalSenctionFileSelfAssign",false]},
          customerId: "$customerDetailData._id",
          productName: { $ifNull: ["$productDetailData.productName",""]},
          selfAssignEmployeeName: { $ifNull: ["$selfAssignEmployee.employeName",""]},
          partnerName : { $ifNull: ["$partnerDetails.fullName",""]},
          regionalBranchName: { $ifNull: ["$regionalBranchDetails.name",""]},
          branchName :{ $ifNull: ["$branchDetails.name",""]},
          loginDate: { $ifNull: ["$customerDetailData.createdAt",""]},
          customerFinId:{ $ifNull: [ "$customerDetailData.customerFinId",""]},
          customerFullName:{ $ifNull: [ "$applicantDetails.fullName",""]},
          customerFatherName:{ $ifNull: [ "$applicantDetails.fatherName",""]},
          mobileNo:{ $ifNull: [ "$applicantDetails.mobileNo",""]},
          salesPersonName: "$salesPerson.employeName",
          salesPersonManagerName: "$reportingManager.employeName",
          pdPersonName: "$pdEmployeeDetail.employeName",
          incomeSanctionStatus: { $ifNull: ["$finalsanctionData.incomeSanctionStatus", ""] },
          sendToPartnerPostDisbursedStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPostDisbursedStatus", ""] },
          sendToPartnerPreDisbursedStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPreDisbursedStatus", ""] },
          sendToPartnerSanctionStatus: { $ifNull: ["$finalsanctionData.sendToPartnerSanctionStatus", ""] },
          fileProcessRejectStatus: { $ifNull: ["$finalsanctionData.fileProcessRejectStatus", ""] }
        }
      },

      // Group by customerId
      {
        $group: {
          _id: "$customerId",
          customerFinId: { $first: "$customerFinId" },
          customerId: { $first: "$customerId" },
          loginDate: { $first: "$loginDate" },
          branchName: { $first: "$branchName" },
          productName: { $first: "$productName" },
          esignStatus: { $first: "$esignStatus" },
          esignLinks : { $first: "$esignLinks" },
          Nachlink: { $first: "$Nachlink" },
          selfAssignEmployeeName: { $first: "$selfAssignEmployeeName" },
          roi : { $first: "$roi" },
          tenureInMonth : { $first: "$tenureInMonth" },
          selfAssignStatus: { $first: "$selfAssignStatus" },
          finalLoanAmount : { $first: "$finalLoanAmount" },
          partnerName: { $first: "$partnerName" },
          regionalBranchName: { $first: "$regionalBranchName" },
          salesPersonName: { $first: "$salesPersonName" },
          customerFullName: { $first: "$customerFullName" },
          customerFatherName: { $first: "$customerFatherName" },
          mobileNo: { $first: "$mobileNo" },
          salesPersonManagerName: { $first: "$salesPersonManagerName" },
          pdPersonName: { $first: "$pdPersonName" },
          creditPdCompleteDate: { $first: "$creditPdCompleteDate" },
          statusByCreditPd: { $first: "$statusByCreditPd" },
          vendors: { $first: "$vendors" },
          selfAssignEmployee: { $first: "$selfAssignEmployee" },
          incomeSanctionStatus: { $first: "$incomeSanctionStatus" },
          sendToPartnerPostDisbursedStatus: { $first: "$sendToPartnerPostDisbursedStatus" },
          sendToPartnerPreDisbursedStatus: { $first: "$sendToPartnerPreDisbursedStatus" },
          sendToPartnerSanctionStatus: { $first: "$sendToPartnerSanctionStatus" },
          fileProcessRejectStatus: { $first: "$fileProcessRejectStatus" }
        }
      },

      // Facet for pagination and counts
      {
        $facet: {
          totalCases: [{ $count: "total" }],
          fileDetails: [
            { $skip: (pageNumber - 1) * pageLimit },
            { $limit: parseInt(pageLimit) }
          ],
          notAssignCount: [
            { $match: { selfAssignEmployee : null } },
            { $count: "count" }
          ],
          selfAssignCount: [
            { $match: { selfAssignEmployee: {$ne:null} } },
            { $count: "count" }
          ],
          incomeSanctionStatus: [
            { $match: { incomeSanctionStatus: "complete" } },
            { $count: "count" }
          ],
          fileProcessRejectStatus: [
            { $match: { fileProcessRejectStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerPostDisbursedStatus: [
            { $match: { sendToPartnerPostDisbursedStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerPreDisbursedStatus: [
            { $match: { sendToPartnerPreDisbursedStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerSanctionStatus: [
            { $match: { sendToPartnerSanctionStatus: "complete" } },
            { $count: "count" }
          ]
        }
      },

      // Format the final output
      {
        $project: {
          totalCases: { $arrayElemAt: ["$totalCases.total", 0] },
          fileDetails: 1,
          counts: {
            notAssignCount : { $arrayElemAt: ["$notAssignCount.count", 0] },
            selfAssignCount: { $arrayElemAt: ["$selfAssignCount.count", 0] },
            fileProcessRejectStatus:{ $arrayElemAt: ["$fileProcessRejectStatus.count", 0] },
            incomeSanctionStatus: { $arrayElemAt: ["$incomeSanctionStatus.count", 0] },
            sendToPartnerPostDisbursedStatus: { $arrayElemAt: ["$sendToPartnerPostDisbursedStatus.count", 0] },
            sendToPartnerPreDisbursedStatus: { $arrayElemAt: ["$sendToPartnerPreDisbursedStatus.count", 0] },
            sendToPartnerSanctionStatus: { $arrayElemAt: ["$sendToPartnerSanctionStatus.count", 0] }
          }
        }
      }
    ];

    const results = await externalVendorFormModel
      .aggregate(aggregationPipeline)
      .allowDiskUse(true);

    // Calculate pagination metadata
    const totalRecords = results[0]?.totalCases || 0;
    const currentPage = Number(pageNumber);
    const totalPages = Math.ceil(totalRecords / pageLimit);
    const hasNextPage = currentPage < totalPages;
    const hasPreviousPage = currentPage > 1;

    const {
      notAssignCount = 0,
      selfAssignCount = 0,
      incomeSanctionStatus = 0,
      fileProcessRejectStatus = 0,
      sendToPartnerPostDisbursedStatus = 0,
      sendToPartnerPreDisbursedStatus = 0,
      sendToPartnerSanctionStatus = 0,
    } = results[0]?.counts || {};

    return success(res, "customerDetails", {
      totalCount: totalRecords,
      notAssignCount,
      selfAssignCount,
      incomeSanctionStatus,
      fileProcessRejectStatus,
      sendToPartnerPostDisbursedStatus,
      sendToPartnerPreDisbursedStatus,
      sendToPartnerSanctionStatus,
      fileDetails: results[0]?.fileDetails || [],
      pagination: {
        totalRecords,
        currentPage,
        pageSize: Number(pageLimit),
        totalPages,
      }
    });

  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


const secondWebhookMethod = async (req, res) => {
  try {
    const { request, documentId } = req.body;
    console.log(req.body, " salt, payload");

    const applicantData = await applicantModel.findOne({ email: request.email });
    const finalData = await final.findOne({ customerId: applicantData?.customerId });

    if (!finalData) {
      return res.status(404).json({ success: false, message: 'Customer data not found' });
    }

    // Initialize update query
    let updateQuery = {};

    // Check if documentId exists in esignLinks values
    const documentExists = Object.values(finalData.esignLinks || {}).some(value => 
      value === documentId || 
      value.applicantDocumentId === documentId || 
      value.coApplicantDocumentId === documentId
    );

    // Check if invitationUrl exists in esignLinks values
    const urlExists = Object.values(finalData.esignLinks || {}).some(value => 
      value === request.invitationUrl || 
      value.applicant === request.invitationUrl || 
      value.coApplicant === request.invitationUrl
    );

    if (documentExists) {
      if (request.action === "Signed") {
        // Get existing signEsignLinks or initialize if doesn't exist
        const existingSignLinks = finalData.signEsignLinks || {};
        
        // Get existing URLs for this documentId or initialize empty array
        const existingUrlsForDoc = existingSignLinks[documentId] || [];
        
        updateQuery = {
          $set: {
            signEsignLinks: {
              ...existingSignLinks,
              [`${documentId}`]: Array.isArray(existingUrlsForDoc) 
                ? [...existingUrlsForDoc, request.invitationUrl]
                : [request.invitationUrl]
            }
          }
        };
      } 

      // Only update if updateQuery is not empty
      if (Object.keys(updateQuery).length > 0) {
        const updatedDoc = await final.findOneAndUpdate(
          { customerId: applicantData.customerId },
          updateQuery,
          { new: true }
        );

        console.log('Updated document:', updatedDoc);
      }
    }

    res.status(200).json({ 
      success: true, 
      message: 'Webhook processed successfully'
    });

  } catch (error) {
    console.error('Error processing webhook:', error);
    const errorMessage = error.message || "An unknown error occurred";
    const errorStack = error.stack || "No stack trace available";
    
    return unknownError(res, error);
  }
};


// check legality document is sign or not
const documentLeegilatyDetails = async (req,res) =>{
  try{
    const { customerId } = req.query

    const finalData = await final.findOne({ customerId });

    const documentId = finalData?.esignLinks?.documentId

    if(documentId)
    {  
      const response = await axios.get(
        `https://app1.leegality.com/api/v3.0/document/details?documentId=${documentId}&file=true`, // <-- Add comma here
        {
          headers: { 
            'X-Auth-Token': process.env.LEGALITY_AUTH_TOKEN
          }
        }
      );
      // console.log(response, "response<<>><<>><>>>");
      
      const pdfBase64 = response?.data?.data?.file;
      if (!pdfBase64) {
        throw new Error("No PDF data received in API response");
      }
  
      const pdfBuffer = Buffer.from(pdfBase64, "base64");
  
      console.log('XML Response:', pdfBuffer);
      // const buffer = Buffer.from(xmlBuffer, 'base64');
      const filePathInBucket = `${process.env.PATH_BUCKET}/LOS/PDF/${Date.now()}_transactions.pdf`;
      const contentType = 'application/pdf';
      const bucketName = 'finexe'; // Replace with your actual bucket name
  
      const data = await uploadToSpaces(
        bucketName,
        filePathInBucket,
        pdfBuffer,
        'public-read',
        contentType
      );
  
      // Return the uploaded file's URL
      const fileUrl = `https://cdn.fincooper.in/${filePathInBucket}`;
      // console.log('PDF uploaded successfully:', fileUrl);

      const allInvitations = response.data.data.invitations;
      if (allInvitations && allInvitations.every(invite => invite.signed === true)) {
        // console.log(fileUrl, "<><><><><><><><><><>");
    const finalData = await final.findOneAndUpdate(
      { customerId },
      {
        $set:{
          signLeegalityLink:fileUrl
        }
      },
      {
        new:true
      }
    );
    // console.log(finalData,"finalData finalData finalData finalData " )
    return success(res,"all document signed",{signedUrl: fileUrl})
      }else{
        return badRequest(res,"document is not signed")
      }

    }else {
      return badRequest(res,"document id not found")
    }

  }catch (error) {
    console.error('Error processing webhook:', error);
    const errorMessage = error.message || "An unknown error occurred";
    const errorStack = error.stack || "No stack trace available";
    
    return unknownError(res, error);
  }
}

async function getDashboardTableByEmployee1(req, res) {
  try {
    const { startDateFilter, endDateFilter } = req.query;

    const formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
    const formattedEnd = new Date(new Date(endDateFilter).setHours(23, 59, 59, 999));

    let dateFilter = {};
    if (startDateFilter && endDateFilter) {
      dateFilter["createdAt"] = { $gte: formattedStart, $lt: formattedEnd };
    }

    const results = await final.aggregate([
      {
        $match: {
          employeeId: { $exists: true, $ne: null },
          ...dateFilter,
        },
      },
      {
        $group: {
          _id: "$employeeId",
          sendForSanction: {
            $sum: { $cond: [{ $eq: ["$sendToPartnerSanctionStatus", "complete"] }, 1, 0] },
          },
          // disbursementComplete: {
          //   $sum: { $cond: [{ $eq: ["$fileProcessDisbursementStatus", "complete"] }, 1, 0] },
          // },
          sentForDisbursement: {
            $sum: { $cond: [{ $eq: ["$sendToPartnerPreDisbursedStatus", "complete"] }, 1, 0] },
          },
          disbursment: {
            $sum: { $cond: [{ $eq: ["$sendToPartnerPostDisbursedStatus", "complete"] }, 1, 0] },
          },
          incomeSanction: {
            $sum: { $cond: [{ $eq: ["$incomeSanctionStatus", "complete"] }, 1, 0] },
          },
          pending: {
            $sum: {
              $cond: [
                {
                  $or: [
                    { $ne: ["$sendToPartnerSanctionStatus", "complete"] },
                    { $ne: ["$sendToPartnerPreDisbursedStatus", "complete"] },
                    { $ne: ["$sendToPartnerPostDisbursedStatus", "complete"] },
                    { $ne: ["$incomeSanctionStatus", "complete"] },

                  ],
                },
                1,
                0,
              ],
            },
          },
        },
      },
      {
        $addFields: {
          total: {
            $add: [
              "$sendForSanction",
              "$sentForDisbursement",
              "$disbursment",
              "$incomeSanction",
              "$pending",
            ],
          },
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "_id",
          foreignField: "_id",
          as: "employeeInfo",
        },
      },
      {
        $unwind: {
          path: "$employeeInfo",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $project: {
          _id: 1,
          employeeName: "$employeeInfo.employeName",
          sendForSanction: 1,
          sentForDisbursement: 1,
          disbursment: 1,
          incomeSanction:1,
          pending: 1,
          total: 1, 
        },
      },
      {
        $group: {
          _id: null,
          totalSendToSanctionComplete: { $sum: "$sendForSanction" },
          totalSendDisbursementComplete: { $sum: "$sentForDisbursement" },
          totalDisbursementComplete: { $sum: "$disbursment" },
          totalIncomeSanctionComplete: { $sum: "$incomeSanction" },
          totalPendingCases: { $sum: "$pending" },
          totalCases: { $sum: "$total" }, 
          employees: { $push: "$$ROOT" },
        },
      },
      {
        $project: {
          _id: 0,
          grandTotal: {
            sendToSanctionComplete: "$totalSendToSanctionComplete",
            sendDisbursementComplete: "$totalSendDisbursementComplete",
            DisbursementComplete: "$totalDisbursementComplete",
            IncomeSanctionComplete: "$totalIncomeSanctionComplete",
            pendingCases: "$totalPendingCases",
            totalCases: "$totalCases", 
          },
          items: "$employees",
        },
      },
    ]);

    return success(res, "Dashboard data retrieved successfully", results[0] || { grandTotal: {}, items: [] });
  } catch (error) {
    console.error("Error in getDashboardData:", error);
    return unknownError(res, error);
  }
}

const getDashboardTableByEmployee= async (req, res) => {
  try {
    const { startDateFilter, endDateFilter } = req.query;

    const formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
    const formattedEnd = new Date(new Date(endDateFilter).setHours(23, 59, 59, 999));

    let dateFilter = {};
    if (startDateFilter && endDateFilter) {
      dateFilter["createdAt"] = { $gte: formattedStart, $lt: formattedEnd };
    }

    const results = await final.aggregate([
      {
        $match: {
          employeeId: { $exists: true, $ne: null },
          ...dateFilter,
        },
      },
      {
        $lookup: {
          from: "externalvendordynamics",
          localField: "customerId",
          foreignField: "customerId",
          as: "externalVendorData",
          pipeline: [
            {
              $match: {
                statusByCreditPd: { $in: ["complete", "approve"] },
                fileStatus: "active",
              },
            },
          ],            
           },
      },
      {
        $match: {
          "externalVendorData": { $ne: [] },
          // "externalVendorData.statusByCreditPd": { $in: ["complete", "approve"] },
          // "externalVendorData.fileStatus": "active",
        },
      },
      {
        $group: {
          _id: "$employeeId",
          sendForSanction: {
            $sum: {
              $cond: [
                {
                  $and: [
                    { $eq: ["$sendToPartnerSanctionStatus", "complete"] },
                    // { $ne: ["$sendToPartnerPreDisbursedStatus", "complete"] },
                  ],
                },
                1,
                0,
              ],
            },
          },
          sentForDisbursement: {
            $sum: {
              $cond: [
                {
                  $and: [
                    { $eq: ["$sendToPartnerSanctionStatus", "complete"] },
                    { $eq: ["$sendToPartnerPreDisbursedStatus", "complete"] },
                    { $ne: ["$sendToPartnerPostDisbursedStatus", "complete"] },
                  ],
                },
                1,
                0,
              ],
            },
          },
          disbursment: {
            $sum: {
              $cond: [
                {
                  $and: [
                    { $eq: ["$sendToPartnerSanctionStatus", "complete"] },
                    { $eq: ["$sendToPartnerPreDisbursedStatus", "complete"] },
                    { $eq: ["$sendToPartnerPostDisbursedStatus", "complete"] },
                  ],
                },
                1,
                0,
              ],
            },
          },
          incomeSanction: {
            $sum: {
              $cond: [
                {
                  $and: [
                    { $eq: ["$incomeSanctionStatuss", "complete"] },
                   
                  ],
                },
                1,
                0,
              ],
            },
          },
          pending: {
            $sum: {
              $cond: [
                {
                  $and: [
                    { $ne: ["$sendToPartnerSanctionStatus", "complete"] },
                    { $ne: ["$sendToPartnerPreDisbursedStatus", "complete"] },
                    { $ne: ["$sendToPartnerPostDisbursedStatus", "complete"] },
                    { $ne: ["$incomeSanctionStatus", "complete"] },

                  ],
                },
                1,
                0,
              ],
            },
          },
        },
      },
      {
        $addFields: {
          total: {
            $add: [
              "$sendForSanction",
              "$sentForDisbursement",
              "$disbursment",
              "$incomeSanction",
              "$pending",
            ],
          },
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "_id",
          foreignField: "_id",
          as: "employeeInfo",
        },
      },
      {
        $unwind: {
          path: "$employeeInfo",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $project: {
          _id: 1,
          employeeName: "$employeeInfo.employeName",
          sendForSanction: 1,
          sentForDisbursement: 1,
          disbursment: 1,
          incomeSanction:1,
          pending: 1,
          total: 1,
        },
      },
      {
        $group: {
          _id: null,
          totalSendToSanctionComplete: { $sum: "$sendForSanction" },
          totalSendDisbursementComplete: { $sum: "$sentForDisbursement" },
          totalDisbursementComplete: { $sum: "$disbursment" },
          totalIncomeSanctionComplete: { $sum: "$incomeSanction" },
          totalPendingCases: { $sum: "$pending" },
          totalCases: { $sum: "$total" },
          employees: { $push: "$$ROOT" },
        },
      },
      {
        $project: {
          _id: 0,
          grandTotal: {
            sendToSanctionComplete: "$totalSendToSanctionComplete",
            sendDisbursementComplete: "$totalSendDisbursementComplete",
            DisbursementComplete: "$totalDisbursementComplete",
            IncomeSanctionComplete: "$totalIncomeSanctionComplete",
            pendingCases: "$totalPendingCases",
            totalCases: "$totalCases",
          },
          items: "$employees",
        },
      },
    ]);

    return success(res, "Dashboard data retrieved successfully", results[0] || { grandTotal: {}, items: [] });
  } catch (error) {
    console.error("Error in getDashboardData:", error);
    return unknownError(res, error);
  }
};
const getDashboardTableByEmployee3 = async (req, res) => {
  try {
    const { startDateFilter, endDateFilter } = req.query;
    const employeeId = req.Id;

    const employeeExist = await employeModel.findOne({
      _id: employeeId,
      status: "active",
    });
    if (!employeeExist) {
      return badRequest(res, "Employee Not Found");
    }

    const formattedStart = new Date(
      new Date(startDateFilter).setHours(0, 0, 0, 0)
    );
    const formattedEnd = new Date(
      new Date(endDateFilter).setHours(23, 59, 59, 999)
    );
    let dateFilter = {};
    if (startDateFilter && endDateFilter) {
      dateFilter["createdAt"] = {
        // Correct way to assign a filter condition
        $gte: formattedStart,
        $lt: formattedEnd,
      };
    }
    console.log(dateFilter, "dateFilter");
    const data = await customerModel.aggregate([
      {
        $lookup: {
          from: "externalvendordynamics",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                statusByCreditPd: { $in: ["complete", "approve"] },
                fileStatus: "active",
              },
            },
          ],
          as: "externalVenderData",
        },
      },
      {
        $match: { "externalVenderData.0": { $exists: true } },
      },
      {
        $lookup: {
          from: "pdformdatas",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                status: { $in: ["complete", "approve"] },
              },
            },
          ],
          as: "pdData",
        },
      },
      {
        $match: { "pdData.0": { $exists: true } },
      },
      // {
      //   $lookup: {
      //     from: "newbranches",
      //     let: { branchId: "$branch" },
      //     pipeline: [
      //       {
      //         $match: { $expr: { $eq: ["$_id", "$$branchId"] } },
      //       },
      //     ],
      //     as: "branchData",
      //   },
      // },
      // {
      //   $unwind: {
      //     path: "$branchData",
      //     preserveNullAndEmptyArrays: true,
      //   },
      // },
      {
        $lookup: {
          from: "employees", // `employeeModel` ka collection name
          localField: "employeId",
          foreignField: "_id",
          as: "employeeDetails",
        },
      },
      {
        $unwind: {
          path: "$employeeDetails",
          preserveNullAndEmptyArrays: true, // Agar employee details na mile toh bhi result aaye
        },
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                ...dateFilter, // Applying date filter here
              },
            },
            {
              $project: {
                createdAt: 1,
                sendToPartnerSanctionStatus: 1,
                sendToPartnerPreDisbursedStatus: 1,
                sendToPartnerPostDisbursedStatus: 1,
                incomeSanctionStatus:1,
              },
            },
          ],
          as: "finalSanctionData",
        },
      },
      {
        $group: {
          _id: 1,
          employeeName: { $first: "$employeeDetails.employeName" }, // Use $first to get the value of employeeName
          totalDocuments: { $sum: 1 },
          finalSanctionData: { $push: "$finalSanctionData" },
        },
      },
      
      {
        $project: {
          _id: 1,
          branchName: 1,
          branchCode: 1,
          totalDocuments: 1,
          metaData: {
            totalCases: { $size: "$finalSanctionData" },
            finalDisbursement: {
              $size: {
                $filter: {
                  input: "$finalSanctionData",
                  as: "fsd",
                  cond: {
                    $and: [
                      {
                        $eq: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerSanctionStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      {
                        $eq: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerPreDisbursedStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      {
                        $eq: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerPostDisbursedStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                    ],
                  },
                },
              },
            },
            sentForDisbursement: {
              $size: {
                $filter: {
                  input: "$finalSanctionData",
                  as: "fsd",
                  cond: {
                    $and: [
                      {
                        $eq: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerSanctionStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      {
                        $eq: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerPreDisbursedStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      {
                        $ne: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerPostDisbursedStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                    ],
                  },
                },
              },
            },
            sendForSanction: {
              $size: {
                $filter: {
                  input: "$finalSanctionData",
                  as: "fsd",
                  cond: {
                    $and: [
                      {
                        $eq: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerSanctionStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      {
                        $ne: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerPreDisbursedStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                    ],
                  },
                },
              },
            },
            pending: {
              $size: {
                $filter: {
                  input: "$finalSanctionData",
                  as: "fsd",
                  cond: {
                    $and: [
                      {
                        $ne: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerSanctionStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      {
                        $ne: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerPreDisbursedStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                      {
                        $ne: [
                          {
                            $arrayElemAt: [
                              "$$fsd.sendToPartnerPostDisbursedStatus",
                              0,
                            ],
                          },
                          "complete",
                        ],
                      },
                    ],
                  },
                },
              },
            },
            total: {
              $add: [
                "$metaData.finalDisbursement",
                "$metaData.sentForDisbursement",
                "$metaData.sendForSanction",
                "$metaData.pending",
              ],
            },
          },
        },
      },
    ]);

    return success(res, "PD Files employee Table Dashboard", {
      status: true,
      message: "Table Dashboard",
      data,
    });
  } catch (error) {
    console.error("Dashboard API Error:", error);
    return res
      .status(500)
      .json({ message: "Internal server error", error: error.toString() });
  }
};

// const getDashboardTableByEmployee = async (req, res) => {
//   try {
//     const { startDateFilter, endDateFilter } = req.query;

//     // Format start and end dates
//     const formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
//     const formattedEnd = new Date(new Date(endDateFilter).setHours(23, 59, 59, 999));

//     let dateFilter = {};
//     if (startDateFilter && endDateFilter) {
//       dateFilter["createdAt"] = { $gte: formattedStart, $lt: formattedEnd };
//     }

//     const results = await finalSanctionModel.aggregate([
//       // Match documents with optional date filter and required employeeId
//       {
//         $match: {
//           employeeId: { $exists: true, $ne: null },
//           ...dateFilter,
//         },
//       },
//       // Lookup externalVendorDynamic collection to join with finalSanctionModel
//       {
//         $lookup: {
//           from: "externalvendordynamics",
//           localField: "customerId", // Assuming finalSanctionModel._id matches externalVendorDynamic.customerId
//           foreignField: "customerId",
//           as: "externalVendorData",
//         },
//       },
//       // Filter results based on external vendor conditions
//       {
//         $match: {
//           "externalVendorData": { $ne: [] }, // Only include documents with related externalVendorData
//           "externalVendorData.statusByCreditPd": { $in: ["complete", "approve"] },
//           "externalVendorData.fileStatus": "active",
//         },
//       },
//       // Group by employeeId and calculate aggregates
//       {
//         $group: {
//           _id: "$employeeId",
//           sendForSanction: {
//             $sum: { $cond: [{ $eq: ["$sendToPartnerSanctionStatus", "complete"] }, 1, 0] },
//           },
//           // disbursementComplete: {
//           //   $sum: { $cond: [{ $eq: ["$fileProcessDisbursementStatus", "complete"] }, 1, 0] },
//           // },
//           sentForDisbursement: {
//             $sum: { $cond: [{ $eq: ["$sendToPartnerPreDisbursedStatus", "complete"] }, 1, 0] },
//           },
//           disbursment: {
//             $sum: { $cond: [{ $eq: ["$fileProcessFinalDisbursementStatus", "complete"] }, 1, 0] },
//           },
//           incomeSanction: {
//             $sum: { $cond: [{ $eq: ["$incomeSanctionStatus", "complete"] }, 1, 0] },
//           },
//           pending: {
//             $sum: {
//               $cond: [
//                 {
//                   $or: [
//                     { $ne: ["$sendToPartnerSanctionStatus", "complete"] },
//                     { $ne: ["$sendToPartnerPreDisbursedStatus", "complete"] },
//                     { $ne: ["$fileProcessFinalDisbursementStatus", "complete"] },
//                     { $ne: ["$incomeSanctionStatus", "complete"] },

//                   ],
//                 },
//                 1,
//                 0,
//               ],
//             },
//           },
//         },
//       },
//       // Add a total field for each employee's aggregates
//       {
//         $addFields: {
//           total: {
//             $add: [
//               "$sendForSanction",
//               "$sentForDisbursement",
//               "$disbursment",
//               "$incomeSanction",
//               "$pending",
//             ],
//           },
//         },
//       },
//       // Lookup employee details from employees collection
//       {
//         $lookup: {
//           from: "employees",
//           localField: "_id",
//           foreignField: "_id",
//           as: "employeeInfo",
//         },
//       },
//       // Unwind employeeInfo array to simplify structure
//       {
//         $unwind: {
//           path: "$employeeInfo",
//           preserveNullAndEmptyArrays: true,
//         },
//       },
//       // Project fields for each employee
//       {
//         $project: {
//           _id: 1,
//           employeeName: "$employeeInfo.employeName",
//           sendForSanction: 1,
//           sentForDisbursement: 1,
//           finalDisbursement: 1,
//           pending: 1,
//           total: 1,
//         },
//       },
//       // Group all data into a summary with grand totals and employee-level data
//       {
//         $group: {
//           _id: null,
//           totalSendToSanctionComplete: { $sum: "$sendForSanction" },
//           totalSendDisbursementComplete: { $sum: "$sentForDisbursement" },
//           totalDisbursementComplete: { $sum: "$disbursment" },
//           totalIncomeSanctionComplete: { $sum: "$incomeSanction" },
//           totalPendingCases: { $sum: "$pending" },
//           totalCases: { $sum: "$total" }, 
//           employees: { $push: "$$ROOT" },
//         },
//       },
//       // Project final structure
//       {
//         $project: {
//           _id: 0,
//           grandTotal: {
//             sendToSanctionComplete: "$totalSendToSanctionComplete",
//             sendDisbursementComplete: "$totalSendDisbursementComplete",
//             DisbursementComplete: "$totalDisbursementComplete",
//             IncomeSanctionComplete: "$totalIncomeSanctionComplete",
//             pendingCases: "$totalPendingCases",
//             totalCases: "$totalCases", 
//           },
//           items: "$employees",
//         },
//       },
//     ]);

//     // Return the response
//     return success(res, "Dashboard data retrieved successfully", results[0] || { grandTotal: {}, items: [] });
//   } catch (error) {
//     console.error("Error in getDashboardData:", error);
//     return unknownError(res, error);
//   }
// };


async function getDashboardDataByProduct(req, res) {
  try {
    const { startDateFilter, endDateFilter } = req.query;

    const formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
    const formattedEnd = new Date(new Date(endDateFilter).setHours(23, 59, 59, 999));

    let dateFilter = {};
    if (startDateFilter && endDateFilter) {
      dateFilter["createdAt"] = { $gte: formattedStart, $lt: formattedEnd };
    }

    const results = await final.aggregate([
      {
        $match: {
          employeeId: { $exists: true, $ne: null },
          ...dateFilter,
        },
      },
      {
        $group: {
          _id: "$employeeId",
          sendToSanctionComplete: {
            $sum: { $cond: [{ $eq: ["$fileProcessSendToSanctionStatus", "complete"] }, 1, 0] },
          },
          // disbursementComplete: {
          //   $sum: { $cond: [{ $eq: ["$fileProcessDisbursementStatus", "complete"] }, 1, 0] },
          // },
          sendDisbursementComplete: {
            $sum: { $cond: [{ $eq: ["$fileProcessSendDisbursementStatus", "complete"] }, 1, 0] },
          },
          finalDisbursementComplete: {
            $sum: { $cond: [{ $eq: ["$fileProcessFinalDisbursementStatus", "complete"] }, 1, 0] },
          },
          pendingCases: {
            $sum: {
              $cond: [
                {
                  $or: [
                    { $ne: ["$fileProcessSendToSanctionStatus", "complete"] },
                    // { $ne: ["$fileProcessDisbursementStatus", "complete"] },
                    { $ne: ["$fileProcessSendDisbursementStatus", "complete"] },
                    { $ne: ["$fileProcessFinalDisbursementStatus", "complete"] },
                  ],
                },
                1,
                0,
              ],
            },
          },
        },
      },
      {
        $lookup: {
          from: "customerdetails",
          localField: "_id",
          foreignField: "employeId",
          as: "customerInfo",
        },
      },
      {
        $unwind: {
          path: "$customerInfo",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $lookup: {
          from: "products",
          localField: "customerInfo.productId",
          foreignField: "_id",
          as: "productInfo",
        },
      },
      {
        $unwind: {
          path: "$productInfo",
          preserveNullAndEmptyArrays: true,
        },
      },
      {
        $group: {
          _id: "$_id",
          productName: { $first: "$productInfo.productName" }, 
          sendForSanction: { $first: "$sendToSanctionComplete" },
          // disbursementComplete: { $first: "$disbursementComplete" },
          sentForDisbursement: { $first: "$sendDisbursementComplete" },
          finalDisbursement: { $first: "$finalDisbursementComplete" },
          pending: { $first: "$pendingCases" },
          total: {
            $first: {
              $add: [
                "$sendToSanctionComplete",
                "$sendDisbursementComplete",
                "$finalDisbursementComplete",
                "$pendingCases",
              ],
            },
          },
        },
      },
      {
        $group: {
          _id: null,
          totalSendToSanctionComplete: { $sum: "$sendForSanction" },
          totalSendDisbursementComplete: { $sum: "$sentForDisbursement" },
          totalFinalDisbursementComplete: { $sum: "$finalDisbursement" },
          totalPendingCases: { $sum: "$pending" },
          totalCases: { $sum: "$total" },
          items: { $push: "$$ROOT" },
        },
      },
      {
        $project: {
          _id: 0,
          grandTotal: {
            sendForSanction: "$totalSendToSanctionComplete",
            sentForDisbursement: "$totalSendDisbursementComplete",
            finalDisbursement: "$totalFinalDisbursementComplete",
            pending: "$totalPendingCases",
            total: "$totalCases",
          },
          items: "$items",
        },
      },
    ]);

    return success(res, "Dashboard data retrieved successfully", results[0] || { grandTotal: {}, items: [] });
  } catch (error) {
    console.error("Error in getDashboardData:", error);
    return unknownError(res, error);
  }
}


async function disbursementEstampDelete(req, res) {
  try {
    const { customerId, estampId } = req.query;

    if (!mongoose.Types.ObjectId.isValid(customerId) || !mongoose.Types.ObjectId.isValid(estampId)) {
      return badRequest(res ,"Invalid customerId or estampId" );
    }

    const disbursementRecord = await disbursementModel.findOne({ customerId });
    if (!disbursementRecord) {
      return badRequest(res, "Customer not found");
    }

    const estampExists = disbursementRecord.estampRequirement.some(estamp => estamp._id.toString() === estampId);
    if (!estampExists) {
      return badRequest(res, "Estamp ID not found");
    }

    const updatedDisbursement = await disbursementModel.findOneAndUpdate(
      { customerId },
      { $pull: { estampRequirement: { _id: estampId } } },
      { new: true }
    );

    return success(res ,"Estamp Requirement deleted successfully",{ data: updatedDisbursement});
  } catch (error) {
    console.error("Error deleting estampRequirement:", error);
    return unknownError(res, error);
  }
}

const finalApprovalFilterApi = async(req,res) =>{
  try{
    const { pageLimit, pageNumber, search } = req.query;
    const { offset, limit } = paginationData(pageLimit, pageNumber);

    console.log("api test------", offset, limit);
    // Build search filter
    const searchFilter = {};
    if (search) {
      searchFilter.$or = [
        { "nearestBranchData.name": { $regex: search, $options: "i" } },
        { "branchDetail.name": { $regex: search, $options: "i" } },
        { "applicantDetail.fullName": { $regex: search, $options: "i" } }, // Applicant name (case-insensitive)
        { customerFinId: { $regex: search, $options: "i" } },
        {
          $expr: {
            $regexMatch: {
              input: { $toString: "$mobileNo" }, // Convert numeric field to string
              regex: search,
              options: "i",
            },
          },
        }, // Mobile number as string (case-insensitive)
      ];
    }
    console.time("API Execution Time");

    const results = await customerModel.aggregate([
      // Lookup pdData with filtered pipeline
      {
        $lookup: {
          from: "externalvendordynamics",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                statusByCreditPd: { $in: ["complete", "approve"] },
                fileStatus: { $in: ["active"] },
              },
            },
            {
              $project: {
                customerId: 1,
                statusByCreditPd: 1,
                fileStatus: 1,
              },
            },
          ],
          as: "externalVenderData",
        },
      },
      { $match: { externalVenderData: { $ne: [] } } },
      {
        $lookup: {
          from: "pdformdatas",
          let: { customerId: "$_id" },
          pipeline: [
            
            {
              $project: {
                status: 1,
                bdCompleteDate: 1,
                pdId: 1,
                hoStatus: 1,
                hoRemark: 1,
                defaultStatus: 1,
                fileProcessStatus: 1,
                branchStatus: 1,
              },
            },
          ],
          as: "pdData",
        },
      },
      // Match customers with pdData
      { $match: { pdData: { $ne: [] } } },
      {
        $lookup: {
          from: "employees",
          let: { pdId: { $arrayElemAt: ["$pdData.pdId", 0] } }, // Lookup using the first pdId
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$pdId"] } } },
            { $project: { employeName: 1 } },
          ],
          as: "pdCompleteDetails",
        },
      },
      // Lookup employeeDetail and branchDetail in one go
      {
        $lookup: {
          from: "employees",
          let: { employeeId: "$employeId" },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$employeeId"] } } },
            {
              $project: {
                employeName: 1,
                userName: 1,
                employeUniqueId: 1,
                reportingManagerId: 1,
                branchId: 1,
              },
            },
          ],
          as: "employeeDetail",
        },
      },
      // Lookup salesManagerDetails
      {
        $lookup: {
          from: "employees",
          let: {
            reportingManagerId: {
              $arrayElemAt: ["$employeeDetail.reportingManagerId", 0],
            },
          },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$reportingManagerId"] } } },
            { $project: { employeName: 1, employeUniqueId: 1, userName: 1 } },
          ],
          as: "salesManagerDetails",
        },
      },
      // Lookup branchDetail
      {
        $lookup: {
          from: "newbranches",
          let: { branchId: { $arrayElemAt: ["$employeeDetail.branchId", 0] } },
          pipeline: [
            { $match: { $expr: { $eq: ["$_id", "$$branchId"] } } },
            { $project: { name: 1 } },
          ],
          as: "branchDetail",
        },
      },
      // Lookup applicantDetail
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            {
              $project: {
                fullName: 1,
                fatherName: 1,
                mobileNo: 1,
                applicantPhoto: 1,
                applicantAddress: "$permanentAddress.addressLine1",
              },
            },
          ],
          as: "applicantDetail",
        },
      },
      // Lookup cibildetailDetail
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [{ $project: { applicantCibilScore: 1 } }],
          as: "cibildetailDetail",
        },
      },
      // Lookup finalSanctionData with nested employee details
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            {
              $lookup: {
                from: "employees",
                localField: "employeeId",
                foreignField: "_id",
                as: "employeeDetail",
              },
            },
            {
              $addFields: {
                isEmployeeIdMissing: {
                  $not: { $ifNull: ["$employeeId", false] },
                },
                esignLinkStatus: {
                  $cond: [
                    {
                      $and: [
                        { $eq: [{ $type: "$esignLink" }, "array"] },
                        {
                          $gt: [{ $size: { $ifNull: ["$esignLink", []] } }, 0],
                        },
                      ],
                    },
                    "Yes",
                    "No",
                  ],
                },
              },
            },
          ],
          as: "finalSanctionData",
        },
      },
      {
        $lookup: {
          from: "bankstatementkycs",
          localField: "_id",
          foreignField: "customerId",
          pipeline: [
            { $match: { Nachlink: { $nin: ["", null] } } }, // Filter out empty/null Nachlink earlier
            { $project: { Nachlink: 1 } },
          ],
          as: "bankStatementKycDetail",
        },
      },

      // Add field to check if Nachlink exists
      {
        $addFields: {
          hasNachLink: {
            $cond: {
              if: { $gt: [{ $size: "$bankStatementKycDetail" }, 0] },
              then: true,
              else: false,
            },
          },
        },
      },
      {
        $lookup: {
          from: "externalvendordynamics",
          localField: "_id",
          foreignField: "customerId",
          as: "externalVendorDetail",
          pipeline: [
            {
              $project: {
                vendors: {
                  $map: {
                    input: "$vendors",
                    as: "vendor",
                    in: {
                      vendorType: "$$vendor.vendorType",
                      statusByVendor: "$$vendor.statusByVendor",
                    },
                  },
                },
              },
            },
          ],
        },
      },
      // Final Projection
      {
        $project: {
          _id: 1,
          employeId: 1,
          productId: 1,
          customerFinId: 1,
          mobileNo: 1,
          executiveName: 1,
          "externalVenderData.customerId": 1,
          "externalVenderData.statusByCreditPd": 1,
          "externalVenderData.fileStatus": 1,
          "pdData.fileProcessStatus": 1,
          "pdData.branchStatus": 1,
          "pdData.branchStatus": 1,
          "pdData.status": 1,
          "pdData.bdCompleteDate": 1,
          "pdData.hoStatus": 1,
          "pdData.hoRemark": 1,
          "pdData.defaultStatus": 1,
          "pdData.fileProcessStatus": 1,
          "pdCompleteDetails.employeName": 1,
          "employeeDetail.employeName": {
            $arrayElemAt: ["$employeeDetail.employeName", 0],
          },
          "employeeDetail.userName": {
            $arrayElemAt: ["$employeeDetail.userName", 0],
          },
          "employeeDetail.employeUniqueId": {
            $arrayElemAt: ["$employeeDetail.employeUniqueId", 0],
          },
          "salesManagerDetails.employeName": {
            $arrayElemAt: ["$salesManagerDetails.employeName", 0],
          },
          "salesManagerDetails.employeUniqueId": {
            $arrayElemAt: ["$salesManagerDetails.employeUniqueId", 0],
          },
          "salesManagerDetails.userName": {
            $arrayElemAt: ["$salesManagerDetails.userName", 0],
          },
          "branchDetail.name": { $arrayElemAt: ["$branchDetail.name", 0] },
          "applicantDetail.fullName": {
            $arrayElemAt: ["$applicantDetail.fullName", 0],
          },
          "applicantDetail.fatherName": {
            $arrayElemAt: ["$applicantDetail.fatherName", 0],
          },
          "applicantDetail.mobileNo": {
            $arrayElemAt: ["$applicantDetail.mobileNo", 0],
          },
          "applicantDetail.applicantPhoto": {
            $arrayElemAt: ["$applicantDetail.applicantPhoto", 0],
          },
          "applicantDetail.applicantAddress": {
            $arrayElemAt: ["$applicantDetail.applicantAddress", 0],
          },
          "cibildetailDetail.applicantCibilScore": {
            $arrayElemAt: ["$cibildetailDetail.applicantCibilScore", 0],
          },
          finalSanctionData: {
            _id: { $arrayElemAt: ["$finalSanctionData._id", 0] },
            status: { $arrayElemAt: ["$finalSanctionData.status", 0] },
            employeeId: { $arrayElemAt: ["$finalSanctionData.employeeId", 0] },
            employeeDetail: {
              employeName: {
                $arrayElemAt: [
                  {
                    $arrayElemAt: [
                      "$finalSanctionData.employeeDetail.employeName",
                      0,
                    ],
                  },
                  0,
                ],
              },
            },
            finalLoanAmount: {
              $arrayElemAt: ["$finalSanctionData.finalLoanAmount", 0],
            },
            roi: { $arrayElemAt: ["$finalSanctionData.roi", 0] },
            tenureInMonth: {
              $arrayElemAt: ["$finalSanctionData.tenureInMonth", 0],
            },
            selfAssignStatus: {
              $cond: {
                if: {
                  $gt: [
                    { $arrayElemAt: ["$finalSanctionData.employeeId", 0] },
                    null,
                  ],
                },
                then: true,
                else: false,
              },
            },
            esignLinkStatus: {
              $cond: {
                if: {
                  $and: [
                    {
                      $eq: [
                        {
                          $type: {
                            $arrayElemAt: ["$finalSanctionData.esignLink", 0],
                          },
                        },
                        "array",
                      ],
                    },
                    {
                      $gt: [
                        {
                          $size: {
                            $ifNull: [
                              {
                                $arrayElemAt: [
                                  "$finalSanctionData.esignLink",
                                  0,
                                ],
                              },
                              [],
                            ],
                          },
                        },
                        0,
                      ],
                    },
                  ],
                },
                then: "Yes",
                else: "No",
              },
            },
          },
          hasNachLink: 1,
          externalVendorDetail: {
            $arrayElemAt: ["$externalVendorDetail.vendors", 0],
          },
        },
      },
      { $match: searchFilter },
      {
        $skip: offset,
      },
      {
        $limit: limit,
      },
    ]);
    // const finalData = await creditPdModel.findOne({customerId: "676f8a4f4e55f86160f1804d"})
    // console.log(finalData,"finalData")
    // Fetch total count without pagination for accurate results
    const totalCount = await customerModel.aggregate([
      // Lookup pdData with filtered pipeline
      {
        $lookup: {
          from: "externalvendordynamics",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: { $eq: ["$customerId", "$$customerId"] },
                statusByCreditPd: { $in: ["complete", "approve"] },
                fileStatus: { $in: ["active"] },
              },
            },
            {
              $project: {
                customerId: 1,
                statusByCreditPd: 1,
                fileStatus: 1,
              },
            },
          ],
          as: "externalVenderData",
        },
      },
      { $match: { externalVenderData: { $ne: [] } } },
      {
        $lookup: {
          from: "pdformdatas",
          let: { customerId: "$_id" },
          pipeline: [
            {
              $match: {
                $expr: {
                  $and: [
                    { $eq: ["$customerId", "$$customerId"] },
                    // { $in: ["$status", ["complete", "approve"]] },
                  ],
                },
              },
            },
            {
              $project: {
                status: 1,
                bdCompleteDate: 1,
                pdId: 1,
                hoStatus: 1,
                hoRemark: 1,
                defaultStatus: 1,
                fileProcessStatus: 1,
                branchStatus: 1,
              },
            },
          ],
          as: "pdData",
        },
      },
      { $match: { pdData: { $ne: [] } } },
      { $match: searchFilter },
    ]);

    // Respond with success
    res.status(200).json({
      success: true,
      totalCount: totalCount.length,
      userDataLength: results.length,
      userData: results,
    });
 
    return success(res ,"Estamp Requirement deleted successfully");
  } catch (error) {
    console.error("Error deleting estampRequirement:", error);
    return unknownError(res, error);
  }
}

//roshni code 
const testDigioApi1 = async (req, res) => {
  try {
    // Fetch PDF from URL
    const pdfUrl = 'https://cdn.fincooper.in/PROD/LOS/PDF/IncomeSanctionLetter1739773256381.pdf';
    
    console.log('Attempting to fetch PDF from:', pdfUrl);
    
    let pdfResponse;
    try {
      pdfResponse = await axios({
        method: 'get',
        url: pdfUrl,
        responseType: 'arraybuffer',
        timeout: 30000, // 30 second timeout
        maxContentLength: 10 * 1024 * 1024, // 10MB max size
        headers: {
          'Accept': 'application/pdf'
        }
      });
      console.log('PDF fetched successfully, size:', pdfResponse.data.length);
    } catch (pdfError) {
      console.error('Error fetching PDF:', pdfError.message);
      return unknownError(res, { message: 'Failed to fetch PDF file' });
    }

  // Convert PDF to base64 and verify the conversion
  const base64Data = Buffer.from(pdfResponse.data, 'binary').toString('base64');
  console.log('Base64 conversion completed, length:', base64Data.length);

    // Prepare the request body
    const requestBody = {
      signers: [{
        identifier: "roshniraikwar@fincoopers.in",
        name: "Roshni Raikwar",
        sign_type: "aadhaar",
        reason: "Testing signature"
      }],
      expire_in_days: 10,
      display_on_page: "custom",
      notify_signers: true,
      send_sign_link: true,
      generate_access_token: true,
      file_name: "IncomeSanctionLetter.pdf",
      file_data: base64Data,  // Using the actual PDF data
      sign_coordinates: {
        "6261439001": {
          "1": [{
            llx: 376.55510204081634,
            lly: 67.89677419354838,
            urx: 535.8943577430973,
            ury: 129.36122241086588
          }]
        }
      },
      estamp_request: {
        tags: {
          estamp_tag_name: "quantity"
        },
        sign_on_page: "ALL",
        note_content: "This is dummy content",
        note_on_page: "ALL"
      }
    };

    // Make the API call to Digio
    const digioResponse = await axios({
      method: 'post',
      url: 'https://api.digio.in/v2/client/document/uploadpdf',
      headers: {
        'accept': 'application/json',
        'content-type': 'application/json',
        'x-session': 'SIDWMHPBWRWXWTIVVBOZOCJKYRXXQDUS'
      },
      data: requestBody
    });

    // Return the success response
    return success(res, "Document uploaded successfully", digioResponse.data);

  } catch (error) {
    // Enhanced error logging
    if (error.response) {
      // The request was made and the server responded with a status code
      console.error("Error response:", {
        status: error.response.status,
        data: error.response.data
      });
    } else if (error.request) {
      // The request was made but no response was received
      console.error("No response received:", error.request);
    } else {
      // Something happened in setting up the request
      console.error("Error setting up request:", error.message);
    }
    return unknownError(res, error);
  }
};

//my updated code
async function testDigioApi3(pdfUrl, aadhaarNumber) {
  try {
      const response = await axios.post(
          "https://ext.digio.in/api/v1/esign/initiate",
          {
              document_url: 'https://cdn.fincooper.in/PROD/LOS/PDF/IncomeSanctionLetter1739773256381.pdf', // Direct PDF URL
              signer_aadhaar: ``, // Aadhaar Number of Signer
              // redirect_url: "https://yourwebsite.com/esign-callback", // Redirect after Signing
              redirect_url: "google.com", // Redirect after Signing

              reason: "Loan Approval Document", // Signing Reason
              notify_signer: true, // Send OTP to Signer
          },
          
          {
              headers: {
                  "Authorization": `Basic ${Buffer.from(`${process.env.DIGIO_CLIENT_ID}:${process.env.DIGIO_CLIENT_SECRET}`).toString("base64")}`,
                  "Content-Type": "application/json",
              },
          }
      );

      return response.data;
  } catch (error) {
      console.error("eSign Initiation Failed:", error.response?.data || error.message);
  }
}


const DIGIO_CLIENT_ID = "ACK2501221719453279F1NVXROSOOFW5";
const DIGIO_CLIENT_SECRET = "ZV1PJIVZ9LXQYZI8UQ4Y9QG6HB4TB7DJ";
// const DIGIO_ESIGN_URL = "https://api.digio.in/v2/client/document/uploadpdf";
const DIGIO_ESIGN_URL = "https://ext.digio.in/v3/client/esign/link";

const PDF_URL = "https://cdn.fincooper.in/PROD/LOS/PDF/IncomeSanctionLetter1739773256381.pdf";


// async function testDigioApi(){
//   try {
//     console.log("📢 Starting eSign process...");

//     // Step 1: Request Payload
//     const requestData = {
//         client_id: DIGIO_CLIENT_ID,
//         document: {
//             document_url: PDF_URL,
//             document_type: "PDF",
//             esign: {
//                 provider: "digio", // Aadhaar-based eSign
//                 signer: {
//                     identifier_type: "aadhaar",
//                     identifier: "123412341234", // Aadhaar number (Replace dynamically)
//                     reason: "Loan Agreement Signature",
//                     location: "Mumbai, India",
//                 },
//                 signature_position: {
//                     page_number: 2, // जिस पेज पर साइन करना है
//                     x: 200, // X-coordinates (Pixels)
//                     y: 500, // Y-coordinates (Pixels)
//                 },
//             },
//         },
//         signer: {
//             name: "Rahul Sharma",
//             email: "rahul@example.com",
//             mobile: "9876543210",
//         },
//     };

//     console.log("📨 Sending request to Digio API...", JSON.stringify(requestData, null, 2));

//     // Step 2: API Call
//     const response = await axios.post(DIGIO_ESIGN_URL, requestData, {
//         auth: {
//             username: DIGIO_CLIENT_ID,
//             password: DIGIO_CLIENT_SECRET,
//         },
//         headers: {
//             "Content-Type": "application/json",
//         },
//     });

//     console.log("✅ eSign Link Generated Successfully:", response.data);

//     return response.data; // Response contains the eSign link
// }  catch (error) {
//         console.error("Error generating eSign link:", error.response?.data || error.message);
//     }
// }

const testDigioApii = async (req, res) => {
  try {
    const pdfUrl = 'https://cdn.fincooper.in/PROD/LOS/PDF/IncomeSanctionLetter1739773256381.pdf';
    console.log('Attempting to fetch PDF from:', pdfUrl);

    let pdfResponse;
    try {
      pdfResponse = await axios({
        method: 'get',
        url: pdfUrl,
        responseType: 'arraybuffer',
        timeout: 30000,
        maxContentLength: 10 * 1024 * 1024, // 10MB max size
        headers: {
          'Accept': 'application/pdf'
        }
      });
      console.log('PDF fetched successfully, size:', pdfResponse.data);
    } catch (pdfError) {
      console.error('Error fetching PDF:', pdfError.message);
      return unknownError(res, { message: 'Failed to fetch PDF file' });
    }

    // Convert PDF to base64
    const base64Data = Buffer.from(pdfResponse.data, 'binary').toString('base64');
    console.log('Base64 conversion completed, length:', base64Data.length);

    // Digio API credentials from environment variables
    const digioClientId = process.env.DIGIO_CLIENT_ID;
    const digioClientSecret = process.env.DIGIO_CLIENT_SECRET;

    if (!digioClientId || !digioClientSecret) {
      console.error("Digio credentials are missing in environment variables.");
      return unknownError(res, { message: "Server misconfiguration: Missing Digio credentials" });
    }

    // Generate Basic Auth Token
    const authToken = Buffer.from(`${digioClientId}:${digioClientSecret}`).toString('base64');

    // Prepare the request body
    const requestBody = {
      signers: [{
        identifier: "akashsharma199425@gmail.com",
        name: "akash sharma",
        sign_type: "aadhaar",
        reason: "Testing signature"
      }],
      expire_in_days: 10,
      display_on_page: "custom",
      notify_signers: true,
      send_sign_link: true,
      generate_access_token: true,
      file_name: "IncomeSanctionLetter.pdf",
      file_data: base64Data, // Using the actual PDF data
      sign_coordinates: {
        "6261439001": {
          "1": [{
            llx: 376.55510204081634,
            lly: 67.89677419354838,
            urx: 535.8943577430973,
            ury: 129.36122241086588
          }]
        }
      },
      // estamp_request: {
      //   // tags: {
      //   //   estamp_tag_name: 1
      //   // },
      //   sign_on_page: "ALL",
      //   note_content: "This is dummy content",
      //   note_on_page: "ALL"
      // }
    };

    // Make the API call to Digio
    const digioResponse = await axios({
      method: 'post',
      url: 'https://api.digio.in/v2/client/document/uploadpdf',
      headers: {
        'accept': 'application/json',
        'content-type': 'application/json',
        'Authorization': `Basic ${authToken}`
      },
      data: requestBody
    });

    // Return the success response
    return success(res, "Document uploaded successfully", digioResponse.data);

  } catch (error) {
    // Enhanced error logging
    if (error.response) {
      console.error("Error response:", {
        status: error.response.status,
        data: error.response.data
      });
    } else if (error.request) {
      console.error("No response received:", error.request);
    } else {
      console.error("Error setting up request:", error.message);
    }
    return unknownError(res, error);
  }
};



// Upload signature on e-sign // 


// const testDigioApi = async (req, res) => { 
//   try {

//           // Digio API credentials from environment variables
//           const digioClientId = process.env.DIGIO_CLIENT_ID;
//           const digioClientSecret = process.env.DIGIO_CLIENT_SECRET;
//     // Extract P
//     // 
//     // DF data from request body if available
//     // const pdfData = "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"

//     // // Digio API credentials from environment variables
//     // const digioClientId = process.env.DIGIO_CLIENT_ID;
//     // const digioClientSecret = process.env.DIGIO_CLIENT_SECRET;

//     const pdfData = "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"
//     if (!digioClientId || !digioClientSecret) {
//       console.error("Digio credentials are missing in environment variables.");
//       return res.status(500).json({ message: "Server misconfiguration: Missing Digio credentials" });
//     }

//     // Generate Basic Auth Token
//     const authToken = Buffer.from(`${digioClientId}:${digioClientSecret}`).toString('base64');

//     console.log('Auth token:', authToken);

//     // Prepare the request body
//     const requestBody = {
  
//       "signers": [{
//         "identifier": "9482202991",
//         "name": "Mohini Khokane",
//         "sign_type": "aadhaar",
//         "reason": "eMandate"
//       }],
//       "expire_in_days": 10,
//       "display_on_page": "custom",
//       "notify_signers": true,
//       "send_sign_link": true,
//       "file_name": "Test.pdf",
//       "file_data": "<JVBERi0xLjMNCiXi48/TDQoNCjEgMCBvYmoNCjw8DQovVHlwZSAvQ2F0YWxvZw0KL091dGxpbmVzIDIgMCBSDQovUGFnZXMgMyAwIFINCj4+DQplbmRvYmoNCg0KMiAwIG9iag0KPDwNCi9UeXBlIC9PdXRsaW5lcw0KL0NvdW50IDANCj4+DQplbmRvYmoNCg0KMyAwIG9iag0KPDwNCi9UeXBlIC9QYWdlcw0KL0NvdW50IDINCi9LaWRzIFsgNCAwIFIgNiAwIFIgXSANCj4+DQplbmRvYmoNCg0KNCAwIG9iag0KPDwNCi9UeXBlIC9QYWdlDQovUGFyZW50IDMgMCBSDQovUmVzb3VyY2VzIDw8DQovRm9udCA8PA0KL0YxIDkgMCBSIA0KPj4NCi9Qcm9jU2V0IDggMCBSDQo+Pg0KL01lZGlhQm94IFswIDAgNjEyLjAwMDAgNzkyLjAwMDBdDQovQ29udGVudHMgNSAwIFINCj4+DQplbmRvYmoNCg0KNSAwIG9iag0KPDwgL0xlbmd0aCAxMDc0ID4+DQpzdHJlYW0NCjIgSg0KQlQNCjAgMCAwIHJnDQovRjEgMDAyNyBUZg0KNTcuMzc1MCA3MjIuMjgwMCBUZA0KKCBBIFNpbXBsZSBQREYgRmlsZSApIFRqDQpFVA0KQlQNCi9GMSAwMDEwIFRmDQo2OS4yNTAwIDY4OC42MDgwIFRkDQooIFRoaXMgaXMgYSBzbWFsbCBkZW1vbnN0cmF0aW9uIC5wZGYgZmlsZSAtICkgVGoNCkVUDQpCVA0KL0YxIDAwMTAgVGYNCjY5LjI1MDAgNjY0LjcwNDAgVGQNCigganVzdCBmb3IgdXNlIGluIHRoZSBWaXJ0dWFsIE1lY2hhbmljcyB0dXRvcmlhbHMuIE1vcmUgdGV4dC4gQW5kIG1vcmUgKSBUag0KRVQNCkJUDQovRjEgMDAxMCBUZg0KNjkuMjUwMCA2NTIuNzUyMCBUZA0KKCB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiApIFRqDQpFVA0KQlQNCi9GMSAwMDEwIFRmDQo2OS4yNTAwIDYyOC44NDgwIFRkDQooIEFuZCBtb3JlIHRleHQuIEFuZCBtb3JlIHRleHQuIEFuZCBtb3JlIHRleHQuIEFuZCBtb3JlIHRleHQuIEFuZCBtb3JlICkgVGoNCkVUDQpCVA0KL0YxIDAwMTAgVGYNCjY5LjI1MDAgNjE2Ljg5NjAgVGQNCiggdGV4dC4gQW5kIG1vcmUgdGV4dC4gQm9yaW5nLCB6enp6ei4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gQW5kICkgVGoNCkVUDQpCVA0KL0YxIDAwMTAgVGYNCjY5LjI1MDAgNjA0Ljk0NDAgVGQNCiggbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiApIFRqDQpFVA0KQlQNCi9GMSAwMDEwIFRmDQo2OS4yNTAwIDU5Mi45OTIwIFRkDQooIEFuZCBtb3JlIHRleHQuIEFuZCBtb3JlIHRleHQuICkgVGoNCkVUDQpCVA0KL0YxIDAwMTAgVGYNCjY5LjI1MDAgNTY5LjA4ODAgVGQNCiggQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgKSBUag0KRVQNCkJUDQovRjEgMDAxMCBUZg0KNjkuMjUwMCA1NTcuMTM2MCBUZA0KKCB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBFdmVuIG1vcmUuIENvbnRpbnVlZCBvbiBwYWdlIDIgLi4uKSBUag0KRVQNCmVuZHN0cmVhbQ0KZW5kb2JqDQoNCjYgMCBvYmoNCjw8DQovVHlwZSAvUGFnZQ0KL1BhcmVudCAzIDAgUg0KL1Jlc291cmNlcyA8PA0KL0ZvbnQgPDwNCi9GMSA5IDAgUiANCj4+DQovUHJvY1NldCA4IDAgUg0KPj4NCi9NZWRpYUJveCBbMCAwIDYxMi4wMDAwIDc5Mi4wMDAwXQ0KL0NvbnRlbnRzIDcgMCBSDQo+Pg0KZW5kb2JqDQoNCjcgMCBvYmoNCjw8IC9MZW5ndGggNjc2ID4+DQpzdHJlYW0NCjIgSg0KQlQNCjAgMCAwIHJnDQovRjEgMDAyNyBUZg0KNTcuMzc1MCA3MjIuMjgwMCBUZA0KKCBTaW1wbGUgUERGIEZpbGUgMiApIFRqDQpFVA0KQlQNCi9GMSAwMDEwIFRmDQo2OS4yNTAwIDY4OC42MDgwIFRkDQooIC4uLmNvbnRpbnVlZCBmcm9tIHBhZ2UgMS4gWWV0IG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gKSBUag0KRVQNCkJUDQovRjEgMDAxMCBUZg0KNjkuMjUwMCA2NzYuNjU2MCBUZA0KKCBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSB0ZXh0LiBBbmQgbW9yZSApIFRqDQpFVA0KQlQNCi9GMSAwMDEwIFRmDQo2OS4yNTAwIDY2NC43MDQwIFRkDQooIHRleHQuIE9oLCBob3cgYm9yaW5nIHR5cGluZyB0aGlzIHN0dWZmLiBCdXQgbm90IGFzIGJvcmluZyBhcyB3YXRjaGluZyApIFRqDQpFVA0KQlQNCi9GMSAwMDEwIFRmDQo2OS4yNTAwIDY1Mi43NTIwIFRkDQooIHBhaW50IGRyeS4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gQW5kIG1vcmUgdGV4dC4gKSBUag0KRVQNCkJUDQovRjEgMDAxMCBUZg0KNjkuMjUwMCA2NDAuODAwMCBUZA0KKCBCb3JpbmcuICBNb3JlLCBhIGxpdHRsZSBtb3JlIHRleHQuIFRoZSBlbmQsIGFuZCBqdXN0IGFzIHdlbGwuICkgVGoNCkVUDQplbmRzdHJlYW0NCmVuZG9iag0KDQo4IDAgb2JqDQpbL1BERiAvVGV4dF0NCmVuZG9iag0KDQo5IDAgb2JqDQo8PA0KL1R5cGUgL0ZvbnQNCi9TdWJ0eXBlIC9UeXBlMQ0KL05hbWUgL0YxDQovQmFzZUZvbnQgL0hlbHZldGljYQ0KL0VuY29kaW5nIC9XaW5BbnNpRW5jb2RpbmcNCj4+DQplbmRvYmoNCg0KMTAgMCBvYmoNCjw8DQovQ3JlYXRvciAoUmF2ZSBcKGh0dHA6Ly93d3cubmV2cm9uYS5jb20vcmF2ZVwpKQ0KL1Byb2R1Y2VyIChOZXZyb25hIERlc2lnbnMpDQovQ3JlYXRpb25EYXRlIChEOjIwMDYwMzAxMDcyODI2KQ0KPj4NCmVuZG9iag0KDQp4cmVmDQowIDExDQowMDAwMDAwMDAwIDY1NTM1IGYNCjAwMDAwMDAwMTkgMDAwMDAgbg0KMDAwMDAwMDA5MyAwMDAwMCBuDQowMDAwMDAwMTQ3IDAwMDAwIG4NCjAwMDAwMDAyMjIgMDAwMDAgbg0KMDAwMDAwMDM5MCAwMDAwMCBuDQowMDAwMDAxNTIyIDAwMDAwIG4NCjAwMDAwMDE2OTAgMDAwMDAgbg0KMDAwMDAwMjQyMyAwMDAwMCBuDQowMDAwMDAyNDU2IDAwMDAwIG4NCjAwMDAwMDI1NzQgMDAwMDAgbg0KDQp0cmFpbGVyDQo8PA0KL1NpemUgMTENCi9Sb290IDEgMCBSDQovSW5mbyAxMCAwIFINCj4+DQoNCnN0YXJ0eHJlZg0KMjcxNA0KJSVFT0YNCg==>",
   
//       "sign_coordinates": {
//         "9482202991": {
//           "1": [{
//             "llx": 380.5,
//             "lly": 696.41,
//             "urx": 540.81,
//             "ury": 737.01
//           }],
//           "2": [{
//             "llx": 148.14,
//             "lly": 784.73,
//             "urx": 308.46,
//             "ury": 825.33
//           }]
//         }
//       }
//   };

//     const pdfUrl = 'https://api.digio.in/v2/client/document/uploadpdf';
//     console.log('Attempting to send PDF to:', pdfUrl);

//     // Make an API request using axios
//     const response = await axios.post(pdfUrl, requestBody, {
//       headers: {
//         'accept': 'application/json',
//         'content-type': 'application/json',
//         'Authorization': `Basic ${authToken}`
//       }
//     });

//     console.log("API Response:", response);
//     return res.status(200).json(response.data);

//   } catch (error) {
//     console.error('Error in Signature:', error.response?.data || error.message);
//     return res.status(500).json({ message: "Internal Server Error", error: error.message });
//   }
// };

const pdfUrl = `https://cdn.fincooper.in/PROD/LOS/PDF/IncomeSanctionLetter1739773256381.pdf`;
const digioClientId = process.env.DIGIO_CLIENT_ID;
const digioClientSecret = process.env.DIGIO_CLIENT_SECRET;
const https = require("https");


async function fetchPdfAsBase64(url) {
  return new Promise((resolve, reject) => {
      https.get(url, (response) => {
          let data = [];
          response.on("data", (chunk) => data.push(chunk));
          response.on("end", () => {
              const buffer = Buffer.concat(data);
              resolve(buffer.toString("base64")); // Convert to Base64
          });
      }).on("error", (err) => reject(err));
  });
}

// Function to get Digio access token
async function getDigioAccessToken() {
  try {
      
      return Buffer.from(`${digioClientId}:${digioClientSecret}`).toString('base64'); // Token return kar raha hai
      console.log( Buffer.from(`${digioClientId}:${digioClientSecret}`).toString('base64'),"token")
  } catch (error) {
      console.error("Error getting Digio access token:", error.response?.data || error.message);
      throw new Error("Failed to fetch Digio access token");
  }
}


// const testDigioApi_done = async (req, res) => { 
//   try {
//     const { customerId } = req.query;
    
//     const finalData = await finalModel.findOne({ customerId });

//     const ratnaapdf = finalData?.ratnaPdfUrls;
//     console.log("ratnaapdf", ratnaapdf);

//     pdfSelections =finalData?.pdfSelection;
//     console.log("pdfSelection", pdfSelection);

//     if (!ratnaapdf) {
//       return res.status(400).json({ success: false, error: "No PDF URLs found" });
//     }

//     // Step 1: token generate karenge
//     const accessToken = await getDigioAccessToken();
//     console.log(accessToken, "accessToken");

//     // Step 2: Convert PDFs to Base64**
//     const pdfData = {
//       sectionLatter: ratnaapdf.sectionLatter,
//       applicantionLatter: ratnaapdf.applicantionLatter,
//       LdAndPdDeed: ratnaapdf.LdAndPdDeed
//     };

//     // har ek page par kaha-2 sign karvana he vo batayenge
//     const signPages = {
//       sectionLatter: [1, 5, 6, 7, 8],
//       applicantionLatter: [2, 4, 7, 5, 9, 11],
//       LdAndPdDeed: [15, 17, 19]
//     };

//     let uploadedDocs = {};

//     for (const [pdfName, pdfUrl] of Object.entries(pdfData)) {
//       const base64PDF = await fetchPdfAsBase64(pdfUrl);

//       // **Dynamically Generate Sign Coordinates for Each Page**
//       let signCoordinates = {};
//       const pages = signPages[pdfName];

//       if (!pages) continue;

//       pages.forEach(page => {
//         signCoordinates["sagarsamediya@fincoopers.in"] = signCoordinates["sagarsamediya@fincoopers.in"] || {};
//         signCoordinates["sagarsamediya@fincoopers.in"][page] = [
//           {
//             "llx": 376.55,
//             "lly": 67.89,
//             "urx": 535.89,
//             "ury": 129.36
//           }
//         ];

//         // signCoordinates["akashsharma199425@gmail.com"] = signCoordinates["akashsharma199425@gmail.com"] || {};
//         // signCoordinates["akashsharma199425@gmail.com"][page] = [
//         //   {
//         //     "llx": 376.55,
//         //     "lly": 67.89,
//         //     "urx": 535.89,
//         //     "ury": 129.36
//         //   }
//         // ];
//       });

//       const payload = {
//         signers: [
//           {
//             identifier: "sagarsamediya@fincoopers.in",
//             name: "John Doe",
//             sign_type: "aadhaar",
//             reason: "Approving the document",
//           }
//           // ,
//           // {
//           //   identifier: "akashsharma199425@gmail.com",
//           //   name: "akash",
//           //   sign_type: "aadhaar",
//           //   reason: "Approving the document",
//           // }
//         ],
//         expire_in_days: 10,
//         display_on_page: "custom",
//         notify_signers: true,
//         send_sign_link: true,
//         generate_access_token: true,
//         file_name: `${pdfName}.pdf`,
//         file_data: base64PDF,
//         sign_coordinates: signCoordinates,
//         estamp_request: null
//       };

//       console.log(payload, `payload for ${pdfName}`);

//       const response = await axios.post("https://api.digio.in/v2/client/document/uploadpdf", payload, {
//         headers: {
//           'accept': 'application/json',
//           'content-type': 'application/json',
//           'Authorization': `Basic ${accessToken}`
//         }
//       });

//       const docId = response.data.id;
//       console.log(`docId for ${pdfName}`, docId);
//       uploadedDocs[pdfName] = docId;  
//     }

//     await finalModel.findOneAndUpdate(
//       { customerId }, 
//       { ratnaDocument_ids: uploadedDocs }, 
//       { new: true, upsert: true }
//     );

//     res.json({ success: true, data: uploadedDocs });

//   } catch (error) {
//     console.error("Error uploading PDFs:", error.response?.data || error.message);
//     res.status(500).json({ success: false, error: error.message });
//   }
// };

const testDigioApi_done1 = async (req, res) => {
  try {
    const { customerId } = req.query;
    const applicantData = await applicantModel.findOne({customerId})
    const coAppData = await coApplicantModel.find({customerId})
    const guarantorData = await guarantorModel.findOne({ customerId })
    const finalData = await finalModel.findOne({ customerId });

    const ratnaapdf = finalData?.ratnaPdfUrls;
    console.log("ratnaapdf", ratnaapdf);

    const pdfSelections = finalData?.pdfSelection;
    console.log("pdfSelection", pdfSelections);

    if (!ratnaapdf) {
      return res.status(400).json({ success: false, error: "No PDF URLs found" });
    }

    // Step 1: Token generate karenge
    const accessToken = await getDigioAccessToken();
    console.log(accessToken, "accessToken");

    // Step 2: Convert PDFs to Base64
    const pdfData = {
      sectionLatter: ratnaapdf.sectionLatter,
      applicantionLatter: ratnaapdf.applicantionLatter,
      LdAndPdDeed: ratnaapdf.LdAndPdDeed
    };

    // Sign Pages ko `pdfSelections` ke basis par set karenge
    // const signPages = {
    //         sectionLatter: [1, 5, 6, 7, 8],
    //         applicantionLatter: [2, 4, 7, 5, 9, 11],
    //         LdAndPdDeed: [15, 17, 19]
    //       };

    let signPages = {};

    switch (pdfSelections) {
      case "accg":
        signPages = {
          sectionLatter: [1, 5, 6, 7, 8],
          applicantionLatter: [2, 4, 7, 9, 10, 11],
          LdAndPdDeed: [11, 14, 17]
        };
        break;
      case "acg":
        signPages = {
          sectionLatter: [1, 3, 5, 6, 9],
          applicantionLatter: [2, 5, 6, 10, 11],
          LdAndPdDeed: [10, 11, 12]
        };
        break;
      case "acc":
        signPages = {
          sectionLatter: [2, 6, 7, 8, 10],
          applicantionLatter: [1, 3, 7, 9, 11],
          LdAndPdDeed: [15, 16, 17]
        };
        break;
      case "ac":
        signPages = {
          sectionLatter: [3, 5, 7, 9, 11],
          applicantionLatter: [4, 8, 12, 16, 10],
          LdAndPdDeed: [10, 15, 17]
        };
        break;
      default:
        signPages = {
          sectionLatter: [],
          applicantionLatter: [],
          LdAndPdDeed: []
        };
        break;
    }

    let uploadedDocs = {};

    for (const [pdfName, pdfUrl] of Object.entries(pdfData)) {
      const base64PDF = await fetchPdfAsBase64(pdfUrl);
      let signCoordinates = {};
      const pages = signPages[pdfName];

      if (!pages) continue;

      pages.forEach(page => {

        //applicant
        signCoordinates[applicantData?.email] = signCoordinates[applicantData?.email] || {};
        signCoordinates[applicantData?.email][page] = [
          {
            "llx": 376.55,
            "lly": 67.89,
            "urx": 535.89,
            "ury": 129.36,
            
          }
        ];

        //coApplicant 1
        signCoordinates[coAppData?.[0].email] = signCoordinates[coAppData?.[0].email] || {};
        signCoordinates[coAppData?.[0].email][page] = [
          {
            "llx": 376.55,
            "lly": 67.89,
            "urx": 535.89,
            "ury": 129.36,
            
          }
        ];

        //coApplicant 2

        signCoordinates[coAppData?.[1].email] = signCoordinates[coAppData?.[1].email] || {};
        signCoordinates[coAppData?.[1].email][page] = [
          {
            "llx": 376.55,
            "lly": 67.89,
            "urx": 535.89,
            "ury": 129.36,
            
          }
        ];

        //gaurantor

        signCoordinates[guarantorData?.email] = signCoordinates[guarantorData?.email] || {};
        signCoordinates[guarantorData?.email][page] = [
          {
            "llx": 376.55,
            "lly": 67.89,
            "urx": 535.89,
            "ury": 129.36,
            
          }
        ];

      });

      const payload = {
        signers: [
          {
            identifier: applicantData?.email,
            name: applicantData?.fullName,
            sign_type: "aadhaar",
            reason: "Approving the document",
          },
          {
            identifier: coAppData?.[0].email,
            name: coAppData?.[0].fullName,
            sign_type: "aadhaar",
            reason: "Approving the document",
          },
          {
            identifier: coAppData?.[1].email,
            name: coAppData?.[1].fullName,
            sign_type: "aadhaar",
            reason: "Approving the document",
          },
          {
            identifier: guarantorData?.email,
            name: guarantorData?.fullName,
            sign_type: "aadhaar",
            reason: "Approving the document",
          }
        ],
        expire_in_days: 10,
        display_on_page: "custom",
        notify_signers: true,
        send_sign_link: true,
        generate_access_token: true,
        file_name: `${pdfName}.pdf`,
        file_data: base64PDF,
        sign_coordinates: signCoordinates,
        estamp_request: null
      };

      console.log(payload, `payload for ${pdfName}`);

      // const response = await axios.post("https://api.digio.in/v2/client/document/uploadpdf", payload, {
      //   headers: {
      //     'accept': 'application/json',
      //     'content-type': 'application/json',
      //     'Authorization': `Basic ${accessToken}`
      //   }
      // });

      const response = await axios.post("https://api.digio.in/v2/client/document/uploadpdf", payload, {
                headers: {
                  'accept': 'application/json',
                  'content-type': 'application/json',
                  'Authorization': `Basic ${accessToken}`
                }
              });

      const docId = response.data.id;
      console.log(`docId for ${pdfName}`, docId);
      uploadedDocs[pdfName] = docId;  
    }

    await finalModel.findOneAndUpdate(
      { customerId }, 
      { ratnaDocument_ids: uploadedDocs }, 
      { new: true, upsert: true }
    );

    res.json({ success: true, data: uploadedDocs });

  } catch (error) {
    console.error("Error uploading PDFs:", error.response?.data || error.message);
    res.status(500).json({ success: false, error: error.message });
  }
};

const testDigioApi_done2 = async (req, res) => {
  try {
    const { customerId } = req.query;
    const applicantData = await applicantModel.findOne({ customerId });
    const coAppData = await coApplicantModel.find({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const finalData = await finalModel.findOne({ customerId });

    const ratnaapdf = finalData?.ratnaPdfUrls;
    console.log("ratnaapdf", ratnaapdf);

    const pdfSelections = finalData?.pdfSelection;
    console.log("pdfSelection", pdfSelections);

    const coappSelections = coAppData?.[1]?.email;
    console.log("coappSelections", coappSelections);

    if (!ratnaapdf) {
      return res.status(400).json({ success: false, error: "No PDF URLs found" });
    }

    const accessToken = await getDigioAccessToken();
    console.log(accessToken, "accessToken");

    const pdfData = {
      sectionLatter: ratnaapdf.sectionLatter,
      applicantionLatter: ratnaapdf.applicantionLatter,
      LdAndPdDeed: ratnaapdf.LdAndPdDeed
    };

    let signPages = {};

    switch (pdfSelections) {
      case "accg":
        signPages = {
          sectionLatter: [1, 5, 6, 7, 8],
          applicantionLatter: [2, 4, 7, 9, 10, 11],
          LdAndPdDeed: [11, 14, 17]
        };
        break;
      case "acg":
        signPages = {
          sectionLatter: [1, 3, 5, 6, 9],
          applicantionLatter: [2, 5, 6, 10, 11],
          LdAndPdDeed: [10, 11, 12]
        };
        break;
      case "acc":
        signPages = {
          sectionLatter: [2, 6, 7, 8, 10],
          applicantionLatter: [1, 3, 7, 9, 11],
          LdAndPdDeed: [15, 16, 17]
        };
        break;
      case "ac":
        signPages = {
          sectionLatter: [3, 5, 7, 9, 11],
          applicantionLatter: [4, 8, 12, 16, 10],
          LdAndPdDeed: [10, 15, 17]
        };
        break;
      default:
        signPages = {
          sectionLatter: [],
          applicantionLatter: [],
          LdAndPdDeed: []
        };
        break;
    }

    let uploadedDocs = {};

    for (const [pdfName, pdfUrl] of Object.entries(pdfData)) {
      const base64PDF = await fetchPdfAsBase64(pdfUrl);
      let signCoordinates = {};
      const pages = signPages[pdfName];

      if (!pages) continue;

      pages.forEach(page => {
        signCoordinates[applicantData?.email] = signCoordinates[applicantData?.email] || {};
        signCoordinates[applicantData?.email][page] = [{  llx: 50, lly: 60, urx: 150, ury: 120}];

        signCoordinates[coAppData?.[0]?.email] = signCoordinates[coAppData?.[0]?.email] || {};
        signCoordinates[coAppData?.[0]?.email][page] = [{ llx: 180, lly: 60, urx: 280, ury: 120 }];

        signCoordinates[coAppData?.[1]?.email] = signCoordinates[coAppData?.[1]?.email] || {};
        signCoordinates[coAppData?.[1]?.email][page] = [{ llx: 310, lly: 60, urx: 410, ury: 120}];

        signCoordinates[guarantorData?.email] = signCoordinates[guarantorData?.email] || {};
        signCoordinates[guarantorData?.email][page] = [{ llx: 440, lly: 60, urx: 540, ury: 120 }];
      });

      const payload = {
        signers: [
          { identifier: applicantData?.email, name: applicantData?.fullName, sign_type: "aadhaar", reason: "Approving the document" },
          { identifier: coAppData?.[0]?.email, name: coAppData?.[0]?.fullName, sign_type: "aadhaar", reason: "Approving the document" },
          { identifier: coAppData?.[1]?.email, name: coAppData?.[1]?.fullName, sign_type: "aadhaar", reason: "Approving the document" },
          { identifier: guarantorData?.email, name: guarantorData?.fullName, sign_type: "aadhaar", reason: "Approving the document" }
        ],
        expire_in_days: 10,
        display_on_page: "custom",
        notify_signers: true,
        send_sign_link: true,
        generate_access_token: true,
        file_name: `${pdfName}.pdf`,
        file_data: base64PDF,
        sign_coordinates: signCoordinates,
        estamp_request: null
      };

      console.log(payload, `payload for ${pdfName}`);

      const response = await axios.post("https://api.digio.in/v2/client/document/uploadpdf", payload, {
        headers: {
          'accept': 'application/json',
          'content-type': 'application/json',
          'Authorization': `Basic ${accessToken}`
        }
      });

      const docId = response.data.id;
      console.log(`docId for ${pdfName}`, docId);
      uploadedDocs[pdfName] = docId;
    }

    await finalModel.findOneAndUpdate(
      { customerId }, 
      { ratnaDocument_ids: uploadedDocs }, 
      { new: true, upsert: true }
    );

    res.json({ success: true, data: uploadedDocs });
  } catch (error) {
    console.error("Error uploading PDFs:", error.response?.data || error.message);
    res.status(500).json({ success: false, error: error.message });
  }
}

const testDigioApi_done = async (req, res) => {
  try {
    const { customerId } = req.query;
    const applicantData = await applicantModel.findOne({ customerId });
    const coAppData = await coApplicantModel.find({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const finalData = await finalModel.findOne({ customerId });

    const ratnaapdf = finalData?.ratnaPdfUrls;
    const pdfSelections = finalData?.pdfSelection;
    if (!ratnaapdf) {
      return res.status(400).json({ success: false, error: "No PDF URLs found" });
    }

    const accessToken = await getDigioAccessToken();

    const pdfData = {
      sectionLatter: ratnaapdf.sectionLatter,
      applicantionLatter: ratnaapdf.applicantionLatter,
      LdAndPdDeed: ratnaapdf.LdAndPdDeed
    };

    let signPages = {
      accg: {
        sectionLatter: [1, 5, 6, 7, 8],
        applicantionLatter: [2, 4, 7, 9, 10, 11],
        LdAndPdDeed: [11, 14, 17]
      },
      acg: {
        sectionLatter: [1, 3, 5, 6, 9],
        applicantionLatter: [2, 5, 6, 10, 11],
        LdAndPdDeed: [10, 11, 12]
      },
      acc: {
        sectionLatter: [2, 6, 7, 8, 10],
        applicantionLatter: [1, 3, 7, 9, 11],
        LdAndPdDeed: [15, 16, 17]
      },
      ac: {
        sectionLatter: [3, 5, 7, 9, 11],
        applicantionLatter: [4, 8, 12, 16, 10],
        LdAndPdDeed: [10, 15, 17]
      }
    };

    let uploadedDocs = {};
    for (const [pdfName, pdfUrl] of Object.entries(pdfData)) {
      const base64PDF = await fetchPdfAsBase64(pdfUrl);
      let signCoordinates = {};
      const pages = signPages[pdfSelections]?.[pdfName] || [];
      
      if (!pages.length) continue;
      
      pages.forEach(page => {
        if (pdfSelections.includes('a')) {
          signCoordinates[applicantData?.mobileNo] = { [page]: [{ llx: 50, lly: 60, urx: 150, ury: 120 }] };
        }
        // if (pdfSelections.includes('a')) {
        //   signCoordinates[applicantData?.email] = { [page]: [{ llx: 50, lly: 60, urx: 150, ury: 120 }] };
        // }
        if (pdfSelections.includes('c')) {
          signCoordinates[coAppData?.[0]?.mobileNo] = { [page]: [{ llx: 180, lly: 60, urx: 280, ury: 120 }] };
        }
        if (pdfSelections.includes('c') && coAppData?.[1]) {
          signCoordinates[coAppData?.[1]?.mobileNo] = { [page]: [{ llx: 310, lly: 60, urx: 410, ury: 120 }] };
        }
        if (pdfSelections.includes('g')) {
          signCoordinates[guarantorData?.mobileNo] = { [page]: [{ llx: 440, lly: 60, urx: 540, ury: 120 }] };
        }
      });

      let signers = [];
      if (pdfSelections.includes('a')) {
        signers.push({ identifier: applicantData?.mobileNo, name: applicantData?.fullName, sign_type: "aadhaar", reason: "Approving the document" });
      }
      if (pdfSelections.includes('c')) {
        signers.push({ identifier: coAppData?.[0]?.mobileNo, name: coAppData?.[0]?.fullName, sign_type: "aadhaar", reason: "Approving the document" });
      }
      if (pdfSelections.includes('c') && coAppData?.[1]) {
        signers.push({ identifier: coAppData?.[1]?.mobileNo, name: coAppData?.[1]?.fullName, sign_type: "aadhaar", reason: "Approving the document" });
      }
      if (pdfSelections.includes('g')) {
        signers.push({ identifier: guarantorData?.mobileNo, name: guarantorData?.fullName, sign_type: "aadhaar", reason: "Approving the document" });
      }

      const payload = {
        signers,
        expire_in_days: 10,
        display_on_page: "custom",
        notify_signers: true,
        send_sign_link: true,
        generate_access_token: true,
        file_name: `${pdfName}.pdf`,
        file_data: base64PDF,
        sign_coordinates: signCoordinates,
        estamp_request: null
      };

      console.log(payload, `payload for ${pdfName}`);

      const response = await axios.post("https://api.digio.in/v2/client/document/uploadpdf", payload, {
        headers: {
          'accept': 'application/json',
          'content-type': 'application/json',
          'Authorization': `Basic ${accessToken}`
        }});
      uploadedDocs[pdfName] = response.data.id;
    }

    await finalModel.findOneAndUpdate(
      { customerId },
      { ratnaDocument_ids: uploadedDocs },
      { new: true, upsert: true });

    res.json({ success: true, data: uploadedDocs });
  } catch (error) {
    console.error("Error uploading PDFs:", error.response?.data || error.message);
    res.status(500).json({ success: false, error: error.message });
  }
};

const documentId = "DID250224175111745PKBXNLAFFJK3US";  


const isBase64 = (str) => {
  try {
      return Buffer.from(str, "base64").toString("base64") === str;
  } catch (err) {
      return false;
  }
};

// async function testDigioApi(req,res) {
//   try {
//     const { customerId } = req.query;
//     const existingData = await final.findOne({ customerId });


//       // const documentId = req.params;
//       // const documentId = "DID250224175111745PKBXNLAFFJK3US";  
//       const documentId =existingData?.ratnaDocument_id ;  


//       const accessToken = await getDigioAccessToken();

//       const statusUrl = `https://api.digio.in/v2/client/document/${documentId}`;
//       const statusResponse = await axios.get(statusUrl, {
//         headers: {
//           Authorization: `Basic ${accessToken}`,
//                "Content-Type": "application/json"

//         },
//       });
  
//       const documentStatus = statusResponse.data.signing_parties?.[0]?.status;
//       console.log("Document Status:", documentStatus);
  
//       // Agar document signed nahi hai toh error return karo
//       if (documentStatus !== "signed") {
//         return badRequest(res, "PDF is not signed yet");
//       }
   

//       const apiUrl = `https://api.digio.in/v2/client/document/download?document_id=${documentId}`;

//       console.log("API URL:", apiUrl);
//       console.log("Authorization Token:", accessToken);

//       const response = await axios.get(apiUrl, {
//           headers: {
//               Authorization: `Basic ${accessToken}`,
//               // "Content-Type": "application/json"
//           },
//           responseType: "arraybuffer" 

//       });

//       // const pdfBase64 = response?.data;
//       // console.log(pdfBase64,"pdfBase64")
//       // if (!pdfBase64) {
//       //   throw new Error("No PDF data received in API response");
//       // }
      
  
//       const pdfBuffer = Buffer.from(response.data, "base64");

    
  
//       console.log('XML Response:', pdfBuffer);
//       // const buffer = Buffer.from(xmlBuffer, 'base64');
//       // const filePathInBucket = `${process.env.PATH_BUCKET}/LOS/PDF/${Date.now()}incomesanction.pdf`;
//       const uploadResponse = await uploadPDFToBucket(pdfBuffer, `incomesanction${Date.now()}.pdf`);
//       console.log(uploadResponse.url,"uploadResponse")

//       const fileUrl =uploadResponse.url

//       await final.findOneAndUpdate(
//         { customerId }, // Query to find the specific customer document
//         {
//           'ratnaSignEsignLink.loandocument': fileUrl,
//         },
//         { new: true, upsert: true } // Options: Return the updated document, don't create a new one
//       );

      
  
      
//       // console.log('PDF uploaded successfully:', fileUrl);


//     return success(res,"all document signed",{signedUrl: fileUrl})

//       // console.log("API Response:", response?.data);
//       // return response.data;
//   } catch (error) {
//     console.error("Error fetching document:", error.message);
        
//     // 🔹 Circular structure issue fix: Only return `error.response?.data || error.message`
//     // return res.status(500).json({ 
//     //     success: false, 
//     //     error: error.response|| error.message 
//     // });

//   console.error("Error deleting estampRequirement:", error);
//   return unknownError(res, error);
//   }


// };



async function testDigioApi(req, res) {
  try {
    const { customerId } = req.query;
    const existingData = await final.findOne({ customerId });

    if (!existingData || !existingData.ratnaDocument_ids) {
      return badRequest(res, "No document IDs found for this customer");
    }

    const accessToken = await getDigioAccessToken();
    const uploadedFiles = {}; 

    // **Loop through all stored document IDs**
    for (const [pdfName, documentId] of Object.entries(existingData.ratnaDocument_ids)) {
      const statusUrl = `https://api.digio.in/v2/client/document/${documentId}`;
      const statusResponse = await axios.get(statusUrl, {
        headers: {
          Authorization: `Basic ${accessToken}`,
          "Content-Type": "application/json",
        },
      });

      const documentStatus = statusResponse.data.signing_parties?.[0]?.status;
      console.log(`Status of ${pdfName}:`, documentStatus);

      if (documentStatus !== "signed") {
        return badRequest(res, `${pdfName} is not signed yet`);
      }

      const apiUrl = `https://api.digio.in/v2/client/document/download?document_id=${documentId}`;
      console.log("Downloading:", apiUrl);

      const response = await axios.get(apiUrl, {
        headers: {
          Authorization: `Basic ${accessToken}`,
        },
        responseType: "arraybuffer",
      });

      const pdfBuffer = Buffer.from(response.data, "base64");

      const uploadResponse = await uploadPDFToBucket(pdfBuffer, `${pdfName}_${Date.now()}.pdf`);
      console.log(`Uploaded ${pdfName} =>`, uploadResponse.url);

      uploadedFiles[pdfName] = uploadResponse.url; // Store the uploaded file URL
    }

    // **Update Database with signed document URLs**
    await final.findOneAndUpdate(
      { customerId },
      { 'ratnaSignEsignLink': uploadedFiles },
      { new: true, upsert: true }
    );

    return success(res, "All documents signed and uploaded successfully", { signedUrls: uploadedFiles });

  } catch (error) {
    console.error("Error fetching documents:", error.message);
    return unknownError(res, error);
  }
};


const uploadPDFToBucket = async (pdfBuffer, fileName) => {
  try {
    const filePathInBucket = `${process.env.PATH_BUCKET}/LOS/PDF/${fileName}`;
    const bucketName = 'finexe'; 
    const contentType = 'application/pdf';

    const uploadResult = await uploadToSpaces(bucketName, filePathInBucket, pdfBuffer, 'public-read', contentType);

    return { url: `https://cdn.fincooper.in/${filePathInBucket}` };
  } catch (error) {
    console.error('Error uploading PDF to bucket:', error);
    throw new Error('Upload failed');
  }
};

const testDigioApi11 = async (req, res) => {
  try {
    // **Step 1: Generate Access Token**
    const accessToken = await getDigioAccessToken();
    console.log(accessToken, "accessToken");

    // **Step 2: Fetch PDF and Convert to Base64**
    const base64PDF = await fetchPdfAsBase64(pdfUrl);
    console.log("✅ PDF Converted to Base64");

    // **Step 3: Prepare API Payload**
    const payload = {
      signers: [
        {
          identifier: "user@example.com",
          name: "John Doe",
          sign_type: "aadhaar",
          reason: "Approving the document",
        },
      ],
      expire_in_days: 10,
      display_on_page: "custom",
      notify_signers: true,
      send_sign_link: true,
      generate_access_token: true,
      file_name: "IncomeSanctionLetter.pdf",
      file_data: base64PDF,
      sign_coordinates: {
        "user@example.com": {
          "1": [
            {
              llx: 376.55,
              lly: 67.89,
              urx: 535.89,
              ury: 129.36,
            },
          ],
        },
      },
      estamp_request: null, // ✅ No e-stamp
    };

    console.log(payload, "payload");

    // **Step 4: Upload PDF to Digio**
    const uploadResponse = await axios.post(
      "https://ext.digio.in/api/v2/client/document/uploadpdf",
      payload,
      {
        headers: {
          accept: "application/json",
          "content-type": "application/json",
          Authorization: `Basic ${accessToken}`,
        },
      }
    );

    console.log("✅ Upload Response:", uploadResponse.data.data);

    const entityId = uploadResponse.data.id; // ✅ Extract `entity_id`
    console.log("📄 Entity ID:", entityId);

    // **Step 5: Fetch Signed PDF URL**
    let signedPDFUrl = null;
    let statusCheckCount = 0;

    while (!signedPDFUrl && statusCheckCount < 10) { // 🔄 Retry for ~10 sec
      await new Promise(resolve => setTimeout(resolve, 2000)); // ⏳ Wait 2 sec

      const statusResponse = await axios.get(
        `https://ext.digio.in/api/v2/client/document/status/${entityId}`,
        { headers: { Authorization: `Basic ${accessToken}` } }
      );

      console.log("📊 Status Response:", statusResponse.data);

      if (statusResponse.data.data.signed_file_url) {
        signedPDFUrl = statusResponse.data.data.signed_file_url; 
        break;
      }

      statusCheckCount++;
    }

    // **Step 6: Return Response**
    if (signedPDFUrl) {
      console.log("✅ Signed PDF URL:", signedPDFUrl);
      res.json({ success: true, signed_pdf_url: signedPDFUrl });
    } else {
      console.log("❌ PDF Not Signed Yet, Try Again Later.");
      res.json({ success: false, message: "PDF not signed yet, retry later." });
    }
  } catch (error) {
    console.error("❌ Error:", error.response?.data || error.message);
    res.status(500).json({ success: false, error: error.message });
  }
};


const addDistanceOfMap = async(req,res) =>{
  try{
    const {customerId,distanceOfMap} = req.body
     await approverFormModel.findOneAndUpdate({
      customerId: new ObjectId(customerId),
    },
  {
    $set:{
      distanceOfMap
    }
  }
  );
  return success(res ,"distanceOfMap added successfully");
  }catch (error) {
    console.error("Error deleting estampRequirement:", error);
    return unknownError(res, error);
  }
}


const sendToBranch = async(req, res) => {
  try {
    const { customerId,ccEmail,isEmail } = req.query;
    const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");
    
    if (!customerId) {
      return badRequest(res, "Customer ID is required");
    }

    const customerDetail = await customerModel.findById(customerId)

    if (!customerDetail) {
      return badRequest(res, "Customer Not Found");
    }

    const finalData = await finalModel
      .findOne({ customerId })
      .populate("partnerId")
      .populate("employeeId");

// console.log(customerId,"customerIdcustomerIdcustomerId")
    // const customerDetails =  await customerModel.findById(customerId)
    const customerDetails = await customerModel.aggregate([
      {
          $match: { _id: new mongoose.Types.ObjectId(customerId) }
      },
      {
          $lookup: {
              from: "employees",
              localField: "employeId",
              foreignField: "_id",
              as: "employeeDetails"
          }
      },
      {
          $unwind: { path: "$employeeDetails", preserveNullAndEmptyArrays: true }
      },
      {
        $lookup: {
            from: "newbranches",
            localField: "branch",
            foreignField: "_id",
            as: "customerBranchDetails"
        }
    },
    

    {
      $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          as: "applicantDataDetails"
      }
  },
  {
      $unwind: { path: "$applicantDataDetails", preserveNullAndEmptyArrays: true }
  },
  
    {
        $unwind: { path: "$customerBranchDetails", preserveNullAndEmptyArrays: true }
    },
      {
          $lookup: {
              from: "employees",
              localField: "employeeDetails.reportingManagerId",
              foreignField: "_id",
              as: "reportingManager"
          }
      },
      {
          $unwind: { path: "$reportingManager", preserveNullAndEmptyArrays: true }
      },

      {
        $lookup: {
            from: "employees",
            localField: "reportingManager.reportingManagerId",
            foreignField: "_id",
            as: "seniorReportingManager"
        }
    },
    {
        $unwind: { path: "$seniorReportingManager", preserveNullAndEmptyArrays: true }
    },

      {
        $project:{
          customerFinId:1,
          "employeeDetails._id":1,
          "employeeDetails.employeName":1,
          "employeeDetails.workEmail":1,
          "reportingManager._id":1,
          "reportingManager.employeName":1,
          "reportingManager.workEmail":1,
          "seniorReportingManager.workEmail":1,
          "customerBranchDetails.name":1,
          "applicantDataDetails.fullName":1,
          "applicantDataDetails.mobileNo":1,
        }
      }
  ]);
    // console.log(customerDetails,"customerDetailscustomerDetailscustomerDetails")

    if(customerDetails.length === 0){
      return badRequest(res, "customer Details Not Find");
    }
    const applicantDetails = await applicantModel.findOne({customerId})
    if(!applicantDetails){
      return badRequest(res, "applicant Not Find");
    }

    const data = await finalModel.findOne({ customerId });
    
    // Check if data exists
    if (!data) {
      return badRequest(res, "No record found for this customer ID");
    }

    
    
    // Check if incomesectionLatterUrl exists and is not empty
    if (!data.incomesectionLatterUrl) {
      return badRequest(res, "Please generate income sanction");
    }

    // Update the document
    await finalModel.findOneAndUpdate(
      { customerId },
      { 
        $set: { 
          incomeSanctionStatus: "complete",
          incomeSanctionDate: todayDate
        } 
      }
    );

    success(res, "Send to branch successfully");


    const { employeeDetails, customerFinId, reportingManager , seniorReportingManager , customerBranchDetails , applicantDataDetails} = customerDetails[0];
    // console.log(employeeDetails, customerFinId, reportingManager,"employeeDetails, customerFinId, reportingManager")
    const toEmails = [];
    const ccEmails = [];

    if (req.headers.host.includes("prod.fincooper.in")) {
      toEmails.push(`${employeeDetails?.workEmail}`);
      ccEmails.push(`${reportingManager?.workEmail}`) 
      ccEmails.push(`${seniorReportingManager?.workEmail}`) 
      ccEmails.push("finexe@fincoopers.com");
      ccEmails.push("ketavpipaliya@fincoopers.in") 
      ccEmails.push("ho@fincoopers.in") 
       //ccEmail
      try {
        const parsedCcEmails = JSON.parse(ccEmail);  // assuming ccEmail is a stringified array
        if (Array.isArray(parsedCcEmails)) {
            ccEmails.push(...parsedCcEmails);  // spread into ccEmails
        } else {
            ccEmails.push(ccEmail);  // fallback if somehow it's a normal string
        }
      } catch (error) {
        // If JSON.parse fails, treat it as a normal email string
        ccEmails.push(ccEmail);
    }
    } else {
      toEmails.push(`${employeeDetails?.workEmail}`);
      ccEmails.push("darshanrajput@fincoopers.in");
      ccEmails.push(`${reportingManager?.workEmail}`)  //ccEmail
      try {
        const parsedCcEmails = JSON.parse(ccEmail);  // assuming ccEmail is a stringified array
        if (Array.isArray(parsedCcEmails)) {
            ccEmails.push(...parsedCcEmails);  // spread into ccEmails
        } else {
            ccEmails.push(ccEmail);  // fallback if somehow it's a normal string
        }
      } catch (error) {
        // If JSON.parse fails, treat it as a normal email string
        ccEmails.push(ccEmail);
    }
    }

    const filteredCcEmails = ccEmails.filter(email => email !== undefined && email !== "");
    const filteredToEmails = toEmails.filter(email => email !== undefined && email !== "");
    

    // console.log('customerFinId-------',customerFinId,toEmails,ccEmails)
    const fullName = applicantDetails?.fullName?.toUpperCase() || "";
    const subject = `Income Sanction Letter - Loan Application for ${fullName} // ${customerFinId} // ${customerBranchDetails.name}`;
//     const pdfContent = `
//   <div style="font-family: Arial, sans-serif; line-height: 1.6;">
//     <div style="border-top: 1px solid #cccccc; padding-top: 10px; margin-top: 10px;">
//       <p>Dear Team,</p>
//       <p>Please Find Attached Income Sanction Letter for the loan application ${customerFinId}</p>

//    <table>
//   <thead>
//       <tr>
//           <th colspan="2" style="text-align: center; padding: 5px;">Recommendation Profile</th>
//       </tr>
//   </thead>
//   <tbody>
//       <tr>
//           <td style="font-weight: bold; padding: 3px; width: 50%;">BRANCH NAME</td>
//           <td style="padding: 3px; width: 50%;">${customerBranchDetails.name}</td>
//       </tr>
//       <tr>
//           <td style="font-weight: bold; padding: 3px;">CUSTOMER NAME</td>
//           <td style="padding: 3px;">${applicantDataDetails?.fullName}</td>
//       </tr>
//       <tr>
//           <td style="font-weight: bold; padding: 3px;">CONTACT NO</td>
//           <td style="padding: 3px;">${applicantDataDetails?.mobileNo}</td>
//       </tr>
//        <tr>
//           <td style="font-weight: bold; padding: 3px;">LOAN AMOUNT</td>
//           <td style="padding: 3px;">Rs.${finalData?.finalLoanAmount}</td>
//       </tr>
//        <tr>
//           <td style="font-weight: bold; padding: 3px;">TENURE</td>
//           <td style="padding: 3px;">${finalData?.tenureInMonth} months</td>
//       </tr>
//       <tr>
//           <td style="font-weight: bold; padding: 3px;">IRR</td>
//           <td style="padding: 3px;">${finalData?.roi}%</td>
//       </tr>
//       <tr>
//           <td style="font-weight: bold; padding: 3px;">EMI</td>
//           <td style="padding: 3px;">Rs.${Math.round(finalData?.emiAmount)}</td>
//       </tr>
//   </tbody>
// </table>

//       <p>Please review the terms and conditions detailed within, including loan amount, interest rate, repayment schedule, and pre-disbursement requirements.</p>

//       <p>The document outlines the necessary steps for finalizing the loan disbursement, such as providing the required documents and completing the E-NACH process. Please ensure all requirements are met to avoid any delays.</p>
// <p> If you have any questions or require further clarification, please do not hesitate to contact HO Person.</p>
// <p> <strong>Please note that this is an automated notification, and replies to this email will not be received. </strong></p>
//       <p>Sincerely.</p>
//       <p>Team Fin Coopers</p>
//     </div>
//   </div>
// `;


const pdfContent = `
  <html>
  <head>
    <style>
      body { font-family: Arial, sans-serif; line-height: 1.6; }
      h2 { color: #4CAF50; }
      p { font-size: 14px; color: #333; }
      table { 
        width: 60%;
        border-collapse: collapse; 
        margin: 20px auto;
        font-size: 12px;
      }
      table, th, td { 
        border: 1px solid #ddd; 
        padding: 6px;
        margin: 15px 0;
        text-align: left;
      }
      th { 
        background-color: rgb(19, 79, 92);
        text-align: left;
        color: white;
      }
      td[style*="font-weight: bold"] {
        background-color: #f8f8f8;
      }
      .footer { margin-top: 20px; font-size: 12px; color: #888; }
    </style>
  </head>
  <body>
    <p>Dear Team,</p>
    <p>Please Find Attached Income Sanction Letter for the loan application ${customerFinId}</p>

    <table>
      <thead>
        <tr>
          <th colspan="2" style="text-align: center; padding: 5px;">Recommendation Profile</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="font-weight: bold; padding: 3px; width: 50%;">BRANCH NAME</td>
          <td style="padding: 3px; width: 50%;">${customerBranchDetails?.name}</td>
        </tr>
        <tr>
          <td style="font-weight: bold; padding: 3px;">CUSTOMER NAME</td>
          <td style="padding: 3px;">${applicantDataDetails?.fullName}</td>
        </tr>
        <tr>
          <td style="font-weight: bold; padding: 3px;">CONTACT NO</td>
          <td style="padding: 3px;">${applicantDataDetails?.mobileNo}</td>
        </tr>
        <tr>
          <td style="font-weight: bold; padding: 3px;">LOAN AMOUNT</td>
          <td style="padding: 3px;">Rs.${finalData?.finalLoanAmount}</td>
        </tr>
        <tr>
          <td style="font-weight: bold; padding: 3px;">TENURE</td>
          <td style="padding: 3px;">${finalData?.tenureInMonth} months</td>
        </tr>
        <tr>
          <td style="font-weight: bold; padding: 3px;">IRR</td>
          <td style="padding: 3px;">${finalData?.roi}%</td>
        </tr>
        <tr>
          <td style="font-weight: bold; padding: 3px;">EMI</td>
          <td style="padding: 3px;">Rs.${Math.round(finalData?.emiAmount)}</td>
        </tr>
      </tbody>
    </table>

    <p>Please review the terms and conditions detailed within, including loan amount, interest rate, repayment schedule, and pre-disbursement requirements.</p>

    <p>The document outlines the necessary steps for finalizing the loan disbursement, such as providing the required documents and completing the E-NACH process. Please ensure all requirements are met to avoid any delays.</p>

    <p>If you have any questions or require further clarification, please do not hesitate to contact HO Person.</p>
    <p><strong>Please note that this is an automated notification, and replies to this email will not be received.</strong></p>
    <p>Sincerely.</p>
    <p>Team Fin Coopers</p>
    </div>
  </body>
  </html>
`;


const attachment = data.incomesectionLatterUrl
  ? [{
      path: data.incomesectionLatterUrl,
      filename: data.incomesectionLatterUrl.split('/').pop(),
      contentType: 'application/pdf'
    }]
  : [];

  if(isEmail == "true" || isEmail == true){
    await sendEmailByVendor("finalApproverQuery", filteredToEmails, filteredCcEmails, subject, pdfContent , attachment);
  }
     await fileProcessSheet(customerId)
  } catch (error) {
    console.error("Error in sendToBranch:", error);
    return unknownError(res, error);
  }
}


const sendToPartnerSanction = async(req, res) => {
  try {
    const { customerId, isEmail = "true"  } = req.query;
    const empId = req.Id
    // console.log(empId,"empIdempId")
    const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");
    if (!customerId) {
      return badRequest(res, "Customer ID is required");
    }
    const approverData = await approverFormModel.findOne({
      customerId: new ObjectId(customerId),
    });

    if (!approverData) {
      return badRequest(res, "Approver data not found");
    }

    const finalData = await finalModel.findOne({ customerId });
    // console.log(finalData,"finalDatafinalDatafinalData")

    // if(!finalData.partnerId){
    //   return badRequest(res,"please select partner first")
    // }
    // const partnerData = await lenderModel({_id: finalData.partnerId})
    // console.log(partnerData,"partnerDatapartnerDatapartnerData")


    const cultivationAcres = finalData?.agricultureIncome?.details[0]?.AreaCultivationAcres || finalData?.agricultureRatnaIncome?.details[0]?.AreaCultivationAcres
    // console.log(cultivationAcres,"cultivationAcrescultivationAcres",
    //   finalData.sanctionZipUrl
    // )

    const externalVendorFormData = await externalVendorFormModel.findOne({
      customerId,
    });

    const rcuVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rcu"
    );
    const legalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "legal"
    );
    const technicalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "technical"
    );

    // console.log(rcuVendor,legalVendor,technicalVendor,"externalVenderData externalVenderData")
    // Extract only numbers from any string/number input
    const extractNumber = (value) => {
      if (typeof value === 'number') return value;
      if (typeof value === 'string') {
        // Extract all numbers (including decimals) from string
        const matches = value.match(/\d+\.?\d*/);
        return matches ? parseFloat(matches[0]) : 0;
      }
      return 0;
    };

    // Extract numerical values only
    const totalLandArea = extractNumber(approverData?.totalLandArea);
    const propertyAge = extractNumber(approverData?.propertyAge);
    const Ltv = extractNumber(approverData?.Ltv);
    const distanceOfMap = extractNumber(approverData?.distanceOfMap);

    // Log parsed values for debugging
    // console.log('Extracted numerical values:', {
    //   totalLandArea,
    //   propertyAge,
    //   Ltv,
    //   distanceOfMap
    // });

     // Validation checks dynamic
    // if (totalLandArea < partnerData.policy.minimumAgricultureLand) {
    //   return badRequest(res, `Property area must be at least ${partnerData.policy.minimumAgricultureLand} sqft. Current area: ${totalLandArea}`);
    // }

    // if (propertyAge > 50) {
    //   return badRequest(res, `Property age must be less than 50 years. Current age: ${propertyAge}`);
    // }

    // if (Ltv > partnerData.policy.ltv) {
    //   return badRequest(res, `LTV must be less than ${partnerData.policy.ltv},Current LTV: ${Ltv}`);
    // }

    // if (distanceOfMap > 60 ){
    //   return badRequest(res, `Distance must be less than  60km. rrent distance: ${distanceOfMap}`);
    // }

    // if (cultivationAcres < partnerData.policy.propertyArea) {
    //   return badRequest(res, `property area min ${partnerData.policy.propertyArea} Acre. Current are: ${cultivationAcres}`);
    // }

    // if (finalData.sanctionZipUrl.length == 0) {
    //   return badRequest(res, `sanction zip is not generated`);
    // }

    // // if (rcuVendor.uploadProperty.length == 0) {
    // //   return badRequest(res, `rcu is not completed`);
    // // }

    // if (legalVendor.uploadProperty.length == 0) {
    //   return badRequest(res, `legal is not completed`);
    // }

    // if (technicalVendor.uploadProperty.length == 0) {
    //   return badRequest(res, `technical is not completed`);
    // }

    // Validation checks
    if (totalLandArea < 400) {
      return badRequest(res, `Property area must be at least 400 sqft. Current area: ${totalLandArea}`);
    }

    if (propertyAge > 50) {
      return badRequest(res, `Property age must be less than 50 years. Current age: ${propertyAge}`);
    }

    if (Ltv > 60) {
      return badRequest(res, `LTV must be less than 60%,Current LTV: ${Ltv}`);
    }

    if (distanceOfMap > 60 ){
      return badRequest(res, `Distance must be less than  60km. rrent distance: ${distanceOfMap}`);
    }

    if (cultivationAcres < 2) {
      return badRequest(res, `property area min 2 Acre. Current are: ${cultivationAcres}`);
    }

    if (finalData.sanctionZipUrl.length == 0) {
      return badRequest(res, `sanction zip is not generated`);
    }

    // if (rcuVendor.uploadProperty.length == 0) {
    //   return badRequest(res, `rcu is not completed`);
    // }

    if (legalVendor.uploadProperty.length == 0) {
      return badRequest(res, `legal is not completed`);
    }

    // if (technicalVendor.uploadProperty.length == 0) {
    //   return badRequest(res, `technical is not completed`);
    // }

    await finalModel.findOneAndUpdate(
      { customerId },
      { $set: { sendToPartnerSanctionStatus: "complete",
        sendToPartnerSanctionDate:todayDate,
        finalSanctionStatus:"complete",
        finalSanctionStatusDate:todayDate
       } },
      {new: true, upsert:true}
    );
    // Success response with original values
    success(res, "Send to partner sanction successfully");
    if(isEmail == "true" || isEmail == true){
      console.log("inside the if block <><><><><><><><><><>")
      await mailSendPartnerToSanction(customerId, req, empId)
    }
    // await fileProcessSheet(customerId)
  } catch (error) {
    console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
  }
};


const uploadDocument = async(req, res) => {
  try {
    const { customerId,sanctionLetter,applicationForm,loanAgreement,repaymentSchedule,kfs,otherDocument } = req.body;
 
   const data =  await finalModel.findOneAndUpdate(
      { customerId },
      { $set: { 
        physicalEsignDocument:{
          sanctionLetter,applicationForm,loanAgreement,repaymentSchedule,kfs,otherDocument
        }
       } },
      {new: true, upsert:true}
    );

     success(res, "document uploaded successfully",{data:data.physicalEsignDocument});
  } catch (error) {
    console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
  }
};

//uploadDocumentList
const uploadDocumentList = async(req, res) => {
  try {
    const { customerId  } = req.query;
    // console.log(req.query,"<>customerId<>---0")
    const data =  await finalModel.findOne({ customerId : customerId  });
    let existingDisbursement = await disbursementModel.findOne({ customerId });
    // console.log(data,"data<<<<<<<<<<<<<<<<<<<<<<<<<<")
    success(res, "document list are",{
      physicalEsignDocument:data?.physicalEsignDocument || {},
      reUploadPhysicalEsignDocument: data?.reUploadPhysicalEsignDocument || {},
      esignLinks: data?.esignLinks || {},
      pasteEsignDocument: data.pasteEsignDocument || ""
    });
  } catch (error) {
    console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
  }
};

//reUploadDocument
const reUploadDocument = async(req, res) => {
  try {
    const { customerId,sanctionLetter,applicationForm,loanAgreement,repaymentSchedule,kfs,otherDocument } = req.body;
 
   const data =  await finalModel.findOneAndUpdate(
      { customerId },
      { $set: { 
        reUploadPhysicalEsignDocument:{
          sanctionLetter,applicationForm,loanAgreement,repaymentSchedule,kfs,otherDocument
        }
       } },
      {new: true, upsert:true}
    );

     success(res, "document uploaded successfully",{data:data.reUploadPhysicalEsignDocument});
  } catch (error) {
    console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
  }
};


const addMortgageDetails = async (req, res) => {
  try {
    const { customerId, mortgageDetails, authorizedPerson } = req.body;
    const todayDate = moment().tz("Asia/Kolkata").format("YYYY-MM-DDThh:mm:ss A");


    const mortgageData = await finalModel.findOneAndUpdate(
      { customerId },
      { $set: { 
          mortgageDetails: mortgageDetails,
          authorizedPerson: authorizedPerson || "" 
        } 
      },
      { new: true, upsert: true }
    );

    const data = {
      mortgageDetails: mortgageData?.mortgageDetails ,
      authorizedPerson:authorizedPerson
    }

    success(res, "Mortgage details updated successfully",data);

    // Update mortgageDetail flag in processModel
    await processModel.findOneAndUpdate(
      { customerId },
      { $set: { mortgageDetail: true } },
      { new: true }
    );

    // Call final approval sheet function
    // await finalApprovalSheet(customerId);

  } catch (error) {
    console.error("Error in addMortgageDetails:", error);
    return unknownError(res, error);
  }
};


const getMortgageDetails = async (req, res) => {
  try {
    const { customerId } = req.query;

    if (!customerId) {
      return badRequest(res, "Customer ID is required");
    }

    const mortgageData = await finalModel.findOne({ customerId })
      .select('mortgageDetails authorizedPerson')
      .lean(); // Use `.lean()` for better performance

    if (!mortgageData) {
      return notFound(res, "Mortgage details not found");
    }

    const data = {
      mortgageDetails: mortgageData.mortgageDetails || [],
      authorizedPerson: mortgageData.authorizedPerson || ""
    };

    return success(res, "Mortgage Details fetched successfully", data);
    
  } catch (error) {
    console.error("Error in getMortgageDetails:", error);
    return unknownError(res, error);
  }
};





const documentList = async(req, res) => {
  try {
    const { customerId } = req.query;
    const data =  await finalModel.findOne({ customerId }).populate("partnerId")
    const bankStatementData = await bankStatementModel.findOne({ customerId })
    const disbursementData = await disbursementModel.findOne({ customerId });
    console.log(data,"data<<>><<>>")

    // let links = 
    // (data?.signEsignLink && Object.values(data.signEsignLink).some(val => val)) 
    // ? data.signEsignLink 
    // : data?.signLeegalityLink//updatedPd?.esignLinks;

    let links = 
        (data?.partnerId?.loanDocument == "physical" && Object.values(data.physicalEsignDocument).some(val => val)) 
        ? data.physicalEsignDocument 
        : data?.signLeegalityLink
        //updatedPd?.esignLinks;
    // console.log(data,"data<><><><><>")
    success(res, "document details",{
      legalDetail:data?.legalDetails,
      nachLink: bankStatementData?.Nachlink?.trim() ? bankStatementData?.Nachlink : disbursementData?.eNachLinkSentToBranch || "",
      esignLinks: links,
      reUploadPhysicalEsignDocument:data?.reUploadPhysicalEsignDocument
    });
  } catch (error) {
    console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
  }
};

//docGenerate
const docGenerate = async(req, res) => {
  try {
    const { customerId } = req.query;
    // const data =  await finalModel.findOne({ customerId })
    const externalVendorFormData = await externalVendorFormModel.findOne({
      customerId,
    });
    const creditPdData = await creditPdModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const disbursementData = await disbursementModel.findOne({ customerId });
    const coApplicantData = await coApplicantModel.find({ customerId });
    const applicantData = await applicantModel.findOne({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const cibilData = await cibilModel.findOne({ customerId });
    const loanDocumentData = await loanDocumentModel.findOne({ customerId });
    const SignKycDetails = await SignKycModel.findOne({ customerId });
    const finalData = await finalModel.findOne({ customerId })

    const customerObjectId = mongoose.Types.ObjectId.isValid(customerId)
      ? new mongoose.Types.ObjectId(customerId)
      : customerId;
    console.log(customerObjectId, "customerObjectId")
    const customerDocumentDetails = await customerDocumentModel.findOne({ customerId: customerObjectId });
    const loanDocument = await loanDocumentModel.findOne({ customerId });
    const bankStatementData = await bankStatementModel.findOne({ customerId })

    const rcuVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rcu"
    );
    const legalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "legal"
    );
    const technicalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "technical"
    );
    const rmVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rm"
    );
    const taggingVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "tagging"
    );

    const responseData = {
        // login check list
        utilityBillAndResiProof:
          customerDocumentDetails?.incomeDocument?.utilityBillDocument || [],
        familyCardDocument:
          customerDocumentDetails?.incomeDocument?.familyCardDocument || [],
        familyCardDocumentDetails: "Recive from sales form",
        udyamCertificate:
          customerDocumentDetails?.incomeDocument?.udyamCertificateDocument ||
          [],
        udyamCertificateDetails: "Recive from sales form",
        bankStatement:
          customerDocumentDetails?.incomeDocument?.bankStatementDocument || [],
        bankStatementDetails: "Recive from sales form",
        incomeDocument:
          customerDocumentDetails?.incomeDocument?.incomeStatemenDocument || [],
        incomeDocumentDetails: "Recive from sales form",
        propertyDocument:
          customerDocumentDetails?.propertyDocuments?.propertyDocument || [],
        propertyDocumentDetails: "Recive from sales form",
        signApplicantKyc: customerDocumentDetails?.signApplicantKyc || [],
        propertyDocumentDetails: "Recive from sales form",
        signCoApplicantKyc: customerDocumentDetails?.signCoApplicantKyc || [],
        signCoApplicantKycDetails: "Recive from sales form",
        signCoTwoApplicantKyc:
          customerDocumentDetails?.signCoTwoApplicantKyc || [],
        signCoTwoApplicantKycDetails: "Recive from sales form",
        signGurantorKyc: customerDocumentDetails?.signGurantorKyc || [],
        signGurantorKycDetails: "Recive from sales form",
        //
        electricityBill: creditPdData?.utilityBillDocument || [],
        electricityBillDetails: "Recive from electricity form",
        SamagraId: creditPdData?.SSSMPhoto || [],
        SamagraIdDetails: "Recive from SamagraId form",
        // gasDiaryDocument:,
        // gasDiaryDocumentDetails:"",

        applicantPhoto: applicantData?.applicantPhoto || "",
        applicantPhotoDetails: "Recive from login form",
        coApplicantPhoto: coApplicantData[0]?.coApplicantPhoto || "",
        coApplicantPhotoDetails: "Recive from login form",
        coApplicantPhotoTwo: coApplicantData[1]?.coApplicantPhoto || "",
        coApplicantPhotoTwoDetails: "Recive from login form",
        guarantorPhoto: guarantorData?.guarantorPhoto || "",
        guarantorPhotoDetails: "Recive from login form",
        applicantKycOsv: SignKycDetails?.ApplicantSignDocument || "",
        applicantKycOsvDetails: "Recive from branch",
        coApplicantKycOsv: SignKycDetails?.coApplicantSignDocument || "",
        coApplicantKycOsvDetails: "Recive from branch",
        gurantorKycOsv: SignKycDetails?.guarantorSignDocument || "",
        gurantorKycOsv: "Recive from branch",
        applicantKyc: {
          applicantAadharFrontImage:
            applicantData?.kycUpload?.aadharFrontImage || "",
          applicantAadharBackImage:
            applicantData?.kycUpload?.aadharBackImage || "",
          applicantPanFrontImage: applicantData?.kycUpload?.panFrontImage || "",
          applicantDrivingLicenceImage:
            applicantData?.kycUpload?.drivingLicenceImage || "",
          applicantVoterIdImage: applicantData?.kycUpload?.voterIdImage || "",
        },
        applicantKycDetails: "Recive from login form",
        coApplicantKyc: {
          coApplicantKycAadharFrontImage:
            coApplicantData[0]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycAadharBackImage:
            coApplicantData[0]?.kycUpload?.aadharBackImage || "",
          // coApplicantKycDocType:coApplicantData[0]?.kycUpload?.docImage || "",
          coApplicantKycDocImage: coApplicantData[0]?.kycUpload?.docImage || "",
        },
        coApplicantKycDetails: "Recive from login form",
        coApplicantKycTwo: {
          coApplicantKycTwoAadharFrontImage:
            coApplicantData[1]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycTwoAadharBackImage:
            coApplicantData[1]?.kycUpload?.aadharBackImage || "",
          coApplicantKycTwoDocImage:
            coApplicantData[1]?.kycUpload?.docImage || "",
        },
        coApplicantKycTwoDetails: "Recive from login form",
        gurantorKyc: {
          gurantorAadharFrontImage:
            guarantorData?.kycUpload?.aadharFrontImage || "",
          gurantorAadharBackImage:
            guarantorData?.kycUpload?.aadharBackImage || "",
          gurantorDocImage: guarantorData?.kycUpload?.docImage || "",
        },
        gurantorKycDetails: "Recive from login form",
        applicantCibilReport: cibilData?.applicantFetchHistory?.slice(-1)[0]?.cibilReport || "",
        applicantCibilReportDetails: "Recive from cibil form",
        coApplicantCibilReport:
          Array.isArray(cibilData?.coApplicantData[0]?.coApplicantFetchHistory)
            ? cibilData.coApplicantData[0].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        coApplicantCibilReportDetails: "Recive from cibil form",
        coApplicantTwoCibilReport:
          Array.isArray(cibilData?.coApplicantData[1]?.coApplicantFetchHistory)
            ? cibilData.coApplicantData[0].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        coApplicantTwoCibilReportDetails: "Recive from cibil form",
        guarantorCibilReport: cibilData?.guarantorFetchHistory?.slice(-1)[0]?.cibilReport || "",
        guarantorCibilReportDetails: "Recive from cibil form",
        pdReport: creditPdData?.pdfLink || "",
        pdReportDetails: "Recive from creditPd form",
        rcuReport: rcuVendor?.uploadProperty || [],
        rcuReportDetails: "Recive from externalVendor form",
        legalReport: legalVendor?.uploadProperty || [],
        legalReportDetails: "Recive from externalVendor form",
        technicalReport: technicalVendor?.uploadProperty || [],
        technicalReportDetails: "Recive from externalVendor form",
        technicalEstimateDocument: technicalVendor?.estimateDocument || [],
        estimateDocumentDetails: "Recive from externalVendor form",
        taggingReport: taggingVendor?.uploadProperty || [],
        taggingReportDetails: "Recive from externalVendor form",
        housePhotos: [
          ...(Array.isArray(creditPdData?.fourBoundaryPhotos)
            ? creditPdData?.fourBoundaryPhotos
            : [creditPdData?.fourBoundaryPhotos]),
          ...(Array.isArray(creditPdData?.houseInsidePhoto)
            ? creditPdData?.houseInsidePhoto
            : [creditPdData?.houseInsidePhoto]),
          ...(Array.isArray(creditPdData?.propertyOtherPhotos)
            ? creditPdData?.propertyOtherPhotos
            : [creditPdData?.propertyOtherPhotos]),
          creditPdData?.selfiWithCustomer || "",
          creditPdData?.photoWithLatLong || "",
          creditPdData?.front || "",
          creditPdData?.leftSide || "",
          creditPdData?.rightSide || "",
          creditPdData?.approachRoad || "",
          creditPdData?.mainRoad || "",
          creditPdData?.interiorRoad || "",
          creditPdData?.selfieWithProperty || "",
          creditPdData?.landmarkPhoto || "",
          creditPdData?.latLongPhoto || "",
        ].filter(Boolean),
        housePhotosDetails: "Recive from creditPd form",
        // workPhotos: creditPdData?.workPhotos || [],
        // workPhotosDetails: "Recive from creditPd form",
        workPhotos: incomeSourcePhotos || [],
        workPhotosDetails: "Recive from creditPd incomeSource data",
        camReport: loanDocument?.camReport || "",
        camReportDetails: "Recive from cam form",
      disbursmentCheckList: {
        dualNameDeclaration: loanDocumentData?.dualNameDeclaration || "",
        dualNameDeclarationDetails: "Recive at the time of final approval",
        dualSignDeclaration: loanDocumentData?.dualSignDeclaration || "",
        dualSignDeclarationDetails: "Recive at the time of final approval",
        dualDoBDeclaration: loanDocumentData?.dualDoBDeclaration || "",
        dualDoBDeclarationDetails: "Recive at the time of final approval",
        applicantPDC: appPdcData?.applicantPdcDocument || [],
        applicantPDCDetails: "Recive from appPdc form",
        guarantorPDC: gtrPdcData?.guarantorPdcDocument || [],
        guarantorPDCDetails: "Recive from gtrPdc form",
        applicantBSV: loanDocumentData?.applicantBSV || "",
        applicantBSVDetails: "Recive at the time of final approval",
        guarantorBSV: loanDocumentData?.guarantorBSV || "",
        guarantorBSVDetails: "Recive at the time of final approval",
        coOwnershipDeed: loanDocumentData?.coOwnershipDeed || "",
        eStampUpload:
          disbursementData?.estampRequirement?.flatMap(
            (stamp) => stamp.eStampUpload || []
          ) || [],

        estampRequirementDetail: "Recive at the time of final approval",
        // ratnaPdfUrls: finalSanctionData?.ratnaPdfUrls || {},
        // fcplPdfUrls: finalSanctionData?.fcplPdfUrls || {},
        // growMoneyPdfUrls: finalSanctionData?.growMoneyPdfUrls || {},

        insuranceForm: loanDocumentData?.insuranceForm || "",
        insuranceFormDetails: "Recive at the time of final approval",
        emOrRmDeed: loanDocumentData?.emOrRmDeed || "",
        emOrRmDeedDetails: "Recive at the time of final approval",
        finalLegal: legalVendor?.finalLegalUpload || "",
        finalLegalDetails: "Recive at the time of final approval",
        vettingReport: loanDocument?.vettingReport || "",
        vettingReportDetails: "Recive at the time of final approval",
        nachLink: bankStatementData?.Nachlink?.trim() ? bankStatementData.Nachlink : disbursementData?.eNachLinkSentToBranch || "",
        nachLinkDetails: "Recive from nach form",
        eNachLinkSignUpload: disbursementData?.eNachLinkSignUpload || "",
        nachLinkSignDetails: "Recive from nach  signsture Complete",
        eSignatureDocuments: disbursementData?.eSignatureDocuments || "",
        eSignatureDocumentsDetails: "Recive from nach  signsture Complete",
        appKycDocument: loanDocument?.appKycDocument || [],
        appKycDocumentDetails: "Recive at the time of final approval",
        coAppKycDocument: loanDocument?.coAppKycDocument || [],
        coApplicantPhotoDetails: "Recive at the time of final approval",
        stampPdf: loanDocumentData?.stampPdf || [],
        sanctionZipUrl: finalData?.sanctionZipUrl || [],
        disbursementZipUrl: finalData?.disbursementZipUrl || [],
        incomeSectionLatterUrl: finalData?.incomesectionLatterUrl || "",
        esignLinks: links || {}
      },
    };
    // console.log(data,"data<><><><><>")
    success(res, "document details",{data:data.physicalEsignDocument});
  } catch (error) {
    console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
  }
};

const customerCoApplicantDetailold = async (req, res) => {
  try {
    const { customerId } = req.query;
    const data = await coApplicantModel.find({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const camReportDetails = await camReportModel.findOne({ customerId });
    const udhyamKycData = await udhyamKycModel.findOne({ customerId });
    // console.log(data, "datadatadata");

    const coApplicantDetailsArray = (
      pdformdatasDetail?.co_Applicant &&
      pdformdatasDetail.co_Applicant.length > 0
        ? pdformdatasDetail.co_Applicant
        : [{}]
    ).map((value = {}, index) => {
      return {
        [`coApplicantDetails_${index + 1}`]: {
          ApplicantType: value.coApplicantType || "",
          bussinessType: value.businessType || "",
          coApplicantPhoto: data?.[index]?.coApplicantPhoto || "",
          fullName: data?.[index]?.fullName || "",
          fatherName: data?.[index]?.fatherName || "",
          motherName: data?.[index]?.motherName || "",
          dob: data?.[index]?.dob || "",
          age: data?.[index]?.age || "",
          gender: data?.[index]?.gender || "",
          maritalStatus: data?.[index]?.maritalStatus || "",
          educationDetails: data?.[index]?.education || "",
          relationWithApplicant: data?.[index]?.relationWithApplicant || "",
          religion: data?.[index]?.religion || "",
          nationality: "indian" || "",
          caste: value.caste || "",
          category: data?.[index]?.category || "",
          occupation: value?.occupation || "",
          residenceType: value?.residenceType || "",

          contactInformation: {
            mobileNo: data?.[index]?.mobileNo || "",
            mobileNoTwo: value.alternateMobileNo || "",
            email: data?.[index]?.email || "",
          },

          kycDetails: {
            udyamRegistrationNo: "",
            docType: data?.[index]?.docType || "",
            aadharNo: data?.[index]?.aadharNo || "",
            docNo: data?.[index]?.docNo || "",
          },
          kycUpload: {
            aadharFrontImage:data?.[index]?.kycUpload?.aadharFrontImage || "",
            aadharBackImage: data?.[index]?.kycUpload?.aadharBackImage || "",
            docImage: data?.[index]?.kycUpload?.docImage || "",
          },

          // permanentAddressInformation: {
          //   presentAddress: data?.[index]?.permanentAddress?.addressLine1 || "",
          //   // landmark: value.houseLandMark || "",
          //   nameOfCity: data?.[index]?.permanentAddress?.city || "",
          //   city: data?.[index]?.permanentAddress?.city || "",
          //   state: data?.[index]?.permanentAddress?.state || "",
          //   districtName: data?.[index]?.permanentAddress?.district || "",
          //   pinCode: data?.[index]?.permanentAddress?.pinCode || "",
          //   // noOfyearsAtCurrentAddress: value.noOfyearsAtCurrentAddress || "",
          //   country: "India",
          //   residenceType: value.residenceType || "",
          // },

          presentAddressInformation: {
            AddressAsPerAdhar: data?.[index]?.localAddress?.addressLine1 || "",
            addressLine2: data?.[index]?.localAddress?.addressLine2 || "",
            // fullAddress: data?.[index]?.permanentAddress?.addressLine2 || "",
            landmark: value.houseLandMark || "",
            nameOfCity: data?.[index]?.localAddress?.city || "",
            // addressLine1: data?.[index]?.permanentAddress?.addressLine1 || "",
            // addressLine2: data?.[index]?.permanentAddress?.addressLine2 || "",
            city: data?.[index]?.localAddress?.city || "",
            state: data?.[index]?.localAddress?.state || "",
            districtName: data?.[index]?.localAddress?.district || "",
            pinCode: data?.[index]?.localAddress?.pinCode || "",
            noOfyearsAtCurrentAddress: value.noOfyearsAtCurrentAddress || "",
            country: "India",
            residenceType: data?.[index]?.permanentAddress?.residenceType || "",
          },

          employeDetails: {
            education: data?.[index]?.education || "",
            occupation:
              camReportDetails?.coApplicationInformation?.[index]?.occupation ||
              "",
            monthlyIncome:
              camReportDetails?.coApplicationInformation?.[index]
                ?.monthlyIncome || "",
            otherMonthlyIncome:
              camReportDetails?.coApplicationInformation?.[index]
                ?.otherMonthlyIncome || "",
            sourceOfOtherIncome:
              camReportDetails?.coApplicationInformation?.[index]
                ?.sourceOfOtherIncome || "",
            annualIncome:
              camReportDetails?.coApplicationInformation?.[index]
                ?.annualIncome || "",
            totalHouseHoldExpenses:
              camReportDetails?.coApplicationInformation?.[index]
                ?.totalHouseHoldExpenses || "",
          },
        },
      };
    });
    console.log("data",data[0].kycUpload.aadharFrontImage )

    // Combine array into an object
    const responseData = coApplicantDetailsArray.reduce(
      (acc, curr) => Object.assign(acc, curr),
      {}
    );

    if (!Object.keys(responseData).length) {
      responseData[`coApplicantDetails_1`] = {
        ApplicantType: "",
        bussinessType: "",
        fullName: "",
        fatherName: "",
        motherName: "",
        dob: "",
        age: "",
        gender: "",
        maritalStatus: "",
        educationDetails: "",
        relationWithApplicant: "",
        religion: "",
        nationality: "",
        category: "",
        caste: "",
        occupation: "",
        residenceType: "",

        contactInformation: {
          mobileNo: "",
          mobileNoTwo: "",
          email: "",
        },

        kycDetails: {
          udyamRegistrationNo: "",
          docType: "",
          aadharNo: "",
          docNo: "",
        },

        permanentAddressInformation: {
          AddressAsPerAdhar: "",
          // landmark: "",
          nameOfCity: "",
          city: "",
          state: "",
          districtName: "",
          pinCode: "",
          noOfyearsAtCurrentAddress: "",
          country: "India",
          residenceType: "",
        },

        presentAddressInformation: {
          presentAddress: "",
          fullAddress: "",
          landmark: "",
          nameOfCity: "",
          addressLine1: "",
          addressLine2: "",
          city: "",
          state: "",
          districtName: "",
          pinCode: "",
          noOfyearsAtCurrentAddress: "",
          country: "India",
        },

        employeDetails: {
          education: "",
          occupation: "",
          monthlyIncome: "",
          otherMonthlyIncome: "",
          sourceOfOtherIncome: "",
          annualIncome: "",
          totalHouseHoldExpenses: "",
        },
      };
    }

    return success(res, "Customer co-applicant details", {
      data: responseData,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

// ----------------------FIle Stage Status Update APi-------------------------------
async function fileStageStatusUpdate(req, res){
  try {
      const { customerId, fileStage } = req.body;

      const validKeys = [
          'dealSummaryBranch',
          'cibilBranch',
          'creditPdBranch',
          'sanctionDetailBranch',
          'preDisbursementBranch',
          'partnerSelectionHo',
          'sanctionHo',
          'nachAndEsignHo',
          'postDisbursementHo'
      ];

      if (!customerId) {
          return badRequest(res, 'customerId is required');
      }

      if (!fileStage || !validKeys.includes(fileStage)) {
          return badRequest(res,'Invalid fileStage key provided');
      }

      // Prepare dynamic update object
      const update = { [`fileStage.${fileStage}`]: true };

      const fileStageDetail = await processModel.findOneAndUpdate(
          { customerId },
          { $set: update },
          { new: true }
      );

      if (!fileStageDetail) {
          return notFound(res,'Process model not found for the given customerId');
      }
       // Filter response to only include customerId and fileStage
       const responseData = {
        customerId: fileStageDetail.customerId,
        fileStage: fileStageDetail.fileStage
    };


      success(res, `${fileStage} updated to true for customerId`, responseData);
     } catch (error) {
      console.error(error);
      unknownError(res, error);
  }
}

// --------------------File Stage Get APi------------------------------
async function getFileStageForAllCustomers(req, res) {
  try {
    const { 
      page, 
      limit,
      regionalBranch,
      branch,
      product,
      selfAssignEmployee,
      startDateFilter,
      endDateFilter,
      finalApproverStatus,
      fileProcessStatus,
      searchQuery,
      sanctionStage
    } = req.query;
    
    const pageNumber = parseInt(page) || 1;
    const limitNumber = parseInt(limit) || 10;
    const skip = (pageNumber - 1) * limitNumber;
    
    // Date filtering logic from finalApprovalDashboardUpdate
    const today = new Date();
    const defaultStartDate = new Date(today.setHours(0, 0, 0, 0));
    const defaultEndDate = new Date(today.setHours(23, 59, 59, 999));

    function formatDateToISO(date) {
      return new Date(date).toISOString();
    }

    let formattedStart = startDateFilter && startDateFilter !== "all"
      ? new Date(new Date(startDateFilter).setHours(0, 0, 0, 0))
      : defaultStartDate;

    let formattedEnd = endDateFilter && endDateFilter !== "all"
      ? new Date(new Date(endDateFilter).setHours(23, 59, 59, 999))
      : defaultEndDate;

    if (startDateFilter && endDateFilter && startDateFilter === endDateFilter) {
      formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
      formattedEnd = new Date(new Date(startDateFilter).setHours(23, 59, 59, 999));
    }

    formattedStart = formatDateToISO(formattedStart);
    formattedEnd = formatDateToISO(formattedEnd);
    
    // Using aggregation pipeline to get complete customer data
    const aggregationPipeline = [
      // Initial match for eligible customers
      {
        $match: {
          statusByCreditPd: { $in: ["complete", "approve"] },
          fileStatus: "active"
        }
      },
      
      // All necessary lookups to gather customer data
      {
        $lookup: {
          from: "customerdetails",
          localField: "customerId",
          foreignField: "_id",
          as: "customerDetailData"
        }
      },
      { 
        $unwind: { 
          path: "$customerDetailData",
          preserveNullAndEmptyArrays: true 
        }
      },
      
      {
        $lookup: {
          from: "employees",
          localField: "customerDetailData.employeId",
          foreignField: "_id",
          as: "salesPerson"
        }
      },
      {
        $unwind: {
          path: "$salesPerson",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "newbranches",
          localField: "salesPerson.branchId",
          foreignField: "_id",
          as: "branchDetails"
        }
      },
      {
        $unwind: {
          path: "$branchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "newbranches",
          localField: "branchDetails.regionalBranchId",
          foreignField: "_id",
          as: "regionalBranchDetails"
        }
      },
      {
        $unwind: {
          path: "$regionalBranchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "employees",
          localField: "salesPerson.reportingManagerId",
          foreignField: "_id",
          as: "reportingManager"
        }
      },
      {
        $unwind: {
          path: "$reportingManager",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "applicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "applicantDetails"
        }
      },
      {
        $unwind: {
          path: "$applicantDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "employees",
          localField: "creditPdId",
          foreignField: "_id",
          as: "pdEmployeeDetail"
        }
      },
      {
        $unwind: {
          path: "$pdEmployeeDetail",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "products",
          localField: "customerDetailData.productId",
          foreignField: "_id",
          as: "productDetailData"
        }
      },
      {
        $unwind: {
          path: "$productDetailData",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "customerId",
          foreignField: "customerId",
          as: "finalsanctionData"
        }
      },
      {
        $unwind: {
          path: "$finalsanctionData",
          preserveNullAndEmptyArrays: true
        }
      },
      
      {
        $lookup: {
          from: "lenders",
          localField: "finalsanctionData.partnerId",
          foreignField: "_id",
          as: "partnerDetails"
        }
      },
      {
        $unwind: {
          path: "$partnerDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      
      // Additional lookup for self assign employee from finalApprovalDashboardUpdate
      {
        $lookup: {
          from: "employees",
          localField: "finalsanctionData.employeeId",
          foreignField: "_id",
          as: "selfAssignEmployee"
        }
      },
      {
        $unwind: {
          path: "$selfAssignEmployee",
          preserveNullAndEmptyArrays: true
        }
      },
      
      // Additional lookup for bank statement data from finalApprovalDashboardUpdate
      {
        $lookup: {
          from: "bankstatementkycs",
          localField: "customerId",
          foreignField: "customerId",
          as: "bankstatementkycData"
        }
      },
      {
        $unwind: {
          path: "$bankstatementkycData",
          preserveNullAndEmptyArrays: true
        }
      },
      
      // Lookup to the process model to get fileStage data
      {
        $lookup: {
          from: "processes",
          localField: "customerId",
          foreignField: "customerId",
          as: "processData"
        }
      },
      {
        $unwind: {
          path: "$processData",
          preserveNullAndEmptyArrays: true
        }
      },
      
      // Apply filters after lookups
      {
        $match: {
          $and: [
            // Search query
            searchQuery ? {
              $or: [
                { "applicantDetails.mobileNo": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fullName": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fatherName": { $regex: searchQuery, $options: "i" } },
                { "customerDetailData.customerFinId": { $regex: searchQuery, $options: "i" } }
              ]
            } : {},

            // Branch filter
            branch && branch !== "all" ? {
              "branchDetails._id": {
                $in: (Array.isArray(branch) ? branch : branch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Regional branch filter
            regionalBranch && regionalBranch !== "all" ? {
              "regionalBranchDetails._id": {
                $in: (Array.isArray(regionalBranch) ? regionalBranch : regionalBranch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Product filter
            product && product !== "all" ? {
              "customerDetailData.productId": {
                $in: (Array.isArray(product) ? product : product.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // SanctionStage filter
            sanctionStage ? 
              sanctionStage === "partnerNotSelect" ? 
                { "finalsanctionData.partnerId": null } : 
              sanctionStage === "sanctionDetailNotComplete" ?
                {
                  $or: [
                    { "vendors.vendorType": "legal", "vendors.statusByVendor": { $ne: "approve" } },
                    { "vendors.vendorType": "technical", "vendors.statusByVendor": { $ne: "complete" } },
                    { "vendors.vendorType": "rcu", "vendors.statusByVendor": { $ne: "notRequired" } }
                  ]
                } :
              sanctionStage === "sanctionDetailComplete" ?
                {
                  $and: [
                    { $or: [
                        { "vendors.vendorType": "legal", "vendors.statusByVendor": "approve" },
                        { "vendors": { $not: { $elemMatch: { vendorType: "legal" } } } }
                      ]
                    },
                    { $or: [
                        { "vendors.vendorType": "technical", "vendors.statusByVendor": "complete" },
                        { "vendors": { $not: { $elemMatch: { vendorType: "technical" } } } }
                      ]
                    },
                    { $or: [
                        { "vendors.vendorType": "rcu", "vendors.statusByVendor": "notRequired" },
                        { "vendors": { $not: { $elemMatch: { vendorType: "rcu" } } } }
                      ]
                    },
                    { "finalsanctionData.sendToPartnerSanctionStatus": { $ne: "complete" } }
                  ]
                } : 
                {}
              : {},

            // finalApproverStatus filter
            finalApproverStatus && finalApproverStatus !== "partnerNotSelect" ? {
              $and: finalApproverStatus.split(",").map(statusKey => ({
                [`finalsanctionData.${statusKey}`]: "complete"
              }))
            } : {},

            // Special case for finalApproverStatus=partnerNotSelect
            finalApproverStatus === "partnerNotSelect" ? {
              "finalsanctionData.partnerId": null
            } : {},

            // fileProcessStatus filter
            fileProcessStatus ? {
              $and: fileProcessStatus.split(",").map(statusKey => ({
                [`finalsanctionData.${statusKey}`]: "complete"
              }))
            } : {},

            // Date range filter
            startDateFilter && endDateFilter && startDateFilter !== "all" && endDateFilter !== "all" ? {
              creditPdCompleteDate: {
                $gte: formattedStart,
                $lt: formattedEnd,
              }
            } : {},
            
            // Self assign employee filter
            selfAssignEmployee && selfAssignEmployee !== "all" ? {
              "finalsanctionData.employeeId": {
                $in: (Array.isArray(selfAssignEmployee) ? selfAssignEmployee : selfAssignEmployee.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},
            
            // Exclude specific products when no product filter
            (!product || product === "all") ? {
              "customerDetailData.productId": {
                $nin: [].map(id => new ObjectId(id))
              }
            } : {}
          ].filter(condition => Object.keys(condition).length > 0)
        }
      },
      
      {
        $addFields: {
          vendors: [
            // RM Vendor
            {
              vendorType: "rm",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rm"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "notAssign"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rm"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // RCU Vendor
            {
              vendorType: "rcu",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rcu"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "notRequired"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rcu"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // Legal Vendor
            {
              vendorType: "legal",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "legal"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "approve"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "legal"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // Technical Vendor
            {
              vendorType: "technical",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "technical"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "complete"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "technical"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            },
            
            // Tagging Vendor
            {
              vendorType: "tagging",
              statusByVendor: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "tagging"] }
                          }
                        },
                        in: "$$this.statusByVendor"
                      }
                    }
                  },
                  "WIP"
                ]
              },
              fileStageStatus: {
                $ifNull: [
                  {
                    $first: {
                      $map: {
                        input: {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "tagging"] }
                          }
                        },
                        in: "$$this.fileStageStatus"
                      }
                    }
                  },
                  ""
                ]
              }
            }
          ]
        }
      },
      
      // Add calculated fields with additional fields from finalApprovalDashboardUpdate
      {
        $addFields: {
          customerId: "$customerDetailData._id",
          productName: { $ifNull: ["$productDetailData.productName", ""] },
          partnerName: { $ifNull: ["$partnerDetails.fullName", ""] },
          regionalBranchName: { $ifNull: ["$regionalBranchDetails.name", ""] },
          branchName: { $ifNull: ["$branchDetails.name", ""] },
          loginDate: { $ifNull: ["$customerDetailData.createdAt", ""] },
          customerFinId: { $ifNull: ["$customerDetailData.customerFinId", ""] },
          customerFullName: { $ifNull: ["$applicantDetails.fullName", ""] },
          customerFatherName: { $ifNull: ["$applicantDetails.fatherName", ""] },
          mobileNo: { $ifNull: ["$applicantDetails.mobileNo", ""] },
          salesPersonName: "$salesPerson.employeName",
          salesPersonManagerName: "$reportingManager.employeName",
          pdPersonName: "$pdEmployeeDetail.employeName",
          finalLoanAmount: { $ifNull: ["$finalsanctionData.finalLoanAmount", ""] },
          tenureInMonth: { $ifNull: ["$finalsanctionData.tenureInMonth", ""] },
          roi: { $ifNull: ["$finalsanctionData.roi", ""] },
          selfAssignEmployeeName: { $ifNull: ["$selfAssignEmployee.employeName", ""] },
          selfAssignStatus: { $ifNull: ["$finalsanctionData.finalSenctionFileSelfAssign", false] },
          selfAssignEmployee: { $ifNull: ["$finalsanctionData.employeeId", null] },
          // Additional fields from finalApprovalDashboardUpdate
          esignLinks: "$finalsanctionData.esignLinks",
          esignStatus: {
            $cond: {
              if: {
                $or: [
                  { $eq: ["$finalsanctionData.esignLinks", null] },
                  { $eq: ["$finalsanctionData.esignLinks", {}] },
                  {
                    $and: [
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.applicant", ""] }, ""] },
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.coApplicant", ""] }, ""] },
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.coApplicantTwo", ""] }, ""] }
                    ]
                  }
                ]
              },
              then: "No",
              else: "Yes"
            }
          },
          Nachlink: {
            $cond: {
              if: { 
                $or: [
                  { $eq: ["$bankstatementkycData.Nachlink", null] }, 
                  { $eq: ["$bankstatementkycData.Nachlink", ""] }
                ] 
              },
              then: "NO",
              else: "YES"
            }
          },
          incomeSanctionStatus: { $ifNull: ["$finalsanctionData.incomeSanctionStatus", ""] },
          sendToPartnerPostDisbursedStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPostDisbursedStatus", ""] },
          sendToPartnerPreDisbursedStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPreDisbursedStatus", ""] },
          sendToPartnerSanctionStatus: { $ifNull: ["$finalsanctionData.sendToPartnerSanctionStatus", ""] },
          fileProcessRejectStatus: { $ifNull: ["$finalsanctionData.fileProcessRejectStatus", ""] },
          fileStage: {
            $cond: {
              if: { $eq: ["$processData", null] },
              then: {},
              else: { $ifNull: ["$processData.fileStage", {}] }
            }
          },
          fileStageForms: {
            $cond: {
              if: { $eq: ["$processData", null] },
              then: {},
              else: { $ifNull: ["$processData.fileStageForms", {}] }
            }
          }
        }
      },
      
      // Group by customerId
      {
        $group: {
          _id: "$customerId",
          customerFinId: { $first: "$customerFinId" },
          customerId: { $first: "$customerId" },
          loginDate: { $first: "$loginDate" },
          branchName: { $first: "$branchName" },
          productName: { $first: "$productName" },
          partnerName: { $first: "$partnerName" },
          regionalBranchName: { $first: "$regionalBranchName" },
          salesPersonName: { $first: "$salesPersonName" },
          customerFullName: { $first: "$customerFullName" },
          customerFatherName: { $first: "$customerFatherName" },
          mobileNo: { $first: "$mobileNo" },
          salesPersonManagerName: { $first: "$salesPersonManagerName" },
          pdPersonName: { $first: "$pdPersonName" },
          creditPdCompleteDate: { $first: "$creditPdCompleteDate" },
          statusByCreditPd: { $first: "$statusByCreditPd" },
          roi: { $first: "$roi" },
          tenureInMonth: { $first: "$tenureInMonth" },
          finalLoanAmount: { $first: "$finalLoanAmount" },
          vendors: { $first: "$vendors" },
          fileStage: { $first: "$fileStage" },
          fileStageForms: { $first: "$fileStageForms" },
          // Additional fields from finalApprovalDashboardUpdate
          esignLinks: { $first: "$esignLinks" },
          esignStatus: { $first: "$esignStatus" },
          Nachlink: { $first: "$Nachlink" },
          selfAssignEmployeeName: { $first: "$selfAssignEmployeeName" },
          selfAssignStatus: { $first: "$selfAssignStatus" },
          selfAssignEmployee: { $first: "$selfAssignEmployee" },
          incomeSanctionStatus: { $first: "$incomeSanctionStatus" },
          sendToPartnerPostDisbursedStatus: { $first: "$sendToPartnerPostDisbursedStatus" },
          sendToPartnerPreDisbursedStatus: { $first: "$sendToPartnerPreDisbursedStatus" },
          sendToPartnerSanctionStatus: { $first: "$sendToPartnerSanctionStatus" },
          fileProcessRejectStatus: { $first: "$fileProcessRejectStatus" }
        }
      },
      
      // Adding counts like finalApprovalDashboardUpdate
      {
        $facet: {
          totalCount: [{ $count: "total" }],
          paginatedResults: [
            { $skip: skip },
            { $limit: limitNumber }
          ],
          notAssignCount: [
            { $match: { selfAssignEmployee: null } },
            { $count: "count" }
          ],
          selfAssignCount: [
            { $match: { selfAssignEmployee: { $ne: null } } },
            { $count: "count" }
          ],
          incomeSanctionStatus: [
            { $match: { incomeSanctionStatus: "complete" } },
            { $count: "count" }
          ],
          fileProcessRejectStatus: [
            { $match: { fileProcessRejectStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerPostDisbursedStatus: [
            { $match: { sendToPartnerPostDisbursedStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerPreDisbursedStatus: [
            { $match: { sendToPartnerPreDisbursedStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerSanctionStatus: [
            { $match: { sendToPartnerSanctionStatus: "complete" } },
            { $count: "count" }
          ]
        }
      }
    ];
    
    const results = await externalVendorFormModel
      .aggregate(aggregationPipeline)
      .allowDiskUse(true);
    
    const total = results[0]?.totalCount[0]?.total || 0;
    const responseData = results[0]?.paginatedResults || [];
    
    if (responseData.length === 0) {
      return notFound(res, 'No eligible customer data found for this page');
    }
    
    const totalPages = Math.ceil(total / limitNumber);
    
    // Calculate count metrics like finalApprovalDashboardUpdate
    const notAssignCount = results[0]?.notAssignCount[0]?.count || 0;
    const selfAssignCount = results[0]?.selfAssignCount[0]?.count || 0;
    const incomeSanctionStatusCount = results[0]?.incomeSanctionStatus[0]?.count || 0;
    const fileProcessRejectStatusCount = results[0]?.fileProcessRejectStatus[0]?.count || 0;
    const sendToPartnerPostDisbursedStatusCount = results[0]?.sendToPartnerPostDisbursedStatus[0]?.count || 0;
    const sendToPartnerPreDisbursedStatusCount = results[0]?.sendToPartnerPreDisbursedStatus[0]?.count || 0;
    const sendToPartnerSanctionStatusCount = results[0]?.sendToPartnerSanctionStatus[0]?.count || 0;
    
    success(res, 'Customer data with file stages fetched successfully', {
      total,
      page: pageNumber,
      limit: limitNumber,
      totalPages,
      data: responseData,
      counts: {
        notAssignCount,
        selfAssignCount,
        incomeSanctionStatus: incomeSanctionStatusCount,
        fileProcessRejectStatus: fileProcessRejectStatusCount,
        sendToPartnerPostDisbursedStatus: sendToPartnerPostDisbursedStatusCount,
        sendToPartnerPreDisbursedStatus: sendToPartnerPreDisbursedStatusCount,
        sendToPartnerSanctionStatus: sendToPartnerSanctionStatusCount
      },
      pagination: {
        totalRecords: total,
        currentPage: pageNumber,
        pageSize: limitNumber,
        totalPages
      }
    });
  } catch (error) {
    console.error(error);
    unknownError(res, error);
  }
}

const updateLenderProduct = async(req, res) => {
  try {
    const { customerId,lenderProdcutId } = req.body;
      const partnerData = await finalModel.findOneAndUpdate({ customerId },
        {
          $set:{
            lenderProdcutId:lenderProdcutId
          }
        },
        {
          new:true
        }
      )
     
    success(res, "document details",{
      data:partnerData.lenderProdcutId
    });
  } catch (error) {
    console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
  }
};

const customerPolicyCheck = async(req, res) => {
  try {
    const { customerId } = req.query;
    const customerData = await customerModel.findOne({_id:customerId})
    .populate("branch", "name") 
    .populate("productId", "productName")
    .populate("employeId", "employeName")
    // console.log(customerData,"customerData<<>><<>>")
      const appData = await applicantModel.findOne({ customerId });
      const cibilData = await cibilModel.findOne({ customerId }).populate("customerId");
      const coAppData = await coApplicantModel.find({ customerId });
      const technicalData = await technicalApproveFormModel.findOne({ customerId });
      const creditPdData = await creditPdModel.findOne({ customerId });
      const partnerData = await finalModel.findOne({ customerId }).populate('partnerId');
      const guarantorDetails = await guarantorModel.findOne({ customerId });
      const approveTechnicalDetails = await approverFormModel.findOne({ customerId })
      const finalData = await finalModel.findOne({ customerId })
      const customerObjectId = mongoose.Types.ObjectId.isValid(customerId)
        ? new mongoose.Types.ObjectId(customerId)
        : customerId;
      let links = (finalData?.signEsignLink && Object.keys(finalData.signEsignLink).length > 0)
        ? finalData.signEsignLink
        : finalData?.esignLinks;
      // console.log(customerDocumentDetails, "customerDocumentDetails")
  
      // Function to extract all income source photos
      const extractIncomeSourcePhotos = (creditPdData) => {
        const allPhotos = [];
        
        if (creditPdData?.incomeSource && Array.isArray(creditPdData.incomeSource)) {
          creditPdData.incomeSource.forEach(source => {
            // Extract agriculture photos
            if (source.agricultureBusiness?.agriculturePhotos && Array.isArray(source.agricultureBusiness.agriculturePhotos)) {
              allPhotos.push(...source.agricultureBusiness.agriculturePhotos);
            }
            
            // Extract milk business photos (milk photos and animal photos)
            if (source.milkBusiness) {
              if (source.milkBusiness.milkPhotos && Array.isArray(source.milkBusiness.milkPhotos)) {
                allPhotos.push(...source.milkBusiness.milkPhotos);
              }
              if (source.milkBusiness.animalPhotos && Array.isArray(source.milkBusiness.animalPhotos)) {
                allPhotos.push(...source.milkBusiness.animalPhotos);
              }
            }
            
            // Extract salary income photos
            if (source.salaryIncome) {
              if (source.salaryIncome.last3MonthSalarySlipPhotos && Array.isArray(source.salaryIncome.last3MonthSalarySlipPhotos)) {
                allPhotos.push(...source.salaryIncome.last3MonthSalarySlipPhotos);
              }
              if (source.salaryIncome.salaryPhotos && Array.isArray(source.salaryIncome.salaryPhotos)) {
                allPhotos.push(...source.salaryIncome.salaryPhotos);
              }
              if (source.salaryIncome.bankStatementPhoto) {
                allPhotos.push(source.salaryIncome.bankStatementPhoto);
              }
              if (source.salaryIncome.salaryCredited6Month) {
                allPhotos.push(source.salaryIncome.salaryCredited6Month);
              }
            }
            
            // Extract other business photos
            if (source.other?.incomeOtherImages && Array.isArray(source.other.incomeOtherImages)) {
              allPhotos.push(...source.other.incomeOtherImages);
            }
          });
        }
        
        // Remove duplicates and filter out empty values
        return [...new Set(allPhotos)].filter(photo => photo);
      };
  
      // Extract income source photos
      const incomeSourcePhotos = extractIncomeSourcePhotos(creditPdData);
      let monthlyIncome = ""; // Initialize monthlyIncome
      let aggreLand = 0;
      function getRoundedEMI(emi) {
        if (emi === undefined || emi === null) return ""; // Return empty string for null or undefined
        return Math.round(emi); // Round off the EMI value to the nearest integer
      }
      if (partnerData?.partnerId?.fullName === 'grow money capital pvt ltd' || partnerData?.partnerId?.fullName === 'GROW MONEY CAPITAL PVT LTD') {
        monthlyIncome = getRoundedEMI(partnerData?.totalIncomeMonthlyCalculation?.totalFormula) || "";
       // Safely calculate the total of AreaCultivationAcres
       aggreLand = partnerData?.agricultureIncome?.details[0]?.AreaCultivationAcres;   
       }
       else {
        monthlyIncome = getRoundedEMI(partnerData?.netCalculation?.totalNetMonthlyIncome) || "";
        aggreLand = partnerData?.agricultureRatnaIncome?.details[0]?.AreaCultivationAcres;
      }

      // console.log(partnerData?.partnerId,"partnerData?.partnerIdpartnerData?.partnerId")
      
      let lenderDetail = await lenderModel
      .findOne({_id:partnerData?.partnerId})
      .populate("branchId", "name") // Only select name and location fields
      .populate("productId", "productName")
      .populate("employeeId", "employeName") // Only select name and price fields
      .populate({
        path: "policy",
        populate: [
          {
            path: "productId",
            model: "lenderProduct",
            select: "name",
          }
        ],
      })

      // console.log(lenderDetail.policy,"lenderDetaillenderDetail<<>><<>>",lenderDetail.fullName)

              // Extract the lender product ID from partner data
              const lenderProductId = partnerData?.lenderProdcutId;
               // console.log(lenderProductId,"lenderProductIdlenderProductIdlenderProductId")
              // Find matching policy for the lender product ID
              const matchingPolicy = lenderDetail?.policy?.find(policy => 
                policy.productId?._id?.toString() === lenderProductId?.toString()
              );
              
              if (!matchingPolicy) {
                return badRequest(res, "No matching policy found for this product");
              }
       
              const customerValues = {
                loanAmount: parseFloat(partnerData?.finalLoanAmount || 0),
                tenure: parseInt(partnerData?.tenureInMonth || 0),
                ageOfApplicant: parseInt(appData?.age || 0),
                ageOfPropertyOwner: parseInt(appData?.age || 0),
                cibilScore: parseInt(cibilData?.applicantCibilScore || 0),
                minimumMonthlyFamilyIncome: partnerData?.netCalculationNew?.overAllTotalNetMonthlyIncome,
                foir: parseFloat(partnerData?.netCalculationNew?.foir || 0),
                ageOfCoBorrower: parseInt(coAppData[0]?.age || 0),
                cibilScoreCoBorrower: parseInt(cibilData?.coApplicantData[0]?.coApplicantCibilScore || 0),
                ageOfGuarantor: parseInt(guarantorDetails?.age || 0),
                cibilScoreGuarantor: parseInt(cibilData?.guarantorCibilScore || 0),
                propertyArea: parseFloat(technicalData?.totalLandArea || 0),
                ltv: technicalData?.Ltv,//,
                minimumAgricultureLand: partnerData?.agricultureIncomeNew?.details[0]?.AreaInAcres || 0// parseFloat(aggreLand || 0)
              };
              
              console.log(customerValues,"customerValues")
              // Build the result with policy checks
              const policyCheckResult = {};
              
              const checkValue = (key, value, policyRange) => {
                if (!policyRange) return { value, checkStatus: "N/A" };
              
                const min = parseFloat(policyRange.min || 0);
                const max = parseFloat(policyRange.max || Infinity);
                let checkStatus = "No";
              
                if (key.includes("cibilScore")) {
                  // CIBIL Score Condition (≤ 300 is Yes, ≥ 650 is Yes)
                  if (value <= 300 || value >= 650) {
                    checkStatus = "Yes"; 
                  } else {
                    checkStatus = "No"; 
                  }
                } else if (key === "ltv" || key === "foir") {
                  // Extract numeric value and convert it to a number
                  const numericValue = parseFloat(value.toString().replace("%", "")); 
              
                  // LTV Condition (≤ 50 is Yes, > 50 is No)
                  checkStatus = numericValue !== "" && numericValue <= 50 ? "Yes" : "No";
              } else {
                  // General range check for other fields
                  checkStatus = value >= min && (max === Infinity || value <= max) ? "Yes" : "No";
                }

                  // Ensure 'upto' appears only for 'ltv' and 'foir'
              //  const maxValueLabel = (key === "ltv" || key === "foir") ? "" : (max === Infinity ? "no limit" : max);
              
                return {
                  value,
                  policyRange: (key === "ltv" || key === "foir") ? `upto ${min}` : `${min} - ${max === Infinity ? "no limit" : max}`,
                  checkStatus
                };
              };
          
              for (const [key, value] of Object.entries(customerValues)) {
                if (matchingPolicy[key]) {
                  policyCheckResult[key] = checkValue(key, value, matchingPolicy[key]);
                }
              }
          
              const isCompliant = Object.values(policyCheckResult).every(check =>
                check.checkStatus === "Yes" || check.checkStatus === "N/A"
              );
          
              return success(res, "Policy check completed", {
                isCompliant,
                policyDetails: policyCheckResult
              });
            } catch (error) {
              console.error("Error in sendToPartnerSanction:", error);
              return unknownError(res, error);
            }
};

const customerAllData = async(req, res) => {
  try {
    const { customerId } = req.query;
    const customerData = await customerModel.findOne({_id:customerId})
    .populate("branch", "name") 
    .populate("productId", "productName")
    .populate("employeId", "employeName")
    const finalData = await finalModel.findOne({customerId}).populate('lenderProdcutId')
    // console.log(finalData,"finalDatafinalData")
    const gtrCoappData = await guarantorStatementDetails.findOne({customerId})
    const loanDocument = await loanDocumentModel.findOne({ customerId });

    // console.log(finalData,"finalData<<<<<>>>>>><<>>")
    
              return success(res, "customer details", {
                employeeId: customerData?.employeId || "",
                productId:  customerData?.productId || "",
                branchId: customerData?.branch || "",
                lenderProdcutId : finalData?.lenderProdcutId || "",
                sanctionZipUrl: finalData?.sanctionZipUrl || "",
                gtrCoAppBankDetails:gtrCoappData || {},
                camReport: loanDocument?.camReport || "",
                incomesectionLatterUrl: finalData?.incomesectionLatterUrl || "",
                enderProdcutId: finalData?.lenderProdcutId || ""
              });
            } catch (error) {
              console.error("Error in sendToPartnerSanction:", error);
              return unknownError(res, error);
            }
};

//check document for the sanction
const customerDocumentCheck = async(req, res) => {
  try {
    const { customerId } = req.query;
    console.log(customerId, "customerIdcustomerId");
    const externalVendorFormData = await externalVendorFormModel.findOne({
      customerId,
    });
    const creditPdData = await creditPdModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const disbursementData = await disbursementModel.findOne({ customerId });
    const coApplicantData = await coApplicantModel.find({ customerId });
    const applicantData = await applicantModel.findOne({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const cibilData = await cibilModel.findOne({ customerId });
    const loanDocumentData = await loanDocumentModel.findOne({ customerId });
    const SignKycDetails = await SignKycModel.findOne({ customerId });
    const finalData = await finalModel.findOne({ customerId })
    const customerObjectId = mongoose.Types.ObjectId.isValid(customerId)
      ? new mongoose.Types.ObjectId(customerId)
      : customerId;
    console.log(customerObjectId, "customerObjectId")
    const customerDocumentDetails = await customerDocumentModel.findOne({ customerId: customerObjectId });
    const loanDocument = await loanDocumentModel.findOne({ customerId });
    const bankStatementData = await bankStatementModel.findOne({ customerId })

    let links = (finalData?.signEsignLink && Object.keys(finalData.signEsignLink).length > 0)
      ? finalData.signEsignLink
      : finalData?.esignLinks;

    const rcuVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rcu"
    );
    const legalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "legal"
    );
    const technicalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "technical"
    );
    const rmVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rm"
    );
    const taggingVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "tagging"
    );

    // Function to extract all income source photos
    const extractIncomeSourcePhotos = (creditPdData) => {
      const allPhotos = [];
      
      if (creditPdData?.incomeSource && Array.isArray(creditPdData.incomeSource)) {
        creditPdData.incomeSource.forEach(source => {
          // Extract agriculture photos
          if (source.agricultureBusiness?.agriculturePhotos && Array.isArray(source.agricultureBusiness.agriculturePhotos)) {
            allPhotos.push(...source.agricultureBusiness.agriculturePhotos);
          }
          
          // Extract milk business photos (milk photos and animal photos)
          if (source.milkBusiness) {
            if (source.milkBusiness.milkPhotos && Array.isArray(source.milkBusiness.milkPhotos)) {
              allPhotos.push(...source.milkBusiness.milkPhotos);
            }
            if (source.milkBusiness.animalPhotos && Array.isArray(source.milkBusiness.animalPhotos)) {
              allPhotos.push(...source.milkBusiness.animalPhotos);
            }
          }
          
          // Extract salary income photos
          if (source.salaryIncome) {
            if (source.salaryIncome.last3MonthSalarySlipPhotos && Array.isArray(source.salaryIncome.last3MonthSalarySlipPhotos)) {
              allPhotos.push(...source.salaryIncome.last3MonthSalarySlipPhotos);
            }
            if (source.salaryIncome.salaryPhotos && Array.isArray(source.salaryIncome.salaryPhotos)) {
              allPhotos.push(...source.salaryIncome.salaryPhotos);
            }
            if (source.salaryIncome.bankStatementPhoto) {
              allPhotos.push(source.salaryIncome.bankStatementPhoto);
            }
            if (source.salaryIncome.salaryCredited6Month) {
              allPhotos.push(source.salaryIncome.salaryCredited6Month);
            }
          }
          
          // Extract other business photos
          if (source.other?.incomeOtherImages && Array.isArray(source.other.incomeOtherImages)) {
            allPhotos.push(...source.other.incomeOtherImages);
          }
        });
      }
      
      // Remove duplicates and filter out empty values
      return [...new Set(allPhotos)].filter(photo => photo);
    };

    // Extract income source photos
    const incomeSourcePhotos = extractIncomeSourcePhotos(creditPdData);

    let lenderDetail = await lenderModel
    .findOne({ _id: finalData?.partnerId })
    .select('sanctionChecklist');

    console.log(lenderDetail,"lenderDetaillenderDetaillenderDetail")

    const responseData = {
          utilityBillAndResiProof:
          customerDocumentDetails?.incomeDocument?.utilityBillDocument || [],
          familyCard:
          customerDocumentDetails?.incomeDocument?.familyCardDocument || [],
          udyamCertificate:
          customerDocumentDetails?.incomeDocument?.udyamCertificateDocument ||
          [],
          bankStatement:
          customerDocumentDetails?.incomeDocument?.bankStatementDocument || [],
          incomeDocument:
          customerDocumentDetails?.incomeDocument?.incomeStatemenDocument || [],
          propertyDocument:
          customerDocumentDetails?.propertyDocuments?.propertyDocument || [],
          applicantKycSelfAttested: customerDocumentDetails?.signApplicantKyc || [],
          coApplicantKycSelfAttested: customerDocumentDetails?.signCoApplicantKyc || [],
          secondCoApplicantKycSelfAttested:
          customerDocumentDetails?.signCoTwoApplicantKyc || [],
          guarantorKycSelfAttested: customerDocumentDetails?.signGurantorKyc || [],
        //
        applicantKycOsv: SignKycDetails?.ApplicantSignDocument || "",
        coApplicantKycOsv: SignKycDetails?.coApplicantSignDocument || "",
        gurantorKycOsv: SignKycDetails?.guarantorSignDocument || "",
        applicantKycNoSignNoOsv: {
          applicantAadharFrontImage:
            applicantData?.kycUpload?.aadharFrontImage || "",
          applicantAadharBackImage:
            applicantData?.kycUpload?.aadharBackImage || "",
          applicantPanFrontImage: applicantData?.kycUpload?.panFrontImage || "",
          applicantDrivingLicenceImage:
            applicantData?.kycUpload?.drivingLicenceImage || "",
          applicantVoterIdImage: applicantData?.kycUpload?.voterIdImage || "",
        },
        coApplicantKycNoSignNoOsv: {
          coApplicantKycAadharFrontImage:
            coApplicantData[0]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycAadharBackImage:
            coApplicantData[0]?.kycUpload?.aadharBackImage || "",
          // coApplicantKycDocType:coApplicantData[0]?.kycUpload?.docImage || "",
          coApplicantKycDocImage: coApplicantData[0]?.kycUpload?.docImage || "",
        },
        secondCoApplicantKycNoSignNoOsv: {
          coApplicantKycTwoAadharFrontImage:
            coApplicantData[1]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycTwoAadharBackImage:
            coApplicantData[1]?.kycUpload?.aadharBackImage || "",
          coApplicantKycTwoDocImage:
            coApplicantData[1]?.kycUpload?.docImage || "",
        },
        guarantorKycNoSignNoOsv: {
          gurantorAadharFrontImage:
            guarantorData?.kycUpload?.aadharFrontImage || "",
          gurantorAadharBackImage:
            guarantorData?.kycUpload?.aadharBackImage || "",
          gurantorDocImage: guarantorData?.kycUpload?.docImage || "",
        },
        applicantCibilReport: cibilData?.applicantFetchHistory?.slice(-1)[0]?.cibilReport || "",
        coApplicantCibilReport:
          Array.isArray(cibilData?.coApplicantData[0]?.coApplicantFetchHistory)
            ? cibilData.coApplicantData[0].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        secondCoApplicantCibilReport:
          Array.isArray(cibilData?.coApplicantData[1]?.coApplicantFetchHistory)
            ? cibilData.coApplicantData[0].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        guarantorCibilReport: cibilData?.guarantorFetchHistory?.slice(-1)[0]?.cibilReport || "",
        pdReport: creditPdData?.pdfLink || "",
        rcuReport: rcuVendor?.uploadProperty || [],
        legalReport: legalVendor?.uploadProperty || [],
        technicalReport: technicalVendor?.uploadProperty || [],
        taggingReport: taggingVendor?.uploadProperty || [],
        housePhotos: [
          ...(Array.isArray(creditPdData?.fourBoundaryPhotos)
            ? creditPdData?.fourBoundaryPhotos
            : [creditPdData?.fourBoundaryPhotos]),
          ...(Array.isArray(creditPdData?.houseInsidePhoto)
            ? creditPdData?.houseInsidePhoto
            : [creditPdData?.houseInsidePhoto]),
          ...(Array.isArray(creditPdData?.propertyOtherPhotos)
            ? creditPdData?.propertyOtherPhotos
            : [creditPdData?.propertyOtherPhotos]),
          creditPdData?.selfiWithCustomer || "",
          creditPdData?.photoWithLatLong || "",
          creditPdData?.front || "",
          creditPdData?.leftSide || "",
          creditPdData?.rightSide || "",
          creditPdData?.approachRoad || "",
          creditPdData?.mainRoad || "",
          creditPdData?.interiorRoad || "",
          creditPdData?.selfieWithProperty || "",
          creditPdData?.landmarkPhoto || "",
          creditPdData?.latLongPhoto || "",
        ].filter(Boolean),
        // workPhotos: creditPdData?.workPhotos || [],
        // workPhotosDetails: "Recive from creditPd form",
        workPhotos: creditPdData?.workPhotos || [],
        camReport: loanDocument?.camReport || "",
        dualNameDeclaration: loanDocumentData?.dualNameDeclaration || "",
        dualSignDeclaration: loanDocumentData?.dualSignDeclaration || "",
        dualDobDeclaration: loanDocumentData?.dualDoBDeclaration || "",
        applicantPDC: appPdcData?.applicantPdcDocument || [],
        guarantorPDC: gtrPdcData?.guarantorPdcDocument || [],
        applicantBSV: loanDocumentData?.applicantBSV || "",
        guarantorBSV: loanDocumentData?.guarantorBSV || "",
        coOwnershipDeed: loanDocumentData?.coOwnershipDeed || "",
        eStampUpload:
          disbursementData?.estampRequirement?.flatMap(
            (stamp) => stamp.eStampUpload || []
          ) || [],
        insuranceFormWithCalculator: loanDocumentData?.insuranceForm || "",
        emOrRmDeed: loanDocumentData?.emOrRmDeed || "",
        finalLegal: legalVendor?.finalLegalUpload || "",
        vettingReport: loanDocument?.vettingReport || "",
        eNachScreenshort: disbursementData?.eNachLinkSignUpload || "",
        eSignatureDocuments: disbursementData?.eSignatureDocuments || "",
        appKycDocument: loanDocument?.appKycDocument || [],
        coAppKycDocument: loanDocument?.coAppKycDocument || [],
        formSixteenSelfAttested: loanDocument?.form60 || [],
        stampPaper: loanDocumentData?.stampPdf || [],
        applicationForm: finalData?.ratnaPdfUrls?.applicantionLatter || finalData?.fcplPdfUrls?.fincooperApplicantPdf || finalData?.growMoneyPdfUrls?.growApplicantPdf || finalData?.naamDevPdflink?.naamDevApplicantPdf || "",
        sanctionLatter: finalData?.ratnaPdfUrls?.sectionLatter || finalData?.fcplPdfUrls?.fincooperSanctionLetterPdf || finalData?.growMoneyPdfUrls?.growSanctionLetterPdf || finalData?.naamDevPdflink?.naamDevSanctionLetter || "",
        loanDocument:  finalData?.fcplPdfUrls?.fincooperLoanAgreement || finalData?.growMoneyPdfUrls?.rcplLoanAgreement|| finalData?.naamDevPdflink?.naamDevLoanPdf || "",
        pdDeed: finalData?.ratnaPdfUrls?.LdAndPdDeed || finalData?.fcplPdfUrls?.fincooperPgDeedPdf || finalData?.growMoneyPdfUrls?.growPgDeedPdf|| ""

    };

    console.log(responseData,"responseData<><><><>")
    const allDocuments = [
      { name: "PD REPORT", key: "pdReport" },
      { name: "TECHNICAL REPORT", key: "technicalReport" },
      { name: "LEGAL REPORT (Sanction)", key: "legalReport" },
      { name: "RCU REPORT", key: "rcuReport" },
      { name: "APPLICANT CIBIL REPORT", key: "applicantCibilReport" },
      { name: "CO-APPLICANT CIBIL REPORT", key: "coApplicantCibilReport" },
      { name: "2nd CO-APPLICANT CIBIL REPORT", key: "secondCoApplicantCibilReport" },
      { name: "GUARANTOR CIBIL REPORT", key: "guarantorCibilReport" },
      { name: "APPLICANT KYC (NO SIGN , NO OSV )", key: "applicantKycNoSignNoOsv" },
      { name: "CO-APPLICANT KYC (NO SIGN , NO OSV )", key: "coApplicantKycNoSignNoOsv" },
      { name: "2nd CO-APPLICANT KYC (NO SIGN , NO OSV )", key: "secondCoApplicantKycNoSignNoOsv" },
      { name: "GUARANTOR KYC (NO SIGN , NO OSV )", key: "guarantorKycNoSignNoOsv" },
      { name: "HOUSE PHOTOS", key: "housePhotos" },
      { name: "WORK PHOTOS", key: "workPhotos" },
      { name: "CAM REPORT", key: "camReport" },
      { name: "APPLICANT KYC (SELF ATTESTED)", key: "applicantKycSelfAttested" },
      { name: "CO-APPLICANT KYC (SELF ATTESTED)", key: "coApplicantKycSelfAttested" },
      { name: "2nd CO-APPLICANT KYC (SELF ATTESTED)", key: "secondCoApplicantKycSelfAttested" },
      { name: "GUARANTOR KYC (SELF ATTESTED)", key: "guarantorKycSelfAttested" },
      { name: "FORM 60 (SELF ATTESTED)", key: "formSixteenSelfAttested" },
      { name: "INSURANCE FORM WITH CALCULATOR", key: "insuranceFormWithCalculator" },
      { name: "DUAL NAME DECLARATION", key: "dualNameDeclaration" },
      { name: "DUAL SIGN DECLARATION", key: "dualSignDeclaration" },
      { name: "DUAL DOB DECLARATION", key: "dualDobDeclaration" },
      { name: "APPLICANT PDC", key: "applicantPdc" },
      { name: "GUARANTOR PDC", key: "guarantorPdc" },
      { name: "APPLICANT BSV", key: "applicantBsv" },
      { name: "GUARANTOR BSV", key: "guarantorBsv" },
      { name: "E-NACH (Screenshot)", key: "eNachScreenshort" },
      { name: "STAMP PAPER", key: "stampPaper" },
      { name: "APPLICATION FORM", key: "applicationForm" },
      { name: "SANCTION LETTER", key: "sanctionLatter" },
      { name: "LOAN DOCUMENT", key: "loanDocument" },
      { name: "PG DEED", key: "pdDeed" },
      { name: "E-SIGNATURE DOCUMENTS", key: "eSignatureDocuments" },
      { name: "TAGGING REPORT", key: "taggingReport" },
      { name: "CO-OWNERSHIP DEED", key: "coOwnershipDeed" },
      { name: "EM/RM DEED", key: "emRmDeed" },
      { name: "LEGAL REPORT (FINAL)", key: "legalReportFinal" },
      { name: "VETTING REPORT", key: "vettingReport" },
      ]
    // This will hold the final checklist
const checklist = [];

// Go through each document in sanctionChecklist
if (lenderDetail?.sanctionChecklist) {
    lenderDetail.sanctionChecklist.forEach((documentKey) => {
        const document = allDocuments.find(doc => doc.key === documentKey);
        if (document) {
            const documentName = document.name;

            // Check if the document exists in responseData and has value
            const documentValue = responseData[documentKey];

            // Logic to check for presence (handling arrays, objects, strings, etc.)
            let isPresent = false;
            if (Array.isArray(documentValue)) {
                isPresent = documentValue.length > 0;  // non-empty array
            } else if (typeof documentValue === 'object') {
                isPresent = Object.values(documentValue).some(val => val);  // check object values
            } else {
                isPresent = !!documentValue;  // check for string/boolean presence
            }

            checklist.push({
                name: documentName,
                status: isPresent ? "Yes" : "No"
            });
        }
    });
}

// Add this checklist to the final response
// responseData.sanctionChecklistStatus = checklist;

// Finally, send the response with updated data
return success(res, "All documents link", checklist);
    
    // return success(res, "All documents link", responseData);
  } catch (error) {
   console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
   }
};


//generate document zip
const generateDocumentZip = async(req, res) => {
  try {
    const { customerId } = req.query;
    // console.log(customerId, "customerIdcustomerId");
    const externalVendorFormData = await externalVendorFormModel.findOne({
      customerId,
    });
    const creditPdData = await creditPdModel.findOne({ customerId });
    const gtrPdcData = await gtrPdcModel.findOne({ customerId });
    const appPdcData = await appPdcModel.findOne({ customerId });
    const disbursementData = await disbursementModel.findOne({ customerId });
    const coApplicantData = await coApplicantModel.find({ customerId });
    const applicantData = await applicantModel.findOne({ customerId });
    const guarantorData = await guarantorModel.findOne({ customerId });
    const cibilData = await cibilModel.findOne({ customerId });
    const loanDocumentData = await loanDocumentModel.findOne({ customerId });
    const SignKycDetails = await SignKycModel.findOne({ customerId });
    const finalData = await finalModel.findOne({ customerId })
    const customerObjectId = mongoose.Types.ObjectId.isValid(customerId)
      ? new mongoose.Types.ObjectId(customerId)
      : customerId;
    console.log(customerObjectId, "customerObjectId")
    const customerDocumentDetails = await customerDocumentModel.findOne({ customerId: customerObjectId });
    const loanDocument = await loanDocumentModel.findOne({ customerId });
    const bankStatementData = await bankStatementModel.findOne({ customerId })

    let links = (finalData?.signEsignLink && Object.keys(finalData.signEsignLink).length > 0)
      ? finalData.signEsignLink
      : finalData?.esignLinks;

    const rcuVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rcu"
    );
    const legalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "legal"
    );
    const technicalVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "technical"
    );
    const rmVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "rm"
    );
    const taggingVendor = externalVendorFormData?.vendors.find(
      (vendor) => vendor.vendorType === "tagging"
    );

    // Function to extract all income source photos
    const extractIncomeSourcePhotos = (creditPdData) => {
      const allPhotos = [];
      
      if (creditPdData?.incomeSource && Array.isArray(creditPdData.incomeSource)) {
        creditPdData.incomeSource.forEach(source => {
          // Extract agriculture photos
          if (source.agricultureBusiness?.agriculturePhotos && Array.isArray(source.agricultureBusiness.agriculturePhotos)) {
            allPhotos.push(...source.agricultureBusiness.agriculturePhotos);
          }
          
          // Extract milk business photos (milk photos and animal photos)
          if (source.milkBusiness) {
            if (source.milkBusiness.milkPhotos && Array.isArray(source.milkBusiness.milkPhotos)) {
              allPhotos.push(...source.milkBusiness.milkPhotos);
            }
            if (source.milkBusiness.animalPhotos && Array.isArray(source.milkBusiness.animalPhotos)) {
              allPhotos.push(...source.milkBusiness.animalPhotos);
            }
          }
          
          // Extract salary income photos
          if (source.salaryIncome) {
            if (source.salaryIncome.last3MonthSalarySlipPhotos && Array.isArray(source.salaryIncome.last3MonthSalarySlipPhotos)) {
              allPhotos.push(...source.salaryIncome.last3MonthSalarySlipPhotos);
            }
            if (source.salaryIncome.salaryPhotos && Array.isArray(source.salaryIncome.salaryPhotos)) {
              allPhotos.push(...source.salaryIncome.salaryPhotos);
            }
            if (source.salaryIncome.bankStatementPhoto) {
              allPhotos.push(source.salaryIncome.bankStatementPhoto);
            }
            if (source.salaryIncome.salaryCredited6Month) {
              allPhotos.push(source.salaryIncome.salaryCredited6Month);
            }
          }
          
          // Extract other business photos
          if (source.other?.incomeOtherImages && Array.isArray(source.other.incomeOtherImages)) {
            allPhotos.push(...source.other.incomeOtherImages);
          }
        });
      }
      
      // Remove duplicates and filter out empty values
      return [...new Set(allPhotos)].filter(photo => photo);
    };

    // Extract income source photos
    const incomeSourcePhotos = extractIncomeSourcePhotos(creditPdData);

    let lenderDetail = await lenderModel
    .findOne({ _id: finalData?.partnerId })
    .select('sanctionChecklist');

    console.log(lenderDetail,"lenderDetaillenderDetaillenderDetail")

    const responseData = {
          utilityBillAndResiProof:
          customerDocumentDetails?.incomeDocument?.utilityBillDocument || [],
          familyCard:
          customerDocumentDetails?.incomeDocument?.familyCardDocument || [],
          udyamCertificate:
          customerDocumentDetails?.incomeDocument?.udyamCertificateDocument ||
          [],
          bankStatement:
          customerDocumentDetails?.incomeDocument?.bankStatementDocument || [],
          incomeDocument:
          customerDocumentDetails?.incomeDocument?.incomeStatemenDocument || [],
          propertyDocument:
          customerDocumentDetails?.propertyDocuments?.propertyDocument || [],
          applicantKycSelfAttested: customerDocumentDetails?.signApplicantKyc || [],
          coApplicantKycSelfAttested: customerDocumentDetails?.signCoApplicantKyc || [],
          secondCoApplicantKycSelfAttested:
          customerDocumentDetails?.signCoTwoApplicantKyc || [],
          guarantorKycSelfAttested: customerDocumentDetails?.signGurantorKyc || [],
        //
        applicantKycOsv: SignKycDetails?.ApplicantSignDocument || "",
        coApplicantKycOsv: SignKycDetails?.coApplicantSignDocument || "",
        gurantorKycOsv: SignKycDetails?.guarantorSignDocument || "",
        applicantKycNoSignNoOsv: {
          applicantAadharFrontImage:
            applicantData?.kycUpload?.aadharFrontImage || "",
          applicantAadharBackImage:
            applicantData?.kycUpload?.aadharBackImage || "",
          applicantPanFrontImage: applicantData?.kycUpload?.panFrontImage || "",
          applicantDrivingLicenceImage:
            applicantData?.kycUpload?.drivingLicenceImage || "",
          applicantVoterIdImage: applicantData?.kycUpload?.voterIdImage || "",
        },
        coApplicantKycNoSignNoOsv: {
          coApplicantKycAadharFrontImage:
            coApplicantData[0]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycAadharBackImage:
            coApplicantData[0]?.kycUpload?.aadharBackImage || "",
          // coApplicantKycDocType:coApplicantData[0]?.kycUpload?.docImage || "",
          coApplicantKycDocImage: coApplicantData[0]?.kycUpload?.docImage || "",
        },
        secondCoApplicantKycNoSignNoOsv: {
          coApplicantKycTwoAadharFrontImage:
            coApplicantData[1]?.kycUpload?.aadharFrontImage || "",
          coApplicantKycTwoAadharBackImage:
            coApplicantData[1]?.kycUpload?.aadharBackImage || "",
          coApplicantKycTwoDocImage:
            coApplicantData[1]?.kycUpload?.docImage || "",
        },
        guarantorKycNoSignNoOsv: {
          gurantorAadharFrontImage:
            guarantorData?.kycUpload?.aadharFrontImage || "",
          gurantorAadharBackImage:
            guarantorData?.kycUpload?.aadharBackImage || "",
          gurantorDocImage: guarantorData?.kycUpload?.docImage || "",
        },
        applicantCibilReport: cibilData?.applicantFetchHistory?.slice(-1)[0]?.cibilReport || "",
        coApplicantCibilReport:
          Array.isArray(cibilData?.coApplicantData[0]?.coApplicantFetchHistory)
            ? cibilData.coApplicantData[0].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        secondCoApplicantCibilReport:
          Array.isArray(cibilData?.coApplicantData[1]?.coApplicantFetchHistory)
            ? cibilData.coApplicantData[0].coApplicantFetchHistory.slice(-1)[0]?.cibilReport
            : "",
        guarantorCibilReport: cibilData?.guarantorFetchHistory?.slice(-1)[0]?.cibilReport || "",
        pdReport: creditPdData?.pdfLink || "",
        rcuReport: rcuVendor?.uploadProperty || [],
        legalReport: legalVendor?.uploadProperty || [],
        technicalReport: technicalVendor?.uploadProperty || [],
        taggingReport: taggingVendor?.uploadProperty || [],
        housePhotos: [
          ...(Array.isArray(creditPdData?.fourBoundaryPhotos)
            ? creditPdData?.fourBoundaryPhotos
            : [creditPdData?.fourBoundaryPhotos]),
          ...(Array.isArray(creditPdData?.houseInsidePhoto)
            ? creditPdData?.houseInsidePhoto
            : [creditPdData?.houseInsidePhoto]),
          ...(Array.isArray(creditPdData?.propertyOtherPhotos)
            ? creditPdData?.propertyOtherPhotos
            : [creditPdData?.propertyOtherPhotos]),
          creditPdData?.selfiWithCustomer || "",
          creditPdData?.photoWithLatLong || "",
          creditPdData?.front || "",
          creditPdData?.leftSide || "",
          creditPdData?.rightSide || "",
          creditPdData?.approachRoad || "",
          creditPdData?.mainRoad || "",
          creditPdData?.interiorRoad || "",
          creditPdData?.selfieWithProperty || "",
          creditPdData?.landmarkPhoto || "",
          creditPdData?.latLongPhoto || "",
        ].filter(Boolean),
        // workPhotos: creditPdData?.workPhotos || [],
        // workPhotosDetails: "Recive from creditPd form",
        workPhotos: incomeSourcePhotos || [],
        camReport: loanDocument?.camReport || "",
        dualNameDeclaration: loanDocumentData?.dualNameDeclaration || "",
        dualSignDeclaration: loanDocumentData?.dualSignDeclaration || "",
        dualDobDeclaration: loanDocumentData?.dualDoBDeclaration || "",
        applicantPDC: appPdcData?.applicantPdcDocument || [],
        guarantorPDC: gtrPdcData?.guarantorPdcDocument || [],
        applicantBSV: loanDocumentData?.applicantBSV || "",
        guarantorBSV: loanDocumentData?.guarantorBSV || "",
        coOwnershipDeed: loanDocumentData?.coOwnershipDeed || "",
        eStampUpload:
          disbursementData?.estampRequirement?.flatMap(
            (stamp) => stamp.eStampUpload || []
          ) || [],
        insuranceFormWithCalculator: loanDocumentData?.insuranceForm || "",
        emOrRmDeed: loanDocumentData?.emOrRmDeed || "",
        finalLegal: legalVendor?.finalLegalUpload || "",
        vettingReport: loanDocument?.vettingReport || "",
        eNachScreenshort: disbursementData?.eNachLinkSignUpload || "",
        eSignatureDocuments: disbursementData?.eSignatureDocuments || "",
        appKycDocument: loanDocument?.appKycDocument || [],
        coAppKycDocument: loanDocument?.coAppKycDocument || [],
        formSixteenSelfAttested: loanDocument?.form60 || [],
        stampPaper: loanDocumentData?.stampPdf || [],
    };

    const allDocuments = [
      { name: "PD REPORT", key: "pdReport" },
      { name: "TECHNICAL REPORT", key: "technicalReport" },
      { name: "LEGAL REPORT (Sanction)", key: "legalReport" },
      { name: "RCU REPORT", key: "rcuReport" },
      { name: "APPLICANT CIBIL REPORT", key: "applicantCibilReport" },
      { name: "CO-APPLICANT CIBIL REPORT", key: "coApplicantCibilReport" },
      { name: "2nd CO-APPLICANT CIBIL REPORT", key: "secondCoApplicantCibilReport" },
      { name: "GUARANTOR CIBIL REPORT", key: "guarantorCibilReport" },
      { name: "APPLICANT KYC (NO SIGN , NO OSV )", key: "applicantKycNoSignNoOsv" },
      { name: "CO-APPLICANT KYC (NO SIGN , NO OSV )", key: "coApplicantKycNoSignNoOsv" },
      { name: "2nd CO-APPLICANT KYC (NO SIGN , NO OSV )", key: "secondCoApplicantKycNoSignNoOsv" },
      { name: "GUARANTOR KYC (NO SIGN , NO OSV )", key: "guarantorKycNoSignNoOsv" },
      { name: "HOUSE PHOTOS", key: "housePhotos" },
      { name: "WORK PHOTOS", key: "workPhotos" },
      { name: "CAM REPORT", key: "camReport" },
      { name: "APPLICANT KYC (SELF ATTESTED)", key: "applicantKycSelfAttested" },
      { name: "CO-APPLICANT KYC (SELF ATTESTED)", key: "coApplicantKycSelfAttested" },
      { name: "2nd CO-APPLICANT KYC (SELF ATTESTED)", key: "secondCoApplicantKycSelfAttested" },
      { name: "GUARANTOR KYC (SELF ATTESTED)", key: "guarantorKycSelfAttested" },
      { name: "FORM 60 (SELF ATTESTED)", key: "formSixteenSelfAttested" },
      { name: "INSURANCE FORM WITH CALCULATOR", key: "insuranceFormWithCalculator" },
      { name: "DUAL NAME DECLARATION", key: "dualNameDeclaration" },
      { name: "DUAL SIGN DECLARATION", key: "dualSignDeclaration" },
      { name: "DUAL DOB DECLARATION", key: "dualDobDeclaration" },
      { name: "APPLICANT PDC", key: "applicantPdc" },
      { name: "GUARANTOR PDC", key: "guarantorPdc" },
      { name: "APPLICANT BSV", key: "applicantBsv" },
      { name: "GUARANTOR BSV", key: "guarantorBsv" },
      { name: "E-NACH (Screenshot)", key: "eNachScreenshort" },
      { name: "STAMP PAPER", key: "stampPaper" },
      { name: "APPLICATION FORM", key: "applicationForm" },
      { name: "SANCTION LETTER", key: "sanctionLatter" },
      { name: "LOAN DOCUMENT", key: "loanDocument" },
      { name: "PG DEED", key: "pdDeed" },
      { name: "E-SIGNATURE DOCUMENTS", key: "eSignatureDocuments" },
      { name: "TAGGING REPORT", key: "taggingReport" },
      { name: "CO-OWNERSHIP DEED", key: "coOwnershipDeed" },
      { name: "EM/RM DEED", key: "emRmDeed" },
      { name: "LEGAL REPORT (FINAL)", key: "legalReportFinal" },
      { name: "VETTING REPORT", key: "vettingReport" },
      ]
   
      // const docMap = Object.fromEntries(allDocuments.map(doc => [doc.key, doc.name]));

      // // Generating the final object dynamically
      // const finalDocumentObject = {};
      // lenderDetail.sanctionChecklist.forEach(docKey => {
      //     if (docMap[docKey]) {
      //         finalDocumentObject[docKey] = docMap[docKey];  // Assigning document name
      //     }
      // });

      const finalDocumentObject = {};

      lenderDetail.sanctionChecklist.forEach(key => {
                if (responseData.hasOwnProperty(key)) {
                    finalDocumentObject[key] = responseData[key];
                }
            });
      // Console Output
      console.log(finalDocumentObject);
      const timestamp = Date.now();
      const type = "sanctionDocument"
      try {
        const filesToZip = [];
    
        // Recursive function to process all types of values (string, array, object)
        const processDocument = (key, value, parentKey = "") => {
            if (!value) return; // Skip if value is null, undefined, or empty string
            
            const keyPath = parentKey ? `${parentKey}_${key}` : key;
    
            if (Array.isArray(value)) {
                // If value is an array (multiple URLs)
                value.forEach((url, index) => {
                    if (url && url.trim() !== "") {
                        const fileExtension = url.split(".").pop().toLowerCase() || "pdf";
                        filesToZip.push({
                            url: url,
                            name: `${keyPath.replace(/[^a-zA-Z0-9-_]/g, "_")}_${index + 1}.${fileExtension}`
                        });
                    }
                });
            } else if (typeof value === "string") {
                // If value is a single URL string
                if (value.trim() !== "") {
                    const fileExtension = value.split(".").pop().toLowerCase() || "pdf";
                    filesToZip.push({
                        url: value,
                        name: `${keyPath.replace(/[^a-zA-Z0-9-_]/g, "_")}.` + fileExtension
                    });
                }
            } else if (typeof value === "object") {
                // If value is an object (nested KYC documents)
                Object.keys(value).forEach(nestedKey => {
                    processDocument(nestedKey, value[nestedKey], keyPath);
                });
            }
        };
    
        // Loop through each document type and process it
        for (const key of Object.keys(finalDocumentObject)) {
            processDocument(key, finalDocumentObject[key]);
        }
    
        console.log(`Preparing to zip ${filesToZip.length} files`);
    
        if (filesToZip.length > 0) {
            const zipFileName = `${customerId}_${timestamp}_${type}_documents.zip`;
            zipFilePath = await uploadZip(filesToZip, zipFileName);
            console.log(zipFilePath,"zipFilePathzipFilePath")
        }
    } catch (error) {
        console.error("Error preparing zip:", error);
    }

    await finalModel.findOneAndUpdate(
      { customerId },
      { $set: { sanctionZipUrl: zipFilePath } },
      { new: true, upsert: true }
    );

    return success(res, "All documents link", zipFilePath);
  } catch (error) {
   console.error("Error in sendToPartnerSanction:", error);
    return unknownError(res, error);
   }
};

const finalMainDashboard = async (req, res) => {
  try {
    const {
      regionalBranch,
      branch,
      product,
      hoSelfAssign,
      branchSelfAssign,
      startDateFilter,
      endDateFilter,
      finalApproverStatus,
      fileProcessStatus,
      pageLimit = 10000,
      pageNumber = 1,
      searchQuery,
      sanctionStage,
    } = req.query;

    const employeeId = req.Id;

    const activeVendors = await vendorTypeModel.find({ status: "active" }).select("vendorType");
    const vendorTypes = activeVendors.map(v => v.vendorType);
    // Basic validation
    const employeeExist = await employeModel
      .findOne({ _id: employeeId, status: "active" }, { _id: 1 })
      .lean();

    if (!employeeExist) {
      return badRequest(res, "Employee Not Found");
    }

    const today = new Date();
    const defaultStartDate = new Date(today.setHours(0, 0, 0, 0));
    const defaultEndDate = new Date(today.setHours(23, 59, 59, 999));

    function formatDateToISO(date) {
      return new Date(date).toISOString();
    }

    let formattedStart = startDateFilter && startDateFilter !== "all"
      ? new Date(new Date(startDateFilter).setHours(0, 0, 0, 0))
      : defaultStartDate;

    let formattedEnd = endDateFilter && endDateFilter !== "all"
      ? new Date(new Date(endDateFilter).setHours(23, 59, 59, 999))
      : defaultEndDate;

    if (startDateFilter && endDateFilter && startDateFilter === endDateFilter) {
      formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
      formattedEnd = new Date(new Date(startDateFilter).setHours(23, 59, 59, 999));
    }

    formattedStart = formatDateToISO(formattedStart);
    formattedEnd = formatDateToISO(formattedEnd);

    // Step 1: Get all customer IDs that match initial criteria
    const initialPipeline = [
      // Initial basic match
      {
        $match: {
          fileStatus: "active",
          statusByCreditPd: { $in: ["complete", "approve"] },
        }
      },
      
      // Only lookup what's needed for filtering
      {
        $lookup: {
          from: "customerdetails",
          localField: "customerId",
          foreignField: "_id",
          as: "customerDetailData"
        }
      },
      { 
        $unwind: { 
          path: "$customerDetailData",
          preserveNullAndEmptyArrays: true 
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "customerDetailData.branch",
          foreignField: "_id",
          as: "branchDetails"
        }
      },
      {
        $unwind: {
          path: "$branchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "branchDetails.regionalBranchId",
          foreignField: "_id",
          as: "regionalBranchDetails"
        }
      },
      {
        $unwind: {
          path: "$regionalBranchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "applicantDetails"
        }
      },
      {
        $unwind: {
          path: "$applicantDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "customerId",
          foreignField: "customerId",
          as: "finalsanctionData"
        }
      },
      {
        $unwind: {
          path: "$finalsanctionData",
          preserveNullAndEmptyArrays: true
        }
      },
// Apply all filters 
      {
        $match: {
          $and: [
            // Search query
            searchQuery ? {
              $or: [
                { "applicantDetails.mobileNo": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fullName": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fatherName": { $regex: searchQuery, $options: "i" } },
                { "customerDetailData.customerFinId": { $regex: searchQuery, $options: "i" } }
              ]
            } : {},

            // Branch filter
            branch && branch !== "all" ? {
              "branchDetails._id": {
                $in: (Array.isArray(branch) ? branch : branch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Regional branch filter
            regionalBranch && regionalBranch !== "all" ? {
              "regionalBranchDetails._id": {
                $in: (Array.isArray(regionalBranch) ? regionalBranch : regionalBranch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Product filter
            product && product !== "all" ? {
              "customerDetailData.productId": {
                $in: (Array.isArray(product) ? product : product.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // SanctionStage filter
            sanctionStage === "partnerNotSelect" ? { "finalsanctionData.partnerId": null } : {},

            // finalApproverStatus filter
            finalApproverStatus && finalApproverStatus !== "partnerNotSelect" ? {
              $and: finalApproverStatus.split(",").map(statusKey => ({
                [`finalsanctionData.${statusKey}`]: "complete"
              }))
            } : {},

            // Special case for finalApproverStatus=partnerNotSelect
            finalApproverStatus === "partnerNotSelect" ? {
              "finalsanctionData.partnerId": null
            } : {},

            fileProcessStatus
            ? {
                $and: fileProcessStatus.split(",").map(statusKey => ({
                  [`finalsanctionData.${statusKey}`]: "complete"
                }))
              }
            : {},

            // startDateFilter && endDateFilter && startDateFilter !== "all" && endDateFilter !== "all"? {
            //   creditPdCompleteDate: {
            //     $gte: formattedStart,
            //     $lt: formattedEnd,
            //   }
            // }:{},
            
            hoSelfAssign && hoSelfAssign !=="all"?{
              "finalsanctionData.employeeId": {
                $in: (Array.isArray(hoSelfAssign) ? hoSelfAssign : hoSelfAssign.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},
            
            // Exclude specific products when no product filter
            (!product || product === "all") ? {
              "customerDetailData.productId": {
                $nin: [].map(id => new ObjectId(id))
              }
            } : {}
          ].filter(condition => Object.keys(condition).length > 0)
        }
      },
    
      // Only project customer IDs for the next stage
      {
        $project: {
          _id: 1,
          customerId: 1
        }
      },
    ];
// Execute the initial pipeline to get filtered customer IDs
    const filteredCustomers = await externalVendorFormModel
      .aggregate(initialPipeline)
      .allowDiskUse(true);

    // Extract customer IDs from the filtered results
    const customerIds = filteredCustomers.map(item => item.customerId);

    // If no customers match the criteria, return empty result
    if (customerIds.length === 0) {
      return success(res, "customerDetails", {
        totalCount: 0,
        notAssignCount: 0,
        selfAssignCount: 0,
        incomeSanctionStatus: 0,
        fileProcessRejectStatus: 0,
        sendToPartnerPostDisbursedStatus: 0,
        sendToPartnerPreDisbursedStatus: 0,
        sendToPartnerSanctionStatus: 0,
        fileDetails: [],
        pagination: {
          totalRecords: 0,
          currentPage: Number(pageNumber),
          pageSize: Number(pageLimit),
          totalPages: 0,
        }
      });
    }

    // Step 2: Fetch complete data for the filtered customer IDs in a second pipeline
    const detailPipeline = [
      // Start with filtered customer IDs
      {
        $match: {
          customerId: { $in: customerIds }
        }
      },
// Perform all lookups in a single batch to reduce pipeline size
      {
        $lookup: {
          from: "customerdetails",
          localField: "customerId",
          foreignField: "_id",
          as: "customerDetailData"
        }
      },
      {
        $lookup: {
          from: "employees",
          localField: "customerDetailData.employeId",
          foreignField: "_id",
          as: "salesPerson"
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "customerDetailData.branch",
          foreignField: "_id",
          as: "branchDetails"
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "branchDetails.regionalBranchId",
          foreignField: "_id",
          as: "regionalBranchDetails"
        }
      },
      {
        $lookup: {
          from: "employees",
          localField: "salesPerson.reportingManagerId",
          foreignField: "_id",
          as: "reportingManager"
        }
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "applicantDetails"
        }
      },
      {
        $lookup: {
          from: "employees",
          localField: "creditPdId",
          foreignField: "_id",
          as: "pdEmployeeDetail"
        }
      },
      {
        $lookup: {
          from: "products",
          localField: "customerDetailData.productId",
          foreignField: "_id",
          as: "productDetailData"
        }
      },
      {
        $lookup: {
          from: "internallegals",
          localField: "customerId",
          foreignField: "customerId",
          as: "loanTypeDetail"
        }
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "customerId",
          foreignField: "customerId",
          as: "finalsanctionData"
        }
      },
      {
        $lookup: {
          from: "employees",
          localField: "finalsanctionData.employeeId",
          foreignField: "_id",
          as: "selfAssignEmployee"
        }
      },
      {
        $lookup: {
          from: "employees",
          localField: "finalsanctionData.branchSelfAssignEmpId",
          foreignField: "_id",
          as: "branchSelfAssignEmployee"
        }
      },
      {
        $lookup: {
          from: "lenders",
          localField: "finalsanctionData.partnerId",
          foreignField: "_id",
          as: "partnerDetails"
        }
      },
      {
        $lookup: {
          from: "bankstatementkycs",
          localField: "customerId",
          foreignField: "customerId",
          as: "bankstatementkycData"
        }
      },
      {
        $lookup: {
          from: "processes",
          localField: "customerId",
          foreignField: "customerId",
          as: "processData"
        }
      },
      {
        $lookup: {
          from: "customerdocuments",
          localField: "customerId",
          foreignField: "customerId",
          as: "customerDocuments"
        }
      },
      {
        $lookup: {
          from: "pdformdatas",
          localField: "customerId",
          foreignField: "customerId",
          as: "creditPdData"
        }
      },
      {
        $lookup: {
          from: "gtrpdcs",
          localField: "customerId",
          foreignField: "customerId",
          as: "gtrPdcData"
        }
      },
      {
        $lookup: {
          from: "apppdcs",
          localField: "customerId",
          foreignField: "customerId",
          as: "appPdcData"
        }
      },
      {
        $lookup: {
          from: "disbursements",
          localField: "customerId",
          foreignField: "customerId",
          as: "disbursementData"
        }
      },
      {
        $lookup: {
          from: "coapplicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "coApplicantData"
        }
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "applicantData"
        }
      },
      {
        $lookup: {
          from: "guarantors",
          localField: "customerId",
          foreignField: "customerId",
          as: "guarantorData"
        }
      },
      {
        $lookup: {
          from: "cibildetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "cibilData"
        }
      },
      {
        $lookup: {
          from: "loandocumentmodels",
          localField: "customerId",
          foreignField: "customerId",
          as: "loanDocumentData"
        }
      },
      {
        $lookup: {
          from: "customerdocumentdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "SignKycDetails"
        }
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "customerId",
          foreignField: "customerId",
          as: "finalData"
        }
      },
      {
        $lookup: {
          from: "bankstatementkycs",
          localField: "customerId",
          foreignField: "customerId",
          as: "bankStatementData"
        }
      },
      {
        $lookup: {
          from: "externalvendordynamics",
          localField: "customerId",
          foreignField: "customerId",
          as: "externalvendordynamicData"
        }
      },
// Unwind arrays in a single step using $addFields instead of multiple $unwind stages
      {
        $addFields: {
          customerDetailData: { $arrayElemAt: ["$customerDetailData", 0] },
          salesPerson: { $arrayElemAt: ["$salesPerson", 0] },
          branchDetails: { $arrayElemAt: ["$branchDetails", 0] },
          regionalBranchDetails: { $arrayElemAt: ["$regionalBranchDetails", 0] },
          reportingManager: { $arrayElemAt: ["$reportingManager", 0] },
          applicantDetails: { $arrayElemAt: ["$applicantDetails", 0] },
          pdEmployeeDetail: { $arrayElemAt: ["$pdEmployeeDetail", 0] },
          productDetailData: { $arrayElemAt: ["$productDetailData", 0] },
          loanTypeDetail: { $arrayElemAt: ["$loanTypeDetail", 0] },
          finalsanctionData: { $arrayElemAt: ["$finalsanctionData", 0] },
          selfAssignEmployee: { $arrayElemAt: ["$selfAssignEmployee", 0] },
          branchSelfAssignEmployee: { $arrayElemAt: ["$branchSelfAssignEmployee", 0] },
          partnerDetails: { $arrayElemAt: ["$partnerDetails", 0] },
          bankstatementkycData: { $arrayElemAt: ["$bankstatementkycData", 0] },
          processData: { $arrayElemAt: ["$processData", 0] },
          customerDocuments: { $arrayElemAt: ["$customerDocuments", 0] },
          creditPdData: { $arrayElemAt: ["$creditPdData", 0] },
          gtrPdcData: { $arrayElemAt: ["$gtrPdcData", 0] },
          appPdcData: { $arrayElemAt: ["$appPdcData", 0] },
          disbursementData: { $arrayElemAt: ["$disbursementData", 0] },
          firstCoApplicant: { $arrayElemAt: ["$coApplicantData", 0] },
          secondCoApplicant: { $arrayElemAt: ["$coApplicantData", 1] },
          applicantData: { $arrayElemAt: ["$applicantData", 0] },
          guarantorData: { $arrayElemAt: ["$guarantorData", 0] },
          cibilData: { $arrayElemAt: ["$cibilData", 0] },
          loanDocumentData: { $arrayElemAt: ["$loanDocumentData", 0] },
          SignKycDetails: { $arrayElemAt: ["$SignKycDetails", 0] },
          finalData: { $arrayElemAt: ["$finalData", 0] },
          bankStatementData: { $arrayElemAt: ["$bankStatementData", 0] },
          externalvendordynamicData: { $arrayElemAt: ["$externalvendordynamicData", 0] }
        }
      },
// Extract vendor info and create document checks in one step
      {
        $addFields: {
          // Vendor information
          rcuVendor: {
            $arrayElemAt: [
              {
                $filter: {
                  input: "$vendors",
                  as: "vendor",
                  cond: { $eq: ["$$vendor.vendorType", "rcu"] }
                }
              },
              0
            ]
          },
          legalVendor: {
            $arrayElemAt: [
              {
                $filter: {
                  input: "$vendors",
                  as: "vendor",
                  cond: { $eq: ["$$vendor.vendorType", "legal"] }
                }
              },
              0
            ]
          },
          technicalVendor: {
            $arrayElemAt: [
              {
                $filter: {
                  input: "$vendors",
                  as: "vendor",
                  cond: { $eq: ["$$vendor.vendorType", "technical"] }
                }
              },
              0
            ]
          },
          taggingVendor: {
            $arrayElemAt: [
              {
                $filter: {
                  input: "$vendors",
                  as: "vendor",
                  cond: { $eq: ["$$vendor.vendorType", "tagging"] }
                }
              },
              0
            ]
          },
          
          // Extract esign links
          // esignLinks: {
          //   $cond: {
          //     if: {
          //       $and: [
          //         { $ne: ["$finalData.signEsignLink", null] },
          //         { $ne: ["$finalData.signEsignLink", {}] },
          //         { $gt: [{ $size: { $objectToArray: { $ifNull: ["$finalData.signEsignLink", {}] } } }, 0] }
          //       ]
          //     },
          //     then: "$finalData.signEsignLink",
          //     else: "$finalData.esignLinks"
          //   }
          // },
          esignLinks: {
            $cond: {
              if: {
                $and: [
                  { $ne: ["$finalData.signEsignLink", null] },
                  { $ne: ["$finalData.signEsignLink", {}] },
                  { $gt: [{ $size: { $objectToArray: { $ifNull: ["$finalData.signEsignLink", {}] } } }, 0] }
                ]
              },
              then: "$finalData.signEsignLink",
              else: "$finalData.esignLinks"
            }
          },
          
          // Extract latest CIBIL reports
          // latestApplicantCibilReport: {
          //   $arrayElemAt: [
          //     { $ifNull: ["$cibilData.applicantFetchHistory", []] },
          //     { $subtract: [{ $size: { $ifNull: ["$cibilData.applicantFetchHistory", []] } }, 1] }
          //   ]
          // },

          latestApplicantCibilReport: {
            $arrayElemAt: [
              { $ifNull: ["$cibilData.applicantFetchHistory", []] },
              { $subtract: [{ $size: { $ifNull: ["$cibilData.applicantFetchHistory", []] } }, 1] }
            ]
          },
          // latestGuarantorCibilReport: {
          //   $arrayElemAt: [
          //     { $ifNull: ["$cibilData.guarantorFetchHistory", []] },
          //     { $subtract: [{ $size: { $ifNull: ["$cibilData.guarantorFetchHistory", []] } }, 1] }
          //   ]
          // },

          latestGuarantorCibilReport: {
            $arrayElemAt: [
              { $ifNull: ["$cibilData.guarantorFetchHistory", []] },
              { $subtract: [{ $size: { $ifNull: ["$cibilData.guarantorFetchHistory", []] } }, 1] }
            ]
          },
// Document check info (combining many checks into a single stage)
          document: {
            SanctionCheckList: {
              // Login check list documents
              utilityBillDocument: {
                $cond: {
                  if: { $ifNull: ["$customerDocuments.incomeDocument.utilityBillDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              familyCardDocument: {
                $cond: {
                  if: { $ifNull: ["$customerDocuments.incomeDocument.familyCardDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              udyamCertificate: {
                $cond: {
                  if: { $ifNull: ["$customerDocuments.incomeDocument.udyamCertificateDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              bankStatement: {
                $cond: {
                  if: { $ifNull: ["$customerDocuments.incomeDocument.bankStatementDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              incomeDocument: {
                $cond: {
                  if: { $ifNull: ["$customerDocuments.incomeDocument.incomeStatemenDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              propertyDocument: {
                $cond: {
                  if: { $ifNull: ["$customerDocuments.propertyDocuments.propertyDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
             
              
              signApplicantKyc: {
                $cond: {
                  if: { $gt: [{ $size: { $ifNull: ["$SignKycDetails.signApplicantKyc", []] } }, 0] },
                  then: "Yes",
                  else: "No"
                }
              },
              
              signCoApplicantKyc: {
                $cond: {
                  if: { $ifNull: ["$customerDocuments.signCoApplicantKyc", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              // signCoTwoApplicantKyc: {
              //   $cond: {
              //     // if: { "$gt": [{ "$size": { "$ifNull": ["$SignKycDetails.signCoTwoApplicantKyc", []] } }, 0] },
              //     if: { $gt: [{ $size: { $ifNull: ["$SignKycDetails.signCoTwoApplicantKyc", []] } }, 0] },

              //     then: "Yes",
              //     else: "No"
              //   }
              // },

              signCoTwoApplicantKyc: {
                $cond: {
                  if: { $gt: [{ $size: { $ifNull: ["$SignKycDetails.signCoTwoApplicantKyc", []] } }, 0] },
                  then: "Yes",
                  else: "No"
                }
              },
              // signGurantorKyc: {
              //   $cond: {
              //     // if: { "$gt": [{ "$size": { "$ifNull": ["$SignKycDetails.signGurantorKyc", []] } }, 0] },
              //     if: { $gt: [{ $size: { $ifNull: ["$SignKycDetails.signGurantorKyc", []] } }, 0] },

              //     then: "Yes",
              //     else: "No"
              //   }
              // },

              signGurantorKyc: {
                $cond: {
                  if: { $gt: [{ $size: { $ifNull: ["$SignKycDetails.signGurantorKyc", []] } }, 0] },
                  then: "Yes",
                  else: "No"
                }
              },
    
// Add all additional SanctionCheckList items
              electricityBill: {
                $cond: {
                  if: { $ifNull: ["$creditPdData.utilityBillDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              samagraIdDoc: {
                $cond: {
                  if: { $ifNull: ["$creditPdData.samagraIdDetail.samagraIdDoc", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              applicantPhoto: {
                $cond: {
                  if: { $ifNull: ["$applicantData.applicantPhoto", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              coApplicantPhoto: {
                $cond: {
                  if: { $ifNull: ["$firstCoApplicant.coApplicantPhoto", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              coApplicantPhotoTwo: {
                $cond: {
                  if: { $ifNull: ["$secondCoApplicant.coApplicantPhoto", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              guarantorPhoto: {
                $cond: {
                  if: { $ifNull: ["$guarantorData.guarantorPhoto", null] },
                  then: "Yes",
                  else: "No"
                }
              },
            applicantKyc: {
                $cond: {
                  if: {
                    $or: [
                      { $ifNull: ["$applicantData.kycUpload.aadharFrontImage", null] },
                      { $ifNull: ["$applicantData.kycUpload.aadharBackImage", null] },
                      { $ifNull: ["$applicantData.kycUpload.panFrontImage", null] },
                      { $ifNull: ["$applicantData.kycUpload.drivingLicenceImage", null] },
                      { $ifNull: ["$applicantData.kycUpload.voterIdImage", null] }
                    ]
                  },
                  then: "Yes",
                  else: "No"
                }
              },
              coApplicantKyc: {
                $cond: {
                  if: {
                    $or: [
                      { $ifNull: ["$firstCoApplicant.kycUpload.aadharFrontImage", null] },
                      { $ifNull: ["$firstCoApplicant.kycUpload.aadharBackImage", null] },
                      { $ifNull: ["$firstCoApplicant.kycUpload.docImage", null] }
                    ]
                  },
                  then: "Yes",
                  else: "No"
                }
              },
              coApplicantKycTwo: {
                $cond: {
                  if: {
                    $or: [
                      { $ifNull: ["$secondCoApplicant.kycUpload.aadharFrontImage", null] },
                      { $ifNull: ["$secondCoApplicant.kycUpload.aadharBackImage", null] },
                      { $ifNull: ["$secondCoApplicant.kycUpload.docImage", null] }
                    ]
                  },
                  then: "Yes",
                  else: "No"
                }
              },
              gurantorKyc: {
                $cond: {
                  if: {
                    $or: [
                      { $ifNull: ["$guarantorData.kycUpload.aadharFrontImage", null] },
                      { $ifNull: ["$guarantorData.kycUpload.aadharBackImage", null] },
                      { $ifNull: ["$guarantorData.kycUpload.docImage", null] }
                    ]
                  },
                  then: "Yes",
                  else: "No"
                }
              },
              applicantCibilReport: {
                $cond: {
                  if: { $ifNull: ["$latestApplicantCibilReport.cibilReport", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              guarantorCibilReport: {
                $cond: {
                  if: { $ifNull: ["$latestGuarantorCibilReport.cibilReport", null] },
                  then: "Yes",
                  else: "No"
                }
              },
pdReport: {
                $cond: {
                  if: { $ifNull: ["$creditPdData.pdfLink", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              rcuReport: {
                $cond: {
                  if: { $ifNull: ["$rcuVendor.uploadProperty", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              legalReport: {
                $cond: {
                  if: { $ifNull: ["$legalVendor.uploadProperty", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              technicalReport: {
                $cond: {
                  if: { $ifNull: ["$technicalVendor.uploadProperty", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              technicalEstimateDocument: {
                $cond: {
                  if: { $ifNull: ["$technicalVendor.estimateDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              taggingReport: {
                $cond: {
                  if: { $ifNull: ["$taggingVendor.uploadProperty", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              camReport: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.camReport", null] },
                  then: "Yes",
                  else: "No"
                }
              }
            },
        disbursmentCheckList: {
              dualNameDeclaration: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.dualNameDeclaration", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              dualSignDeclaration: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.dualSignDeclaration", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              dualDoBDeclaration: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.dualDoBDeclaration", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              applicantPDC: {
                $cond: {
                  if: { $ifNull: ["$appPdcData.applicantPdcDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              guarantorPDC: {
                $cond: {
                  if: { $ifNull: ["$gtrPdcData.guarantorPdcDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              applicantBSV: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.applicantBSV", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              guarantorBSV: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.guarantorBSV", null] },
                  then: "Yes",
                  else: "No"
                }
              },
          coOwnershipDeed: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.coOwnershipDeed", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              eStampUpload: {
                $cond: {
                  if: { 
                   

                    $gt: [
                      {
                        $size: {
                          $ifNull: [
                            {
                              $reduce: {
                                input: "$disbursementData.estampRequirement",
                                initialValue: [],
                                in: { $concatArrays: ["$$value", { $ifNull: ["$$this.eStampUpload", []] }] }
                              }
                            },
                            []
                          ]
                        }
                      },
                      0
                    ]
                  },
                  then: "Yes",
                  else: "No"
                }
              },
              
              insuranceForm: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.insuranceForm", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              emOrRmDeed: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.emOrRmDeed", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              finalLegal: {
                $cond: {
                  if: { $ifNull: ["$legalVendor.finalLegalUpload", null] },
                  then: "Yes",
                  else: "No"
                }
              },
vettingReport: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.vettingReport", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              nachLink: {
                $cond: {
                  if: { $ifNull: ["$bankStatementData.Nachlink", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              eNachLinkSignUpload: {
                $cond: {
                  if: { $ifNull: ["$disbursementData.eNachLinkSignUpload", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              eSignatureDocuments: {
                $cond: {
                  if: { $ifNull: ["$disbursementData.eSignatureDocuments", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              appKycDocument: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.appKycDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              coAppKycDocument: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.coAppKycDocument", null] },
                  then: "Yes",
                  else: "No"
                }
              },
stampPdf: {
                $cond: {
                  if: { $ifNull: ["$loanDocumentData.stampPdf", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              sanctionZipUrl: {
                $cond: {
                  if: { $ifNull: ["$finalData.sanctionZipUrl", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              disbursementZipUrl: {
                $cond: {
                  if: { $ifNull: ["$finalData.disbursementZipUrl", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              incomeSectionLatterUrl: {
                $cond: {
                  if: { $ifNull: ["$finalData.incomesectionLatterUrl", null] },
                  then: "Yes",
                  else: "No"
                }
              },
              esignLinks: {
                $cond: {
                  if: { $ifNull: ["$esignLinks", null] },
                  then: "Yes",
                  else: "No"
                }
              }
            }
          },

                  
          vendors: {
            $map: {
              input: vendorTypes, // **Dynamic Vendor List**
              as: "vendorType",
              in: {
                vendorType: "$$vendorType",
                statusByVendor: {
                  $ifNull: [
                    {
                      $first: {
                        $map: {
                          input: {
                            $filter: {
                              input: "$vendors",
                              cond: { $eq: ["$$this.vendorType", "$$vendorType"] }
                            }
                          },
                          in: "$$this.statusByVendor"
                        }
                      }
                    },
                    "notAssign"
                  ]
                },
                fileStageStatus: {
                  $ifNull: [
                    {
                      $first: {
                        $map: {
                          input: {
                            $filter: {
                              input: "$vendors",
                              cond: { $eq: ["$$this.vendorType", "$$vendorType"] }
                            }
                          },
                          in: "$$this.fileStageStatus"
                        }
                      }
                    },
                    ""
                  ]
                }
              }
            }
          },
          // Ensure dates are proper date objects
          createdAtDate: {
            $cond: {
              if: { $eq: [{ $type: "$customerDetailData.createdAt" }, "date"] },
              then: "$customerDetailData.createdAt",
              else: new Date()
            }
          },
          pdCompleteDate: {
            $cond: {
              if: { $eq: [{ $type: "$creditPdCompleteDate" }, "date"] },
              then: "$creditPdCompleteDate",
              else: new Date()
            }
          },
// Convert loan details to numbers for calculation
          numericLoanAmount: { 
            $convert: { 
              input: "$finalsanctionData.finalLoanAmount", 
              to: "double",
              onError: 0,
              onNull: 0
            } 
          },
          numericRoi: { 
            $convert: { 
              input: "$finalsanctionData.roi", 
              to: "double",
              onError: 0,
              onNull: 0
            } 
          },
          numericTenure: { 
            $convert: { 
              input: "$finalsanctionData.tenureInMonth", 
              to: "int",
              onError: 0,
              onNull: 0
            } 
          },
          
          // Calculate turnaround times (TAT)
          // loginTat: {
          //   $convert: {
          //     input: {
          //       $round: [
          //         {
          //           $divide: [
          //             { $subtract: [new Date(), "$createdAtDate"] },
          //             1000 * 60 * 60 * 24 // Convert ms to days
          //           ]
          //         },
          //         0
          //       ]
          //     },
          //     to: "int",
          //     onError: 0
          //   }
          // },

          loginTat: {
            $let: {
              vars: {
                caDate: { $toDate: "$customerDetailData.paymentDate" },
                today: { $toDate: "$$NOW" }
              },
              in: {
                $cond: {
                  if: { $not: ["$$caDate"] },
                  then: null,
                  else: {
                    $ceil: {
                      $divide: [
                        {
                          $subtract: [
                            { $dateTrunc: { date: "$$today", unit: "day" } },
                            { $dateTrunc: { date: "$$caDate", unit: "day" } }
                          ]
                        },
                        86400000
                      ]
                    }
                  }
                }
              }
            }
          },          
           
          externalvendordynamicCreatedAt: { $ifNull: ["$externalvendordynamicData.createdAt", ""] },

          pdTat: {
            $let: {
              vars: {
                caDate: "$externalvendordynamicData.createdAt",
                today: "$$NOW"
              },
              in: {
                $cond: {
                  if: { $not: ["$$caDate"] },
                  then: null,
                  else: {
                    $ceil: {
                      $divide: [
                        {
                          $subtract: [
                            { $dateTrunc: { date: "$$today", unit: "day" } },
                            { $dateTrunc: { date: "$$caDate", unit: "day" } }
                          ]
                        },
                        86400000
                      ]
                    }
                  }
                }
              }
            }
          },         

// Extract vendor statuses from the vendor array
          rcuStatus: {
            $ifNull: [
              {
                $let: {
                  vars: {
                    rcu: {
                      $arrayElemAt: [
                        {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "rcu"] }
                          }
                        },
                        0
                      ]
                    }
                  },
                  in: "$$rcu.statusByVendor"
                }
              },
              "notRequired"
            ]
          },
          
          legalStatus: {
            $ifNull: [
              {
                $let: {
                  vars: {
                    legal: {
                      $arrayElemAt: [
                        {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "legal"] }
                          }
                        },
                        0
                      ]
                    }
                  },
                  in: "$$legal.statusByVendor"
                }
              },
              "approve"
            ]
          },
          
          technicalStatus: {
            $ifNull: [
              {
                $let: {
                  vars: {
                    technical: {
                      $arrayElemAt: [
                        {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "technical"] }
                          }
                        },
                        0
                      ]
                    }
                  },
                  in: "$$technical.statusByVendor"
                }
              },
              "complete"
            ]
          },
          
          taggingStatus: {
            $ifNull: [
              {
                $let: {
                  vars: {
                    tagging: {
                      $arrayElemAt: [
                        {
                          $filter: {
                            input: "$vendors",
                            cond: { $eq: ["$$this.vendorType", "tagging"] }
                          }
                        },
                        0
                      ]
                    }
                  },
                  in: "$$tagging.statusByVendor"
                }
              },
              "WIP"
            ]
          },
// Map to new field names
          selfAssignEmployee: { $ifNull: ["$finalsanctionData.employeeId", null] },
          esignStatus: {
            $cond: {
              if: {
                $or: [
                  { $eq: ["$finalsanctionData.esignLinks", null] },
                  { $eq: ["$finalsanctionData.esignLinks", {}] },
                  {
                    $and: [
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.applicant", ""] }, ""] },
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.coApplicant", ""] }, ""] },
                      { $eq: [{ $ifNull: ["$finalsanctionData.esignLinks.coApplicantTwo", ""] }, ""] }
                    ]
                  }
                ]
              },
              then: "No",
              else: "Yes"
            }
          },
          nachLink: {
            $cond: {
              if: { 
                $or: [
                  { $eq: ["$bankstatementkycData.nachLink", null] }, 
                  { $eq: ["$bankstatementkycData.nachLink", ""] }
                ] 
              },
              then: "NO",
              else: "YES"
            }
          },
          fileStageForms: {
            $cond: {
              if: { $eq: ["$processData", null] },
              then: {},
              else: { $ifNull: ["$processData.fileStageForms", {}] }
            }
          },
// Status fields
          chargesStatus: "Pending", // Default value
          mortgageStatus: "Pending", // Default value
          
          salesCompleteDate: { $ifNull: ["$processData.salesCompleteDate", ""] },
          pdCreatedAt: { $ifNull: ["$creditPdData.createdAt", ""] },
          // external vender created at

          // Query statuses
          sanctionQueryStatus: { $ifNull: ["$finalsanctionData.sendToPartnerSanctionStatus", "Pending"] },
          preDisbursementQueryStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPreDisbursedStatus", "Pending"] },
          disbursementQueryStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPostDisbursedStatus", "Pending"] },
          
          // Partner related information
          jainamLoanNo: { $ifNull: ["$finalsanctionData.jainamLoanNo", ""] },
          jainamProfileNo: { $ifNull: ["$finalsanctionData.jainamProfileNo", ""] },
          partnerLoanNo: { $ifNull: ["$finalsanctionData.partnerLoanNo", ""] },
          oldFinId: { $ifNull: ["$finalsanctionData.oldFinId", ""] },
          oldLanNo: { $ifNull: ["$finalsanctionData.oldLanNo", ""] },
          
                   // Dates
          sanctionDate: { $ifNull: ["$finalsanctionData.finalSanctionStatusDate", ""] },
          disbursementDate: { $ifNull: ["$finalsanctionData.finalDisbursementStatusDate", ""] },
          
          // Status and responsibility fields
          loanType: { $ifNull: ["$loanTypeDetail.LoanType", ""] },
          fileStatus: { $ifNull: ["$finalsanctionData.fileStatus", ""] },
          responsibility: { $ifNull: ["$finalsanctionData.responsibility", ""] },
          hoRemark: { $ifNull: ["$finalsanctionData.hoRemark", ""] },
          partnerPending: { $ifNull: ["$finalsanctionData.partnerPending", ""] }, 

          // Basic fields
          finalLoanAmount: { $ifNull: ["$finalsanctionData.finalLoanAmount", ""] },
          tenureInMonth: { $ifNull: ["$finalsanctionData.tenureInMonth", ""] },
          roi: { $ifNull: ["$finalsanctionData.roi", ""] },
          emi: { $ifNull: ["$finalsanctionData.emiAmount", ""] },
          selfAssignStatus: { $ifNull: ["$finalsanctionData.finalSenctionFileSelfAssign", false] },
          customerId: "$customerDetailData._id",
          productName: { $ifNull: ["$productDetailData.productName", ""] },
          selfAssignEmployeeName: { $ifNull: ["$selfAssignEmployee.employeName", ""] },
          branchSelfAssignEmployee: { $ifNull: ["$branchSelfAssignEmployee.employeName", ""] },
          partnerName: { $ifNull: ["$partnerDetails.fullName", ""] },
          regionalBranchName: { $ifNull: ["$regionalBranchDetails.name", ""] },
          branchName: { $ifNull: ["$branchDetails.name", ""] },
          loginDate: { $ifNull: ["$customerDetailData.createdAt", ""] },
          paymentDate: { $ifNull: ["$customerDetailData.paymentDate", ""] },
          customerFinId: { $ifNull: ["$customerDetailData.customerFinId", ""] },
          customerFullName: { $ifNull: ["$applicantDetails.fullName", ""] },
          customerFatherName: { $ifNull: ["$applicantDetails.fatherName", ""] },
          mobileNo: { $ifNull: ["$applicantDetails.mobileNo", ""] },
          salesPersonName: { $ifNull: ["$salesPerson.employeName", ""] },
          salesPersonManagerName: { $ifNull: ["$reportingManager.employeName", ""] },
          pdPersonName: { $ifNull: ["$pdEmployeeDetail.employeName", ""] },
          incomeSanctionStatus: { $ifNull: ["$finalsanctionData.incomeSanctionStatus", ""] },
          sendToPartnerPostDisbursedStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPostDisbursedStatus", ""] },
          sendToPartnerPreDisbursedStatus: { $ifNull: ["$finalsanctionData.sendToPartnerPreDisbursedStatus", ""] },
          sendToPartnerSanctionStatus: { $ifNull: ["$finalsanctionData.sendToPartnerSanctionStatus", ""] },
          fileProcessRejectStatus: { $ifNull: ["$finalsanctionData.fileProcessRejectStatus", ""] }
}
      },
      
      // Group by customerId with fixed field names
      {
        $group: {
          _id: "$customerId",
          // Map to new column names per requirement
          customerFinId: { $first: "$customerFinId" },
          hoSelfAssign: { $first: "$selfAssignEmployeeName" },
          branchSelfAssign: { $first: "$branchSelfAssignEmployee" },
          partnerName: { $first: "$partnerName" },
          productName: { $first: "$productName" },
          loanType: { $first: "$loanType" },
          fileStatus: { $first: "$fileStatus" },
          responsibility: { $first: "$responsibility" },
          hoRemark: { $first: "$hoRemark" },
          partnerPending: { $first: "$partnerPending" },
          branchName: { $first: "$branchName" },
          customerName: { $first: "$customerFullName" },
          fatherName: { $first: "$customerFatherName" },
          mobileNo: { $first: "$mobileNo" },
          salesperson: { $first: "$salesPersonName" },
          salesManager: { $first: "$salesPersonManagerName" },
          loginDate: { $first: "$loginDate" },
          paymentDate: { $first: "$paymentDate" },
          salesCompleteDate: { $first: "$salesCompleteDate" },
          loginTat: { $first: "$loginTat" },
          pdDate: { $first: "$creditPdCompleteDate" },
          pdCreatedAt: { $first: "$pdCreatedAt" },
          externalvendordynamicCreatedAt: { $first: "$externalvendordynamicCreatedAt" },
          pdTat: { $first: "$pdTat" },
          nachLink: { $first: "$nachLink" },
          esignStatus: { $first: "$esignStatus" },
          charges: { $first: "$chargesStatus" },
          mortgage: { $first: "$mortgageStatus" },
          sanctionQueryStatus: { $first: "$sanctionQueryStatus" },
          preDisbursementQueryStatus: { $first: "$preDisbursementQueryStatus" },
          disbursementQueryStatus: { $first: "$disbursementQueryStatus" },
          finalLoanAmount: { $first: "$finalLoanAmount" },
          roi: { $first: "$roi" },
          tenure: { $first: "$tenureInMonth" },
          emi: { $first: "$emi" },
          jainamLoanNo: { $first: "$jainamLoanNo" },
          jainamProfileNo: { $first: "$jainamProfileNo" },
          partnerLoanNo: { $first: "$partnerLoanNo" },
          oldFinId: { $first: "$oldFinId" },
          oldLanNo: { $first: "$oldLanNo" },
          sanctionDate: { $first: "$sanctionDate" },
          disbursementDate: { $first: "$disbursementDate" },
          
          // Keep original fields for internal use
          customerId: { $first: "$customerId" },
          regionalBranchName: { $first: "$regionalBranchName" },
          pdPersonName: { $first: "$pdPersonName" },
          statusByCreditPd: { $first: "$statusByCreditPd" },
          vendors: { $first: "$vendors" },
          fileStageForms: { $first: "$fileStageForms" },
          document: { $first: "$document" }, // Include document data in the grouping
          selfAssignEmployee: { $first: "$selfAssignEmployee" },
          incomeSanctionStatus: { $first: "$incomeSanctionStatus" },
          sendToPartnerPostDisbursedStatus: { $first: "$sendToPartnerPostDisbursedStatus" },
          sendToPartnerPreDisbursedStatus: { $first: "$sendToPartnerPreDisbursedStatus" },
          sendToPartnerSanctionStatus: { $first: "$sendToPartnerSanctionStatus" },
          fileProcessRejectStatus: { $first: "$fileProcessRejectStatus" }
        }
      },
// Facet for pagination and counts
      {
        $facet: {
          totalCases: [{ $count: "total" }],
          fileDetails: [
            { $skip: (pageNumber - 1) * pageLimit },
            { $limit: parseInt(pageLimit) }
          ],
          notAssignCount: [
            { $match: { selfAssignEmployee: null } },
            { $count: "count" }
          ],
          selfAssignCount: [
            { $match: { selfAssignEmployee: { $ne: null } } },
            { $count: "count" }
          ],
          incomeSanctionStatus: [
            { $match: { incomeSanctionStatus: "complete" } },
            { $count: "count" }
          ],
          fileProcessRejectStatus: [
            { $match: { fileProcessRejectStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerPostDisbursedStatus: [
            { $match: { sendToPartnerPostDisbursedStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerPreDisbursedStatus: [
            { $match: { sendToPartnerPreDisbursedStatus: "complete" } },
            { $count: "count" }
          ],
          sendToPartnerSanctionStatus: [
            { $match: { sendToPartnerSanctionStatus: "complete" } },
            { $count: "count" }
          ]
        }
      },

      // Format the final output
      {
        $project: {
          totalCases: { $arrayElemAt: ["$totalCases.total", 0] },
          fileDetails: 1,
          counts: {
            notAssignCount: { $arrayElemAt: ["$notAssignCount.count", 0] },
            selfAssignCount: { $arrayElemAt: ["$selfAssignCount.count", 0] },
            fileProcessRejectStatus: { $arrayElemAt: ["$fileProcessRejectStatus.count", 0] },
            incomeSanctionStatus: { $arrayElemAt: ["$incomeSanctionStatus.count", 0] },
            sendToPartnerPostDisbursedStatus: { $arrayElemAt: ["$sendToPartnerPostDisbursedStatus.count", 0] },
            sendToPartnerPreDisbursedStatus: { $arrayElemAt: ["$sendToPartnerPreDisbursedStatus.count", 0] },
            sendToPartnerSanctionStatus: { $arrayElemAt: ["$sendToPartnerSanctionStatus.count", 0] }
          }
        }
      },
      {
        $sort: { "createdAt": -1 }  // Sort by creation date, newest first
      },
    ];
// Execute the detailed pipeline for the filtered results
    const detailResults = await externalVendorFormModel
      .aggregate(detailPipeline)
      .allowDiskUse(true);

    // Calculate pagination metadata
    const totalRecords = detailResults[0]?.totalCases || 0;
    const currentPage = Number(pageNumber);
    const totalPages = Math.ceil(totalRecords / pageLimit);
    const hasNextPage = currentPage < totalPages;
    const hasPreviousPage = currentPage > 1;

    const {
      notAssignCount = 0,
      selfAssignCount = 0,
      incomeSanctionStatus = 0,
      fileProcessRejectStatus = 0,
      sendToPartnerPostDisbursedStatus = 0,
      sendToPartnerPreDisbursedStatus = 0,
      sendToPartnerSanctionStatus = 0,
    } = detailResults[0]?.counts || {};

    return success(res, "customerDetails", {
      totalCount: totalRecords,
      notAssignCount,
      selfAssignCount,
      incomeSanctionStatus,
      fileProcessRejectStatus,
      sendToPartnerPostDisbursedStatus,
      sendToPartnerPreDisbursedStatus,
      sendToPartnerSanctionStatus,
      fileDetails: detailResults[0]?.fileDetails || [],
      pagination: {
        totalRecords,
        currentPage,
        pageSize: Number(pageLimit),
        totalPages,
      }
    });

  } catch (error) {
    console.error(error);
    return unknownError(res, error.message);
  }
};




//finalMainDashboardMonthlyCount

const finalMainDashboardMonthlyCount = async (req, res) => {
  try {
    const {
      regionalBranch,
      branch,
      product,
      hoSelfAssign,
      branchSelfAssign,
      startDateFilter,
      endDateFilter,
      finalApproverStatus,
      fileProcessStatus,
      searchQuery,
      sanctionStage,
      year, // Optional year parameter
    } = req.query;

    const employeeId = req.Id;

    const activeVendors = await vendorTypeModel.find({ status: "active" }).select("vendorType");
    const vendorTypes = activeVendors.map(v => v.vendorType);
    
    // Basic validation
    const employeeExist = await employeModel
      .findOne({ _id: employeeId, status: "active" }, { _id: 1 })
      .lean();

    if (!employeeExist) {
      return badRequest(res, "Employee Not Found");
    }

    // Get current year as default
    const today = new Date();
    const currentYear = today.getFullYear();
    
    // Determine date range based on inputs - EXACTLY matching the first API logic
    const defaultStartDate = new Date(today.setHours(0, 0, 0, 0));
    const defaultEndDate = new Date(today.setHours(23, 59, 59, 999));

    function formatDateToISO(date) {
      return new Date(date).toISOString();
    }

    let formattedStart = startDateFilter && startDateFilter !== "all"
      ? new Date(new Date(startDateFilter).setHours(0, 0, 0, 0))
      : defaultStartDate;

    let formattedEnd = endDateFilter && endDateFilter !== "all"
      ? new Date(new Date(endDateFilter).setHours(23, 59, 59, 999))
      : defaultEndDate;

    if (startDateFilter && endDateFilter && startDateFilter === endDateFilter) {
      formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
      formattedEnd = new Date(new Date(startDateFilter).setHours(23, 59, 59, 999));
    }

    formattedStart = formatDateToISO(formattedStart);
    formattedEnd = formatDateToISO(formattedEnd);
    
    // Flag for determining how to display the months
    const useSpecificDateRange = startDateFilter && startDateFilter !== "all" && endDateFilter && endDateFilter !== "all";
    
    // Step 1: Get all customer IDs that match initial criteria - EXACTLY matching first API logic
    const initialPipeline = [
      // Initial basic match
      {
        $match: {
          fileStatus: "active",
          statusByCreditPd: { $in: ["complete", "approve"] }
        }
      },
      
      // Only lookup what's needed for filtering
      {
        $lookup: {
          from: "customerdetails",
          localField: "customerId",
          foreignField: "_id",
          as: "customerDetailData"
        }
      },
      { 
        $unwind: { 
          path: "$customerDetailData",
          preserveNullAndEmptyArrays: true 
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "customerDetailData.branch",
          foreignField: "_id",
          as: "branchDetails"
        }
      },
      {
        $unwind: {
          path: "$branchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "branchDetails.regionalBranchId",
          foreignField: "_id",
          as: "regionalBranchDetails"
        }
      },
      {
        $unwind: {
          path: "$regionalBranchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "applicantDetails"
        }
      },
      {
        $unwind: {
          path: "$applicantDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "customerId",
          foreignField: "customerId",
          as: "finalsanctionData"
        }
      },
      {
        $unwind: {
          path: "$finalsanctionData",
          preserveNullAndEmptyArrays: true
        }
      },
      
      // Apply all filters - EXACTLY matching first API's conditional logic
      {
        $match: {
          $and: [
            // Search query
            searchQuery ? {
              $or: [
                { "applicantDetails.mobileNo": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fullName": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fatherName": { $regex: searchQuery, $options: "i" } },
                { "customerDetailData.customerFinId": { $regex: searchQuery, $options: "i" } }
              ]
            } : {},

            // Branch filter
            branch && branch !== "all" ? {
              "branchDetails._id": {
                $in: (Array.isArray(branch) ? branch : branch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Regional branch filter
            regionalBranch && regionalBranch !== "all" ? {
              "regionalBranchDetails._id": {
                $in: (Array.isArray(regionalBranch) ? regionalBranch : regionalBranch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Product filter
            product && product !== "all" ? {
              "customerDetailData.productId": {
                $in: (Array.isArray(product) ? product : product.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // SanctionStage filter
            sanctionStage === "partnerNotSelect" ? { "finalsanctionData.partnerId": null } : {},

            // finalApproverStatus filter
            finalApproverStatus && finalApproverStatus !== "partnerNotSelect" ? {
              $and: finalApproverStatus.split(",").map(statusKey => ({
                [`finalsanctionData.${statusKey}`]: "complete"
              }))
            } : {},

            // Special case for finalApproverStatus=partnerNotSelect
            finalApproverStatus === "partnerNotSelect" ? {
              "finalsanctionData.partnerId": null
            } : {},

            fileProcessStatus
            ? {
                $and: fileProcessStatus.split(",").map(statusKey => ({
                  [`finalsanctionData.${statusKey}`]: "complete"
                }))
              }
            : {},

            // Date filter - EXACTLY matching first API
            startDateFilter && endDateFilter && startDateFilter !== "all" && endDateFilter !== "all"? {
              creditPdCompleteDate: {
                $gte: formattedStart,
                $lt: formattedEnd,
              }
            }:{},
            
            hoSelfAssign && hoSelfAssign !=="all"?{
              "finalsanctionData.employeeId": {
                $in: (Array.isArray(hoSelfAssign) ? hoSelfAssign : hoSelfAssign.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},
            
            // Exclude specific products when no product filter
            (!product || product === "all") ? {
              "customerDetailData.productId": {
                $nin: [].map(id => new ObjectId(id))
              }
            } : {}
          ].filter(condition => Object.keys(condition).length > 0)
        }
      },
      
      // Project relevant fields
      {
        $project: {
          _id: 1,
          customerId: 1,
          creditPdCompleteDate: 1,
          pdDate: 1, 
          "finalsanctionData.employeeId": 1,
          "finalsanctionData.incomeSanctionStatus": 1,
          "finalsanctionData.fileProcessRejectStatus": 1,
          "finalsanctionData.sendToPartnerPostDisbursedStatus": 1,
          "finalsanctionData.sendToPartnerPreDisbursedStatus": 1,
          "finalsanctionData.sendToPartnerSanctionStatus": 1
        }
      }
    ];
    
    // Execute the initial pipeline
    const filteredRecords = await externalVendorFormModel
      .aggregate(initialPipeline)
      .allowDiskUse(true);
    
    // Function to parse various date formats
    function parseDate(dateStr) {
      if (!dateStr) return null;
      
      // If it's already a Date object
      if (dateStr instanceof Date) return dateStr;
      
      // If it's an ISO string
      if (typeof dateStr === 'string') {
        // Check if it has AM/PM format (like "2025-03-25T03:36:16 PM")
        const amPmRegex = /(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}) (AM|PM)/;
        const match = dateStr.match(amPmRegex);
        
        if (match) {
          // Parse the date part
          const [_, datePart, amPm] = match;
          const date = new Date(datePart);
          
          // Adjust hours for PM
          if (amPm === 'PM' && date.getHours() < 12) {
            date.setHours(date.getHours() + 12);
          }
          
          return date;
        } else {
          // Try standard ISO parsing
          const date = new Date(dateStr);
          if (!isNaN(date.getTime())) {
            return date;
          }
        }
      }
      
      return null;
    }
    
    // Total counts will be based on exactly what we got from initial pipeline
    const totalCount = filteredRecords.length;
    
    // Calculate total counts using EXACT same logic as first API
    let notAssignCount = 0;
    let selfAssignCount = 0;
    let incomeSanctionStatus = 0;
    let fileProcessRejectStatus = 0;
    let sendToPartnerPostDisbursedStatus = 0;
    let sendToPartnerPreDisbursedStatus = 0;
    let sendToPartnerSanctionStatus = 0;

    // Count directly from the filtered records, exactly like the first API would do
    filteredRecords.forEach(record => {
      if (record.finalsanctionData && record.finalsanctionData.employeeId) {
        selfAssignCount++;
      } else {
        notAssignCount++;
      }
      
      if (record.finalsanctionData) {
        if (record.finalsanctionData.incomeSanctionStatus === "complete") {
          incomeSanctionStatus++;
        }
        
        if (record.finalsanctionData.fileProcessRejectStatus === "complete") {
          fileProcessRejectStatus++;
        }
        
        if (record.finalsanctionData.sendToPartnerPostDisbursedStatus === "complete") {
          sendToPartnerPostDisbursedStatus++;
        }
        
        if (record.finalsanctionData.sendToPartnerPreDisbursedStatus === "complete") {
          sendToPartnerPreDisbursedStatus++;
        }
        
        if (record.finalsanctionData.sendToPartnerSanctionStatus === "complete") {
          sendToPartnerSanctionStatus++;
        }
      }
    });
    
    // Determine which years are covered in the date range if using specific range
    const startYear = new Date(formattedStart).getFullYear();
    const endYear = new Date(formattedEnd).getFullYear();
    
    // Initialize data structure for all years in the range
    const yearlyData = {};
    for (let year = startYear; year <= endYear; year++) {
      yearlyData[year] = new Array(12).fill(0).map((_, index) => ({
        year,
        month: index + 1,
        totalCount: 0,
        notAssignCount: 0,
        selfAssignCount: 0,
        incomeSanctionStatus: 0,
        fileProcessRejectStatus: 0,
        sendToPartnerPostDisbursedStatus: 0,
        sendToPartnerPreDisbursedStatus: 0,
        sendToPartnerSanctionStatus: 0
      }));
    }
    
    // Process each record for monthly breakdown
    for (const record of filteredRecords) {
      // Now handle monthly distribution
      // Parse the PD date - try various date fields
      const pdDateObj = parseDate(record.pdDate) || parseDate(record.creditPdCompleteDate);
      
      // Skip month assignment if can't determine PD date
      if (!pdDateObj) continue;
      
      // Get year and month
      const year = pdDateObj.getFullYear();
      const month = pdDateObj.getMonth(); // 0-based month
      
      // Skip if year isn't in our range
      if (!yearlyData[year]) continue;
      
      // Get the month data for this year/month
      const monthData = yearlyData[year][month];
      monthData.totalCount++;
      
      // Status checks for month distribution
      const hasSelfAssign = record.finalsanctionData && record.finalsanctionData.employeeId;
      if (hasSelfAssign) {
        monthData.selfAssignCount++;
      } else {
        monthData.notAssignCount++;
      }
      
      // Check other statuses for month distribution
      if (record.finalsanctionData) {
        if (record.finalsanctionData.incomeSanctionStatus === "complete") {
          monthData.incomeSanctionStatus++;
        }
        
        if (record.finalsanctionData.fileProcessRejectStatus === "complete") {
          monthData.fileProcessRejectStatus++;
        }
        
        if (record.finalsanctionData.sendToPartnerPostDisbursedStatus === "complete") {
          monthData.sendToPartnerPostDisbursedStatus++;
        }
        
        if (record.finalsanctionData.sendToPartnerPreDisbursedStatus === "complete") {
          monthData.sendToPartnerPreDisbursedStatus++;
        }
        
        if (record.finalsanctionData.sendToPartnerSanctionStatus === "complete") {
          monthData.sendToPartnerSanctionStatus++;
        }
      }
    }
    
    // Format the monthly data for response
    const monthNames = [
      "January", "February", "March", "April",
      "May", "June", "July", "August", 
      "September", "October", "November", "December"
    ];
    
    // Prepare final response data
    let formattedMonthlyData = [];
    
    // Check if date range is within the same year
    const isSameYearDateRange = startYear === endYear;
    
    if (isSameYearDateRange) {
      // Case 1: Same year - show all 12 months of that year
      formattedMonthlyData = yearlyData[startYear].map((data, index) => ({
        month: monthNames[index],
        totalCount: data.totalCount,
        notAssignCount: data.notAssignCount,
        selfAssignCount: data.selfAssignCount,
        incomeSanctionStatus: data.incomeSanctionStatus,
        fileProcessRejectStatus: data.fileProcessRejectStatus,
        sendToPartnerPostDisbursedStatus: data.sendToPartnerPostDisbursedStatus,
        sendToPartnerPreDisbursedStatus: data.sendToPartnerPreDisbursedStatus,
        sendToPartnerSanctionStatus: data.sendToPartnerSanctionStatus
      }));
    } else if (useSpecificDateRange) {
      // Case 2: Multi-year range - show months with year labels
      let allMonthsData = [];
      
      // Include all years in the range
      for (let yr = startYear; yr <= endYear; yr++) {
        // Get all months for this year
        const yearMonths = yearlyData[yr].map((data, index) => ({
          year: yr,
          month: `${monthNames[index]} ${yr}`,
          monthNumber: index + 1,
          totalCount: data.totalCount,
          notAssignCount: data.notAssignCount,
          selfAssignCount: data.selfAssignCount,
          incomeSanctionStatus: data.incomeSanctionStatus,
          fileProcessRejectStatus: data.fileProcessRejectStatus,
          sendToPartnerPostDisbursedStatus: data.sendToPartnerPostDisbursedStatus,
          sendToPartnerPreDisbursedStatus: data.sendToPartnerPreDisbursedStatus,
          sendToPartnerSanctionStatus: data.sendToPartnerSanctionStatus
        }));
        
        // Add non-zero months to result
        const nonZeroMonths = yearMonths.filter(data => data.totalCount > 0);
        allMonthsData = [...allMonthsData, ...nonZeroMonths];
      }
      
      // Sort months chronologically
      allMonthsData.sort((a, b) => {
        if (a.year !== b.year) return a.year - b.year;
        return a.monthNumber - b.monthNumber;
      });
      
      formattedMonthlyData = allMonthsData.map(data => ({
        month: data.month,
        totalCount: data.totalCount,
        notAssignCount: data.notAssignCount,
        selfAssignCount: data.selfAssignCount,
        incomeSanctionStatus: data.incomeSanctionStatus,
        fileProcessRejectStatus: data.fileProcessRejectStatus,
        sendToPartnerPostDisbursedStatus: data.sendToPartnerPostDisbursedStatus,
        sendToPartnerPreDisbursedStatus: data.sendToPartnerPreDisbursedStatus,
        sendToPartnerSanctionStatus: data.sendToPartnerSanctionStatus
      }));
    } else {
      // Case 3: No specific date range - use year from param or current year
      const selectedYear = year ? parseInt(year) : currentYear;
      
      // Make sure the year exists in our data structure
      if (!yearlyData[selectedYear]) {
        yearlyData[selectedYear] = new Array(12).fill(0).map((_, index) => ({
          year: selectedYear,
          month: index + 1,
          totalCount: 0,
          notAssignCount: 0,
          selfAssignCount: 0,
          incomeSanctionStatus: 0,
          fileProcessRejectStatus: 0,
          sendToPartnerPostDisbursedStatus: 0,
          sendToPartnerPreDisbursedStatus: 0,
          sendToPartnerSanctionStatus: 0
        }));
      }
      
      formattedMonthlyData = yearlyData[selectedYear].map((data, index) => ({
        month: monthNames[index],
        totalCount: data.totalCount,
        notAssignCount: data.notAssignCount,
        selfAssignCount: data.selfAssignCount,
        incomeSanctionStatus: data.incomeSanctionStatus,
        fileProcessRejectStatus: data.fileProcessRejectStatus,
        sendToPartnerPostDisbursedStatus: data.sendToPartnerPostDisbursedStatus,
        sendToPartnerPreDisbursedStatus: data.sendToPartnerPreDisbursedStatus,
        sendToPartnerSanctionStatus: data.sendToPartnerSanctionStatus
      }));
    }
    
    // If we have no monthly data, initialize empty months for display
    if (formattedMonthlyData.length === 0) {
      formattedMonthlyData = monthNames.map(month => ({
        month,
        totalCount: 0,
        notAssignCount: 0,
        selfAssignCount: 0,
        incomeSanctionStatus: 0,
        fileProcessRejectStatus: 0,
        sendToPartnerPostDisbursedStatus: 0,
        sendToPartnerPreDisbursedStatus: 0,
        sendToPartnerSanctionStatus: 0
      }));
    }
    
    // Double check to ensure summary counts match array sum counts
    // This is a safety check to detect any discrepancies
    let sumOfMonthlyTotal = 0;
    let sumOfMonthlySelfAssign = 0;
    
    for (let yr = startYear; yr <= endYear; yr++) {
      if (yearlyData[yr]) {
        for (const monthData of yearlyData[yr]) {
          sumOfMonthlyTotal += monthData.totalCount;
          sumOfMonthlySelfAssign += monthData.selfAssignCount;
        }
      }
    }
    
    // Adjust if there's a mismatch (this shouldn't happen with a proper implementation)
    if (sumOfMonthlyTotal !== totalCount) {
      console.warn(`Warning: Sum of monthly totals (${sumOfMonthlyTotal}) doesn't match overall total (${totalCount})`);
    }
    
    // Return the response with EXACTLY the correct total counts
    return success(res, "customerDetails", {
      totalCount,
      notAssignCount,
      selfAssignCount,
      incomeSanctionStatus,
      fileProcessRejectStatus,
      sendToPartnerPostDisbursedStatus,
      sendToPartnerPreDisbursedStatus,
      sendToPartnerSanctionStatus,
      monthlyData: formattedMonthlyData,
      fileCount: totalCount // For backward compatibility
    });

  } catch (error) {
    console.error(error);
    return unknownError(res, error.message);
  }
};


async function overAllDashboard(req, res) {
  try {
  
        // Handle pagination
        const page = parseInt(req.query.page) || 1;
        const limit = parseInt(req.query.limit) || 10;
        const skip = (page - 1) * limit;
    
        // Basic aggregation pipeline to focus only on document data and pagination
        const aggregationPipeline = [
          // Initial match for active files with completed PD status
          {
            $match: {
              fileStatus: "active",
              statusByCreditPd: { $in: ["complete", "approve"] }
            }
          },
    
          // Lookup all collections that contain document information
          // Customer documents
          {
            $lookup: {
              from: "customerdocuments",
              localField: "customerId",
              foreignField: "customerId",
              as: "customerDocuments"
            }
          },
          {
            $unwind: {
              path: "$customerDocuments",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Credit PD data
          {
            $lookup: {
              from: "pdformdatas",
              localField: "customerId",
              foreignField: "customerId",
              as: "creditPdData"
            }
          },
          {
            $unwind: {
              path: "$creditPdData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Guarantor PDC data
          {
            $lookup: {
              from: "gtrpdcs",
              localField: "customerId",
              foreignField: "customerId",
              as: "gtrPdcData"
            }
          },
          {
            $unwind: {
              path: "$gtrPdcData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Applicant PDC data
          {
            $lookup: {
              from: "apppdcs",
              localField: "customerId",
              foreignField: "customerId",
              as: "appPdcData"
            }
          },
          {
            $unwind: {
              path: "$appPdcData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Disbursement data
          {
            $lookup: {
              from: "disbursements",
              localField: "customerId",
              foreignField: "customerId",
              as: "disbursementData"
            }
          },
          {
            $unwind: {
              path: "$disbursementData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Co-applicant data
          {
            $lookup: {
              from: "coapplicantdetails",
              localField: "customerId",
              foreignField: "customerId",
              as: "coApplicantData"
            }
          },
    
          // Applicant data
          {
            $lookup: {
              from: "applicantdetails",
              localField: "customerId",
              foreignField: "customerId",
              as: "applicantData"
            }
          },
          {
            $unwind: {
              path: "$applicantData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Guarantor data
          {
            $lookup: {
              from: "guarantors",
              localField: "customerId",
              foreignField: "customerId",
              as: "guarantorData"
            }
          },
          {
            $unwind: {
              path: "$guarantorData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // CIBIL data
          {
            $lookup: {
              from: "cibildetails",
              localField: "customerId",
              foreignField: "customerId",
              as: "cibilData"
            }
          },
          {
            $unwind: {
              path: "$cibilData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Loan document data
          {
            $lookup: {
              from: "loandocumentmodels",
              localField: "customerId",
              foreignField: "customerId",
              as: "loanDocumentData"
            }
          },
          {
            $unwind: {
              path: "$loanDocumentData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // SignKYC details
          {
            $lookup: {
              from: "customerdocumentdetails",
              localField: "customerId",
              foreignField: "customerId",
              as: "SignKycDetails"
            }
          },
          {
            $unwind: {
              path: "$SignKycDetails",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Final data
          {
            $lookup: {
              from: "finalsanctiondetaails",
              localField: "customerId",
              foreignField: "customerId",
              as: "finalData"
            }
          },
          {
            $unwind: {
              path: "$finalData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Bank statement data
          {
            $lookup: {
              from: "bankstatementkycs",
              localField: "customerId",
              foreignField: "customerId",
              as: "bankStatementData"
            }
          },
          {
            $unwind: {
              path: "$bankStatementData",
              preserveNullAndEmptyArrays: true
            }
          },
    
          // Extract vendors by type from vendors array
          {
            $addFields: {
              rcuVendor: {
                $arrayElemAt: [
                  {
                    $filter: {
                      input: "$vendors",
                      as: "vendor",
                      cond: { $eq: ["$$vendor.vendorType", "rcu"] }
                    }
                  },
                  0
                ]
              },
              legalVendor: {
                $arrayElemAt: [
                  {
                    $filter: {
                      input: "$vendors",
                      as: "vendor",
                      cond: { $eq: ["$$vendor.vendorType", "legal"] }
                    }
                  },
                  0
                ]
              },
              technicalVendor: {
                $arrayElemAt: [
                  {
                    $filter: {
                      input: "$vendors",
                      as: "vendor",
                      cond: { $eq: ["$$vendor.vendorType", "technical"] }
                    }
                  },
                  0
                ]
              },
              taggingVendor: {
                $arrayElemAt: [
                  {
                    $filter: {
                      input: "$vendors",
                      as: "vendor",
                      cond: { $eq: ["$$vendor.vendorType", "tagging"] }
                    }
                  },
                  0
                ]
              },
              // Extract first and second co-applicants
              firstCoApplicant: { $arrayElemAt: ["$coApplicantData", 0] },
              secondCoApplicant: { $arrayElemAt: ["$coApplicantData", 1] },
              // Extract esign links
              esignLinks: {
                $cond: {
                  if: {
                    $and: [
                      { $ne: ["$finalData.signEsignLink", null] },
                      { $ne: ["$finalData.signEsignLink", {}] },
                      { $gt: [{ $size: { $objectToArray: { $ifNull: ["$finalData.signEsignLink", {}] } } }, 0] }
                    ]
                  },
                  then: "$finalData.signEsignLink",
                  else: "$finalData.esignLinks"
                }
              },
              // Extract latest CIBIL reports
              latestApplicantCibilReport: {
                $arrayElemAt: [
                  { $ifNull: ["$cibilData.applicantFetchHistory", []] },
                  { $subtract: [{ $size: { $ifNull: ["$cibilData.applicantFetchHistory", []] } }, 1] }
                ]
              },
              latestGuarantorCibilReport: {
                $arrayElemAt: [
                  { $ifNull: ["$cibilData.guarantorFetchHistory", []] },
                  { $subtract: [{ $size: { $ifNull: ["$cibilData.guarantorFetchHistory", []] } }, 1] }
                ]
              },
              // Extract house photos array
              housePhotos: {
                $concatArrays: [
                  { $ifNull: [{ $cond: { if: { $isArray: "$creditPdData.fourBoundaryPhotos" }, then: "$creditPdData.fourBoundaryPhotos", else: ["$creditPdData.fourBoundaryPhotos"] } }, []] },
                  { $ifNull: [{ $cond: { if: { $isArray: "$creditPdData.houseInsidePhoto" }, then: "$creditPdData.houseInsidePhoto", else: ["$creditPdData.houseInsidePhoto"] } }, []] },
                  { $ifNull: [{ $cond: { if: { $isArray: "$creditPdData.propertyOtherPhotos" }, then: "$creditPdData.propertyOtherPhotos", else: ["$creditPdData.propertyOtherPhotos"] } }, []] },
                  [
                    { $ifNull: ["$creditPdData.selfiWithCustomer", null] },
                    { $ifNull: ["$creditPdData.photoWithLatLong", null] },
                    { $ifNull: ["$creditPdData.front", null] },
                    { $ifNull: ["$creditPdData.leftSide", null] },
                    { $ifNull: ["$creditPdData.rightSide", null] },
                    { $ifNull: ["$creditPdData.approachRoad", null] },
                    { $ifNull: ["$creditPdData.mainRoad", null] },
                    { $ifNull: ["$creditPdData.interiorRoad", null] },
                    { $ifNull: ["$creditPdData.selfieWithProperty", null] },
                    { $ifNull: ["$creditPdData.landmarkPhoto", null] },
                    { $ifNull: ["$creditPdData.latLongPhoto", null] }
                  ]
                ]
              }
            }
          },
    
          // Project only the document yes/no fields
          {
            $project: {
              _id: 0,
              customerId: 1,
              SanctionCheckList: {
                // Login check list documents
                utilityBillDocument: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.incomeDocument.utilityBillDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                familyCardDocument: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.incomeDocument.familyCardDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                udyamCertificate: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.incomeDocument.udyamCertificateDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                bankStatement: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.incomeDocument.bankStatementDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                incomeDocument: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.incomeDocument.incomeStatemenDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                propertyDocument: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.propertyDocuments.propertyDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                signApplicantKyc: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.signApplicantKyc", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                signCoApplicantKyc: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.signCoApplicantKyc", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                signCoTwoApplicantKyc: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.signCoTwoApplicantKyc", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                signGurantorKyc: {
                  $cond: {
                    if: { $ifNull: ["$customerDocuments.signGurantorKyc", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Credit PD documents
                electricityBill: {
                  $cond: {
                    if: { $ifNull: ["$creditPdData.utilityBillDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                samagraIdDoc: {
                  $cond: {
                    if: { $ifNull: ["$creditPdData.samagraIdDetail.samagraIdDoc", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Photos
                applicantPhoto: {
                  $cond: {
                    if: { $ifNull: ["$applicantData.applicantPhoto", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                coApplicantPhoto: {
                  $cond: {
                    if: { $ifNull: ["$firstCoApplicant.coApplicantPhoto", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                coApplicantPhotoTwo: {
                  $cond: {
                    if: { $ifNull: ["$secondCoApplicant.coApplicantPhoto", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                guarantorPhoto: {
                  $cond: {
                    if: { $ifNull: ["$guarantorData.guarantorPhoto", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // KYC documents
                signApplicantKyc: {
        $cond: {
          if: { "$gt": [{ "$size": { "$ifNull": ["$SignKycDetails.signApplicantKyc", []] } }, 0] },
          then: "Yes",
          else: "No"
        }
      },
                signCoApplicantKyc: {
                  $cond: {
                    if: { "$gt": [{ "$size": { "$ifNull": ["$SignKycDetails.signCoApplicantKyc", []] } }, 0] },
                    then: "Yes",
                    else: "No"
                  }
                },
                signCoTwoApplicantKyc: {
                  $cond: {
                    if: { "$gt": [{ "$size": { "$ifNull": ["$SignKycDetails.signCoTwoApplicantKyc", []] } }, 0] },
                    then: "Yes",
                    else: "No"
                  }
                },
                signGurantorKyc: {
                  $cond: {
                    if: { "$gt": [{ "$size": { "$ifNull": ["$SignKycDetails.signGurantorKyc", []] } }, 0] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Applicant KYC
                applicantKyc: {
                  $cond: {
                    if: {
                      $or: [
                        { $ifNull: ["$applicantData.kycUpload.aadharFrontImage", null] },
                        { $ifNull: ["$applicantData.kycUpload.aadharBackImage", null] },
                        { $ifNull: ["$applicantData.kycUpload.panFrontImage", null] },
                        { $ifNull: ["$applicantData.kycUpload.drivingLicenceImage", null] },
                        { $ifNull: ["$applicantData.kycUpload.voterIdImage", null] }
                      ]
                    },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Co-applicant KYC
                coApplicantKyc: {
                  $cond: {
                    if: {
                      $or: [
                        { $ifNull: ["$firstCoApplicant.kycUpload.aadharFrontImage", null] },
                        { $ifNull: ["$firstCoApplicant.kycUpload.aadharBackImage", null] },
                        { $ifNull: ["$firstCoApplicant.kycUpload.docImage", null] }
                      ]
                    },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Second co-applicant KYC
                coApplicantKycTwo: {
                  $cond: {
                    if: {
                      $or: [
                        { $ifNull: ["$secondCoApplicant.kycUpload.aadharFrontImage", null] },
                        { $ifNull: ["$secondCoApplicant.kycUpload.aadharBackImage", null] },
                        { $ifNull: ["$secondCoApplicant.kycUpload.docImage", null] }
                      ]
                    },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Guarantor KYC
                gurantorKyc: {
                  $cond: {
                    if: {
                      $or: [
                        { $ifNull: ["$guarantorData.kycUpload.aadharFrontImage", null] },
                        { $ifNull: ["$guarantorData.kycUpload.aadharBackImage", null] },
                        { $ifNull: ["$guarantorData.kycUpload.docImage", null] }
                      ]
                    },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // CIBIL reports
                applicantCibilReport: {
                  $cond: {
                    if: { $ifNull: ["$latestApplicantCibilReport.cibilReport", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // First co-applicant CIBIL
                coApplicantCibilReport: {
                  $let: {
                    vars: {
                      coAppData: { $arrayElemAt: [{ $ifNull: ["$cibilData.coApplicantData", []] }, 0] }
                    },
                    in: {
                      $cond: {
                        if: {
                          $and: [
                            { $ne: ["$$coAppData", null] },
                            { $ne: ["$$coAppData", undefined] },
                            { $isArray: "$$coAppData.coApplicantFetchHistory" },
                            { $gt: [{ $size: { $ifNull: ["$$coAppData.coApplicantFetchHistory", []] } }, 0] }
                          ]
                        },
                        then: {
                          $let: {
                            vars: {
                              lastReport: {
                                $arrayElemAt: [
                                  "$$coAppData.coApplicantFetchHistory",
                                  { $subtract: [{ $size: "$$coAppData.coApplicantFetchHistory" }, 1] }
                                ]
                              }
                            },
                            in: {
                              $cond: {
                                if: { $ifNull: ["$$lastReport.cibilReport", null] },
                                then: "Yes",
                                else: "No"
                              }
                            }
                          }
                        },
                        else: "No"
                      }
                    }
                  }
                },
                
                // Second co-applicant CIBIL
                coApplicantTwoCibilReport: {
                  $let: {
                    vars: {
                      coAppData: { $arrayElemAt: [{ $ifNull: ["$cibilData.coApplicantData", []] }, 1] }
                    },
                    in: {
                      $cond: {
                        if: {
                          $and: [
                            { $ne: ["$$coAppData", null] },
                            { $ne: ["$$coAppData", undefined] },
                            { $isArray: "$$coAppData.coApplicantFetchHistory" },
                            { $gt: [{ $size: { $ifNull: ["$$coAppData.coApplicantFetchHistory", []] } }, 0] }
                          ]
                        },
                        then: {
                          $let: {
                            vars: {
                              lastReport: {
                                $arrayElemAt: [
                                  "$$coAppData.coApplicantFetchHistory",
                                  { $subtract: [{ $size: "$$coAppData.coApplicantFetchHistory" }, 1] }
                                ]
                              }
                            },
                            in: {
                              $cond: {
                                if: { $ifNull: ["$$lastReport.cibilReport", null] },
                                then: "Yes",
                                else: "No"
                              }
                            }
                          }
                        },
                        else: "No"
                      }
                    }
                  }
                },
                
                // Guarantor CIBIL
                guarantorCibilReport: {
                  $cond: {
                    if: { $ifNull: ["$latestGuarantorCibilReport.cibilReport", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Other reports
                pdReport: {
                  $cond: {
                    if: { $ifNull: ["$creditPdData.pdfLink", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                rcuReport: {
                  $cond: {
                    if: { $ifNull: ["$rcuVendor.uploadProperty", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                legalReport: {
                  $cond: {
                    if: { $ifNull: ["$legalVendor.uploadProperty", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                technicalReport: {
                  $cond: {
                    if: { $ifNull: ["$technicalVendor.uploadProperty", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                technicalEstimateDocument: {
                  $cond: {
                    if: { $ifNull: ["$technicalVendor.estimateDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                taggingReport: {
                  $cond: {
                    if: { $ifNull: ["$taggingVendor.uploadProperty", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // House photos existence check
                housePhotos: {
                  $cond: {
                    if: { $gt: [{ $size: { $filter: { input: "$housePhotos", as: "photo", cond: { $ne: ["$$photo", null] } } } }, 0] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                // Work photos (income source photos) existence check
                workPhotos: {
                  $cond: {
                    if: {
                      $or: [
                        { 
                          $gt: [
                            { 
                              $size: { 
                                $filter: { 
                                  input: { $ifNull: ["$creditPdData.incomeSource", []] }, 
                                  as: "source", 
                                  cond: { 
                                    $or: [
                                      { $gt: [{ $size: { $ifNull: ["$$source.agricultureBusiness.agriculturePhotos", []] } }, 0] },
                                      { $gt: [{ $size: { $ifNull: ["$$source.milkBusiness.milkPhotos", []] } }, 0] },
                                      { $gt: [{ $size: { $ifNull: ["$$source.milkBusiness.animalPhotos", []] } }, 0] },
                                      { $gt: [{ $size: { $ifNull: ["$$source.salaryIncome.last3MonthSalarySlipPhotos", []] } }, 0] },
                                      { $gt: [{ $size: { $ifNull: ["$$source.salaryIncome.salaryPhotos", []] } }, 0] },
                                      { $ne: ["$$source.salaryIncome.bankStatementPhoto", null] },
                                      { $ne: ["$$source.salaryIncome.salaryCredited6Month", null] },
                                      { $gt: [{ $size: { $ifNull: ["$$source.other.incomeOtherImages", []] } }, 0] }
                                    ]
                                  }
                                }
                              }
                            }, 
                            0
                          ]
                        }
                      ]
                    },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                camReport: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.camReport", null] },
                    then: "Yes",
                    else: "No"
                  }
                }
              },
              disbursmentCheckList: {
                dualNameDeclaration: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.dualNameDeclaration", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                dualSignDeclaration: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.dualSignDeclaration", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                dualDoBDeclaration: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.dualDoBDeclaration", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                applicantPDC: {
                  $cond: {
                    if: { $ifNull: ["$appPdcData.applicantPdcDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                guarantorPDC: {
                  $cond: {
                    if: { $ifNull: ["$gtrPdcData.guarantorPdcDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                applicantBSV: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.applicantBSV", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                guarantorBSV: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.guarantorBSV", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                coOwnershipDeed: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.coOwnershipDeed", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                eStampUpload: {
                  $cond: {
                    if: { 
                      $gt: [
                        { 
                          $size: { 
                            $reduce: {
                              input: { $ifNull: ["$disbursementData.estampRequirement", []] },
                              initialValue: [],
                              in: { $concatArrays: ["$$value", { $ifNull: ["$$this.eStampUpload", []] }] }
                            }
                          }
                        },
                        0
                      ]
                    },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                insuranceForm: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.insuranceForm", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                emOrRmDeed: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.emOrRmDeed", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                finalLegal: {
                  $cond: {
                    if: { $ifNull: ["$legalVendor.finalLegalUpload", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                vettingReport: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.vettingReport", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                nachLink: {
                            $cond: {
                              if: { $ifNull: ["$bankStatementData.Nachlink", null] },
                              then: "Yes",
                              else: "No"
                  }
                },
                
                eNachLinkSignUpload: {
                  $cond: {
                    if: { $ifNull: ["$disbursementData.eNachLinkSignUpload", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                eSignatureDocuments: {
                  $cond: {
                    if: { $ifNull: ["$disbursementData.eSignatureDocuments", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                appKycDocument: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.appKycDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                coAppKycDocument: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.coAppKycDocument", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                stampPdf: {
                  $cond: {
                    if: { $ifNull: ["$loanDocumentData.stampPdf", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                sanctionZipUrl: {
                  $cond: {
                    if: { $ifNull: ["$finalData.sanctionZipUrl", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                disbursementZipUrl: {
                  $cond: {
                    if: { $ifNull: ["$finalData.disbursementZipUrl", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                incomeSectionLatterUrl: {
                  $cond: {
                    if: { $ifNull: ["$finalData.incomesectionLatterUrl", null] },
                    then: "Yes",
                    else: "No"
                  }
                },
                
                esignLinks: {
                  $cond: {
                    if: { $ifNull: ["$esignLinks", null] },
                    then: "Yes",
                    else: "No"
                  }
                }
              }
            }
          },
          
          // Count total documents for pagination
          {
            $facet: {
              totalCount: [{ $count: "count" }],
              paginatedResults: [
                { $skip: skip },
                { $limit: limit }
              ]
            }
          },
          
          // Format the final output
          {
            $project: {
              data: "$paginatedResults",
              pagination: {
                currentPage: { $literal: page },
                totalPages: {
                  $ceil: {
                    $divide: [
                      { $arrayElemAt: ["$totalCount.count", 0] },
                      limit
                    ]
                  }
                },
                totalCustomers: { $arrayElemAt: ["$totalCount.count", 0] },
                limit: { $literal: limit }
              }
            }
          }
        ];
    
        // Execute the aggregation pipeline
        const results = await externalVendorFormModel.aggregate(aggregationPipeline);
        
        // Format the output and handle edge cases
        const paginationInfo = {
          currentPage: page,
          totalPages: results[0]?.pagination?.totalPages || 0,
          totalCustomers: results[0]?.pagination?.totalCustomers || 0,
          limit: limit
        };
        
        return success(res, "All Document For Dashboard Successfully", {
          data: results[0]?.data || [],
          pagination: paginationInfo
        });
        
 
  } catch (error) {
    console.error('Error in overAllDashboard:', error);
    return unknownError(res, error);
  }
}

// ------------fileStatus, hoRemark, responsibility, partnerPending  given fields updated---------------------
// async function updateStatusApi(req, res) { 
//   try {
//       const { customerId, fileStatus, responsibility, hoRemark, partnerPending } = req.body;
//       // const finalDetail = await final.findOne({customerId:customerId})
//       if (!customerId) {
//           return badRequest(res, "customerId is required");
//       }

//       // Create an update object with only provided fields
//       let update = {};
//       if (fileStatus !== undefined) update.fileStatus = fileStatus;
//       if (responsibility !== undefined) update.responsibility = responsibility;
//       if (hoRemark !== undefined) update.hoRemark = hoRemark;
//       if (partnerPending !== undefined) update.partnerPending = partnerPending;

//       const fileStageDetail = await final.findOneAndUpdate(
//           { customerId },
//           { $set: update },
//           { new: true }
//       );

//       if (!fileStageDetail) {
//           return notFound(res, "Final Sanction Detail Not Found For The Given customerId");
//       }

//       // Response with updated fields
//       const responseData = {
//           customerId: fileStageDetail.customerId,
//           fileStatus: fileStageDetail.fileStatus,
//           responsibility: fileStageDetail.responsibility,
//           hoRemark: fileStageDetail.hoRemark,
//           partnerPending: fileStageDetail.partnerPending
//       };

//       success(res, "Status updated successfully", responseData);
//   } catch (error) {
//       console.error(error);
//       unknownError(res, error);
//   }
// }
async function updateStatusApi(req, res) { 
  try {
      const { customerId, fileStatus, responsibility, hoRemark, partnerPending } = req.body;

      if (!customerId) {
          return badRequest(res, "customerId is required");
      }

      // Create an update object with only provided fields
      let update = {};
      if (fileStatus !== undefined) update.fileStatus = fileStatus;
      if (responsibility !== undefined) update.responsibility = responsibility;
      if (hoRemark !== undefined) update.hoRemark = hoRemark;
      if (partnerPending !== undefined) update.partnerPending = partnerPending;

      // Find and update OR create if not exists
      const fileStageDetail = await final.findOneAndUpdate(
          { customerId },
          { $set: update },
          { new: true, upsert: true } // `upsert: true` creates if not found
      );

      // Response with updated or newly created fields
      const responseData = {
          customerId: fileStageDetail.customerId,
          fileStatus: fileStageDetail.fileStatus,
          responsibility: fileStageDetail.responsibility,
          hoRemark: fileStageDetail.hoRemark,
          partnerPending: fileStageDetail.partnerPending
      };

      success(res, fileStageDetail.isNew ? "New entry created successfully" : "Status updated successfully", responseData);
  } catch (error) {
      console.error(error);
      unknownError(res, error);
  }
}

const camDropDown = async (req, res) => {
  try {
    const { customerId, ID, applicantType } = req.query; // Added `applicantType`

    if (!customerId) {
      return badRequest(res, "Customer ID is required");
    }

    const applicant = await applicantModel.findOne({ customerId });
    const coApplicants = await coApplicantModel.find({ customerId });
    const pdformdatasDetail = await creditPdModel.findOne({ customerId });
    const pdformdata = await creditPdModel.findOne({ customerId });
    // Construct applicant data
    let applicantData = [];
    if (applicant) {
      applicantData.push({
        fullName: applicant.fullName || "",
        fatherName: applicant.fatherName || "",
        age: applicant.age || "",
        district: applicant?.localAddress?.district || "",
        Relationship: "Self",
        _id: applicant._id,
      });
    }

    // Construct co-applicant data
    const coApplicantsData = coApplicants.map((coApp, index) => ({
      fullName: coApp.fullName,
      fatherName: coApp.fatherName,
      age: coApp.age || "",
      RelationshipWithMember: coApp.relationWithApplicant || "",
      _id: coApp._id,
    }));

    const finalModelData = await finalModel.findOne({ customerId });

    const Calculation = {
      Amount: finalModelData?.finalLoanAmount || "",
      Tenure: finalModelData?.tenureInMonth
        ? (Math.round((finalModelData.tenureInMonth / 12) * 10) / 10).toFixed(1)
        : ""
    };

    // If applicantType is passed, filter data accordingly
    let responseData = [];
    if (applicantType == "applicant") {
      responseData = applicantData; // Only applicant data
    } else if (applicantType == "coapplicant") {
      responseData = coApplicantsData; // Only co-applicant data
    } else {
      responseData = [...applicantData, ...coApplicantsData]; // Both if no filter applied
    }

    // If ID is passed, filter specific applicant or co-applicant
    if (ID) {
      const filteredPerson = responseData.find(person => person._id == ID);
      if (!filteredPerson) {
        return notFound(res, "Person details not found.");
      }
      return success(res, "Person details fetched successfully.", {
        data: [filteredPerson]
      });
    }

    return success(res, "Detailed dropdown names fetched successfully.", {
      data: responseData, // Filtered data based on applicantType
    });

  } catch (error) {
    console.error(error);
    return unknownError(res, error);
  }
};

async function getCamDetails(req, res) { 
  try {
      const { customerId } = req.query;

      if (!customerId) {
          return badRequest(res, "customerId is required");
      }

      const creditPdData = await creditPdModel.findOne({ customerId });

      let agriData;
      let milkData;
      let salaryData;
      let otherData;

      if (
        creditPdData?.incomeSource?.some(
          (src) => src?.incomeSourceType === "agricultureBusiness"
        )
      ) {
        agriData =
          creditPdData?.incomeSource?.find(
            (src) => src?.incomeSourceType === "agricultureBusiness"
          )?.agricultureBusiness ?? {};
        // console.log("Agriculture Business Data:", agriData);
      }

      if (
        creditPdData?.incomeSource?.some(
          (src) => src?.incomeSourceType === "milkBusiness"
        )
      ) {
        milkData =
          creditPdData?.incomeSource?.find(
            (src) => src?.incomeSourceType === "milkBusiness"
          )?.milkBusiness ?? {};
        // console.log("Milk Business Data:", milkData);
      }

      if (
        creditPdData?.incomeSource?.some(
          (src) => src?.incomeSourceType === "salaryIncome"
        )
      ) {
        salaryData =
          creditPdData?.incomeSource?.find(
            (src) => src?.incomeSourceType === "salaryIncome"
          )?.salaryIncome ?? {};
        // console.log("Salary Income Data:", salaryData);
      }

      if (
        creditPdData?.incomeSource?.some(
          (src) => src?.incomeSourceType === "other"
        )
      ) {
        otherData =
          creditPdData?.incomeSource?.find(
            (src) => src?.incomeSourceType === "other"
          )?.other ?? {};
        // console.log("Other Income Data:", otherData);
      }
      // Find and update OR create if not exists
      const fileStageDetail = await final.findOne({ customerId });

      // Response with updated or newly created fields
      const responseData = {
         agricultureIncomeNew:{
          ownerDetails: fileStageDetail?.agricultureIncomeNew?.ownerDetails || [],
          details: fileStageDetail?.agricultureIncomeNew?.details || [],
          totalNetAnnualIncome: fileStageDetail?.agricultureIncomeNew?.totalNetAnnualIncome || "",
          totalNetMonthlyIncome: fileStageDetail?.agricultureIncomeNew?.totalNetMonthlyIncome || "",
          noOfAgricultureOwner: fileStageDetail?.agricultureIncomeNew?.noOfAgricultureOwner || "",
          lastCropDetail: fileStageDetail?.agricultureIncomeNew?.lastCropDetail || "",
          agriDocument: fileStageDetail?.agricultureIncomeNew?.agriDocument || [],
          serveyNoAgriculture: agriData?.agriLandSurveyNo || "",
          yearOfDoingAgriculture: agriData?.agriDoingFromNoOfYears || ""
         },
         milkIncomeCalculationNew:{
          details: fileStageDetail?.milkIncomeCalculationNew?.details || [],
          averageSaleOfMilk: fileStageDetail?.milkIncomeCalculationNew?.averageSaleOfMilk || "",
          totalNetMonthlyIncomeAsPerSales: fileStageDetail?.milkIncomeCalculationNew?.totalNetMonthlyIncomeAsPerSales || "",
          totalNetAnnualIncomeAsPerSales: fileStageDetail?.milkIncomeCalculationNew?.totalNetAnnualIncomeAsPerSales || "",
          totalNetMonthlyIncomeAsPerCattle: fileStageDetail?.milkIncomeCalculationNew?.totalNetMonthlyIncomeAsPerCattle || "",
          totalNetAnnualIncomeAsPerCattle: fileStageDetail?.milkIncomeCalculationNew?.totalNetAnnualIncomeAsPerCattle || "",
          milkIncomeInTheNameOf: fileStageDetail?.milkIncomeCalculationNew?.milkIncomeInTheNameOf || "",
          milkDocument: fileStageDetail?.milkIncomeCalculationNew?.milkDocument || [],
          numberOfCattrels : milkData?.noOfMilkGivingCattles || "",
          totalMilkSupplyPerDay : milkData?.totalMilkSupplyPerDay || "",
          doingFromNoOfYears: milkData?.doingFromNoOfYears || "",
          nameOfDairy: milkData?.nameOfDairy || "",
          dairyAddress: milkData?.dairyAddress || "",
          dairyOwnerMobNo: milkData?.dairyOwnerMobNo || "",
          milkprovideFromSinceYear : milkData?.milkprovideFromSinceYear || ""
         },
         otherIncomeNew:fileStageDetail?.otherIncomeNew || {},
         netCalculationNew:fileStageDetail?.netCalculationNew || {},
      };

      success(res,"can details successfully fetched", responseData);
  } catch (error) {
      console.error(error);
      unknownError(res, error);
  }
}


async function updateCamDetails(req, res) { 
  try {
    const { customerId, agricultureIncomeNew, milkIncomeCalculationNew,otherIncomeNew,netCalculationNew } = req.body;

    if (!customerId) {
      return badRequest(res, "customerId is required");
    }

    // Find and update the agricultureBusiness inside incomeSource array
   
    if(agricultureIncomeNew && Object.keys(agricultureIncomeNew).length > 0){

      await creditPdModel.findOneAndUpdate(
        {
          customerId,
          "incomeSource.incomeSourceType": "agricultureBusiness"
        },
        {
          $set: {
            "incomeSource.$.agricultureBusiness.agriLandSurveyNo": agricultureIncomeNew?.serveyNoAgriculture || "",
            "incomeSource.$.agricultureBusiness.agriDoingFromNoOfYears": agricultureIncomeNew?.yearOfDoingAgriculture || ""
          }
        },
        { new: true }
      ).then(async (result) => {
        if (!result) {
          console.log("agricultureBusiness not found, adding new entry...");
    
          // If no document exists, push a new agricultureBusiness entry
          await creditPdModel.findOneAndUpdate(
            { customerId },
            {
              $push: {
                incomeSource: {
                  incomeSourceType: "agricultureBusiness",
                  agricultureBusiness: {
                    agriLandSurveyNo: agricultureIncomeNew?.serveyNoAgriculture || "",
                    agriDoingFromNoOfYears: agricultureIncomeNew?.yearOfDoingAgriculture || ""
                  }
                }
              }
            },
            { new: true }
          );
        }
      });
    }
   
    if(milkIncomeCalculationNew && Object.keys(milkIncomeCalculationNew).length > 0){
      console.log("in if condition<<>>><<>>")
      await creditPdModel.findOneAndUpdate(
        {
          customerId,
          "incomeSource.incomeSourceType": "milkBusiness"
        },
        {
          $set: {
            "incomeSource.$.milkBusiness.noOfMilkGivingCattles": milkIncomeCalculationNew?.numberOfCattrels,
            "incomeSource.$.milkBusiness.totalMilkSupplyPerDay": milkIncomeCalculationNew?.totalMilkSupplyPerDay,
            "incomeSource.$.milkBusiness.doingFromNoOfYears": milkIncomeCalculationNew?.doingFromNoOfYears,
            "incomeSource.$.milkBusiness.nameOfDairy": milkIncomeCalculationNew?.nameOfDairy,
            "incomeSource.$.milkBusiness.dairyAddress": milkIncomeCalculationNew?.dairyAddress,
            "incomeSource.$.milkBusiness.dairyOwnerMobNo": milkIncomeCalculationNew?.dairyOwnerMobNo,
            "incomeSource.$.milkBusiness.milkprovideFromSinceYear": milkIncomeCalculationNew?.milkprovideFromSinceYear
          }
        },
        { new: true }
      ).then(async (result) => {
        if (!result) {
          // If no matching document is found, push new milkBusiness entry
          await creditPdModel.findOneAndUpdate(
            { customerId },
            {
              $push: {
                incomeSource: {
                  incomeSourceType: "milkBusiness",
                  milkBusiness: {
                    numberOfCattrels: milkIncomeCalculationNew?.numberOfCattrels,
                    totalMilkSupplyPerDay: milkIncomeCalculationNew?.totalMilkSupplyPerDay,
                    doingFromNoOfYears: milkIncomeCalculationNew?.doingFromNoOfYears,
                    nameOfDairy: milkIncomeCalculationNew?.nameOfDairy,
                    dairyAddress: milkIncomeCalculationNew?.dairyAddress,
                    dairyOwnerMobNo: milkIncomeCalculationNew?.dairyOwnerMobNo,
                    milkprovideFromSinceYear: milkIncomeCalculationNew?.milkprovideFromSinceYear
                  }
                }
              }
            },
            { new: true }
          );
        }
      });
      
    }

    let agriData = {};
    let milkData = {};
    let salaryData = {};
    let otherData = {};

   const creditPdData = await creditPdModel.findOne({ customerId })

    if (creditPdData) {
      agriData = creditPdData.incomeSource.find(src => src.incomeSourceType === "agricultureBusiness")?.agricultureBusiness || {};
      milkData = creditPdData.incomeSource.find(src => src.incomeSourceType === "milkBusiness")?.milkBusiness || {};
      salaryData = creditPdData.incomeSource.find(src => src.incomeSourceType === "salaryIncome")?.salaryIncome || {};
      otherData = creditPdData.incomeSource.find(src => src.incomeSourceType === "other")?.other || {};
    }
    // console.log(milkData,"milkDatamilkData<><><>",creditPdData)
    // Find and update OR create if not exists
    const fileStageDetail = await final.findOneAndUpdate(
      { customerId },
      { $set: { agricultureIncomeNew,milkIncomeCalculationNew,otherIncomeNew,netCalculationNew } },
      { new: true, upsert: true }
    );

    // Response with updated or newly created fields
    const responseData = {
      agricultureIncomeNew: {
        ownerDetails: fileStageDetail?.agricultureIncomeNew?.ownerDetails || [],
        details: fileStageDetail?.agricultureIncomeNew?.details || [],
        totalNetAnnualIncome: fileStageDetail?.agricultureIncomeNew?.totalNetAnnualIncome || "",
        totalNetMonthlyIncome: fileStageDetail?.agricultureIncomeNew?.totalNetMonthlyIncome || "",
        noOfAgricultureOwner: fileStageDetail?.agricultureIncomeNew?.noOfAgricultureOwner || "",
        lastCropDetail: fileStageDetail?.agricultureIncomeNew?.lastCropDetail || "",
        agriDocument: fileStageDetail?.agricultureIncomeNew?.agriDocument || "",
        serveyNoAgriculture: agriData?.agriLandSurveyNo || "",
        yearOfDoingAgriculture: agriData?.agriDoingFromNoOfYears || ""
      },
      milkIncomeCalculationNew:{
        details: fileStageDetail?.milkIncomeCalculationNew?.details || [],
        averageSaleOfMilk: fileStageDetail?.milkIncomeCalculationNew?.averageSaleOfMilk || "",
        totalNetMonthlyIncomeAsPerSales: fileStageDetail?.milkIncomeCalculationNew?.totalNetMonthlyIncomeAsPerSales || "",
        totalNetAnnualIncomeAsPerSales: fileStageDetail?.milkIncomeCalculationNew?.totalNetAnnualIncomeAsPerSales || "",
        totalNetMonthlyIncomeAsPerCattle: fileStageDetail?.milkIncomeCalculationNew?.totalNetMonthlyIncomeAsPerCattle || "",
        totalNetAnnualIncomeAsPerCattle: fileStageDetail?.milkIncomeCalculationNew?.totalNetAnnualIncomeAsPerCattle || "",
        milkIncomeInTheNameOf: fileStageDetail?.milkIncomeCalculationNew?.milkIncomeInTheNameOf || "",
        milkDocument: fileStageDetail?.milkIncomeCalculationNew?.milkDocument || "",
        numberOfCattrels : milkData?.noOfMilkGivingCattles || "",
        totalMilkSupplyPerDay : milkData?.totalMilkSupplyPerDay || "",
        doingFromNoOfYears: milkData?.doingFromNoOfYears || "",
        nameOfDairy: milkData?.nameOfDairy || "",
        dairyAddress: milkData?.dairyAddress || "",
        dairyOwnerMobNo: milkData?.dairyOwnerMobNo || "",
        milkprovideFromSinceYear : milkData?.milkprovideFromSinceYear || ""
       },
       otherIncomeNew:fileStageDetail?.otherIncomeNew || {},
       netCalculationNew:fileStageDetail?.netCalculationNew || {},

    };

    success(res, "CAM details successfully updated", responseData);
  } catch (error) {
    console.error(error);
    unknownError(res, error);
  }
}

const newfinalMainDashboard = async (req, res) => {
  try {
    console.time();
    const empId = new mongoose.Types.ObjectId(req.Id);
    const { pageLimit, pageNumber, search, type, selfId } = req.query;
    const { offset, limit } = paginationData(pageLimit, pageNumber);

    // Build search filter
    const searchFilter = {};
    if (search) {
      searchFilter.$or = [
        { "nearestBranchData.name": { $regex: search, $options: "i" } },
        { "applicantDetail.fullName": { $regex: search, $options: "i" } },
        { customerFinId: { $regex: search, $options: "i" } },
        {
          $expr: {
            $regexMatch: {
              input: { $toString: "$mobileNo" },
              regex: search,
              options: "i",
            },
          },
        },
      ];
    }

    // Aggregation pipeline
    const userData = await customerModel.aggregate([
      {
        $lookup: {
          from: "pdformdatas",
          localField: "_id",
          foreignField: "customerId",
          as: "pdData",
        },
      },
      {
        $addFields: {
          pdData: { $arrayElemAt: ["$pdData", 0] },
        },
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "_id",
          foreignField: "customerId",
          as: "finalSanctionData",
        },
      },
      {
        $addFields: {
          finalSanctionData: { $arrayElemAt: ["$finalSanctionData", 0] },
        },
      },
      {
        $match: {
          $and: [
            { "finalSanctionData.finalSenctionFileSelfAssign": true },
            type === "Ho"
              ? { "finalSanctionData.employeeId": new ObjectId(empId) }
              : { "finalSanctionData.branchSelfAssignEmpId": new ObjectId(empId) },
          ],
        },
      },
      {
        $lookup: {
          from: "products",
          localField: "productId",
          foreignField: "_id",
          as: "productData",
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "employeId",
          foreignField: "_id",
          as: "employeeDetail",
        },
      },
      {
        $lookup: {
          from: "employees",
          localField: "employeeDetail.reportingManagerId",
          foreignField: "_id",
          as: "salesManagerDetails",
        },
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "employeeDetail.branchId",
          foreignField: "_id",
          as: "nearestBranchData",
        },
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "_id",
          foreignField: "customerId",
          as: "applicantDetail",
        },
      },
      {
        $lookup: {
          from: "cibildetails",
          localField: "_id",
          foreignField: "customerId",
          as: "cibildetailDetail",
        },
      },
      {
        $addFields: {
          productData: { $arrayElemAt: ["$productData", 0] },
          employeeDetail: { $arrayElemAt: ["$employeeDetail", 0] },
          salesManagerDetails: { $arrayElemAt: ["$salesManagerDetails", 0] },
          nearestBranchData: { $arrayElemAt: ["$nearestBranchData", 0] },
          applicantDetail: { $arrayElemAt: ["$applicantDetail", 0] },
          cibildetailDetail: { $arrayElemAt: ["$cibildetailDetail", 0] },
        },
      },
      {
        $project: {
          _id: 1,
          employeId: 1,
          productId: 1,
          customerFinId: 1,
          mobileNo: 1,
          loanAmount: 1,
          roi: 1,
          tenure: 1,
          emi: 1,
          executiveName: 1,
          createdAt: 1,
          updatedAt: 1,
          "applicantDetail.fullName": 1,
          "applicantDetail.fatherName": 1,
          "applicantDetail.mobileNo": 1,
          "applicantDetail.applicantPhoto": 1,
          "applicantDetail.applicantAddress":
            "$applicantDetail.permanentAddress.addressLine1",
          "cibildetailDetail.applicantCibilScore": 1,
          "nearestBranchData.name": 1,
          "productData.productName": 1,
          "employeeDetail.employeName": 1,
          "employeeDetail.userName": 1,
          "employeeDetail.employeUniqueId": 1,
          "salesManagerDetails.employeName": 1,
          "salesManagerDetails.employeUniqueId": 1,
          "salesManagerDetails.userName": 1,
          tvrDetails: {
            income: "7%",
            propertyValue: "50L",
            foir: "30%",
            ltv: "9%",
          },
        },
      },
      { $match: searchFilter },
      {
        $facet: {
          paginatedResults: [{ $skip: offset }, { $limit: limit }],
          totalCount: [{ $count: "count" }],
        },
      },
    ]);

    const totalCount = userData[0].totalCount[0]?.count || 0;
    const paginatedResults = userData[0].paginatedResults;
    console.timeEnd();

    return success(res, "All customer details List", {
      totalCount,
      userDataLength: paginatedResults.length,
      userData: paginatedResults,
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
};

const addRatnaEsignLink = async (req,res) =>{
  try{
    const { pasteEsignDocument, customerId } = req.body
    const data = await final.findOneAndUpdate(
      {customerId },
      {
        $set:{
          pasteEsignDocument
        }
      },
      {
        new:true
      }
    )
    return success(res, "link paste successfully", {
      data:data?.pasteEsignDocument || {}
    });
  } catch (error) {
    console.log(error);
    return unknownError(res, error);
  }
}

//newFileManagementDashbord

const newFileManagementDashbord = async (req, res) => {
  try {
    const {
      regionalBranch,
      branch,
      product,
      hoSelfAssign,
      branchSelfAssign,
      startDateFilter,
      endDateFilter,
      finalApproverStatus,
      fileProcessStatus,
      pageLimit = 10000,
      pageNumber = 1,
      searchQuery,
      sanctionStage,
      status, // Status filter parameter
      responsibility, // Added responsibility filter
    } = req.query;

    const employeeId = req.Id;

    const activeVendors = await vendorTypeModel.find({ status: "active" }).select("vendorType");
    const vendorTypes = activeVendors.map(v => v.vendorType);
    // Basic validation
    const employeeExist = await employeModel
      .findOne({ _id: employeeId, status: "active" }, { _id: 1 })
      .lean();

    if (!employeeExist) {
      return badRequest(res, "Employee Not Found");
    }

    const today = new Date();
    const defaultStartDate = new Date(today.setHours(0, 0, 0, 0));
    const defaultEndDate = new Date(today.setHours(23, 59, 59, 999));

    function formatDateToISO(date) {
      return new Date(date).toISOString();
    }

    let formattedStart = startDateFilter && startDateFilter !== "all"
      ? new Date(new Date(startDateFilter).setHours(0, 0, 0, 0))
      : defaultStartDate;

    let formattedEnd = endDateFilter && endDateFilter !== "all"
      ? new Date(new Date(endDateFilter).setHours(23, 59, 59, 999))
      : defaultEndDate;

    if (startDateFilter && endDateFilter && startDateFilter === endDateFilter) {
      formattedStart = new Date(new Date(startDateFilter).setHours(0, 0, 0, 0));
      formattedEnd = new Date(new Date(startDateFilter).setHours(23, 59, 59, 999));
    }

    formattedStart = formatDateToISO(formattedStart);
    formattedEnd = formatDateToISO(formattedEnd);

    // Define status map for exact matching
    const statusMap = {
      "PD DONE": "pd done",
      "UNDER PROCESS": "under process",
      "INCOME SANCTION": "income sanction",
      "SANCTION": "sanction",
      "FINAL QUERY": "final query",
      "RTD": "rtd",
      "DISBURSED": "disbursed",
      "PARTIAL DISBURSED": "partial disbursed",
      "HOLD": "hold",
      "REJECT": "reject"
    };

    // Get normalized status for matching if provided
    let normalizedStatusFilter = null;
    if (status && status !== "all") {
      // Look for an exact match in the status keys (case insensitive)
      const statusKey = Object.keys(statusMap).find(
        key => key.toLowerCase() === status.toLowerCase()
      );
      
      if (statusKey) {
        normalizedStatusFilter = statusMap[statusKey];
      } else {
        // If not found in our mapping, just use the provided status in lowercase
        normalizedStatusFilter = status.toLowerCase();
      }
    }

    // Normalize responsibility for case-insensitive matching
    let normalizedResponsibility = null;
    if (responsibility && responsibility !== "all") {
      normalizedResponsibility = responsibility.toLowerCase();
    }

    const initialPipeline = [
      // Initial basic match
      {
        $match: {
          fileStatus: "active",
          statusByCreditPd: { $in: ["complete", "approve"] }
        }
      },
      
      // Only lookup what's needed for filtering
      {
        $lookup: {
          from: "customerdetails",
          localField: "customerId",
          foreignField: "_id",
          as: "customerDetailData"
        }
      },
      { 
        $unwind: { 
          path: "$customerDetailData",
          preserveNullAndEmptyArrays: true 
        }
      },
      {
        $lookup: {
          from: "products",
          localField: "customerDetailData.productId",
          foreignField: "_id",
          as: "productData"
        }
      },
      {
        $unwind: {
          path: "$productData",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "customerDetailData.branch",
          foreignField: "_id",
          as: "newbranchesData"
        }
      },
      {
        $unwind: {
          path: "$newbranchesData",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "newbranches",
          localField: "branchDetails.regionalBranchId",
          foreignField: "_id",
          as: "regionalBranchDetails"
        }
      },
      {
        $unwind: {
          path: "$regionalBranchDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "applicantdetails",
          localField: "customerId",
          foreignField: "customerId",
          as: "applicantDetails"
        }
      },
      {
        $unwind: {
          path: "$applicantDetails",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "finalsanctiondetaails",
          localField: "customerId",
          foreignField: "customerId",
          as: "finalsanctionData"
        }
      },
      {
        $unwind: {
          path: "$finalsanctionData",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "lenders",
          localField: "finalsanctionData.partnerId",
          foreignField: "_id",
          as: "partnerDetailData"
        }
      },
      {
        $unwind: {
          path: "$partnerDetailData",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "internallegals",
          localField: "customerId",
          foreignField: "customerId",
          as: "loanTypeDetail"
        }
      },
      {
        $unwind: {
          path: "$loanTypeDetail",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "pdformdatas",
          localField: "customerId",
          foreignField: "customerId",
          as: "creditPdData"
        }
      },
      {
        $unwind: {
          path: "$creditPdData",
          preserveNullAndEmptyArrays: true
        }
      },
      {
        $lookup: {
          from: "externalvendordynamics",
          localField: "customerId",
          foreignField: "customerId",
          as: "externalvendordynamicData"
        }
      },
      {
        $unwind: {
          path: "$externalvendordynamicData",
          preserveNullAndEmptyArrays: true
        }
      },
      // Apply all filters 
      {
        $match: {
          $and: [
            // Search query
            searchQuery ? {
              $or: [
                { "applicantDetails.mobileNo": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fullName": { $regex: searchQuery, $options: "i" } },
                { "applicantDetails.fatherName": { $regex: searchQuery, $options: "i" } },
                { "customerDetailData.customerFinId": { $regex: searchQuery, $options: "i" } }
              ]
            } : {},

            // Branch filter - FIXED
            branch && branch !== "all" ? {
              "customerDetailData.branch": new ObjectId(branch)
            } : {},

            // Regional branch filter
            regionalBranch && regionalBranch !== "all" ? {
              "regionalBranchDetails._id": {
                $in: (Array.isArray(regionalBranch) ? regionalBranch : regionalBranch.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},

            // Product filter
            product && product !== "all" ? {
              "customerDetailData.productId": {
                $in: (Array.isArray(product) ? product : product.split(","))
                  .map(id => new ObjectId(id))
              }
            } : {},
            // File Status filter - UPDATED for exact matching
            normalizedStatusFilter
            ? {
                $expr: {
                  $eq: [
                    { $toLower: "$finalsanctionData.fileStatus" },
                    normalizedStatusFilter
                  ]
                }
              }
            : {},

            // Responsibility filter
            normalizedResponsibility
            ? {
                $expr: {
                  $eq: [
                    { $toLower: "$finalsanctionData.responsibility" },
                    normalizedResponsibility
                  ]
                }
              }
            : {},

            startDateFilter && endDateFilter && startDateFilter !== "all" && endDateFilter !== "all"? {
              creditPdCompleteDate: {
                $gte: formattedStart,
                $lt: formattedEnd,
              }
            }:{},
                        
            // Exclude specific products when no product filter
            (!product || product === "all") ? {
              "customerDetailData.productId": {
                $nin: [].map(id => new ObjectId(id))
              }
            } : {}
          ].filter(condition => Object.keys(condition).length > 0)
        }
      },

      {
        $addFields: {
          customerFinId: "$customerDetailData.customerFinId",
          loginDate: "$customerDetailData.paymentDate",
          loginTat: {
            $let: {
              vars: {
                caDate: { $toDate: "$customerDetailData.paymentDate" },
                today: { $toDate: "$$NOW" }
              },
              in: {
                $cond: {
                  if: { $not: ["$$caDate"] },
                  then: null,
                  else: {
                    $ceil: {
                      $divide: [
                        {
                          $subtract: [
                            { $dateTrunc: { date: "$$today", unit: "day" } },
                            { $dateTrunc: { date: "$$caDate", unit: "day" } }
                          ]
                        },
                        86400000
                      ]
                    }
                  }
                }
              }
            }
          },
          productId: "$productData._id",
          productName: "$productData.productName",
          branchId: "$newbranchesData._id",
          branchName: "$newbranchesData.name",
          fileStatus: "$finalsanctionData.fileStatus",
          responsibility: "$finalsanctionData.responsibility",
          hoRemark: "$finalsanctionData.hoRemark",
          esignLinks: {
            $cond: {
              if: {
                $and: [
                  { $ne: ["$finalsanctionData.signEsignLink", null] },
                  { $ne: ["$finalsanctionData.signEsignLink", {}] },
                  { $gt: [{ $size: { $objectToArray: { $ifNull: ["$finalsanctionData.signEsignLink", {}] } } }, 0] }
                ]
              },
              then: "$finalsanctionData.signEsignLink",
              else: "$finalsanctionData.esignLinks"
            }
          },
          partnerName: "$partnerDetailData.fullName",
          partnerPending: "$finalsanctionData.partnerPending",
          loanType: { $ifNull: ["$loanTypeDetail.LoanType", ""] },
          emiAmount: { $ifNull: ["$loanTypeDetail.emiAmount", ""] },
          roi: { $ifNull: ["$loanTypeDetail.roi", ""] },
          tenure: { $ifNull: ["$loanTypeDetail.tenureInMonth", ""] },
          finalLoanAmount: { $ifNull: ["$loanTypeDetail.finalLoanAmount", ""] },
          mobileNo: { $ifNull: ["$applicantDetails.mobileNo", ""] },
          fatherName: { $ifNull: ["$applicantDetails.fatherName", ""] },
          fullName: { $ifNull: ["$applicantDetails.fullName", ""] }, //creditPdData
          cibilOkDate: { $ifNull: ["$externalvendordynamicData.createdAt", ""] },
          pdTat: {
            $let: {
              vars: {
                caDate: { $toDate: "$externalvendordynamicData.createdAt" },
                today: { $toDate: "$$NOW" }
              },
              in: {
                $cond: {
                  if: { $not: ["$$caDate"] },
                  then: null,
                  else: {
                    $ceil: {
                      $divide: [
                        {
                          $subtract: [
                            { $dateTrunc: { date: "$$today", unit: "day" } },
                            { $dateTrunc: { date: "$$caDate", unit: "day" } }
                          ]
                        },
                        86400000
                      ]
                    }
                  }
                }
              }
            }
          },
          
        }
      },
    
      // Project needed fields
      {
        $project: {
          _id: 1,
          customerId: 1,
          customerFinId: 1,
          loginDate: 1,
          loginTat:1,
          productId: 1,
          productName: 1,
          branchName: 1,
          branchId: 1,
          fileStatus: 1,
          responsibility: 1,
          hoRemark: 1,
          partnerPending:1,
          loanType:1,
          fullName:1,
          fatherName:1,
          mobileNo:1,
          cibilOkDate:1,
          pdTat:1,
          partnerName:1,
          esignLinks: {
            $cond: {
              if: { $ifNull: ["$esignLinks", null] },
              then: "Yes",
              else: "No"
            }
          },
          emiAmount:1,
          roi:1,
          tenure:1,
          finalLoanAmount:1
        }
      }
    ];

    //lead management 
  //  add product setup - feature
    // Execute the initial pipeline to get filtered customer IDs
    const filteredCustomers = await externalVendorFormModel
      .aggregate(initialPipeline)
      .allowDiskUse(true);

    // For counting, we'll use the updated statusMap format
    const statusCounts = {};
    Object.keys(statusMap).forEach(status => {
      statusCounts[status] = 0;
    });

    // Count files by status (case-insensitive with exact matching)
    filteredCustomers.forEach(customer => {
      if (customer.fileStatus) {
        const normalizedStatus = customer.fileStatus.toLowerCase();
        
        for (const [statusKey, normalizedKey] of Object.entries(statusMap)) {
          if (normalizedStatus === normalizedKey) {
            statusCounts[statusKey]++;
            break;
          }
        }
      }
    });

    // Capturing any other statuses not explicitly defined
    const otherStatuses = {};
    filteredCustomers.forEach(customer => {
      if (customer.fileStatus) {
        const normalizedStatus = customer.fileStatus.toLowerCase();
        let matched = false;
        
        for (const normalizedKey of Object.values(statusMap)) {
          if (normalizedStatus === normalizedKey) {
            matched = true;
            break;
          }
        }
        
        if (!matched) {
          // This is a status we didn't account for
          const originalStatus = customer.fileStatus;
          otherStatuses[originalStatus] = (otherStatuses[originalStatus] || 0) + 1;
        }
      }
    });

    // Count by responsibility
    const responsibilityCounts = {
      "HO": 0,
      "Branch": 0,
      "Other": 0
    };

    filteredCustomers.forEach(customer => {
      if (customer.responsibility) {
        const normalizedResp = customer.responsibility.toLowerCase();
        if (normalizedResp === "ho") {
          responsibilityCounts["HO"]++;
        } else if (normalizedResp === "branch") {
          responsibilityCounts["Branch"]++;
        } else {
          responsibilityCounts["Other"]++;
        }
      }
    });

    return success(res, "customerDetails", {
      totalCount: filteredCustomers.length,
      statusCounts: statusCounts,
      otherStatusCounts: otherStatuses,
      responsibilityCounts: responsibilityCounts,
      filteredCustomers: filteredCustomers,
    });

  } catch (error) {
    console.error(error);
    return unknownError(res, error.message);
  }
};

module.exports = {
  customerLoanType,
  customerDetailsList,
  customerDetails,
  dealSummaryType,
  customerApplicantDetail,
  customerCoApplicantDetail,
  customerCoApplicantDetailold,
  customerGuarantorDetail,
  customerReferenceDetail,
  customerCibilDetail,
  customerbankDetail,
  customercollateralDetail,
  customerloanAgreementDetail,
  customercreditAndPdReportDetail,
  customerdueDiligenceReportDetail,
  partnerNameDetails,
  branchPendencyDetails,
  sanctionDetails,
  disbursementDetails,
  inventoryManagement,
  sendToPartner,
  addCibilDetails,
  updateCibilDetails,
  growMonetSendToPartner,
  excelSheetData,
  ratnaFinSendToPartner,
  ratnaFinGenerateEsign,
  growMoneySendToPartner,
  growMoneyGenerateEsign,
  allDocuments,
  getAllDocumentDashboard,
  uploadDocuments,
  addLoanDocuments,
  partnerDocumentRequest,
  uploadRequestDocument,
  requestDocumentList,
  addDocumetsList,
  uploadkycDocument,
  ratnaFinSendEmail,
  sanctionPendency,
  sanctionPendencyDetails,
  updateDocument,
  downloadSanctionDocument,
  sendToPartnernew,
  sendEmailToPartner,
  sendEmailToPartnerForEsign,
  sendEmailToCustomerForEsign,
  eSignGenerate,
  addOrUpdateGoogleSheetData,
  selectPartner,
  getPartnerDetails,
  addQuery,
  getQuery,
  addCoAppCibilDetails,
  // createCamReport,
  downloadCamReport,
  SelectSelection,
  IncomeSanctionsendToPartner,
  IncomeSanctionSendEmail,
  allLegalPdfs,
  dobsignnew,
  addSelfAssign,
  disbursementFormAdd,
  slefAssignList, 
  getAllEstampReq,
  eStampUploadApi,
  getPartnerDetailByCustomerId,
  eStampUploadApi,
  getPartnerDetailByCustomerId,
  getCustomerEsignDocument,
  getCustomerEsignUrl,
  updatePropertyDetails,
  RejectByHo,
  updateStatusByHo,
  dashbordCountUser,
  customerListFileProcess,
  testecustomerDetailsList,
  getDissionBox,
  DissionBox,
  getDissionBox,
  getEstampReq,
  signEsignDocument,
  signEsignDocumentDetails,
  deedpdfs,
  updateStatus,
  statusList,
  newUploadDocuments,
  generateLegalityDocument,
  webhookMethod,
  finalApprovalDashbord,
  secondWebhookMethod,
  documentLeegilatyDetails,
  getDashboardTableByEmployee,
  getDashboardDataByProduct,
  // sendToPartnernew1,
  disbursementEstampDelete,
  finalApprovalDashboardUpdate,
  finalApprovalFilterApi,
  testDigioApi,
  sendToBranch,
  sendToPartnerSanction,
  addDistanceOfMap,
  testDigioApi_done,
  uploadDocument,
  documentList,
  docGenerate,
  fileStageStatusUpdate,
  getFileStageForAllCustomers,
  addMortgageDetails,
  getMortgageDetails,
  reUploadDocument,
  customerAllData,
  updateLenderProduct,
  customerPolicyCheck,
  customerDocumentCheck,
  generateDocumentZip,
  finalMainDashboard,
  overAllDashboard,
  updateStatusApi,
  getCamDetails,
  updateCamDetails,
  camDropDown,
  newfinalMainDashboard,
  // createNewCamReport,
  PartnerValidation,
  uploadDocumentList,
  addRatnaEsignLink,
  finalMainDashboardMonthlyCount,
  newFileManagementDashbord
};
